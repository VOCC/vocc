(this.webpackJsonpgba_vocc_ts=this.webpackJsonpgba_vocc_ts||[]).push([[0],{21:function(e,t,a){e.exports=a(33)},32:function(e,t,a){},33:function(e,t,a){"use strict";a.r(t);var n,r,i=a(0),o=a.n(i),c=a(18),l=a.n(c),s=a(2),u=a.n(s),g=a(4),b=a(3),d={height:16,width:16},m=d.height*d.width;function h(e,t,a){switch(t){case 3:return f(e);case 4:return function(e,t){if(!t)return console.error("Tried to generate mode 4 header string with no palette! Falling back to mode 3..."),f(e);for(var a=e.fileName.slice(0,e.fileName.lastIndexOf(".")),n=e.dimensions.height*e.dimensions.width,r="const unsigned short ".concat(a,"Bitmap[").concat(n/2,"]__attribute__((aligned(4)))=\n{\n"),i=e.getImageData(),o="",c=0;c<i.length;c+=2)o+=E(i[c],i[c+1]),(c/2+1)%8===0&&(o+="\n");var l=function(e){for(var t="const unsigned short powPal["+m+"] __attribute__((aligned(4)))=\n{\n",a=1;a<=e.length;a++){var n=e[a-1];t+=C(n)+",",a%8===0&&(t+="\n"),a%64===0&&(t+="\n")}return t+"};"}(t);return r+o+"};\n\n"+l}(e,a);default:return f(e)}}function f(e){for(var t=e.fileName.slice(0,e.fileName.lastIndexOf(".")),a=e.dimensions.height*e.dimensions.width,n="const unsigned short ".concat(t,"Bitmap[").concat(a/2,"]__attribute__((aligned(4)))=\n{\n\t"),r=e.getImageData(),i="",o=0,c=0,l=r.length;c<l;c+=4){i+=x([r[c+2],r[c+1],r[c]])+",",++o%8===0&&(i+="\n",i+=o%64===0?"\n\t":"\t")}return n+i+"\n};\n"}function v(e,t){switch(t){case 3:return p(e);case 4:return function(e){var t=e.fileName,a=e.imageDimensions;if(!e.palette)return console.error("Tried to generate mode 4 header string with no palette! Falling back to mode 3..."),p({fileName:t,imageDimensions:a});var n=t.slice(0,t.lastIndexOf(".")),r=a.height*a.width,i="#define ".concat(n.toUpperCase(),"_SIZE ").concat(r,"\n"),o="#define ".concat(n.toUpperCase(),"_HEIGHT ").concat(a.height,"\n"),c="#define ".concat(n.toUpperCase(),"_WIDTH ").concat(a.width,"\n"),l="extern const unsigned short ".concat(n,"Bitmap[").concat(r/2,"];\n\n"),s="#define ".concat(n.toUpperCase(),"_PAL_SIZE ").concat(2*m,"\n"),u="extern const unsigned short ".concat(n,"Palette[").concat(m,"];\n\n");return i+o+c+l+s+u}(e);default:return console.warn("Attempting to generate header file for mode ".concat(t,", but it's unsupported for now. Defaulting to mode 3.")),p(e)}}function p(e){var t=e.fileName,a=e.imageDimensions,n=(e.palette,t.slice(0,t.lastIndexOf("."))),r=a.height*a.width,i=2*r,o="#define ".concat(n.toUpperCase(),"_SIZE ").concat(i,"\n");return"#define ".concat(n.toUpperCase(),"_LENGTH ").concat(r,"\n")+o+"#define ".concat(n.toUpperCase(),"_HEIGHT ").concat(a.height,"\n")+"#define ".concat(n.toUpperCase(),"_WIDTH ").concat(a.width,"\n")+"\n"+"extern const unsigned short ".concat(n,"Bitmap[").concat(r,"];\n\n")+"\n"}function E(e,t){(e>255||t>255)&&console.error("Tried to convert palette indices ".concat(e," and ").concat(t,", but at least one is out of range! Truncating bitwise..."));var a=((t&=255)|(e&=255)<<8).toString(16).toUpperCase().padStart(4,"0");return"0x".concat(a,", ")}function x(e){var t="0";e.forEach((function(e){for(var a=(e=Math.floor(32*e/256)).toString(2);a.length<5;)a="0"+a;t+=a}));for(var a=parseInt(t,2).toString(16);a.length<4;)a="0"+a;return"0x"+(a=a.toUpperCase())}function C(e){return x([e.b,e.g,e.r])}function w(e,t){return O.apply(this,arguments)}function O(){return(O=Object(g.a)(u.a.mark((function e(t,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a,e.next="BMP"===e.t0||"PNG"===e.t0?3:6;break;case 3:return e.next=5,t.getImageFileBlob();case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",new Blob(["Invalid file type"]));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.PENCIL=0]="PENCIL",e[e.BUCKET=1]="BUCKET",e[e.SQUARE=2]="SQUARE",e[e.ELLIPSE=3]="ELLIPSE",e[e.ZOOM=4]="ZOOM",e[e.PAN=5]="PAN",e[e.DROPPER=6]="DROPPER"}(n||(n={})),function(e){e.Bitmap="Bitmap",e.Spritesheet="Spritesheet",e.Background="Background"}(r||(r={}));var k=a(6),y=a(7),N=a(12),I=a(10),j=a(9),P=a(19),S=a(13),M=function(){function e(t,a,n){Object(k.a)(this,e),this.fileName=void 0,this.dimensions=void 0,this.imageData=void 0,this.imageCanvas=void 0,this.fileName=t,this.dimensions=a,this.imageData=n||new Uint8ClampedArray(this.dimensions.width*this.dimensions.height*4)}return Object(y.a)(e,[{key:"getImageCanvasElement",value:function(){return this.imageCanvas.getImageCanvasElement()}},{key:"getPixelGridCanvasElement",value:function(){return this.imageCanvas.getPixelGridCanvasElement()}},{key:"getImageData",value:function(){return this.imageData}},{key:"getImageFileBlob",value:function(){var e=Object(g.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.getImageCanvasElement().toBlob((function(t){return e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"updateImageData",value:function(e,t){this.imageData[_(e,this.dimensions)]=t.r,this.imageData[_(e,this.dimensions)+1]=t.g,this.imageData[_(e,this.dimensions)+2]=t.b,this.imageData[_(e,this.dimensions)+3]=t.a}}]),e}(),R=function(){function e(t){Object(k.a)(this,e),this.dimensions=void 0,this.pixelGridRatio=16,this.hiddenCanvas=void 0,this.context=void 0,this.pixelGrid=void 0,console.log("Creating new internal ImageCanvas."),this.dimensions=t.dimensions,this.hiddenCanvas=D(t.dimensions),this.context=this.hiddenCanvas.getContext("2d"),this.pixelGrid=new L(t.dimensions,this.pixelGridRatio),this.drawImageToHiddenCanvas(t)}return Object(y.a)(e,[{key:"getImageCanvasElement",value:function(){return this.hiddenCanvas}},{key:"getPixelGridCanvasElement",value:function(){return this.pixelGrid.getCanvasElement()}},{key:"updatePixel",value:function(e,t){this.drawPixel(e,t)}},{key:"updateRegion",value:function(e,t,a,n,r){}},{key:"redrawImage",value:function(e){this.drawImageToHiddenCanvas(e)}},{key:"drawPixel",value:function(e,t){if(this.context){var a="rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")");this.context.fillStyle=a,this.context.fillRect(e.x,e.y,1,1)}}},{key:"drawImageToHiddenCanvas",value:function(e){for(var t=0;t<e.dimensions.width;t++)for(var a=0;a<e.dimensions.height;a++)this.drawPixel({x:t,y:a},e.getPixelColorAt({x:t,y:a}))}}]),e}(),L=function(){function e(t,a){Object(k.a)(this,e),this.dimensions=void 0,this.pixelGridRatio=16,this.hiddenCanvas=void 0,this.context=void 0,console.log("Setting up pixel grid."),this.pixelGridRatio=a,this.dimensions=t,this.hiddenCanvas=D({width:this.dimensions.width*this.pixelGridRatio,height:this.dimensions.height*this.pixelGridRatio}),this.context=this.hiddenCanvas.getContext("2d"),this.drawGrid()}return Object(y.a)(e,[{key:"getCanvasElement",value:function(){return this.hiddenCanvas}},{key:"drawGrid",value:function(){if(this.context){var e=this.dimensions,t=e.width,a=e.height;this.context.strokeStyle="gray",this.context.beginPath();for(var n=0;n<=t;n++)this.context.moveTo(n*this.pixelGridRatio,0),this.context.lineTo(n*this.pixelGridRatio,a*this.pixelGridRatio);for(var r=0;r<=a;r++)this.context.moveTo(0,r*this.pixelGridRatio),this.context.lineTo(t*this.pixelGridRatio,r*this.pixelGridRatio);this.context.stroke()}}}]),e}(),T=function(e){function t(e,a,n){var r;return Object(k.a)(this,t),(r=Object(N.a)(this,Object(j.a)(t).call(this,e,a,n))).imageCanvas=void 0,r.imageCanvas=new R(Object(I.a)(r)),r}return Object(S.a)(t,e),Object(y.a)(t,[{key:"getCSourceData",value:function(){return h(this,3)}},{key:"getHeaderData",value:function(){return v({fileName:this.fileName,imageDimensions:this.dimensions},3)}},{key:"getPixelColorAt",value:function(e){return{r:this.imageData[_(e,this.dimensions)],g:this.imageData[_(e,this.dimensions)+1],b:this.imageData[_(e,this.dimensions)+2],a:this.imageData[_(e,this.dimensions)+3]}}},{key:"setPixelColor",value:function(e,a){console.log("setting pixel color bmp3"),Object(P.a)(Object(j.a)(t.prototype),"updateImageData",this).call(this,e,a),this.imageCanvas.updatePixel(e,a)}}]),t}(M),D=function(e){var t=document.createElement("canvas");return t.hidden=!0,t.setAttribute("height",e.height+"px"),t.setAttribute("width",e.width+"px"),t},B=function(e,t){return e.getContext("2d").getImageData(0,0,t.width,t.height).data},G=function(e){return new Promise((function(t,a){var n=new Image;n.hidden=!0,n.onload=function(){t(n)},n.onerror=a,n.src=URL.createObjectURL(e)}))},A=function(){var e=Object(g.a)(u.a.mark((function e(t){var a,n,r,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return a=e.sent,n={height:a.naturalHeight,width:a.naturalWidth},r=D(n),(i=r.getContext("2d"))&&i.drawImage(a,0,0),o=B(r,n),e.abrupt("return",new T(t.name,n,o));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e,t){return 4*(e.y*t.width+e.x)},U=function(){var e=Object(g.a)(u.a.mark((function e(t){var a,n,r,i,o,c,l,s,g;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Response(t).text();case 2:if(a=e.sent,n=a.trim().replace(/\t/g,"").replace(/\n/g,""),r=new Array(256),"0x00"!==n.substr(0,4)){e.next=11;break}for(console.log("Palette file is valid. Generating color array..."),i=0,o=0;i<n.length;i+=10,o++)c=parseInt(n.substr(i+4,2),16),l=parseInt(n.substr(i+6,2),16),s=parseInt(n.substr(i+8,2),16),g={r:c,g:l,b:s,a:1},r[o]=g;return e.abrupt("return",r);case 11:return console.log("Invalid palette. Palette unchanged."),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(e){function t(e,a,n,r){var i;return Object(k.a)(this,t),(i=Object(N.a)(this,Object(j.a)(t).call(this,e,r))).data=void 0,i.palette=void 0,i.currentPaletteIndex=void 0,i.imageCanvas=void 0,i.data=a,i.palette=n,i.imageCanvas=new R(Object(I.a)(i)),i.currentPaletteIndex=0,i}return Object(S.a)(t,e),Object(y.a)(t,[{key:"getHeaderData",value:function(){return v({fileName:this.fileName,imageDimensions:this.dimensions,palette:this.palette},4)}},{key:"getCSourceData",value:function(){return h(this,4,this.palette)}},{key:"getPixelColorAt",value:function(e){return(e.x>=this.dimensions.width||e.y>=this.dimensions.height)&&console.error("Tried to access pixel at",e,"but dimensions of sprite are",this.dimensions),this.palette[this.data[this.dimensions.width*e.y+e.x]]}},{key:"setPixelColor",value:function(e){this.data[e.y*this.dimensions.width+e.x]=this.currentPaletteIndex,this.imageCanvas.updatePixel(e,this.palette[this.currentPaletteIndex])}},{key:"setPaletteIndex",value:function(e){this.currentPaletteIndex=e}},{key:"updatePalette",value:function(e){this.palette=e,this.imageCanvas.redrawImage(this)}}]),t}(M),J={r:0,g:0,b:0,a:1};function z(e,t){for(var a,n=function(e){for(var t=[],a=0;a<e.dimensions.height;a++)for(var n=0;n<e.dimensions.width;n++){var r=e.getPixelColorAt({x:n,y:a});t.push([Math.round(Math.min(Math.max(r.r,0),255)),Math.round(Math.min(Math.max(r.g,0),255)),Math.round(Math.min(Math.max(r.b,0),255))])}return t}(e),r=t,i=[],o=[],c=0;c<n.length;c++){var l=n[c];o.includes(JSON.stringify(l))||(i.push(l),o.push(JSON.stringify(l)))}if(1===r||i.length<r)a=i,r=i.length;else{var s=function(e,t){var a=442,n=0,r=(a+n)/2,i=0,o=[];for(;n<=a;){var c=F(e,r=(a+n)/2,t),l=c.possible,s=c.centers;l?(i<r&&(o=JSON.parse(JSON.stringify(s)),i=r),n=r+1):a=r-1}return{pickedCentroids:o}}(i,r).pickedCentroids;a=JSON.parse(JSON.stringify(s))}for(var u=function(e,t,a){var n=[],r=0,i=0,o=JSON.parse(JSON.stringify(t)),c=!1;do{for(var l=0;l<a;l++)n[l]=[];c=!1,c=!1;for(var s=0;s<e.length;s++){for(var u=-1,g=0,b=0;b<a;b++){for(var d=0,m=0;m<e[s].length;m++)d+=Math.pow(Math.abs(e[s][m]-t[b][m]),2);i=Math.sqrt(d),(-1===u||i<=u)&&(u=i,g=b)}n[g].push(e[s].slice())}for(var h=0;h<a;h++){for(var f=0;f<n[h].length;f++)for(var v=0;v<n[h][f].length;v++)t[h][v]+=n[h][f][v];for(var p=0;p<t[h].length;p++)t[h][p]=Math.round(Math.min(Math.max(t[h][p]/(n[h].length<=1?1:n[h].length),0),255)),t[h][p]!==o[h][p]&&(c=!0,o=[],o=JSON.parse(JSON.stringify(t)))}r++}while(!0===c&&r<1e3);return console.log("kmeans output:"),console.log(r),console.log(".........."),{groups:n,centers:t}}(JSON.parse(JSON.stringify(n)),JSON.parse(JSON.stringify(a)),r),g=u.groups,b=u.centers,d=[],m=0;m<b.length;m++){var h=[[],[]];h[0]=b[m];for(var f=0;f<g[m].length;f++)h[f+1]=g[m][f];d.push(h)}d.sort((function(e,t){return t.length-e.length})),console.log(d);var v=e.dimensions.height*e.dimensions.width,p=new Array(v);p.fill(0);for(var E=new Array(256),x=0;x<d.length&&x<256;x++){var C={r:d[x][0][0],g:d[x][0][1],b:d[x][0][2],a:1};E[x]=C;for(var w=1;w<d[x].length;w++){var O=W(n,d[x][w]);-1!==O&&(p[O]=x)}}for(;x<256;x++)E[x]=J;return{sprite:new H(e.fileName,p,E,e.dimensions),palette:E}}function W(e,t){for(var a=0;a<e.length;a++)if(e[a][0]===t[0]&&e[a][1]===t[1]&&e[a][2]===t[2])return e[a]=[-1,-1,-1],a;return-1}function F(e,t,a){var n=1,r=e[0],i=!1,o=[];o.push(r);for(var c=0;c<e.length;c++){for(var l=0,s=0;s<e[c].length;s++)l+=Math.pow(Math.abs(e[c][s]-r[s]),2);if((l=Math.sqrt(l))>=t&&(n++,r=e[c],o.push(e[c]),n>=a))return{possible:i=!0,centers:o}}return{possible:i,centers:o}}var Q=a(14),q=[{r:0,g:0,b:0,a:1},{r:128,g:0,b:0,a:1},{r:0,g:128,b:0,a:1},{r:128,g:128,b:0,a:1},{r:0,g:0,b:128,a:1},{r:128,g:0,b:128,a:1},{r:0,g:128,b:128,a:1},{r:192,g:192,b:192,a:1},{r:128,g:128,b:128,a:1},{r:248,g:0,b:0,a:1},{r:0,g:248,b:0,a:1},{r:248,g:248,b:0,a:1},{r:0,g:0,b:248,a:1},{r:248,g:0,b:248,a:1},{r:0,g:248,b:248,a:1},{r:248,g:248,b:248,a:1},{r:32,g:0,b:0,a:1},{r:63,g:0,b:0,a:1},{r:95,g:0,b:0,a:1},{r:127,g:0,b:0,a:1},{r:159,g:0,b:0,a:1},{r:191,g:0,b:0,a:1},{r:223,g:0,b:0,a:1},{r:255,g:0,b:0,a:1},{r:0,g:32,b:0,a:1},{r:0,g:63,b:0,a:1},{r:0,g:95,b:0,a:1},{r:0,g:127,b:0,a:1},{r:0,g:159,b:0,a:1},{r:0,g:191,b:0,a:1},{r:0,g:223,b:0,a:1},{r:0,g:255,b:0,a:1},{r:32,g:32,b:0,a:1},{r:63,g:63,b:0,a:1},{r:95,g:95,b:0,a:1},{r:127,g:127,b:0,a:1},{r:159,g:159,b:0,a:1},{r:191,g:191,b:0,a:1},{r:223,g:223,b:0,a:1},{r:255,g:255,b:0,a:1},{r:0,g:0,b:32,a:1},{r:0,g:0,b:63,a:1},{r:0,g:0,b:95,a:1},{r:0,g:0,b:127,a:1},{r:0,g:0,b:159,a:1},{r:0,g:0,b:191,a:1},{r:0,g:0,b:223,a:1},{r:0,g:0,b:255,a:1},{r:32,g:0,b:32,a:1},{r:63,g:0,b:63,a:1},{r:95,g:0,b:95,a:1},{r:127,g:0,b:127,a:1},{r:159,g:0,b:159,a:1},{r:191,g:0,b:191,a:1},{r:223,g:0,b:223,a:1},{r:255,g:0,b:255,a:1},{r:0,g:32,b:32,a:1},{r:0,g:63,b:63,a:1},{r:0,g:95,b:95,a:1},{r:0,g:127,b:127,a:1},{r:0,g:159,b:159,a:1},{r:0,g:191,b:191,a:1},{r:0,g:223,b:223,a:1},{r:0,g:255,b:255,a:1},{r:16,g:16,b:16,a:1},{r:31,g:31,b:31,a:1},{r:47,g:47,b:47,a:1},{r:63,g:63,b:63,a:1},{r:79,g:79,b:79,a:1},{r:95,g:95,b:95,a:1},{r:111,g:111,b:111,a:1},{r:127,g:127,b:127,a:1},{r:143,g:143,b:143,a:1},{r:159,g:159,b:159,a:1},{r:175,g:175,b:175,a:1},{r:191,g:191,b:191,a:1},{r:207,g:207,b:207,a:1},{r:223,g:223,b:223,a:1},{r:239,g:239,b:239,a:1},{r:255,g:255,b:255,a:1},{r:255,g:0,b:0,a:1},{r:255,g:31,b:0,a:1},{r:255,g:63,b:0,a:1},{r:255,g:95,b:0,a:1},{r:255,g:127,b:0,a:1},{r:255,g:159,b:0,a:1},{r:255,g:191,b:0,a:1},{r:255,g:223,b:0,a:1},{r:255,g:255,b:0,a:1},{r:224,g:255,b:0,a:1},{r:192,g:255,b:0,a:1},{r:160,g:255,b:0,a:1},{r:128,g:255,b:0,a:1},{r:96,g:255,b:0,a:1},{r:64,g:255,b:0,a:1},{r:32,g:255,b:0,a:1},{r:0,g:255,b:0,a:1},{r:0,g:255,b:31,a:1},{r:0,g:255,b:63,a:1},{r:0,g:255,b:95,a:1},{r:0,g:255,b:127,a:1},{r:0,g:255,b:159,a:1},{r:0,g:255,b:191,a:1},{r:0,g:255,b:223,a:1},{r:0,g:255,b:255,a:1},{r:0,g:224,b:255,a:1},{r:0,g:192,b:255,a:1},{r:0,g:160,b:255,a:1},{r:0,g:128,b:255,a:1},{r:0,g:96,b:255,a:1},{r:0,g:64,b:255,a:1},{r:0,g:32,b:255,a:1},{r:0,g:0,b:255,a:1},{r:31,g:0,b:255,a:1},{r:63,g:0,b:255,a:1},{r:95,g:0,b:255,a:1},{r:127,g:0,b:255,a:1},{r:159,g:0,b:255,a:1},{r:191,g:0,b:255,a:1},{r:223,g:0,b:255,a:1},{r:255,g:0,b:255,a:1},{r:255,g:0,b:224,a:1},{r:255,g:0,b:192,a:1},{r:255,g:0,b:160,a:1},{r:255,g:0,b:128,a:1},{r:255,g:0,b:96,a:1},{r:255,g:0,b:64,a:1},{r:255,g:0,b:32,a:1},{r:255,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:1},{r:8,g:8,b:8,a:1},{r:16,g:16,b:16,a:1},{r:24,g:24,b:24,a:1},{r:32,g:32,b:32,a:1},{r:41,g:41,b:41,a:1},{r:49,g:49,b:49,a:1},{r:57,g:57,b:57,a:1},{r:65,g:65,b:65,a:1},{r:74,g:74,b:74,a:1},{r:82,g:82,b:82,a:1},{r:90,g:90,b:90,a:1},{r:98,g:98,b:98,a:1},{r:106,g:106,b:106,a:1},{r:115,g:115,b:115,a:1},{r:123,g:123,b:123,a:1},{r:131,g:131,b:131,a:1},{r:139,g:139,b:139,a:1},{r:148,g:148,b:148,a:1},{r:156,g:156,b:156,a:1},{r:164,g:164,b:164,a:1},{r:172,g:172,b:172,a:1},{r:180,g:180,b:180,a:1},{r:189,g:189,b:189,a:1},{r:197,g:197,b:197,a:1},{r:205,g:205,b:205,a:1},{r:213,g:213,b:213,a:1},{r:222,g:222,b:222,a:1},{r:230,g:230,b:230,a:1},{r:238,g:238,b:238,a:1},{r:246,g:246,b:246,a:1},{r:255,g:255,b:255,a:1}];function Z(e){var t=e.image,a=e.palette,n=e.selectedPaletteIndex,r=e.settings,c=e.scale,l=e.onMouseWheel,s=Object(i.useRef)(null),u=Object(i.useState)([0,0]),g=Object(b.a)(u,2),d=g[0],m=g[1],h=Object(i.useState)(!1),f=Object(b.a)(h,2),v=f[0],p=f[1],E=Object(i.useState)(void 0),x=Object(b.a)(E,2),C=(x[0],x[1]),w=Object(i.useCallback)((function(){var e=s.current;if(e){var a=e.getContext("2d");a&&t&&(a.clearRect(0,0,e.width,e.height),a.drawImage(t.getImageCanvasElement(),0,0,t.dimensions.width*c,t.dimensions.height*c),r.grid&&c>=8&&a.drawImage(t.getPixelGridCanvasElement(),0,0,t.dimensions.width*c,t.dimensions.height*c))}}),[t,s,c,r.grid]);Object(i.useLayoutEffect)((function(){window.addEventListener("resize",(function(){s.current&&m([s.current.clientWidth,s.current.clientHeight])}))}),[]),Object(i.useLayoutEffect)((function(){console.log("Setting up canvas...");var e=s.current;if(e){var t=e.getContext("2d");t&&(m([e.clientWidth,e.clientHeight]),t.imageSmoothingEnabled=!1)}}),[s]),Object(i.useLayoutEffect)((function(){var e=s.current;if(e){var t=e.getContext("2d");if(t){var a=window.devicePixelRatio||1;e.width=d[0]*a,e.height=d[1]*a,t.imageSmoothingEnabled=!1}}}),[d,s]),Object(i.useLayoutEffect)((function(){s.current&&s.current.addEventListener("wheel",l)}),[l]),Object(i.useLayoutEffect)((function(){return w()}),[w,a,d]);var O=function(e){var t=s.current;if(t){var a=t.getBoundingClientRect(),n=t.width/a.width,r=t.height/a.height;return{x:(e.clientX-a.left)*n,y:(e.clientY-a.top)*r}}},k=Object(i.useCallback)((function(e){return{x:Math.floor(e.x/c),y:Math.floor(e.y/c)}}),[c]),y=Object(i.useCallback)((function(e,a){s.current&&(s.current.getContext("2d")&&(t.setPixelColor(e,a),w()))}),[w,t]),N=Object(i.useCallback)((function(e){var t=O(e);t&&(C(t),p(!0))}),[]),I=Object(i.useCallback)((function(e){var t=O(e);v&&t&&(y(k(t),a[n]),C(t))}),[v,y,k,a,n]),j=Object(i.useCallback)((function(){C(void 0),p(!1)}),[]);return Object(i.useEffect)((function(){if(s.current){var e=s.current;return e.addEventListener("mousedown",N),function(){return e.removeEventListener("mousedown",N)}}}),[N]),Object(i.useEffect)((function(){if(s.current){var e=s.current;return e.addEventListener("mousemove",I),function(){e.removeEventListener("mousemove",I)}}}),[I]),Object(i.useEffect)((function(){if(s.current){var e=s.current;return e.addEventListener("mouseup",j),e.addEventListener("mouseleave",j),function(){e.removeEventListener("mouseup",j),e.removeEventListener("mouseleave",j)}}}),[j]),o.a.createElement("canvas",{ref:s,className:"image-canvas"})}var K=function(e){var t=e.startImageExport,a=e.buttonLabel;return o.a.createElement("button",{className:"button export-button",onClick:function(){t()}},a)};var V=function(e){var t=e.onFileChange,a=e.buttonLabel,n=Object(i.useRef)(null),r=function(e){e.preventDefault(),n.current&&n.current.files&&t(n.current.files[0])};return o.a.createElement("button",{className:"button import-button"},o.a.createElement("label",null,a,o.a.createElement("input",{type:"file",accept:".png, .jpg, .jpeg, .bmp, .pal",ref:n,onChange:r})))};function Y(e,t){var a=t.getContext("2d");if(a)for(var n=0;n<m;n++){var r=e[n];a.fillStyle="rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")"),a.fillRect(n%16,Math.floor(n/16),1,1)}else console.error("Failed to get Palette hidden canvas context!")}var X=192,$=192,ee=X/16,te=function(e){return function(e){var t=e.x;return 16*e.y+t}(function(e){var t=e.x,a=e.y;return{x:Math.floor(t/ee),y:Math.floor(a/ee)}}(e))};var ae=function(e){var t=e.palette,a=e.selectedColorIndex,n=e.onChangeSelectedColorIndex,r=Object(i.useState)(),c=Object(b.a)(r,2),l=c[0],s=c[1],u=Object(i.useState)(),g=Object(b.a)(u,2),m=g[0],h=g[1],f=Object(i.useRef)(null),v=Object(i.useCallback)((function(){if(f.current&&m){var e=f.current.getContext("2d");e&&e.drawImage(m.getCanvasElement(),0,0,$*window.devicePixelRatio,X*window.devicePixelRatio)}}),[m]),p=Object(i.useCallback)((function(){if(f.current&&l){var e=f.current.getContext("2d");e&&(Y(t,l),e.drawImage(l,0,0,$*window.devicePixelRatio,X*window.devicePixelRatio))}}),[t,l]),E=Object(i.useCallback)((function(e){if(f.current){var t=f.current.getContext("2d");if(t){t.beginPath(),t.strokeStyle="rgba(255, 255, 0, 1)",t.lineWidth=2;var a=window.devicePixelRatio*ee;t.rect(function(e){return e%16}(e)*a,function(e){return Math.floor(e/16)}(e)*a,a,a),t.stroke()}}}),[f]);return Object(i.useEffect)((function(){console.log("Setting up palette canvas");f.current&&function(e){var t=window.devicePixelRatio||1;e.width=e.clientWidth*t,e.height=e.clientHeight*t;var a=e.getContext("2d");a&&(a.imageSmoothingEnabled=!1)}(f.current);var e={pixelGrid:new L(d,8),hiddenCanvas:D(d)},t=e.pixelGrid;s(e.hiddenCanvas),h(t)}),[]),Object(i.useEffect)((function(){p(),v(),E(a)}),[t,a,p,v,E]),o.a.createElement("canvas",{ref:f,onClick:function(e){n(te(function(e){if(f.current){var t=f.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}return{x:-1,y:-1}}(e)))},className:"palette-canvas"})};var ne=function(e){var t=e.handleQuantize,a=Object(i.useState)(15),n=Object(b.a)(a,2),r=n[0],c=n[1];return o.a.createElement("div",{className:"quantize-container"},o.a.createElement("button",{className:"quantize-button",onClick:function(){r?t(r):alert("Can't quantize with unspecified color depth!")}},"Quantize"),o.a.createElement("input",{className:"quantize-input",type:"number",value:r,min:1,max:256,onChange:function(e){return c(parseInt(e.target.value))}}))};function re(e){var t=e.palette,a=e.selectedColorIndex,n=e.onChangeSelectedColorIndex,r=e.onChangeColor,i=e.handleQuantize;return o.a.createElement("div",null,o.a.createElement("div",{className:"panel-label"},"Color Palette"),o.a.createElement("div",{className:"palette-container"},o.a.createElement(ae,{palette:t,selectedColorIndex:a,onChangeSelectedColorIndex:n})),o.a.createElement(oe,{currentColor:t[a],onChangeColor:r}),o.a.createElement(ne,{handleQuantize:i}))}var ie=function(e){return{r:8*(e.r+1)-1,g:8*(e.g+1)-1,b:8*(e.b+1)-1,a:1}};function oe(e){var t=e.currentColor,a=e.onChangeColor,n=function(e){var t=e.r,a=e.g,n=e.b;return{r:Math.ceil((t+1)/8)-1,g:Math.ceil((a+1)/8)-1,b:Math.ceil((n+1)/8)-1,a:1}}(t);return o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("label",null,"Red: "),o.a.createElement("input",{type:"number",max:"31",min:"0",value:n.r,onChange:function(e){return function(e){var t=ie({r:e,g:n.g,b:n.b,a:1});a(t)}(parseInt(e.target.value))}})),o.a.createElement("div",null,o.a.createElement("label",null,"Green: "),o.a.createElement("input",{type:"number",max:"31",min:"0",value:n.g,onChange:function(e){return function(e){var t=ie({r:n.r,g:e,b:n.b,a:1});a(t)}(parseInt(e.target.value))}})),o.a.createElement("div",null,o.a.createElement("label",null,"Blue: "),o.a.createElement("input",{type:"number",max:"31",min:"0",value:n.b,onChange:function(e){return function(e){var t=ie({r:n.r,g:n.g,b:e,a:1});a(t)}(parseInt(e.target.value))}})))}var ce=a(20),le=a(8),se=a(15),ue=a(5);function ge(e){var t=e.state,a=e.onClick,n=e.children;return o.a.createElement("button",{className:t?"toggle-on":"toggle-off",onClick:function(){return a(!t)}},n)}function be(e){var t=e.settings,a=e.onSettingsChange,r=e.onToolChange;return o.a.createElement("div",null,o.a.createElement("div",{className:"heading"},"Tools"),o.a.createElement(ge,{state:t.currentTool===n.PENCIL,onClick:function(){return r(n.PENCIL)}},o.a.createElement(ue.a,{icon:le.f})),o.a.createElement(ge,{state:t.currentTool===n.BUCKET,onClick:function(){return r(n.BUCKET)}},o.a.createElement(ue.a,{icon:le.d})),o.a.createElement(ge,{state:t.currentTool===n.SQUARE,onClick:function(){return r(n.SQUARE)}},o.a.createElement(ue.a,{icon:se.c})),o.a.createElement(ge,{state:t.currentTool===n.ELLIPSE,onClick:function(){return r(n.ELLIPSE)}},o.a.createElement(ue.a,{icon:se.a})),o.a.createElement(ge,{state:t.currentTool===n.ZOOM,onClick:function(){return r(n.ZOOM)}},o.a.createElement(ue.a,{icon:le.g})),o.a.createElement(ge,{state:t.currentTool===n.PAN,onClick:function(){return r(n.PAN)}},o.a.createElement(ue.a,{icon:se.b})),o.a.createElement(ge,{state:t.currentTool===n.DROPPER,onClick:function(){return r(n.DROPPER)}},o.a.createElement(ue.a,{icon:le.c})),o.a.createElement("div",{className:"heading"},"View"),o.a.createElement(ge,{state:t.grid,onClick:function(){var e=Object(ce.a)({},t);e.grid=!t.grid,a(e)}},o.a.createElement(ue.a,{icon:le.a})),o.a.createElement(ge,{state:!1,onClick:function(){return null}},o.a.createElement(ue.a,{icon:le.e})),o.a.createElement(ge,{state:!1,onClick:function(){return null}},o.a.createElement(ue.a,{icon:le.b})),o.a.createElement("div",{className:"heading"},"Settings"),o.a.createElement("div",null,"Mode: ",t.mode,o.a.createElement("br",null),t.editorMode.toString()))}function de(e){var t=e.label,a=e.children,n=Object(i.useState)(!1),r=Object(b.a)(n,2),c=r[0],l=r[1];return o.a.createElement("div",{className:"dd-container"},o.a.createElement("button",{onClick:function(){return l(!c)},className:"dd-button"},t),o.a.createElement("div",{id:"myDropdown",className:c?"dd-content dd-show":"dd-content"},a))}function me(e,t){return 1===(t.deltaY<0?-1:1)?1.1*e:e/1.1}var he=function(){var e=Object(i.useState)(q),t=Object(b.a)(e,2),a=t[0],c=t[1],l=Object(i.useState)(),s=Object(b.a)(l,2),d=s[0],m=s[1],h=Object(i.useState)(0),f=Object(b.a)(h,2),v=f[0],p=f[1],E=Object(i.useState)({grid:!0,currentTool:n.PENCIL,mode:3,editorMode:r.Bitmap}),x=Object(b.a)(E,2),C=x[0],O=x[1],k=Object(i.useReducer)(me,8),y=Object(b.a)(k,2),N=y[0],I=y[1],j=Object(i.useCallback)((function(e){return I(e)}),[]),P=function(){var e=Object(g.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("Loading image..."),e.next=4,A(t);case 4:a=e.sent,m(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=Object(i.useCallback)((function(e){O({grid:C.grid,currentTool:e,mode:C.mode,editorMode:C.editorMode})}),[C]),M=Object(i.useCallback)((function(e,t){O({grid:C.grid,currentTool:C.currentTool,mode:t,editorMode:e})}),[C]),R=function(){var e=Object(g.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("Loading palette..."),e.next=4,U(t);case 4:(a=e.sent)&&(d instanceof H&&d.updatePalette(a),c(a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(g.a)(u.a.mark((function e(t){var n,r,i,o,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="",n=d?d.fileName.slice(0,d.fileName.lastIndexOf(".")):"default",o=function(){return alert("Failed to export image! Check console for more information.")},e.t0=t,e.next="GBA"===e.t0?6:"PAL"===e.t0?16:"BMP"===e.t0?24:"PNG"===e.t0?32:40;break;case 6:if(d){e.next=9;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 9:return r=".c",c=new Blob([d.getCSourceData()]),Object(Q.saveAs)(c,n+r),r=".h",l=new Blob([d.getHeaderData()]),Object(Q.saveAs)(l,n+r),e.abrupt("return");case 16:if(a){e.next=21;break}return alert("Can't export a non-existant palette!"),e.abrupt("return");case 21:return r=".pal",i=new Blob([(s=a,function(e){var t="",a=1;return e.forEach((function(e){var n="0x00";n+=e.r<16?"0"+e.r.toString(16):e.r.toString(16),n+=e.g<16?"0"+e.g.toString(16):e.g.toString(16),n+=e.b<16?"0"+e.b.toString(16):e.b.toString(16),t+=n+"\t",4===a?(t+="\n",a=1):a++})),t}(s))]),e.abrupt("break",47);case 24:if(d){e.next=27;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 27:return r=".bmp",e.next=30,w(d,t);case 30:return i=e.sent,e.abrupt("break",47);case 32:if(d){e.next=35;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 35:return r=".png",e.next=38,w(d,t);case 38:return i=e.sent,e.abrupt("break",47);case 40:if(d){e.next=43;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 43:return r=".txt",e.next=46,w(d,t);case 46:i=e.sent;case 47:i?Object(Q.saveAs)(i,n+r):o();case 48:case"end":return e.stop()}var s}),e)})));return function(t){return e.apply(this,arguments)}}(),D=Object(i.useCallback)((function(e){return O(e)}),[]);return o.a.createElement("div",{className:"app-container"},o.a.createElement("div",{className:"navbar"},o.a.createElement("span",{className:"title"},"VOCC"),o.a.createElement(de,{label:"New"},o.a.createElement("div",{className:"dd-content-header"},"Bitmap"),o.a.createElement("button",{onClick:function(){return M(r.Bitmap,3)}},"Mode 3"),o.a.createElement("button",{onClick:function(){return M(r.Bitmap,4)}},"Mode 4"),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement("div",{className:"dd-content-header"},"Spritesheet"),o.a.createElement("button",{onClick:function(){return M(r.Spritesheet,4)}},"4 bpp"),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement("div",{className:"dd-content-header"},"Background"),o.a.createElement("button",{onClick:function(){return M(r.Background,0)}},"Mode 0")),o.a.createElement(de,{label:"Edit"},o.a.createElement("button",{onClick:function(){return null}},"Undo"),o.a.createElement("button",{onClick:function(){return null}},"Redo"),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement("button",{onClick:function(){return null}},"Clear All")),o.a.createElement(de,{label:"Import"},o.a.createElement("div",{className:"dd-content-header"},"Image"),o.a.createElement(V,{onFileChange:P,buttonLabel:"Image (*.png, *.bmp, *.jpg)"}),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement(V,{onFileChange:R,buttonLabel:"Palette (*.pal)"})),o.a.createElement(de,{label:"Export"},o.a.createElement("div",{className:"dd-content-header"},"Image"),o.a.createElement(K,{startImageExport:L.bind(null,"PNG"),buttonLabel:"PNG Image (*.png)"}),o.a.createElement(K,{startImageExport:L.bind(null,"BMP"),buttonLabel:"Bitmap (*.bmp)"}),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement("div",{className:"dd-content-header"},"GBA"),o.a.createElement(K,{startImageExport:L.bind(null,"GBA"),buttonLabel:"C Source Code (*.c/.h)"}),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement(K,{startImageExport:L.bind(null,"PAL"),buttonLabel:"Color Palette (*.pal)"})),o.a.createElement(de,{label:"Help"},o.a.createElement("form",null,o.a.createElement("button",{type:"submit",formAction:"",formTarget:""},"Documentation")),o.a.createElement("form",null,o.a.createElement("button",{type:"submit",formAction:"https://www.coranac.com/tonc/text/",formTarget:"_blank"},"GBA Graphics 101")),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement("form",null,o.a.createElement("button",{type:"submit",formAction:"",formTarget:""},"About VOCC")),o.a.createElement("div",{className:"dd-divider"}),o.a.createElement("form",null,o.a.createElement("button",{type:"submit",formAction:"https://github.com/lbussell/vocc",formTarget:"_blank"},"View on GitHub")))),o.a.createElement("div",{className:"workspace-container"},o.a.createElement("div",{className:"left-panel"},o.a.createElement("div",{className:"tools-container"},o.a.createElement(be,{settings:C,onSettingsChange:D,onToolChange:S})),d?o.a.createElement("div",null," Scale: ",N.toFixed(2),"x "):null),o.a.createElement("div",{className:"image-container"},d?o.a.createElement(Z,{image:d,settings:C,palette:a,selectedPaletteIndex:v,scale:N,onMouseWheel:j}):o.a.createElement("div",{className:"start-message"},o.a.createElement("em",null,"Import an image to get started"))),o.a.createElement("div",{className:"right-panel"},o.a.createElement(re,{palette:a,updatePalette:c,selectedColorIndex:v,onChangeSelectedColorIndex:function(e){p(e),d instanceof H&&d.setPaletteIndex(e)},onChangeColor:function(e){var t=a.slice();t[v]=e,d instanceof H&&d.updatePalette(t),c(t)},handleQuantize:function(e){if(e=Math.floor(e),d instanceof T){if(window.confirm("(Don't panic!) Quantizing a bitmap will change it from mode 3 to mode 4. Is this okay?")){var t=z(d,e),a=t.palette,n=t.sprite;m(n),c(a)}}else alert("Requantization of paletted images currently not supported!")}}))))};a(32),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(he,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[21,1,2]]]);
//# sourceMappingURL=main.73a61eed.chunk.js.map