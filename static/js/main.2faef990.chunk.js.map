{"version":3,"sources":["util/interfaces.ts","util/consts.ts","util/defaultPalette.ts","util/exportUtils.ts","models/Bitmap.ts","models/ImageCanvas.ts","models/Bitmap3.ts","util/fileLoadUtils.ts","models/Bitmap4.ts","util/quantize.ts","components/buttons/ExportButton.tsx","components/buttons/ImportButton.tsx","components/Dropdown.tsx","components/EditorCanvas.tsx","models/Palette.ts","components/PaletteDisplay.tsx","components/buttons/QuantizeButton.tsx","components/PalettePanel.tsx","components/buttons/Toggle.tsx","components/ToolsPanel.tsx","components/modals/NewImageModal.tsx","components/hooks/useModal.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["EditorMode","Color","r","g","b","a","this","other","that","Tool","PALETTE_SIZE","height","width","PALETTE_LENGTH","STORAGE","DEFAULT_SETTINGS","grid","currentTool","PENCIL","imageMode","editorMode","Bitmap","DEFAULT_PALETTE","generateCSourceFileString","image","mode","palette","generateMode3CSourceFileString","console","error","getImageDataStore","fileName","dimensions","imageData","variableName","slice","lastIndexOf","bitmapLength","imageDefinitionString","imageDataHexString","i","length","paletteIndicesToHex","paletteCSourceString","palC","element","colorToHex","PaletteToGBA","generateMode4CSourceFileString","pixelCount","j","pixelToHex","generateHeaderString","params","generateMode3HeaderString","imageDimensions","bitmapLengthDefinition","toUpperCase","imageHeightDefinition","imageWidthDefinition","paletteLengthDefinition","paletteDefinitionString","generateMode4HeaderString","warn","bitmapSize","bitmapSizeDefinition","index1","index2","combinedIndexString","toString","padStart","bgr","binary_value","forEach","elementString","Math","floor","hex_value","parseInt","color","exportImage","img","type","getImageFileBlob","Blob","imageCanvas","Uint8ClampedArray","getImageCanvasElement","getPixelGridCanvasElement","Promise","resolve","toBlob","blob","pos","Loader","ImageCanvas","pixelGridRatio","hiddenCanvas","context","pixelGrid","log","createHiddenCanvas","getContext","PixelGrid","drawImageToHiddenCanvas","getCanvasElement","drawPixel","x","y","dx","dy","colorString","fillStyle","fillRect","getPixelColorAt","drawGrid","strokeStyle","beginPath","moveTo","lineTo","stroke","Bitmap3","updatePixel","d","document","createElement","hidden","setAttribute","loadImageDataFromCanvas","canvas","getImageData","data","loadHiddenImage","imagefile","reject","Image","onload","onerror","src","URL","createObjectURL","loadNewImage","imageFile","hiddenImage","naturalHeight","naturalWidth","drawImage","name","offset","loadNewPalette","paletteFile","Response","text","fileString","trim","replace","colors","Array","substr","red","green","blue","Bitmap4","indexArray","currentPaletteIndex","fill","newPaletteIndex","newPalette","redrawImage","BLACK","quantize","depth","centroids","imageArr","push","round","min","max","imageToArr","uniqueColors","uniqueColorsString","check","includes","JSON","stringify","pickedCentroids","maxDist","minDist","midDist","dist","centroidPossible","possible","centers","parse","findCentroids","arrayToProcess","clusters","Groups","iterations","tempdistance","oldcentroids","changed","reset","minCluster","clusterIterate","pow","abs","sqrt","groups","kmeans","newCluster","sort","spriteIndexArrayLength","spriteIndexArray","center","imageIndex","getColorIndex","sprite","colorArr","points","numCentroids","currColor","ExportButton","startImageExport","buttonLabel","className","onClick","ImportButton","onFileInputChange","fileInput","useRef","accept","ref","onChange","e","current","Dropdown","label","children","useState","open","setOpen","id","EditorCanvas","selectedPaletteIndex","settings","scale","onChangeImage","onMouseWheel","canvasRef","canvasSize","setCanvasSize","isPainting","setIsPainting","undefined","mousePos","setMousePos","imagePosition","setImagePosition","drawImageOnCanvas","useCallback","clearRect","useLayoutEffect","window","addEventListener","clientWidth","clientHeight","imageSmoothingEnabled","devicePixelRatio","getMousePos","rect","getBoundingClientRect","scaleX","scaleY","clientX","left","clientY","top","getImageCoord","fillPixel","setPixelColor","bucketFill","newColor","isEqual","queue","explored","curr","shift","edges","filter","n","startPaint","mousePosition","imageCoord","BUCKET","PAN","paint","newMousePos","newImagePosition","stopPaint","useEffect","removeEventListener","generateEditorCanvasProps","tool","base","drawPaletteToHiddenCanvas","PALETTE_CANVAS_SIZE","SCALE","MOUSE_POS_TO_INDEX","XY_TO_INDEX","MOUSE_POS_TO_XY","PaletteDisplay","selectedColorIndex","onChangeSelectedColorIndex","paletteHiddenCanvas","setPaletteHiddenCanvas","setPixelGrid","drawPalette","PaletteUtils","drawSelectedColorHighlight","index","lineWidth","ratio","INDEX_TO_X","INDEX_TO_Y","setupCanvasSize","handleQuantize","setDepth","alert","value","target","PalettePanel","onChangeColor","onSettingsChange","ColorInput","currentColor","QuantizeButton","color32to256","color32","ceil","color256to32","newRValue","color256","handleRChange","newGValue","handleGChange","newBValue","handleBChange","Toggle","state","ToolsPanel","onToolChange","icon","faPen","faFillDrip","SQUARE","faSquare","ELLIPSE","faCircle","ZOOM","faSearchPlus","faHandPaper","DROPPER","faEyeDropper","newSettings","faBorderAll","faLayerGroup","faCode","NewImageForm","onAccept","setFileName","setHeight","setWidth","onSubmit","preventDefault","htmlFor","NewImageModal","isShowing","hide","ReactDOM","createPortal","Fragment","aria-modal","aria-hidden","tabIndex","role","body","useModal","setIsShowing","toggle","scaleReducer","deltaY","App","setImage","setPalette","setSelectedColorIndex","editorSettings","setEditorSettings","isMode3BitmapModalShowing","toggleMode3BitmpModal","isMode4BitmapModalShowing","toggleMode4BitmpModal","useReducer","scaleDispatch","handleMouseWheelEvent","handleFileInputChange","event","files","handleImageLoad","handlePaletteLoad","handleImageChange","newImage","localStorage","setItem","handlePaletteChange","handleSettingsChange","palFile","updatePalette","handleToolChange","newTool","handleNewBitmap","confirm","Spritesheet","Background","handleImageExport","fileType","exportFailAlert","cBlob","getCSourceData","saveAs","hBlob","getHeaderData","pal","count","hex","paletteToHex","alertBadFormatting","loadedImageMode","getItem","loadedImageType","loadedPalette","loadedImage","clear","parsedImage","parsedImageMode","parsedImageType","fromDataStore","newEditorSettings","parsedPalette","bind","formAction","formTarget","toFixed","newIndex","setPaletteIndex","newColorDepth","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","render","getElementById","process","href","origin","fetch","response","contentType","headers","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"+KA6CYA,E,qFA3CCC,EAAb,WAME,WAAYC,EAAWC,EAAWC,EAAWC,GAAY,yBALlDH,OAKiD,OAJjDC,OAIiD,OAHjDC,OAGiD,OAFjDC,OAEiD,EACtDC,KAAKJ,EAAIA,EACTI,KAAKH,EAAIA,EACTG,KAAKF,EAAIA,EACTE,KAAKD,EAAIA,EAVb,oDAaiBE,GACb,GAAIA,IAAUD,KACZ,OAAO,EAET,KAAMC,aAAiBN,GACrB,OAAO,EAET,IAAMO,EAAcD,EACpB,OACED,KAAKJ,IAAMM,EAAKN,GAChBI,KAAKH,IAAMK,EAAKL,GAChBG,KAAKF,IAAMI,EAAKJ,GAChBE,KAAKD,IAAMG,EAAKH,MAzBtB,M,SA2CYL,K,gBAAAA,E,0BAAAA,E,yBAAAA,M,KC1CH,IAAIC,EAAM,EAAG,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACpB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACpB,IAAIA,EAAM,EAAG,EAAG,IAAK,GAJvB,IAUKQ,EAHCC,EAA2B,CAAEC,OAAQ,GAAIC,MAAO,IAChDC,EAAiBH,EAAaC,OAASD,EAAaE,O,SAErDH,O,mBAAAA,I,mBAAAA,I,mBAAAA,I,qBAAAA,I,eAAAA,I,aAAAA,I,sBAAAA,M,KAUL,IAAMK,EAEA,YAFAA,EAGF,UAHEA,EAIA,YAJAA,EAKA,YAGAC,EAAmC,CAC9CC,MAAM,EACNC,YAAaR,EAAKS,OAClBC,UAAW,EACXC,WAAYpB,EAAWqB,QCoOVC,EAnQkB,CAC/B,IAAIrB,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,GAAI,EAAG,EAAG,GACpB,IAAIA,EAAM,GAAI,EAAG,EAAG,GACpB,IAAIA,EAAM,GAAI,EAAG,EAAG,GACpB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,EAAG,GAAI,EAAG,GACpB,IAAIA,EAAM,EAAG,GAAI,EAAG,GACpB,IAAIA,EAAM,EAAG,GAAI,EAAG,GACpB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,GAAI,GAAI,EAAG,GACrB,IAAIA,EAAM,GAAI,GAAI,EAAG,GACrB,IAAIA,EAAM,GAAI,GAAI,EAAG,GACrB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,EAAG,EAAG,GAAI,GACpB,IAAIA,EAAM,EAAG,EAAG,GAAI,GACpB,IAAIA,EAAM,EAAG,EAAG,GAAI,GACpB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,GAAI,EAAG,GAAI,GACrB,IAAIA,EAAM,GAAI,EAAG,GAAI,GACrB,IAAIA,EAAM,GAAI,EAAG,GAAI,GACrB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,EAAG,GAAI,GAAI,GACrB,IAAIA,EAAM,EAAG,GAAI,GAAI,GACrB,IAAIA,EAAM,EAAG,GAAI,GAAI,GACrB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,GAAI,EAAG,GACtB,IAAIA,EAAM,IAAK,GAAI,EAAG,GACtB,IAAIA,EAAM,IAAK,GAAI,EAAG,GACtB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,GAAI,IAAK,EAAG,GACtB,IAAIA,EAAM,GAAI,IAAK,EAAG,GACtB,IAAIA,EAAM,GAAI,IAAK,EAAG,GACtB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,GAAI,GACtB,IAAIA,EAAM,EAAG,IAAK,GAAI,GACtB,IAAIA,EAAM,EAAG,IAAK,GAAI,GACtB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,GAAI,IAAK,GACtB,IAAIA,EAAM,EAAG,GAAI,IAAK,GACtB,IAAIA,EAAM,EAAG,GAAI,IAAK,GACtB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,GAAI,EAAG,IAAK,GACtB,IAAIA,EAAM,GAAI,EAAG,IAAK,GACtB,IAAIA,EAAM,GAAI,EAAG,IAAK,GACtB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,GAAI,GACtB,IAAIA,EAAM,IAAK,EAAG,GAAI,GACtB,IAAIA,EAAM,IAAK,EAAG,GAAI,GACtB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,E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","file":"static/js/main.2faef990.chunk.js","sourcesContent":["import { Tool } from \"./consts\";\n\nexport class Color {\n  public r: number;\n  public g: number;\n  public b: number;\n  public a: number;\n\n  constructor(r: number, g: number, b: number, a: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a;\n  }\n\n  public isEqual(other: Object): boolean {\n    if (other === this) {\n      return true;\n    }\n    if (!(other instanceof Color)) {\n      return false;\n    }\n    const that: Color = other as Color;\n    return (\n      this.r === that.r &&\n      this.g === that.g &&\n      this.b === that.b &&\n      this.a === that.a\n    );\n  }\n}\n\nexport interface Color32 {\n  r: number;\n  g: number;\n  b: number;\n}\n\nexport interface Dimensions {\n  height: number;\n  width: number;\n}\n\nexport type Mode = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\n\nexport enum EditorMode {\n  Bitmap = \"Bitmap\",\n  Spritesheet = \"Spritesheet\",\n  Background = \"Background\"\n}\n\nexport interface Drawable {\n  dimensions: Dimensions;\n  getImageCanvasElement: () => HTMLCanvasElement;\n  getPixelGridCanvasElement: () => HTMLCanvasElement;\n}\n\n/**\n * Eventually, these methods should be entirely encapsulated within the classes\n * themselves, not separated as part of a utilities file. Make classes do the\n * work, not functions with access to the classes' private information.\n * Perhaps an abstract class with default implementations will work well here.\n */\nexport interface Exportable {\n  fileName: string;\n  getImageDataStore: () => ImageDataStore;\n  getImageFileBlob: () => Promise<Blob | null>;\n  getHeaderData: () => string;\n  getCSourceData: () => string;\n  getPixelColorAt: (pos: ImageCoordinates) => Color;\n}\n\nexport interface Modifiable {\n  setPixelColor: (pos: ImageCoordinates, color: Color) => void;\n}\n\nexport interface ImageInterface extends Drawable, Exportable, Modifiable {}\n\nexport interface EditorSettings {\n  grid: boolean;\n  currentTool: Tool;\n  imageMode: Mode;\n  editorMode: EditorMode;\n}\n\nexport interface ImageCoordinates {\n  x: number;\n  y: number;\n}\n\nexport interface ImageDataStore {\n  fileName: string;\n  dimensions: Dimensions;\n  imageData: Uint8ClampedArray | number[];\n}\n","import { Dimensions, Color, EditorMode, EditorSettings } from \"./interfaces\";\n\nexport const COLORS = {\n  black: new Color(0, 0, 0, 1),\n  red: new Color(255, 0, 0, 1),\n  blue: new Color(0, 255, 0, 1),\n  green: new Color(0, 0, 255, 1)\n};\n\nexport const PALETTE_SIZE: Dimensions = { height: 16, width: 16 };\nexport const PALETTE_LENGTH = PALETTE_SIZE.height * PALETTE_SIZE.width;\n\nexport enum Tool {\n  PENCIL,\n  BUCKET,\n  SQUARE,\n  ELLIPSE,\n  ZOOM,\n  PAN,\n  DROPPER\n}\n\nexport const STORAGE = {\n  image: \"image\",\n  imageData: \"imageData\",\n  palette: \"palette\",\n  imageMode: \"imageMode\",\n  imageType: \"imageType\"\n};\n\nexport const DEFAULT_SETTINGS: EditorSettings = {\n  grid: true,\n  currentTool: Tool.PENCIL,\n  imageMode: 3,\n  editorMode: EditorMode.Bitmap\n};\n","import Palette from \"../models/Palette\";\nimport { Color } from \"./interfaces\";\n\nconst DEFAULT_PALETTE: Palette = [\n  new Color(0, 0, 0, 1),\n  new Color(128, 0, 0, 1),\n  new Color(0, 128, 0, 1),\n  new Color(128, 128, 0, 1),\n  new Color(0, 0, 128, 1),\n  new Color(128, 0, 128, 1),\n  new Color(0, 128, 128, 1),\n  new Color(192, 192, 192, 1),\n  new Color(128, 128, 128, 1),\n  new Color(248, 0, 0, 1),\n  new Color(0, 248, 0, 1),\n  new Color(248, 248, 0, 1),\n  new Color(0, 0, 248, 1),\n  new Color(248, 0, 248, 1),\n  new Color(0, 248, 248, 1),\n  new Color(248, 248, 248, 1),\n  new Color(32, 0, 0, 1),\n  new Color(63, 0, 0, 1),\n  new Color(95, 0, 0, 1),\n  new Color(127, 0, 0, 1),\n  new Color(159, 0, 0, 1),\n  new Color(191, 0, 0, 1),\n  new Color(223, 0, 0, 1),\n  new Color(255, 0, 0, 1),\n  new Color(0, 32, 0, 1),\n  new Color(0, 63, 0, 1),\n  new Color(0, 95, 0, 1),\n  new Color(0, 127, 0, 1),\n  new Color(0, 159, 0, 1),\n  new Color(0, 191, 0, 1),\n  new Color(0, 223, 0, 1),\n  new Color(0, 255, 0, 1),\n  new Color(32, 32, 0, 1),\n  new Color(63, 63, 0, 1),\n  new Color(95, 95, 0, 1),\n  new Color(127, 127, 0, 1),\n  new Color(159, 159, 0, 1),\n  new Color(191, 191, 0, 1),\n  new Color(223, 223, 0, 1),\n  new Color(255, 255, 0, 1),\n  new Color(0, 0, 32, 1),\n  new Color(0, 0, 63, 1),\n  new Color(0, 0, 95, 1),\n  new Color(0, 0, 127, 1),\n  new Color(0, 0, 159, 1),\n  new Color(0, 0, 191, 1),\n  new Color(0, 0, 223, 1),\n  new Color(0, 0, 255, 1),\n  new Color(32, 0, 32, 1),\n  new Color(63, 0, 63, 1),\n  new Color(95, 0, 95, 1),\n  new Color(127, 0, 127, 1),\n  new Color(159, 0, 159, 1),\n  new Color(191, 0, 191, 1),\n  new Color(223, 0, 223, 1),\n  new Color(255, 0, 255, 1),\n  new Color(0, 32, 32, 1),\n  new Color(0, 63, 63, 1),\n  new Color(0, 95, 95, 1),\n  new Color(0, 127, 127, 1),\n  new Color(0, 159, 159, 1),\n  new Color(0, 191, 191, 1),\n  new Color(0, 223, 223, 1),\n  new Color(0, 255, 255, 1),\n  new Color(16, 16, 16, 1),\n  new Color(31, 31, 31, 1),\n  new Color(47, 47, 47, 1),\n  new Color(63, 63, 63, 1),\n  new Color(79, 79, 79, 1),\n  new Color(95, 95, 95, 1),\n  new Color(111, 111, 111, 1),\n  new Color(127, 127, 127, 1),\n  new Color(143, 143, 143, 1),\n  new Color(159, 159, 159, 1),\n  new Color(175, 175, 175, 1),\n  new Color(191, 191, 191, 1),\n  new Color(207, 207, 207, 1),\n  new Color(223, 223, 223, 1),\n  new Color(239, 239, 239, 1),\n  new Color(255, 255, 255, 1),\n  new Color(255, 0, 0, 1),\n  new Color(255, 31, 0, 1),\n  new Color(255, 63, 0, 1),\n  new Color(255, 95, 0, 1),\n  new Color(255, 127, 0, 1),\n  new Color(255, 159, 0, 1),\n  new Color(255, 191, 0, 1),\n  new Color(255, 223, 0, 1),\n  new Color(255, 255, 0, 1),\n  new Color(224, 255, 0, 1),\n  new Color(192, 255, 0, 1),\n  new Color(160, 255, 0, 1),\n  new Color(128, 255, 0, 1),\n  new Color(96, 255, 0, 1),\n  new Color(64, 255, 0, 1),\n  new Color(32, 255, 0, 1),\n  new Color(0, 255, 0, 1),\n  new Color(0, 255, 31, 1),\n  new Color(0, 255, 63, 1),\n  new Color(0, 255, 95, 1),\n  new Color(0, 255, 127, 1),\n  new Color(0, 255, 159, 1),\n  new Color(0, 255, 191, 1),\n  new Color(0, 255, 223, 1),\n  new Color(0, 255, 255, 1),\n  new Color(0, 224, 255, 1),\n  new Color(0, 192, 255, 1),\n  new Color(0, 160, 255, 1),\n  new Color(0, 128, 255, 1),\n  new Color(0, 96, 255, 1),\n  new Color(0, 64, 255, 1),\n  new Color(0, 32, 255, 1),\n  new Color(0, 0, 255, 1),\n  new Color(31, 0, 255, 1),\n  new Color(63, 0, 255, 1),\n  new Color(95, 0, 255, 1),\n  new Color(127, 0, 255, 1),\n  new Color(159, 0, 255, 1),\n  new Color(191, 0, 255, 1),\n  new Color(223, 0, 255, 1),\n  new Color(255, 0, 255, 1),\n  new Color(255, 0, 224, 1),\n  new Color(255, 0, 192, 1),\n  new Color(255, 0, 160, 1),\n  new Color(255, 0, 128, 1),\n  new Color(255, 0, 96, 1),\n  new Color(255, 0, 64, 1),\n  new Color(255, 0, 32, 1),\n  new Color(255, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(8, 8, 8, 1),\n  new Color(16, 16, 16, 1),\n  new Color(24, 24, 24, 1),\n  new Color(32, 32, 32, 1),\n  new Color(41, 41, 41, 1),\n  new Color(49, 49, 49, 1),\n  new Color(57, 57, 57, 1),\n  new Color(65, 65, 65, 1),\n  new Color(74, 74, 74, 1),\n  new Color(82, 82, 82, 1),\n  new Color(90, 90, 90, 1),\n  new Color(98, 98, 98, 1),\n  new Color(106, 106, 106, 1),\n  new Color(115, 115, 115, 1),\n  new Color(123, 123, 123, 1),\n  new Color(131, 131, 131, 1),\n  new Color(139, 139, 139, 1),\n  new Color(148, 148, 148, 1),\n  new Color(156, 156, 156, 1),\n  new Color(164, 164, 164, 1),\n  new Color(172, 172, 172, 1),\n  new Color(180, 180, 180, 1),\n  new Color(189, 189, 189, 1),\n  new Color(197, 197, 197, 1),\n  new Color(205, 205, 205, 1),\n  new Color(213, 213, 213, 1),\n  new Color(222, 222, 222, 1),\n  new Color(230, 230, 230, 1),\n  new Color(238, 238, 238, 1),\n  new Color(246, 246, 246, 1),\n  new Color(255, 255, 255, 1)\n];\n\nexport default DEFAULT_PALETTE;\n","import { ImageInterface, Color, Dimensions, Mode } from \"./interfaces\";\nimport { PALETTE_LENGTH } from \"./consts\";\nimport Palette from \"../models/Palette\";\n\n/*\n  getGBAImageString\n\n  take in ImageObject and Palette\n  get the image array from image2GBA\n  get the palette array from pal2GBA\n  returns the combination of them into one string\n*/\nexport function generateCSourceFileString(\n  image: ImageInterface,\n  mode: Mode,\n  palette?: Palette\n): string {\n  switch (mode) {\n    case 3:\n      return generateMode3CSourceFileString(image);\n    case 4:\n      return generateMode4CSourceFileString(image, palette);\n    default:\n      return generateMode3CSourceFileString(image);\n  }\n}\n\nfunction generateMode3CSourceFileString(image: ImageInterface): string {\n  const { fileName, dimensions, imageData } = image.getImageDataStore();\n\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = dimensions.height * dimensions.width;\n  const imageDefinitionString = `const unsigned short ${variableName}Bitmap[${bitmapLength /\n    2}]__attribute__((aligned(4)))=\\n{\\n\\t`;\n\n  let imageDataHexString = ``;\n\n  let pixelCount = 0;\n  for (var i = 0, j = imageData.length; i < j; i += 4) {\n    let bgr = [imageData[i + 2], imageData[i + 1], imageData[i]]; // bgr for little endian\n    let hexcode = pixelToHex(bgr);\n    imageDataHexString += hexcode + \",\";\n    pixelCount++;\n    if (pixelCount % 8 === 0) {\n      imageDataHexString += \"\\n\";\n      if (pixelCount % 64 === 0) {\n        imageDataHexString += \"\\n\\t\";\n      } else {\n        imageDataHexString += \"\\t\";\n      }\n    }\n  }\n\n  const imageDefinitionEnd = `\\n};\\n`;\n\n  return imageDefinitionString + imageDataHexString + imageDefinitionEnd;\n}\n\nfunction generateMode4CSourceFileString(\n  image: ImageInterface,\n  palette?: Palette\n): string {\n  if (!palette) {\n    console.error(\n      \"Tried to generate mode 4 header string with no palette! Falling back to mode 3...\"\n    );\n    return generateMode3CSourceFileString(image);\n  }\n\n  const { fileName, dimensions, imageData } = image.getImageDataStore();\n\n  // Note: we compress the length of the bitmap by 2 because we can fit 2 chars\n  // into a short\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = dimensions.height * dimensions.width;\n  const imageDefinitionString = `const unsigned short ${variableName}Bitmap[${bitmapLength /\n    2}]__attribute__((aligned(4)))=\\n{\\n`;\n\n  let imageDataHexString = \"\";\n  for (let i = 0; i < imageData.length; i += 2) {\n    imageDataHexString += paletteIndicesToHex(imageData[i], imageData[i + 1]);\n    if ((i / 2 + 1) % 8 === 0) imageDataHexString += `\\n`;\n  }\n  const imageDefinitionEnd = `};\\n\\n`;\n\n  // Palette length is uncompressed\n  const paletteCSourceString = PaletteToGBA(palette);\n\n  const CSourceString =\n    imageDefinitionString +\n    imageDataHexString +\n    imageDefinitionEnd +\n    paletteCSourceString;\n\n  return CSourceString;\n}\n\ninterface headerFileParams {\n  fileName: string;\n  imageDimensions: Dimensions;\n  palette?: Palette;\n}\n\nexport function generateHeaderString(\n  params: headerFileParams,\n  mode: 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7\n): string {\n  switch (mode) {\n    case 3:\n      return generateMode3HeaderString(params);\n    case 4:\n      return generateMode4HeaderString(params);\n    default:\n      console.warn(\n        `Attempting to generate header file for mode ${mode}, but it's unsupported for now. Defaulting to mode 3.`\n      );\n      return generateMode3HeaderString(params);\n  }\n}\n\nexport function generateMode3HeaderString({\n  fileName,\n  imageDimensions,\n  palette\n}: headerFileParams): string {\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = imageDimensions.height * imageDimensions.width;\n  const bitmapSize = bitmapLength * 2;\n  // TODO: Find out how to compute the size vs. the length of the bitmap\n  const bitmapSizeDefinition = `#define ${variableName.toUpperCase()}_SIZE ${bitmapSize}\\n`;\n  const bitmapLengthDefinition = `#define ${variableName.toUpperCase()}_LENGTH ${bitmapLength}\\n`;\n  const imageHeightDefinition = `#define ${variableName.toUpperCase()}_HEIGHT ${\n    imageDimensions.height\n  }\\n`;\n  const imageWidthDefinition = `#define ${variableName.toUpperCase()}_WIDTH ${\n    imageDimensions.width\n  }\\n`;\n  const imageDefinitionString = `extern const unsigned short ${variableName}Bitmap[${bitmapLength}];\\n\\n`;\n\n  const headerString =\n    bitmapLengthDefinition +\n    bitmapSizeDefinition +\n    imageHeightDefinition +\n    imageWidthDefinition +\n    `\\n` +\n    imageDefinitionString +\n    `\\n`;\n\n  return headerString;\n}\n\nexport function generateMode4HeaderString({\n  fileName,\n  imageDimensions,\n  palette\n}: headerFileParams): string {\n  if (!palette) {\n    console.error(\n      \"Tried to generate mode 4 header string with no palette! Falling back to mode 3...\"\n    );\n    return generateMode3HeaderString({\n      fileName: fileName,\n      imageDimensions: imageDimensions\n    });\n  }\n\n  // Note: we compress the length of the bitmap by 2 because we can fit 2 chars\n  // into a short\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = imageDimensions.height * imageDimensions.width;\n  const bitmapLengthDefinition = `#define ${variableName.toUpperCase()}_SIZE ${bitmapLength}\\n`;\n  const imageHeightDefinition = `#define ${variableName.toUpperCase()}_HEIGHT ${\n    imageDimensions.height\n  }\\n`;\n  const imageWidthDefinition = `#define ${variableName.toUpperCase()}_WIDTH ${\n    imageDimensions.width\n  }\\n`;\n  const imageDefinitionString = `extern const unsigned short ${variableName}Bitmap[${bitmapLength /\n    2}];\\n\\n`;\n\n  // Palette length is uncompressed\n  const paletteLengthDefinition = `#define ${variableName.toUpperCase()}_PAL_SIZE ${PALETTE_LENGTH *\n    2}\\n`;\n  const paletteDefinitionString = `extern const unsigned short ${variableName}Palette[${PALETTE_LENGTH}];\\n\\n`;\n\n  const headerString =\n    bitmapLengthDefinition +\n    imageHeightDefinition +\n    imageWidthDefinition +\n    imageDefinitionString +\n    paletteLengthDefinition +\n    paletteDefinitionString;\n\n  return headerString;\n}\n\nfunction paletteIndicesToHex(index1: number, index2: number): string {\n  if (index1 > 255 || index2 > 255) {\n    console.error(\n      `Tried to convert palette indices ${index1} and ${index2}, but at least one is out of range! Truncating bitwise...`\n    );\n  }\n\n  index1 = index1 & 0xff; // Truncate in case the indices are too big\n  index2 = index2 & 0xff;\n\n  const combinedIndexString = (index2 | (index1 << 8))\n    .toString(16)\n    .toUpperCase()\n    .padStart(4, \"0\");\n\n  return `0x${combinedIndexString}, `;\n}\n\n/*\n  pixel2hex\n\n  takes in a number array [b: number, g: number, r: number]\n  convert each pixel to GBA compatible bgr hex format\n  return hex value of pixel\n*/\nfunction pixelToHex(bgr: number[]): string {\n  // convert to 16-bit binary format: 0bbbbbgggggrrrrr\n  let binary_value = \"0\";\n  bgr.forEach(element => {\n    element = Math.floor((element * 32) / 256);\n    let elementString = element.toString(2); // convert to binary\n    while (elementString.length < 5) {\n      elementString = \"0\" + elementString;\n    }\n    binary_value += elementString;\n  });\n  // convert to hex\n  let hex_value = parseInt(binary_value, 2).toString(16);\n  while (hex_value.length < 4) {\n    hex_value = \"0\" + hex_value;\n  }\n  hex_value = hex_value.toUpperCase();\n  return \"0x\" + hex_value;\n}\n\nfunction colorToHex(color: Color): string {\n  let bgr = [color.b, color.g, color.r];\n  return pixelToHex(bgr);\n}\n\n/*\n  pal2Hex\n  \n  takes in a Palette and converts rgb into hex values 0x00rrggbb\n  outputs string of the converted Palette colorArray\n*/\nexport function paletteToHex(palette: Palette): string {\n  let palFile = \"\";\n  let count = 1;\n  const alignment = 4; //this number can change depending on how we want to format\n  palette.forEach(element => {\n    let hex = \"0x00\";\n    hex +=\n      element.r < 16 ? \"0\" + element.r.toString(16) : element.r.toString(16);\n    hex +=\n      element.g < 16 ? \"0\" + element.g.toString(16) : element.g.toString(16);\n    hex +=\n      element.b < 16 ? \"0\" + element.b.toString(16) : element.b.toString(16);\n    palFile += hex + \"\\t\";\n    if (count === alignment) {\n      palFile += \"\\n\";\n      count = 1;\n    } else {\n      count++;\n    }\n  });\n  return palFile;\n}\n\n/*\n  pal2GBA\n  \n  takes in a Palette and converts rgb into hex values (binary: 0bbbbbgggggrrrrr)\n  adds a declaration for the palette array in C\n  outputs string with the declaration and converted Palette colorArray\n*/\nfunction PaletteToGBA(palette: Palette): string {\n  const palArea = PALETTE_LENGTH;\n  const colAlignment = 8; //these numbers can change depending depending on how we want to format\n  const rowAlignment = 8; //\n\n  let palC =\n    \"const unsigned short powPal[\" +\n    palArea +\n    \"] __attribute__((aligned(4)))=\\n{\\n\";\n\n  for (let i = 1; i <= palette.length; i++) {\n    const element = palette[i - 1];\n    palC += colorToHex(element) + \",\";\n\n    if (i % colAlignment === 0) {\n      palC += \"\\n\";\n    }\n    if (i % (colAlignment * rowAlignment) === 0) {\n      palC += \"\\n\";\n    }\n  }\n\n  return palC + \"};\";\n}\n\nexport function exportPalette(pal: Palette): string {\n  return paletteToHex(pal);\n}\n\nexport async function exportImage(\n  img: ImageInterface,\n  type: string\n): Promise<Blob | null> {\n  switch (type) {\n    case \"BMP\":\n    case \"PNG\":\n      return await img.getImageFileBlob();\n    default:\n      return new Blob([\"Invalid file type\"]);\n  }\n}\n","import {\n  Color,\n  Dimensions,\n  ImageInterface,\n  ImageCoordinates,\n  ImageDataStore\n} from \"../util/interfaces\";\nimport ImageCanvas from \"./ImageCanvas\";\nimport * as Loader from \"../util/fileLoadUtils\";\n\nexport default abstract class Bitmap implements ImageInterface {\n  public fileName: string;\n  public dimensions: Dimensions;\n\n  protected imageData: Uint8ClampedArray;\n  protected abstract imageCanvas: ImageCanvas;\n\n  constructor(\n    fileName: string,\n    dimensions: Dimensions,\n    imageData?: Uint8ClampedArray\n  ) {\n    this.fileName = fileName;\n    this.dimensions = dimensions;\n\n    if (imageData) {\n      this.imageData = imageData;\n    } else {\n      this.imageData = new Uint8ClampedArray(\n        this.dimensions.width * this.dimensions.height * 4\n      );\n    }\n  }\n\n  public getImageCanvasElement(): HTMLCanvasElement {\n    return this.imageCanvas.getImageCanvasElement();\n  }\n\n  public getPixelGridCanvasElement(): HTMLCanvasElement {\n    return this.imageCanvas.getPixelGridCanvasElement();\n  }\n\n  // public getRawImageData(): Uint8ClampedArray {\n  //   return this.imageData;\n  // }\n\n  public getImageDataStore(): ImageDataStore {\n    return {\n      fileName: this.fileName,\n      dimensions: this.dimensions,\n      imageData: this.imageData\n    };\n  }\n\n  public async getImageFileBlob(): Promise<Blob | null> {\n    return new Promise(resolve => {\n      this.getImageCanvasElement().toBlob(blob => resolve(blob));\n    });\n  }\n\n  protected updateImageData(pos: ImageCoordinates, color: Color): void {\n    this.imageData[Loader.offset(pos, this.dimensions)] = color.r;\n    this.imageData[Loader.offset(pos, this.dimensions) + 1] = color.g;\n    this.imageData[Loader.offset(pos, this.dimensions) + 2] = color.b;\n    this.imageData[Loader.offset(pos, this.dimensions) + 3] = color.a;\n  }\n\n  /////////////////////////////////////// abstract classes\n\n  public abstract getCSourceData(): string;\n  public abstract getHeaderData(): string;\n  public abstract getPixelColorAt(pos: ImageCoordinates): Color;\n  public abstract setPixelColor(pos: ImageCoordinates, color: Color): void;\n}\n","import {\n  Color,\n  Dimensions,\n  ImageInterface,\n  ImageCoordinates\n} from \"../util/interfaces\";\nimport { createHiddenCanvas } from \"../util/fileLoadUtils\";\n\nexport default class ImageCanvas {\n  public dimensions: Dimensions;\n  public pixelGridRatio = 16;\n\n  private hiddenCanvas: HTMLCanvasElement;\n  private context: CanvasRenderingContext2D | null;\n  private pixelGrid: PixelGrid;\n\n  public constructor(image: ImageInterface) {\n    console.log(\"Creating new internal ImageCanvas.\");\n\n    this.dimensions = image.dimensions;\n    this.hiddenCanvas = createHiddenCanvas(image.dimensions);\n    this.context = this.hiddenCanvas.getContext(\"2d\");\n    this.pixelGrid = new PixelGrid(image.dimensions, this.pixelGridRatio);\n\n    this.drawImageToHiddenCanvas(image);\n  }\n\n  public getImageCanvasElement(): HTMLCanvasElement {\n    return this.hiddenCanvas;\n  }\n\n  public getPixelGridCanvasElement(): HTMLCanvasElement {\n    return this.pixelGrid.getCanvasElement();\n  }\n\n  public updatePixel(pos: ImageCoordinates, color: Color): void {\n    this.drawPixel(pos, color);\n  }\n\n  public updateRegion(\n    image: ImageInterface,\n    x: number,\n    y: number,\n    dx: number,\n    dy: number\n  ): void {\n    // for (let x = 0; x < image.dimensions.width; x++) {\n    //   for (let y = 0; y < image.dimensions.height; y++) {\n    //     this.drawPixel({ x, y }, image.getPixelColorAt({ x, y }));\n    //   }\n    // }\n  }\n\n  public redrawImage(image: ImageInterface): void {\n    this.drawImageToHiddenCanvas(image);\n  }\n\n  private drawPixel(pos: ImageCoordinates, color: Color): void {\n    if (!this.context) return;\n    let colorString = `rgba(${color.r}, ${color.g}, ${color.b}, 1)`;\n    this.context.fillStyle = colorString;\n    this.context.fillRect(pos.x, pos.y, 1, 1);\n  }\n\n  private drawImageToHiddenCanvas(image: ImageInterface) {\n    for (let x = 0; x < image.dimensions.width; x++) {\n      for (let y = 0; y < image.dimensions.height; y++) {\n        this.drawPixel({ x, y }, image.getPixelColorAt({ x, y }));\n      }\n    }\n  }\n}\n\nexport class PixelGrid {\n  public dimensions: Dimensions;\n  public pixelGridRatio = 16;\n\n  private hiddenCanvas: HTMLCanvasElement;\n  private context: CanvasRenderingContext2D | null;\n\n  constructor(dimensions: Dimensions, pixelGridRatio: number) {\n    console.log(\"Setting up pixel grid.\");\n\n    this.pixelGridRatio = pixelGridRatio;\n\n    this.dimensions = dimensions;\n    this.hiddenCanvas = createHiddenCanvas({\n      width: this.dimensions.width * this.pixelGridRatio,\n      height: this.dimensions.height * this.pixelGridRatio\n    });\n    this.context = this.hiddenCanvas.getContext(\"2d\");\n\n    this.drawGrid();\n  }\n\n  public getCanvasElement(): HTMLCanvasElement {\n    return this.hiddenCanvas;\n  }\n\n  private drawGrid(): void {\n    if (!this.context) return;\n    const { width, height } = this.dimensions;\n    this.context.strokeStyle = \"gray\";\n    this.context.beginPath();\n\n    for (let x = 0; x <= width; x++) {\n      this.context.moveTo(x * this.pixelGridRatio, 0);\n      this.context.lineTo(\n        x * this.pixelGridRatio,\n        height * this.pixelGridRatio\n      );\n    }\n\n    for (let y = 0; y <= height; y++) {\n      this.context.moveTo(0, y * this.pixelGridRatio);\n      this.context.lineTo(width * this.pixelGridRatio, y * this.pixelGridRatio);\n    }\n\n    this.context.stroke();\n  }\n}\n","import {\n  Color,\n  Dimensions,\n  ImageCoordinates,\n  ImageDataStore\n} from \"../util/interfaces\";\nimport {\n  generateHeaderString,\n  generateCSourceFileString\n} from \"../util/exportUtils\";\nimport * as Loader from \"../util/fileLoadUtils\";\nimport Bitmap from \"./Bitmap\";\nimport ImageCanvas from \"./ImageCanvas\";\n\nclass Bitmap3 extends Bitmap {\n  protected imageCanvas: ImageCanvas;\n\n  constructor(\n    fileName: string,\n    dimensions: Dimensions,\n    imageData?: Uint8ClampedArray\n  ) {\n    super(fileName, dimensions, imageData);\n\n    this.imageCanvas = new ImageCanvas(this);\n  }\n\n  static fromDataStore({\n    imageData,\n    dimensions,\n    fileName\n  }: ImageDataStore): Bitmap3 {\n    return new Bitmap3(fileName, dimensions, imageData as Uint8ClampedArray);\n  }\n\n  public getCSourceData(): string {\n    return generateCSourceFileString(this, 3);\n  }\n\n  public getHeaderData(): string {\n    return generateHeaderString(\n      { fileName: this.fileName, imageDimensions: this.dimensions },\n      3\n    );\n  }\n\n  public getPixelColorAt(pos: ImageCoordinates): Color {\n    const r = this.imageData[Loader.offset(pos, this.dimensions)];\n    const g = this.imageData[Loader.offset(pos, this.dimensions) + 1];\n    const b = this.imageData[Loader.offset(pos, this.dimensions) + 2];\n    const a = this.imageData[Loader.offset(pos, this.dimensions) + 3];\n\n    return new Color(r, g, b, a);\n  }\n\n  public setPixelColor(pos: ImageCoordinates, color: Color): void {\n    super.updateImageData(pos, color);\n    this.imageCanvas.updatePixel(pos, color);\n  }\n}\n\nexport default Bitmap3;\n","import { Dimensions, ImageCoordinates, Color } from \"./interfaces\";\nimport Bitmap from \"../models/Bitmap\";\nimport Bitmap3 from \"../models/Bitmap3\";\nimport Palette from \"../models/Palette\";\n\nexport const createHiddenCanvas = (d: Dimensions): HTMLCanvasElement => {\n  let hiddenCanvas = document.createElement(\"canvas\");\n  hiddenCanvas.hidden = true;\n  hiddenCanvas.setAttribute(\"height\", d.height + \"px\");\n  hiddenCanvas.setAttribute(\"width\", d.width + \"px\");\n  return hiddenCanvas;\n};\n\nexport const loadImageDataFromCanvas = (\n  canvas: HTMLCanvasElement,\n  dimensions: Dimensions\n): Uint8ClampedArray => {\n  const context = canvas.getContext(\"2d\") as CanvasRenderingContext2D; // unsafe\n  return context.getImageData(0, 0, dimensions.width, dimensions.height).data;\n};\n\n// is async necessary here???? I don't think it is\nexport const loadHiddenImage = (imagefile: File): Promise<HTMLImageElement> => {\n  return new Promise((resolve, reject) => {\n    let image = new Image();\n    image.hidden = true;\n\n    image.onload = () => {\n      resolve(image);\n    };\n\n    image.onerror = reject;\n    image.src = URL.createObjectURL(imagefile);\n  });\n};\n\nexport const loadNewImage = async (imageFile: File): Promise<Bitmap> => {\n  let hiddenImage = await loadHiddenImage(imageFile);\n  let dimensions = {\n    height: hiddenImage.naturalHeight,\n    width: hiddenImage.naturalWidth\n  };\n  let hiddenCanvas = createHiddenCanvas(dimensions);\n  const context = hiddenCanvas.getContext(\"2d\");\n  if (context) context.drawImage(hiddenImage, 0, 0);\n  let imageData = loadImageDataFromCanvas(hiddenCanvas, dimensions);\n  return new Bitmap3(imageFile.name, dimensions, imageData);\n};\n\nexport const offset = (pos: ImageCoordinates, d: Dimensions) =>\n  4 * (pos.y * d.width + pos.x);\n\n/**\n * loadNewPalette\n * @param paletteFile .pal file being imported\n * generates a Color[] by iterating through the File\n * returns initialized palette\n */\nexport const loadNewPalette = async (\n  paletteFile: File\n): Promise<Palette | null> => {\n  let text = await new Response(paletteFile).text();\n  let fileString = text\n    .trim()\n    .replace(/\\t/g, \"\")\n    .replace(/\\n/g, \"\");\n  let colors: Color[] = new Array(256);\n\n  // checking to make sure string is properly formatted before iterating through it\n  if (fileString.substr(0, 4) === \"0x00\") {\n    console.log(\"Palette file is valid. Generating color array...\");\n\n    // string is in 0x00rrggbb format (length 10)\n    for (let i = 0, j = 0; i < fileString.length; i += 10, j++) {\n      let red = parseInt(fileString.substr(i + 4, 2), 16);\n      let green = parseInt(fileString.substr(i + 6, 2), 16);\n      let blue = parseInt(fileString.substr(i + 8, 2), 16);\n\n      let color = new Color(red, green, blue, 1);\n      colors[j] = color;\n    }\n    return colors;\n  } else {\n    console.log(\"Invalid palette. Palette unchanged.\");\n    return null;\n  }\n};\n","import {\n  Color,\n  Dimensions,\n  ImageCoordinates,\n  ImageDataStore\n} from \"../util/interfaces\";\nimport {\n  generateHeaderString,\n  generateCSourceFileString\n} from \"../util/exportUtils\";\nimport Palette from \"./Palette\";\nimport ImageCanvas from \"./ImageCanvas\";\nimport Bitmap from \"./Bitmap\";\n\nexport default class Bitmap4 extends Bitmap {\n  private data: number[];\n  private palette: Palette;\n  private currentPaletteIndex: number;\n\n  protected imageCanvas: ImageCanvas;\n\n  constructor(\n    fileName: string,\n    palette: Palette,\n    dimensions: Dimensions,\n    indexArray?: number[]\n  ) {\n    super(fileName, dimensions);\n    if (indexArray) {\n      this.data = indexArray;\n    } else {\n      this.data = Array<number>(dimensions.height * dimensions.width).fill(0);\n    }\n    this.palette = palette;\n    this.imageCanvas = new ImageCanvas(this);\n    this.currentPaletteIndex = 0;\n  }\n\n  static fromDataStore(\n    { imageData, dimensions, fileName }: ImageDataStore,\n    palette: Palette\n  ): Bitmap4 {\n    return new Bitmap4(fileName, palette, dimensions, imageData as number[]);\n  }\n\n  public getHeaderData(): string {\n    return generateHeaderString(\n      {\n        fileName: this.fileName,\n        imageDimensions: this.dimensions,\n        palette: this.palette\n      },\n      4\n    );\n  }\n\n  public getCSourceData(): string {\n    return generateCSourceFileString(this, 4, this.palette);\n  }\n\n  /**\n   * Returns the color at the specified index in the image by indexing into the\n   * color palette\n   * @param ImageCoordinates the index in the Sprite that you would like to get\n   *    the color at\n   */\n  public getPixelColorAt(pos: ImageCoordinates): Color {\n    if (pos.x >= this.dimensions.width || pos.y >= this.dimensions.height) {\n      console.error(\n        \"Tried to access pixel at\",\n        pos,\n        \"but dimensions of sprite are\",\n        this.dimensions\n      );\n    }\n    return this.palette[this.data[this.dimensions.width * pos.y + pos.x]];\n  }\n\n  public setPixelColor(pos: ImageCoordinates): void {\n    this.data[pos.y * this.dimensions.width + pos.x] = this.currentPaletteIndex;\n    this.imageCanvas.updatePixel(pos, this.palette[this.currentPaletteIndex]);\n  }\n\n  setPaletteIndex(newPaletteIndex: number) {\n    this.currentPaletteIndex = newPaletteIndex;\n  }\n\n  public updatePalette(newPalette: Palette): void {\n    this.palette = newPalette;\n    this.imageCanvas.redrawImage(this);\n  }\n\n  public getImageDataStore(): ImageDataStore {\n    return {\n      imageData: this.data,\n      dimensions: this.dimensions,\n      fileName: this.fileName\n    };\n  }\n}\n","import Bitmap4 from \"../models/Bitmap4\";\r\nimport Palette from \"../models/Palette\";\r\nimport { Color } from \"./interfaces\";\r\nimport Bitmap from \"../models/Bitmap\";\r\n\r\nconst BLACK: Color = new Color(0, 0, 0, 1);\r\n\r\nexport function quantize(\r\n  image: Bitmap,\r\n  depth: number\r\n): { sprite: Bitmap4; palette: Palette } {\r\n  let centroids: number[][];\r\n  let imageArr = imageToArr(image);\r\n  let colors = depth;\r\n  const MaxPalSize = 256;\r\n\r\n  //start by checking that there are at least 'depth' unique colors in image\r\n  // console.log(\"find colors\")\r\n  let uniqueColors = [];\r\n  let uniqueColorsString: String[] = [];\r\n  for (let i = 0; i < imageArr.length; i++) {\r\n    let check = imageArr[i];\r\n    if (!uniqueColorsString.includes(JSON.stringify(check))) {\r\n      uniqueColors.push(check);\r\n      uniqueColorsString.push(JSON.stringify(check));\r\n    }\r\n  }\r\n\r\n  //pick unique colors for centroids using binary search to find points with\r\n  //largest average distance\r\n  if (colors === 1 || uniqueColors.length < colors) {\r\n    centroids = uniqueColors;\r\n    colors = uniqueColors.length;\r\n  } else {\r\n    let { pickedCentroids } = findCentroids(uniqueColors, colors);\r\n    // console.log(pickedCentroids)\r\n    centroids = JSON.parse(JSON.stringify(pickedCentroids));\r\n  }\r\n\r\n  // use K-means to fit all colors in image to 'colors' clusters\r\n  let { groups, centers } = kmeans(\r\n    JSON.parse(JSON.stringify(imageArr)),\r\n    JSON.parse(JSON.stringify(centroids)),\r\n    colors\r\n  );\r\n\r\n  // console.log(\"kmeans output:\")\r\n  // console.log(groups[0][0]);\r\n  // console.log(centers);\r\n\r\n  let clusters: number[][][] = [];\r\n  //group centers and points in cluster for sorting\r\n  for (let i = 0; i < centers.length; i++) {\r\n    let newCluster: number[][] = [[], []];\r\n    newCluster[0] = centers[i];\r\n    for (var j = 0; j < groups[i].length; j++) {\r\n      newCluster[j + 1] = groups[i][j];\r\n    }\r\n    clusters.push(newCluster);\r\n  }\r\n  // sort clusters from largest to smallest\r\n  clusters.sort(function(a, b) {\r\n    return b.length - a.length;\r\n  });\r\n\r\n  console.log(clusters);\r\n\r\n  let spriteIndexArrayLength = image.dimensions.height * image.dimensions.width;\r\n\r\n  // generate out sprite and palette based on k-means clusters\r\n  let spriteIndexArray: number[] = new Array<number>(spriteIndexArrayLength);\r\n  spriteIndexArray.fill(0);\r\n\r\n  let palette: Color[] = new Array(256);\r\n\r\n  //clusters: [center[r,g,b]], [point 1[r,g,b]], ...]\r\n  let i = 0;\r\n  for (i; i < clusters.length && i < MaxPalSize; i++) {\r\n    let center: Color = new Color(\r\n      clusters[i][0][0],\r\n      clusters[i][0][1],\r\n      clusters[i][0][2],\r\n      1\r\n    );\r\n    palette[i] = center;\r\n    for (let j = 1; j < clusters[i].length; j++) {\r\n      let imageIndex = getColorIndex(imageArr, clusters[i][j]);\r\n      // console.log(imageIndex);\r\n      if (imageIndex !== -1) {\r\n        spriteIndexArray[imageIndex] = i;\r\n      }\r\n    }\r\n  }\r\n  // console.log(paletteColorArray)\r\n  for (i; i < MaxPalSize; i++) {\r\n    palette[i] = BLACK;\r\n  }\r\n\r\n  let sprite = new Bitmap4(\r\n    image.fileName,\r\n    palette,\r\n    image.dimensions,\r\n    spriteIndexArray\r\n  );\r\n  return { sprite, palette };\r\n}\r\n\r\n// Used to find index of colors for building sprite colorArray\r\n// This kills the imageArr (imageArr is destroyed by this function)\r\nfunction getColorIndex(imageArr: number[][], colorArr: number[]): number {\r\n  for (let i = 0; i < imageArr.length; i++) {\r\n    if (\r\n      imageArr[i][0] === colorArr[0] &&\r\n      imageArr[i][1] === colorArr[1] &&\r\n      imageArr[i][2] === colorArr[2]\r\n    ) {\r\n      imageArr[i] = [-1, -1, -1];\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\n//converts imageObject into array of colors for k-means\r\nfunction imageToArr(image: Bitmap): number[][] {\r\n  let imageArr = [];\r\n  for (let y = 0; y < image.dimensions.height; y++) {\r\n    for (let x = 0; x < image.dimensions.width; x++) {\r\n      let color = image.getPixelColorAt({ x, y });\r\n      imageArr.push([\r\n        Math.round(Math.min(Math.max(color.r, 0), 255)),\r\n        Math.round(Math.min(Math.max(color.g, 0), 255)),\r\n        Math.round(Math.min(Math.max(color.b, 0), 255))\r\n      ]);\r\n    }\r\n  }\r\n  return imageArr;\r\n}\r\n\r\n//used to find clusters of similar points for image depth reduction (quantization)\r\n//arrayToProcess: number array of colors; [[r, g, b], [r, g, b], ...]\r\n//centroids: center point of clusters;\r\n//clusters: number of clusters to generate\r\nfunction kmeans(\r\n  arrayToProcess: number[][],\r\n  centroids: number[][],\r\n  clusters: number\r\n): { groups: number[][][]; centers: number[][] } {\r\n  let Groups: any[] = [];\r\n  let iterations = 0;\r\n  let tempdistance = 0;\r\n  let oldcentroids: number[][] = JSON.parse(JSON.stringify(centroids));\r\n  let changed = false;\r\n\r\n  do {\r\n    for (let reset = 0; reset < clusters; reset++) {\r\n      Groups[reset] = [];\r\n    }\r\n\r\n    changed = false;\r\n\r\n    changed = false;\r\n\r\n    for (let i = 0; i < arrayToProcess.length; i++) {\r\n      let minDist = -1;\r\n      let minCluster = 0;\r\n\r\n      for (\r\n        let clusterIterate = 0;\r\n        clusterIterate < clusters;\r\n        clusterIterate++\r\n      ) {\r\n        let dist = 0;\r\n\r\n        for (let j = 0; j < arrayToProcess[i].length; j++) {\r\n          dist += Math.pow(\r\n            Math.abs(arrayToProcess[i][j] - centroids[clusterIterate][j]),\r\n            2\r\n          );\r\n        }\r\n        tempdistance = Math.sqrt(dist);\r\n\r\n        if (minDist === -1 || tempdistance <= minDist) {\r\n          minDist = tempdistance;\r\n          minCluster = clusterIterate;\r\n        }\r\n      }\r\n      Groups[minCluster].push(arrayToProcess[i].slice());\r\n    }\r\n\r\n    for (let clusterIterate = 0; clusterIterate < clusters; clusterIterate++) {\r\n      for (let i = 0; i < Groups[clusterIterate].length; i++) {\r\n        for (let j = 0; j < Groups[clusterIterate][i].length; j++) {\r\n          centroids[clusterIterate][j] += Groups[clusterIterate][i][j];\r\n        }\r\n      }\r\n      for (let i = 0; i < centroids[clusterIterate].length; i++) {\r\n        centroids[clusterIterate][i] = Math.round(\r\n          Math.min(\r\n            Math.max(\r\n              centroids[clusterIterate][i] /\r\n                (Groups[clusterIterate].length <= 1\r\n                  ? 1\r\n                  : Groups[clusterIterate].length),\r\n              0\r\n            ),\r\n            255\r\n          )\r\n        );\r\n\r\n        if (centroids[clusterIterate][i] !== oldcentroids[clusterIterate][i]) {\r\n          changed = true;\r\n          oldcentroids = [];\r\n          oldcentroids = JSON.parse(JSON.stringify(centroids));\r\n        }\r\n      }\r\n    }\r\n    iterations++;\r\n  } while (changed === true && iterations < 1000);\r\n\r\n  console.log(\"kmeans output:\");\r\n  console.log(iterations);\r\n  // console.log(Groups.length);\r\n  // console.log(Groups);\r\n  console.log(\"..........\");\r\n\r\n  // let ret = [Groups, centroids];\r\n  // console.log(ret);\r\n  // return ret;\r\n\r\n  return { groups: Groups, centers: centroids };\r\n}\r\n\r\n//function to determine if there exists a group of centroids with specific\r\n//average distance between them\r\n//points: list of points to search\r\n//midDist: desired average distance\r\n//numCentroids: number of points to find\r\n//\r\n//returns:\r\n//possible (boolean)\r\n//centers (list of points with desired distance)\r\nfunction centroidPossible(\r\n  points: number[][],\r\n  midDist: number,\r\n  numCentroids: number\r\n): { possible: boolean; centers: number[][] } {\r\n  let centroids = 1;\r\n  let currColor: number[] = points[0];\r\n  let possible = false;\r\n  let centers: number[][] = [];\r\n\r\n  centers.push(currColor);\r\n\r\n  for (let i = 0; i < points.length; i++) {\r\n    let dist = 0;\r\n\r\n    for (let j = 0; j < points[i].length; j++) {\r\n      dist += Math.pow(Math.abs(points[i][j] - currColor[j]), 2);\r\n    }\r\n    dist = Math.sqrt(dist);\r\n\r\n    if (dist >= midDist) {\r\n      centroids++;\r\n      currColor = points[i];\r\n      centers.push(points[i]);\r\n\r\n      if (centroids >= numCentroids) {\r\n        possible = true;\r\n        return { possible, centers };\r\n      }\r\n    }\r\n  }\r\n  return { possible, centers };\r\n}\r\n\r\n//binary search to find centroids, reutrn list of centroids with\r\n// average largest distance between them\r\nfunction findCentroids(\r\n  uniqueColors: number[][],\r\n  depth: number\r\n): { pickedCentroids: number[][] } {\r\n  let maxDist = 442;\r\n  let minDist = 0;\r\n  let midDist = (maxDist + minDist) / 2;\r\n\r\n  let dist = 0;\r\n\r\n  let pickedCentroids: number[][] = [];\r\n\r\n  while (minDist <= maxDist) {\r\n    midDist = (maxDist + minDist) / 2;\r\n    let { possible, centers } = centroidPossible(uniqueColors, midDist, depth);\r\n\r\n    if (!possible) {\r\n      maxDist = midDist - 1;\r\n    } else {\r\n      if (dist < midDist) {\r\n        pickedCentroids = JSON.parse(JSON.stringify(centers));\r\n        dist = midDist;\r\n      }\r\n      minDist = midDist + 1;\r\n    }\r\n  }\r\n  return { pickedCentroids };\r\n}\r\n","import React from \"react\";\n\ninterface ExportButtonProps {\n  startImageExport: () => void;\n  buttonLabel: string;\n}\n\nfunction ExportButton({ startImageExport, buttonLabel }: ExportButtonProps): JSX.Element {\n  const handleClick = () => {\n    startImageExport();\n  };\n\n  return (\n    <button className=\"button export-button\" onClick={handleClick}>\n      {buttonLabel}\n    </button>\n  );\n}\n\nexport default ExportButton;\n","import React, { useRef } from \"react\";\n\ntype ImportFile = File | null;\n\ninterface IProps {\n  buttonLabel: string;\n  onFileInputChange: (\n    element: HTMLInputElement | null,\n    event: React.FormEvent<HTMLInputElement>\n  ) => void;\n}\n\nfunction ImportButton({ onFileInputChange, buttonLabel }: IProps): JSX.Element {\n  const fileInput = useRef<HTMLInputElement>(null);\n\n  return (\n    <>\n      <label>\n        {buttonLabel}\n        <input\n          type=\"file\"\n          accept=\".png, .jpg, .jpeg, .bmp, .pal\"\n          ref={fileInput}\n          onChange={e => onFileInputChange(fileInput.current, e)}\n        />\n      </label>\n    </>\n  );\n}\n\nexport default ImportButton;\n","import React, { useState, PropsWithChildren } from \"react\";\r\n\r\ninterface DropdownProps {\r\n  label: string;\r\n}\r\n\r\nexport default function Dropdown({\r\n  label,\r\n  children\r\n}: PropsWithChildren<DropdownProps>) {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  return (\r\n    <div className=\"dd-container\">\r\n      <button onClick={() => setOpen(!open)} className=\"dd-button\">\r\n        {label}\r\n      </button>\r\n      <div\r\n        id=\"myDropdown\"\r\n        className={open ? \"dd-content dd-show\" : \"dd-content\"}\r\n        onClick={() => setOpen(false)}\r\n      >\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, {\n  useEffect,\n  useRef,\n  useState,\n  useCallback,\n  useLayoutEffect\n} from \"react\";\nimport { EditorSettings, ImageCoordinates, Color } from \"../util/interfaces\";\nimport Bitmap from \"../models/Bitmap\";\nimport Palette from \"../models/Palette\";\nimport { Tool } from \"../util/consts\";\n\n// The pixel grid will not be visible when the scale is smaller than this value.\nconst PIXELGRID_ZOOM_LIMIT = 8;\n\ninterface EditorCanvasProps {\n  image: Bitmap;\n  palette: Palette;\n  selectedPaletteIndex: number;\n  settings: EditorSettings;\n  scale: number;\n  onChangeImage: (newImage: Bitmap) => void;\n  onMouseWheel: (e: WheelEvent) => void;\n}\n\nexport default function EditorCanvas({\n  image,\n  palette,\n  selectedPaletteIndex,\n  settings,\n  scale,\n  onChangeImage,\n  onMouseWheel\n}: EditorCanvasProps): JSX.Element {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [canvasSize, setCanvasSize] = useState<number[]>([0, 0]);\n\n  ///////////////////// Drawing Tool\n  const [isPainting, setIsPainting] = useState<boolean>(false);\n  const [mousePos, setMousePos] = useState<ImageCoordinates | undefined>(\n    undefined\n  );\n  const [imagePosition, setImagePosition] = useState<ImageCoordinates>({\n    x: 0,\n    y: 0\n  });\n  /////////////////////\n\n  const drawImageOnCanvas = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n    if (!image) return;\n\n    // Clear the context\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    // Draw the image at the correct position and scale\n    context.drawImage(\n      image.getImageCanvasElement(),\n      imagePosition.x,\n      imagePosition.y,\n      image.dimensions.width * scale,\n      image.dimensions.height * scale\n    );\n    // Draw the grid (if we need to)\n    if (settings.grid && scale >= PIXELGRID_ZOOM_LIMIT) {\n      context.drawImage(\n        image.getPixelGridCanvasElement(),\n        imagePosition.x,\n        imagePosition.y,\n        image.dimensions.width * scale,\n        image.dimensions.height * scale\n      );\n    }\n  }, [image, imagePosition, canvasRef, scale, settings.grid]);\n\n  /**\n   * Handle window resizing and set the new canvasSize state.\n   */\n  useLayoutEffect(() => {\n    const updateCanvasSize = () => {\n      if (canvasRef.current) {\n        setCanvasSize([\n          canvasRef.current.clientWidth,\n          canvasRef.current.clientHeight\n        ]);\n      }\n    };\n    window.addEventListener(\"resize\", () => updateCanvasSize());\n  }, []);\n\n  /**\n   * Set up the canvas.\n   */\n  useLayoutEffect(() => {\n    console.log(\"Setting up canvas...\");\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n    setCanvasSize([canvas.clientWidth, canvas.clientHeight]);\n    context.imageSmoothingEnabled = false;\n  }, [canvasRef]);\n\n  /**\n   * Change the dimensions of the canvas when the canvasSize changes.\n   */\n  useLayoutEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n    canvas.width = canvasSize[0] * devicePixelRatio;\n    canvas.height = canvasSize[1] * devicePixelRatio;\n    context.imageSmoothingEnabled = false;\n  }, [canvasSize, canvasRef]);\n\n  /**\n   * Handle mousewheel zooming\n   */\n  useLayoutEffect(() => {\n    if (canvasRef.current) {\n      canvasRef.current.addEventListener(\"wheel\", onMouseWheel);\n    }\n  }, [onMouseWheel]);\n\n  /**\n   * Draw the image whenever the image, imageCanvas, context, scale, or editor\n   * settings change.\n   */\n  useLayoutEffect(() => drawImageOnCanvas(), [\n    drawImageOnCanvas,\n    palette,\n    canvasSize\n  ]);\n\n  /////////////////////////////////////////////////////////////////////////////\n  // Drawing Tool\n  const getMousePos = (e: MouseEvent): ImageCoordinates | undefined => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const rect = canvas.getBoundingClientRect();\n      const scaleX = canvas.width / rect.width;\n      const scaleY = canvas.height / rect.height;\n      return {\n        x: (e.clientX - rect.left) * scaleX,\n        y: (e.clientY - rect.top) * scaleY\n      };\n    }\n    return undefined;\n  };\n\n  const getImageCoord = useCallback(\n    (mousePos: ImageCoordinates): ImageCoordinates | undefined => {\n      const x = Math.floor((mousePos.x - imagePosition.x) / scale);\n      const y = Math.floor((mousePos.y - imagePosition.y) / scale);\n      if (\n        x < 0 ||\n        x > image.dimensions.width ||\n        y < 0 ||\n        y > image.dimensions.height\n      )\n        return undefined;\n      return { x, y };\n    },\n    [scale, imagePosition, image.dimensions]\n  );\n\n  const fillPixel = useCallback(\n    (pos: ImageCoordinates | undefined, color: Color): void => {\n      if (!pos) return;\n      if (!canvasRef.current) return;\n      const context = canvasRef.current.getContext(\"2d\");\n      if (!context) return;\n\n      image.setPixelColor(pos, color);\n      drawImageOnCanvas();\n    },\n    [drawImageOnCanvas, image]\n  );\n\n  const bucketFill = useCallback(\n    (pos: ImageCoordinates | undefined, newColor: Color): void => {\n      // BFS fill\n      if (!pos) return;\n      const color = image.getPixelColorAt(pos);\n      if (color.isEqual(newColor)) return;\n      image.setPixelColor(pos, newColor);\n      console.log(color);\n      let queue = new Array<ImageCoordinates>(pos);\n      let explored = new Array<ImageCoordinates>(pos);\n      while (queue[0] !== undefined) {\n        let curr = queue.shift() as ImageCoordinates;\n        let edges = new Array<ImageCoordinates>(0);\n        // add edges\n        if (curr.y > 0) {\n          edges.push({ x: curr.x, y: curr.y - 1 });\n        }\n        if (curr.y < image.dimensions.height - 1) {\n          edges.push({ x: curr.x, y: curr.y + 1 });\n        }\n        if (curr.x > 0) {\n          edges.push({ x: curr.x - 1, y: curr.y });\n        }\n        if (curr.x < image.dimensions.width - 1) {\n          edges.push({ x: curr.x + 1, y: curr.y });\n        }\n        ///\n        edges\n          .filter(n => !explored.includes(n))\n          .forEach(n => {\n            explored.push(n);\n            if (image.getPixelColorAt(n).isEqual(color)) {\n              queue.push(n);\n              image.setPixelColor(n, newColor);\n            }\n          });\n      }\n\n      drawImageOnCanvas();\n    },\n    [image, drawImageOnCanvas]\n  );\n\n  const startPaint = useCallback(\n    (e: MouseEvent) => {\n      const mousePosition = getMousePos(e);\n      if (!mousePosition) return;\n      setMousePos(mousePosition);\n      const imageCoord = getImageCoord(mousePosition);\n      // if (!imageCoord) return;\n      switch (settings.currentTool) {\n        case Tool.PENCIL:\n          setIsPainting(true);\n          fillPixel(imageCoord, palette[selectedPaletteIndex]);\n          break;\n        case Tool.BUCKET:\n          bucketFill(imageCoord, palette[selectedPaletteIndex]);\n          break;\n        case Tool.PAN:\n          setIsPainting(true);\n          break;\n      }\n    },\n    [\n      settings.currentTool,\n      bucketFill,\n      fillPixel,\n      getImageCoord,\n      palette,\n      selectedPaletteIndex\n    ]\n  );\n\n  const paint = useCallback(\n    (e: MouseEvent) => {\n      const newMousePos = getMousePos(e);\n      if (!newMousePos) return;\n      const imageCoord = getImageCoord(newMousePos);\n      // if (!imageCoord) return;\n      switch (settings.currentTool) {\n        case Tool.PENCIL:\n          if (isPainting) {\n            fillPixel(imageCoord, palette[selectedPaletteIndex]);\n          }\n          break;\n        case Tool.PAN:\n          if (isPainting && mousePos) {\n            const newImagePosition = {\n              x: imagePosition.x + (newMousePos.x - mousePos.x),\n              y: imagePosition.y + (newMousePos.y - mousePos.y)\n            };\n            setImagePosition(newImagePosition);\n          }\n          break;\n      }\n      setMousePos(newMousePos);\n    },\n    [\n      isPainting,\n      fillPixel,\n      getImageCoord,\n      palette,\n      selectedPaletteIndex,\n      imagePosition,\n      mousePos,\n      settings.currentTool\n    ]\n  );\n\n  const stopPaint = useCallback(() => {\n    setMousePos(undefined);\n    setIsPainting(false);\n    onChangeImage(image);\n  }, [image, onChangeImage]);\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    canvas.addEventListener(\"mousedown\", startPaint);\n    return () => canvas.removeEventListener(\"mousedown\", startPaint);\n  }, [startPaint]);\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    canvas.addEventListener(\"mousemove\", paint);\n    return () => {\n      canvas.removeEventListener(\"mousemove\", paint);\n    };\n  }, [paint]);\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    canvas.addEventListener(\"mouseup\", stopPaint);\n    canvas.addEventListener(\"mouseleave\", stopPaint);\n    return () => {\n      canvas.removeEventListener(\"mouseup\", stopPaint);\n      canvas.removeEventListener(\"mouseleave\", stopPaint);\n    };\n  }, [stopPaint]);\n\n  /////////////////////////////////////////////////////////////////////////////\n\n  return (\n    <canvas\n      ref={canvasRef}\n      className={generateEditorCanvasProps(settings.currentTool)}\n    />\n  );\n}\n\nconst generateEditorCanvasProps = (tool: Tool): string => {\n  const base = \"image-canvas \";\n  switch (tool) {\n    case Tool.PENCIL:\n      return base + \"pencil\";\n    case Tool.BUCKET:\n      return base + \"bucket\";\n    case Tool.PAN:\n      return base + \"pan\";\n  }\n  return base;\n};\n","import { Color } from \"../util/interfaces\";\nimport { PALETTE_SIZE, PALETTE_LENGTH } from \"../util/consts\";\nimport { createHiddenCanvas } from \"../util/fileLoadUtils\";\nimport { PixelGrid } from \"./ImageCanvas\";\n\n// interface IPalette {\n//   readonly dimensions: Dimensions;\n//   getColorAt: (index: number) => Color;\n//   setColorAt: (index: number, color: Color) => void;\n//   swapRows: (row1: number, row2: number) => void;\n//   getColorArray: () => Color[];\n// }\n\ntype Palette = Color[];\n\nexport interface PaletteDrawables {\n  readonly pixelGrid: PixelGrid;\n  readonly hiddenCanvas: HTMLCanvasElement;\n}\n\n/**\n * Constructor for Palette objects. Contains initial draw call.\n * @param colorArray color array to be used as data for the palette\n */\nexport function PaletteDrawablesGenerator(): PaletteDrawables {\n  const pixelGrid = new PixelGrid(PALETTE_SIZE, 8);\n  const hiddenCanvas = createHiddenCanvas(PALETTE_SIZE);\n  // drawPaletteToHiddenCanvas(colorArray, hiddenCanvas);\n  return { pixelGrid, hiddenCanvas };\n}\n\nexport function drawPaletteToHiddenCanvas(\n  palette: Palette,\n  hiddenCanvas: HTMLCanvasElement\n) {\n  const context = hiddenCanvas.getContext(\"2d\");\n  if (!context) {\n    console.error(\"Failed to get Palette hidden canvas context!\");\n    return;\n  }\n  for (let i = 0; i < PALETTE_LENGTH; i++) {\n    const color = palette[i];\n    context.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n    context.fillRect(i % 16, Math.floor(i / 16), 1, 1);\n  }\n}\n\nexport function setPaletteColorAndRedraw(\n  palette: Palette,\n  hiddenCanvas: HTMLCanvasElement,\n  index: number,\n  color: Color\n) {\n  palette[index] = color;\n  drawPaletteToHiddenCanvas(palette, hiddenCanvas);\n}\n\nexport default Palette;\n\n// export default class Palette implements IPalette {\n//   public dimensions: Dimensions;\n//   private colorArray: Color[];\n//   private hiddenCanvas: HTMLCanvasElement;\n//   private pixelGrid: PixelGrid;\n\n//   // constructor input will be the inputs needed for generatePalette() function\n//   constructor(colorArray?: Color[]) {\n//     this.dimensions = PALETTE_SIZE;\n\n//     this.colorArray = new Array(this.dimensions.width * this.dimensions.height);\n//     if (colorArray === undefined) {\n//       this.colorArray.fill(COLORS.black);\n//     } else {\n//       if (colorArray.length > PALETTE_SIZE.height * PALETTE_SIZE.width) {\n//         console.warn(\n//           \"why would you ever try to make a palette bigger than 16x16 -_-\"\n//         );\n//         this.colorArray = colorArray.slice(0, 255);\n//       } else {\n//         this.colorArray = colorArray;\n//       }\n//     }\n\n//     this.hiddenCanvas = createHiddenCanvas(this.dimensions);\n//     this.drawPaletteToHiddenCanvas(this.hiddenCanvas);\n//     this.pixelGrid = new PixelGrid(PALETTE_SIZE, 8);\n//   }\n\n//   public swapRows(row1: number, row2: number) {\n//     if (row1 >= this.dimensions.height || row2 >= this.dimensions.height) {\n//       console.error(\"cannot swap rows: input out of bounds\");\n//     } else {\n//       console.log(\"swapping rows...\");\n//       const start1 = row1 * this.dimensions.height;\n//       const start2 = row2 * this.dimensions.height;\n//       this.groupSwap(start1, start2, this.dimensions.width);\n//     }\n//   }\n\n//   public getColorAt(index: number): Color {\n//     if (index >= PALETTE_LENGTH || index < 0) {\n//       console.error(\n//         \"Attempting to access palette at index greater than \" +\n//           PALETTE_LENGTH +\n//           \".\"\n//       );\n//     }\n//     // console.log(\"Palette index\", i, \"Color at index\", this.colorArray[i]);\n//     return this.colorArray[index];\n//   }\n\n//   public setColorAt(index: number, color: Color) {\n//     this.colorArray[index] = color;\n//     this.drawPaletteToHiddenCanvas(this.hiddenCanvas);\n//   }\n\n//   public getPaletteCanvas(): HTMLCanvasElement {\n//     return this.hiddenCanvas;\n//   }\n\n//   public getPixelGridCanvas(): HTMLCanvasElement {\n//     return this.pixelGrid.getCanvasElement();\n//   }\n\n//   public getColorArray(): Color[] {\n//     return this.colorArray;\n//   }\n\n//   private swapIndices(index1: number, index2: number) {\n//     const size = this.dimensions.width * this.dimensions.height;\n//     if (index1 >= size || index2 >= size) {\n//       console.error(\"cannot swip indices: input out of bounds\");\n//     } else {\n//       const temp = this.colorArray[index1];\n//       this.setColorAt(index1, this.colorArray[index2]);\n//       this.setColorAt(index2, temp);\n//     }\n//   }\n\n//   private groupSwap(start1: number, start2: number, len: number) {\n//     for (let i = 0; i < len; i++) {\n//       this.swapIndices(start1 + i, start2 + i);\n//     }\n//   }\n\n//   private drawPaletteToHiddenCanvas(canvas: HTMLCanvasElement) {\n//     const context = canvas.getContext(\"2d\");\n//     if (!context) {\n//       console.error(\"Failed to get Palette hidden canvas context!\");\n//       return;\n//     }\n//     for (let i = 0; i < PALETTE_LENGTH; i++) {\n//       const color = this.colorArray[i];\n//       context.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n//       context.fillRect(i % 16, Math.floor(i / 16), 1, 1);\n//     }\n//   }\n// }\n","import React, { useRef, useEffect, useCallback, useState } from \"react\";\nimport Palette, * as PaletteUtils from \"../models/Palette\";\nimport { PixelGrid } from \"../models/ImageCanvas\";\n\ninterface IPaletteDisplay {\n  palette: Palette;\n  selectedColorIndex: number;\n  onChangeSelectedColorIndex: (newIndex: number) => void;\n}\n\ninterface MousePos {\n  x: number;\n  y: number;\n}\n\n// This size is defined the same in app.scss\nconst PALETTE_CANVAS_SIZE = {\n  height: 192,\n  width: 192\n};\n\nconst SCALE = PALETTE_CANVAS_SIZE.height / 16;\n\nconst INDEX_TO_X = (index: number) => index % 16;\nconst INDEX_TO_Y = (index: number) => Math.floor(index / 16);\nconst XY_TO_INDEX = ({ x, y }: { x: number; y: number }) => y * 16 + x;\nconst MOUSE_POS_TO_XY = ({ x, y }: { x: number; y: number }) => ({\n  x: Math.floor(x / SCALE),\n  y: Math.floor(y / SCALE)\n});\nconst MOUSE_POS_TO_INDEX = (pos: { x: number; y: number }) =>\n  XY_TO_INDEX(MOUSE_POS_TO_XY(pos));\n\nfunction PaletteDisplay({\n  palette,\n  selectedColorIndex,\n  onChangeSelectedColorIndex\n}: IPaletteDisplay): JSX.Element {\n  const [paletteHiddenCanvas, setPaletteHiddenCanvas] = useState<\n    HTMLCanvasElement\n  >();\n  const [pixelGrid, setPixelGrid] = useState<PixelGrid>();\n\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  /**\n   * method to draw the palette grid\n   */\n  const drawGrid = useCallback(() => {\n    if (!canvasRef.current || !pixelGrid) return;\n    const context = canvasRef.current.getContext(\"2d\");\n    if (!context) return;\n    context.drawImage(\n      pixelGrid.getCanvasElement(),\n      0,\n      0,\n      PALETTE_CANVAS_SIZE.width * window.devicePixelRatio,\n      PALETTE_CANVAS_SIZE.height * window.devicePixelRatio\n    );\n  }, [pixelGrid]);\n\n  /**\n   * method to populate the palette with colors\n   * fills palette index with proper color using palette colorArray\n   */\n  const drawPalette = useCallback(() => {\n    if (!canvasRef.current || !paletteHiddenCanvas) return;\n    const context = canvasRef.current.getContext(\"2d\");\n    if (!context) return;\n    PaletteUtils.drawPaletteToHiddenCanvas(palette, paletteHiddenCanvas);\n    context.drawImage(\n      paletteHiddenCanvas,\n      0,\n      0,\n      PALETTE_CANVAS_SIZE.width * window.devicePixelRatio,\n      PALETTE_CANVAS_SIZE.height * window.devicePixelRatio\n    );\n  }, [palette, paletteHiddenCanvas]);\n\n  /**\n   * Draws a box around the selected color in the palette view.\n   */\n  const drawSelectedColorHighlight = useCallback(\n    (index: number) => {\n      if (!canvasRef.current) return;\n      let context = canvasRef.current.getContext(\"2d\");\n      if (!context) return;\n      context.beginPath();\n      context.strokeStyle = \"rgba(255, 255, 0, 1)\";\n      context.lineWidth = 2;\n      const ratio = window.devicePixelRatio * SCALE;\n      context.rect(\n        INDEX_TO_X(index) * ratio,\n        INDEX_TO_Y(index) * ratio,\n        ratio,\n        ratio\n      );\n      context.stroke();\n    },\n    [canvasRef]\n  );\n\n  /**\n   * gets mouse position on the palette canvas\n   * @param e MouseEvent\n   */\n  const getMousePos = (e: React.MouseEvent): MousePos => {\n    if (canvasRef.current) {\n      const rect = canvasRef.current.getBoundingClientRect();\n      return {\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top\n      };\n    }\n    return {\n      x: -1,\n      y: -1\n    };\n  };\n\n  /**\n   * handles mouse click event\n   * selects the proper row on the palette\n   * @param e MouseEvent\n   */\n  const handleClick = (e: React.MouseEvent): void => {\n    onChangeSelectedColorIndex(MOUSE_POS_TO_INDEX(getMousePos(e)));\n  };\n\n  /**\n   * Set up the canvas\n   */\n  useEffect(() => {\n    console.log(\"Setting up palette canvas\");\n    const setupCanvasSize = (canvas: HTMLCanvasElement) => {\n      const devicePixelRatio = window.devicePixelRatio || 1;\n      canvas.width = canvas.clientWidth * devicePixelRatio;\n      canvas.height = canvas.clientHeight * devicePixelRatio;\n      const context = canvas.getContext(\"2d\");\n      if (context) context.imageSmoothingEnabled = false;\n    };\n    if (canvasRef.current) {\n      setupCanvasSize(canvasRef.current);\n    }\n    const {\n      pixelGrid,\n      hiddenCanvas\n    } = PaletteUtils.PaletteDrawablesGenerator();\n    setPaletteHiddenCanvas(hiddenCanvas);\n    setPixelGrid(pixelGrid);\n  }, []);\n\n  /**\n   * Draw the palette every time something changes\n   */\n  useEffect(() => {\n    drawPalette();\n    drawGrid();\n    drawSelectedColorHighlight(selectedColorIndex);\n  }, [selectedColorIndex, drawPalette, drawGrid, drawSelectedColorHighlight]);\n\n  return (\n    <canvas ref={canvasRef} onClick={handleClick} className=\"palette-canvas\" />\n  );\n}\n\nexport default PaletteDisplay;\n","import React, { useState } from \"react\";\n\nconst MIN_QUANTIZE = 1;\nconst MAX_QUANTIZE = 256;\n\ninterface ExportButtonProps {\n  handleQuantize: (newColorDepth: number) => void;\n}\n\nfunction ExportButton({ handleQuantize }: ExportButtonProps): JSX.Element {\n  const [depth, setDepth] = useState<number>(15);\n\n  const handleClick = () => {\n    if (!depth) {\n      alert(\"Can't quantize with unspecified color depth!\");\n      return;\n    }\n    handleQuantize(depth);\n  };\n\n  return (\n    <div className=\"quantize-container\">\n      <button className=\"quantize-button\" onClick={handleClick}>\n        Quantize\n      </button>\n      <input\n        className=\"quantize-input\"\n        type=\"number\"\n        value={depth}\n        min={MIN_QUANTIZE}\n        max={MAX_QUANTIZE}\n        onChange={e => setDepth(parseInt(e.target.value))}\n      ></input>\n    </div>\n  );\n}\n\nexport default ExportButton;\n","import React from \"react\";\nimport Palette from \"../models/Palette\";\nimport PaletteDisplay from \"./PaletteDisplay\";\nimport QuantizeButton from \"./buttons/QuantizeButton\";\nimport { Color, EditorSettings } from \"../util/interfaces\";\n\ninterface PalettePanelProps {\n  palette: Palette;\n  selectedColorIndex: number;\n  updatePalette: (newPalette: Palette) => void;\n  onChangeSelectedColorIndex: (newIndex: number) => void;\n  onChangeColor: (newColor: Color) => void;\n  handleQuantize: (newColorDepth: number) => void;\n  settings: EditorSettings;\n  onSettingsChange: (newSettings: EditorSettings) => void;\n}\n\nexport default function PalettePanel({\n  palette,\n  selectedColorIndex,\n  onChangeSelectedColorIndex,\n  onChangeColor,\n  handleQuantize,\n  settings,\n  onSettingsChange\n}: PalettePanelProps): JSX.Element {\n  return (\n    <div>\n      <div className=\"panel-label\">Color Palette</div>\n      <div className=\"palette-container\">\n        <PaletteDisplay\n          palette={palette}\n          selectedColorIndex={selectedColorIndex}\n          onChangeSelectedColorIndex={onChangeSelectedColorIndex}\n        />\n      </div>\n      <ColorInput\n        currentColor={palette[selectedColorIndex]}\n        onChangeColor={onChangeColor}\n      ></ColorInput>\n      <QuantizeButton handleQuantize={handleQuantize} />\n      <div className=\"heading\">Settings</div>\n      <div>\n        Mode: {settings.editorMode}\n        <br />\n        {settings.editorMode.toString()}\n      </div>\n    </div>\n  );\n}\n\nconst MIN_COLOR_VAL = \"0\";\nconst MAX_COLOR_VAL = \"31\";\n\nconst color256to32 = (color: Color): Color => {\n  const r = Math.ceil((color.r + 1) / 8) - 1;\n  const g = Math.ceil((color.g + 1) / 8) - 1;\n  const b = Math.ceil((color.b + 1) / 8) - 1;\n\n  return new Color(r, g, b, 1);\n};\n\nconst color32to256 = (color: Color): Color => {\n  const r = (color.r + 1) * 8 - 1;\n  const g = (color.g + 1) * 8 - 1;\n  const b = (color.b + 1) * 8 - 1;\n\n  return new Color(r, g, b, 1);\n};\n\ninterface ColorInputProps {\n  currentColor: Color;\n  onChangeColor: (newColor: Color) => void;\n}\n\nfunction ColorInput({\n  currentColor,\n  onChangeColor\n}: ColorInputProps): JSX.Element {\n  // const [color, setColor] = useState<Color>(Color256to32(currentColor));\n\n  /**\n   * When we select a new color from props, we should update which color is being inspected\n   */\n  // useEffect(() => {\n  //   setColor(Color256to32(currentColor));\n  // }, [currentColor]);\n\n  // useEffect(() => {\n  //   onChangeColor(Color32to256(color));\n  // }, [color, onChangeColor]);\n\n  const color32 = color256to32(currentColor);\n\n  const handleRChange = (newRValue: number) => {\n    color32.r = newRValue;\n    const color256 = color32to256(color32);\n    onChangeColor(color256);\n  };\n\n  const handleGChange = (newGValue: number) => {\n    color32.g = newGValue;\n    const color256 = color32to256(color32);\n    onChangeColor(color256);\n  };\n\n  const handleBChange = (newBValue: number) => {\n    color32.b = newBValue;\n    const color256 = color32to256(color32);\n    onChangeColor(color256);\n  };\n\n  return (\n    <div>\n      <div>\n        <label>R</label>\n        <input\n          type=\"number\"\n          max={MAX_COLOR_VAL}\n          min={MIN_COLOR_VAL}\n          value={color32.r}\n          onChange={e => handleRChange(parseInt(e.target.value))}\n        ></input>\n      </div>\n      <div>\n        <label>G</label>\n        <input\n          type=\"number\"\n          max={MAX_COLOR_VAL}\n          min={MIN_COLOR_VAL}\n          value={color32.g}\n          onChange={e => handleGChange(parseInt(e.target.value))}\n        ></input>\n      </div>\n      <div>\n        <label>B</label>\n        <input\n          type=\"number\"\n          max={MAX_COLOR_VAL}\n          min={MIN_COLOR_VAL}\n          value={color32.b}\n          onChange={e => handleBChange(parseInt(e.target.value))}\n        ></input>\n      </div>\n    </div>\n  );\n}\n","import React, { PropsWithChildren } from \"react\";\n\ntype ToggleProps = {\n  state: boolean;\n  onClick: (newState: boolean) => void;\n};\n\nexport default function Toggle({\n  state,\n  onClick,\n  children\n}: PropsWithChildren<ToggleProps>): JSX.Element {\n  return (\n    <button\n      className={state ? \"toggle-on\" : \"toggle-off\"}\n      onClick={() => onClick(!state)}\n    >\n      {children}\n    </button>\n  );\n}\n","import React from \"react\";\nimport { EditorSettings } from \"../util/interfaces\";\nimport {\n  faBorderAll,\n  faPen,\n  faFillDrip,\n  faSearchPlus,\n  faEyeDropper,\n  faLayerGroup,\n  faCode\n} from \"@fortawesome/free-solid-svg-icons\";\nimport {\n  faCircle,\n  faSquare,\n  faHandPaper\n} from \"@fortawesome/free-regular-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { Tool } from \"../util/consts\";\nimport Toggle from \"./buttons/Toggle\";\n\ntype ToolsPanelProps = {\n  settings: EditorSettings;\n  onSettingsChange: (newSettings: EditorSettings) => void;\n  onToolChange: (newTool: Tool) => void;\n};\n\nexport default function ToolsPanel({\n  settings,\n  onSettingsChange,\n  onToolChange\n}: ToolsPanelProps) {\n  return (\n    <div>\n      <div className=\"heading\">Tools</div>\n      <Toggle\n        state={settings.currentTool === Tool.PENCIL}\n        onClick={() => onToolChange(Tool.PENCIL)}\n      >\n        <FontAwesomeIcon icon={faPen} />\n      </Toggle>\n      <Toggle\n        state={settings.currentTool === Tool.BUCKET}\n        onClick={() => onToolChange(Tool.BUCKET)}\n      >\n        <FontAwesomeIcon icon={faFillDrip} />\n      </Toggle>\n      <Toggle\n        state={settings.currentTool === Tool.SQUARE}\n        onClick={() => onToolChange(Tool.SQUARE)}\n      >\n        <FontAwesomeIcon icon={faSquare} />\n      </Toggle>\n      <Toggle\n        state={settings.currentTool === Tool.ELLIPSE}\n        onClick={() => onToolChange(Tool.ELLIPSE)}\n      >\n        <FontAwesomeIcon icon={faCircle} />\n      </Toggle>\n      <Toggle\n        state={settings.currentTool === Tool.ZOOM}\n        onClick={() => onToolChange(Tool.ZOOM)}\n      >\n        <FontAwesomeIcon icon={faSearchPlus} />\n      </Toggle>\n      <Toggle\n        state={settings.currentTool === Tool.PAN}\n        onClick={() => onToolChange(Tool.PAN)}\n      >\n        <FontAwesomeIcon icon={faHandPaper} />\n      </Toggle>\n      <Toggle\n        state={settings.currentTool === Tool.DROPPER}\n        onClick={() => onToolChange(Tool.DROPPER)}\n      >\n        <FontAwesomeIcon icon={faEyeDropper} />\n      </Toggle>\n      <div className=\"heading\">View</div>\n      <Toggle\n        state={settings.grid}\n        onClick={() => {\n          let newSettings = { ...settings };\n          newSettings.grid = !settings.grid;\n          onSettingsChange(newSettings);\n        }}\n      >\n        <FontAwesomeIcon icon={faBorderAll} />\n      </Toggle>\n      <Toggle state={false} onClick={() => null}>\n        <FontAwesomeIcon icon={faLayerGroup} />\n      </Toggle>\n      <Toggle state={false} onClick={() => null}>\n        <FontAwesomeIcon icon={faCode} />\n      </Toggle>\n      {/* <div className=\"heading\">Settings</div>\n      <div>\n        Mode: {settings.imageMode}\n        <br />\n        {settings.editorMode.toString()}\n      </div> */}\n    </div>\n  );\n}\n","import React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Dimensions } from \"../../util/interfaces\";\n\nconst MIN_IMG_SIZE = 1;\n\ninterface NewImageModalProps {\n  onAccept: (fileName: string, dimensions: Dimensions) => void;\n  isShowing: boolean;\n  hide: () => void;\n}\n\ninterface NewImageFormProps {\n  onAccept: (fileName: string, dimensions: Dimensions) => void;\n}\n\nconst NewImageModal = ({ onAccept, isShowing, hide }: NewImageModalProps) =>\n  isShowing\n    ? ReactDOM.createPortal(\n        <React.Fragment>\n          <div className=\"modal-overlay\" />\n          <div\n            className=\"modal-wrapper\"\n            aria-modal\n            aria-hidden\n            tabIndex={-1}\n            role=\"dialog\"\n          >\n            <div className=\"modal\">\n              <div className=\"modal-header\">Create a New Image</div>\n              <NewImageForm\n                onAccept={(fileName, dimensions) => {\n                  onAccept(fileName, dimensions);\n                  hide();\n                }}\n              ></NewImageForm>\n              <div className=\"modal-button-right\">\n                <button onClick={hide} className=\"modal-button\">Cancel</button>\n              </div>\n            </div>\n          </div>\n        </React.Fragment>,\n        document.body\n      )\n    : null;\n\nconst NewImageForm = ({ onAccept }: NewImageFormProps) => {\n  const [fileName, setFileName] = useState<string>(\"untitled\");\n  const [height, setHeight] = useState<number>(32);\n  const [width, setWidth] = useState<number>(32);\n\n  const handleFileNameChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setFileName(e.target.value);\n\n  const handleHeightChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setHeight(parseInt(e.target.value));\n\n  const handleWidthChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setWidth(parseInt(e.target.value));\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onAccept(fileName, { height, width });\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <div className=\"modal-input-text\">\n        <label htmlFor=\"filename\" className=\"modal-label\">Name:</label>\n        <input\n          id=\"filename\"\n          name=\"filename\"\n          type=\"text\"\n          value={fileName}\n          onChange={handleFileNameChange}\n        />\n      </div>\n      <br />\n      <label className=\"modal-label\">Image Size</label>\n      <div className=\"modal-input-num\">\n        <label htmlFor=\"height\" className=\"modal-label-num\">Height:</label>\n        <input\n          id=\"height\"\n          type=\"number\"\n          min={MIN_IMG_SIZE}\n          value={height}\n          onChange={handleHeightChange}\n        />\n        <label>&nbsp;px</label>\n        <br />\n        <label htmlFor=\"width\" className=\"modal-label-num\">Width:</label>\n        <input\n          id=\"width\"\n          type=\"number\"\n          min={MIN_IMG_SIZE}\n          value={width}\n          onChange={handleWidthChange}\n        />\n        <label>&nbsp;px</label>\n      </div>\n      <br />\n      <div className=\"modal-button-left\">\n      <button className=\"modal-button\">OK</button>\n      </div>\n    </form>\n  );\n};\n\nexport default NewImageModal;\n","import { useState } from \"react\";\n\nconst useModal = () => {\n  const [isShowing, setIsShowing] = useState(false);\n  const toggle = () => setIsShowing(!isShowing);\n  return { isShowing, toggle };\n};\n\nexport default useModal;\n","import { saveAs } from \"file-saver\";\nimport React, { useCallback, useReducer, useState, useEffect } from \"react\";\nimport { Tool, STORAGE, DEFAULT_SETTINGS } from \"../util/consts\";\nimport DEFAULT_PALETTE from \"../util/defaultPalette\";\nimport { exportImage, exportPalette } from \"../util/exportUtils\";\nimport { loadNewImage, loadNewPalette } from \"../util/fileLoadUtils\";\nimport {\n  Color,\n  Dimensions,\n  EditorMode,\n  EditorSettings,\n  Mode,\n  ImageDataStore\n} from \"../util/interfaces\";\nimport { quantize } from \"../util/quantize\";\nimport Bitmap from \"../models/Bitmap\";\nimport Bitmap3 from \"../models/Bitmap3\";\nimport Bitmap4 from \"../models/Bitmap4\";\nimport Palette from \"../models/Palette\";\nimport ExportButton from \"./buttons/ExportButton\";\nimport ImportButton from \"./buttons/ImportButton\";\nimport Dropdown from \"./Dropdown\";\nimport EditorCanvas from \"./EditorCanvas\";\nimport PalettePanel from \"./PalettePanel\";\nimport ToolsPanel from \"./ToolsPanel\";\nimport NewImageModal from \"./modals/NewImageModal\";\nimport useModal from \"./hooks/useModal\";\n\nfunction scaleReducer(state: number, e: WheelEvent) {\n  const direction = e.deltaY < 0 ? -1 : 1;\n  if (direction === 1) {\n    return state * 1.1;\n  } else {\n    return state / 1.1;\n  }\n}\n\nfunction App(): JSX.Element {\n  const [image, setImage] = useState<Bitmap>();\n  const [palette, setPalette] = useState<Palette>(DEFAULT_PALETTE);\n  const [selectedColorIndex, setSelectedColorIndex] = useState<number>(0);\n  const [editorSettings, setEditorSettings] = useState<EditorSettings>({\n    grid: true,\n    currentTool: Tool.PENCIL,\n    imageMode: 3,\n    editorMode: EditorMode.Bitmap\n  });\n\n  const {\n    isShowing: isMode3BitmapModalShowing,\n    toggle: toggleMode3BitmpModal\n  } = useModal();\n  const {\n    isShowing: isMode4BitmapModalShowing,\n    toggle: toggleMode4BitmpModal\n  } = useModal();\n\n  const [scale, scaleDispatch] = useReducer(scaleReducer, 8);\n  const handleMouseWheelEvent = useCallback(e => scaleDispatch(e), []);\n\n  const handleFileInputChange = (\n    type: \"Image\" | \"Palette\",\n    element: HTMLInputElement | null,\n    event: React.FormEvent<HTMLInputElement>\n  ): void => {\n    event.preventDefault();\n    if (!element || !element.files) return;\n    switch (type) {\n      case \"Image\":\n        handleImageLoad(element.files[0]);\n        break;\n      case \"Palette\":\n        handlePaletteLoad(element.files[0]);\n        break;\n    }\n  };\n\n  const handleImageLoad = async (imageFile: File | null) => {\n    if (imageFile) {\n      console.log(\"Loading image from file...\");\n      let image = await loadNewImage(imageFile);\n      setImage(image);\n    }\n  };\n\n  const handleImageChange = (newImage: Bitmap) => {\n    window.localStorage.setItem(\n      STORAGE.imageData,\n      JSON.stringify(newImage.getImageDataStore())\n    );\n    setImage(newImage);\n  };\n\n  const handlePaletteChange = (newPalette: Palette) => {\n    window.localStorage.setItem(STORAGE.palette, JSON.stringify(newPalette));\n    setPalette(newPalette);\n  };\n\n  const handleSettingsChange = (newSettings: EditorSettings) => {\n    window.localStorage.setItem(\n      STORAGE.imageMode,\n      newSettings.imageMode.toString()\n    );\n    window.localStorage.setItem(\n      STORAGE.imageType,\n      newSettings.editorMode.toString()\n    );\n    setEditorSettings(newSettings);\n  };\n\n  const handleClearLocalStorage = () => window.localStorage.clear();\n\n  const handlePaletteLoad = async (palFile: File | null) => {\n    if (palFile) {\n      console.log(\"Loading palette from file...\");\n      let newPalette = await loadNewPalette(palFile);\n      if (newPalette) {\n        if (image instanceof Bitmap4) {\n          image.updatePalette(newPalette);\n        }\n        handlePaletteChange(newPalette);\n      }\n    }\n  };\n\n  const handlePaletteImport = (\n    oldPal: Palette,\n    newPal: Palette,\n    oldStartRow: number,\n    newStartRow: number,\n    numRows: number,\n    overwrite: boolean\n  ) => {};\n\n  const handleToolChange = useCallback(\n    (newTool: Tool) => {\n      handleSettingsChange({\n        grid: editorSettings.grid,\n        currentTool: newTool,\n        imageMode: editorSettings.imageMode,\n        editorMode: editorSettings.editorMode\n      });\n    },\n    [editorSettings]\n  );\n\n  /**\n   * Call this function when initializing a new \"project\" or whatever you want\n   * to call it. You will be greeted with a blank image to work on.\n   *\n   * @param editorMode The mode to set up the editor in. Can be either bitmap,\n   * spritesheet, or background.\n   * @param imageMode The image mode to edit in. Can be any of the GBA Modes,\n   * although only 0, 3, and 4 are supported.\n   */\n  const handleNewBitmap = (\n    editorMode: EditorMode,\n    imageMode: Mode,\n    fileName: string,\n    dimensions: Dimensions\n  ) => {\n    if (image) {\n      let accept = window.confirm(\n        \"Are you sure you want to create a new image? You will lose all unsaved work.\"\n      );\n      if (!accept) return;\n    }\n    switch (editorMode) {\n      case EditorMode.Bitmap:\n        // Open a modal dialog to query for image filename and dimensions\n        switch (imageMode) {\n          case 3: // Set up the editor for working on a mode 3 bitmap\n            editorSettings.editorMode = EditorMode.Bitmap;\n            editorSettings.imageMode = 3;\n            handleSettingsChange(editorSettings);\n            handleImageChange(new Bitmap3(fileName, dimensions));\n            handlePaletteChange(palette);\n            break;\n          case 4: // Set up the editor for working on a mode 4 paletted bitmap\n            editorSettings.editorMode = EditorMode.Bitmap;\n            editorSettings.imageMode = 4;\n            handleSettingsChange(editorSettings);\n            handleImageChange(new Bitmap4(fileName, palette, dimensions));\n            handlePaletteChange(palette);\n            break;\n          default:\n            alert(\"Unsupported image mode!\");\n            break;\n        }\n        break;\n      case EditorMode.Spritesheet:\n      case EditorMode.Background:\n      default:\n        alert(\"Unsupported editing mode!\");\n        break;\n    }\n  };\n\n  const handleQuantize = (newColorDepth: number): void => {\n    newColorDepth = Math.floor(newColorDepth); // just in case of a float\n    if (!(image instanceof Bitmap3)) {\n      alert(\"Requantization of paletted images currently not supported!\");\n    } else {\n      let ok = window.confirm(\n        \"(Don't panic!) Quantizing a bitmap will change it from mode 3 to mode 4. Is this okay?\"\n      );\n      if (ok) {\n        let { palette, sprite } = quantize(image, newColorDepth);\n        handleImageChange(sprite);\n        handlePaletteChange(palette);\n      }\n    }\n  };\n\n  const handleChangeSelectedColor = (newIndex: number) => {\n    setSelectedColorIndex(newIndex);\n    if (image instanceof Bitmap4) {\n      image.setPaletteIndex(newIndex);\n    }\n  };\n\n  const handleColorChange = (newColor: Color): void => {\n    const newPalette = palette.slice();\n    newPalette[selectedColorIndex] = newColor;\n    if (image instanceof Bitmap4) {\n      image.updatePalette(newPalette);\n    }\n    handlePaletteChange(newPalette);\n  };\n\n  const handleImageExport = async (type: string) => {\n    let fileName;\n    let fileType = \"\";\n    let blob: Blob | null;\n\n    if (image) {\n      fileName = image.fileName.slice(0, image.fileName.lastIndexOf(\".\"));\n    } else {\n      fileName = \"default\";\n    }\n\n    const exportFailAlert = () =>\n      alert(\"Failed to export image! Check console for more information.\");\n\n    switch (type) {\n      case \"GBA\":\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //.c file\n        fileType = \".c\";\n        let cBlob = new Blob([image.getCSourceData()]);\n        saveAs(cBlob, fileName + fileType);\n        //.h file\n        fileType = \".h\";\n        let hBlob = new Blob([image.getHeaderData()]);\n        saveAs(hBlob, fileName + fileType);\n        return;\n      case \"PAL\":\n        //.pal file\n        if (!palette) {\n          alert(\"Can't export a non-existant palette!\");\n          return;\n        } else {\n          fileType = \".pal\";\n          blob = new Blob([exportPalette(palette)]);\n          break;\n        }\n      case \"BMP\":\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //.bmp file\n        fileType = \".bmp\";\n        blob = await exportImage(image, type);\n        break;\n      case \"PNG\":\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //.png file\n        fileType = \".png\";\n        blob = await exportImage(image, type);\n        break;\n      default:\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //default as .txt if unrecognized type is selected\n        fileType = \".txt\";\n        blob = await exportImage(image, type);\n    }\n    if (!blob) {\n      exportFailAlert();\n    } else {\n      saveAs(blob, fileName + fileType);\n    }\n  };\n\n  useEffect(() => {\n    const alertBadFormatting = () =>\n      alert(\"Image data incorrectly formatted. Aborting load operation.\");\n    const askLoadImage = () =>\n      window.confirm(\n        \"Found automatically saved image data from your last session in storage. Would you like to load it? If not, it will be deleted.\"\n      );\n\n    const loadedImageMode = window.localStorage.getItem(STORAGE.imageMode);\n    const loadedImageType = window.localStorage.getItem(STORAGE.imageType);\n    const loadedPalette = window.localStorage.getItem(STORAGE.palette);\n    const loadedImage = window.localStorage.getItem(STORAGE.imageData);\n\n    if (loadedImageMode && loadedImageType && loadedImage) {\n      let loadImage = askLoadImage();\n\n      if (!loadImage) {\n        window.localStorage.clear();\n        return;\n      }\n\n      const parsedImage = JSON.parse(loadedImage) as ImageDataStore;\n      const parsedImageMode: Mode = parseInt(loadedImageMode) as Mode;\n      const parsedImageType: EditorMode = loadedImageType as EditorMode;\n\n      switch (parsedImageMode) {\n        case 3:\n          setImage(Bitmap3.fromDataStore(parsedImage));\n          let newEditorSettings = DEFAULT_SETTINGS;\n          newEditorSettings.imageMode = parsedImageMode;\n          newEditorSettings.editorMode = parsedImageType;\n          setEditorSettings(newEditorSettings);\n          break;\n        case 4:\n          if (!loadedPalette) {\n            alertBadFormatting();\n            return;\n          } else {\n            const parsedPalette = JSON.parse(loadedPalette) as Palette;\n            setImage(Bitmap4.fromDataStore(parsedImage, parsedPalette));\n            setPalette(parsedPalette);\n            let newEditorSettings = DEFAULT_SETTINGS;\n            newEditorSettings.imageMode = parsedImageMode;\n            newEditorSettings.editorMode = parsedImageType;\n            setEditorSettings(newEditorSettings);\n          }\n          break;\n        default:\n          alertBadFormatting();\n      }\n    }\n  }, []);\n\n  return (\n    <div className=\"app-container\">\n      <div className=\"navbar\">\n        <span className=\"title\">VOCC</span>\n        <Dropdown label=\"New\">\n          <div className=\"dd-content-header\">Bitmap</div>\n          <button onClick={toggleMode3BitmpModal}>Mode 3</button>\n          <NewImageModal\n            isShowing={isMode3BitmapModalShowing}\n            hide={toggleMode3BitmpModal}\n            onAccept={handleNewBitmap.bind(null, EditorMode.Bitmap, 3)}\n          ></NewImageModal>\n          <button onClick={toggleMode4BitmpModal}>Mode 4</button>\n          <NewImageModal\n            isShowing={isMode4BitmapModalShowing}\n            hide={toggleMode4BitmpModal}\n            onAccept={handleNewBitmap.bind(null, EditorMode.Bitmap, 4)}\n          ></NewImageModal>\n          <div className=\"dd-divider\"></div>\n          <div className=\"dd-content-header\">Spritesheet</div>\n          <button\n            onClick={() =>\n              alert(\"Spritesheet editing not currently supported.\")\n            }\n          >\n            4 bpp\n          </button>\n          <div className=\"dd-divider\"></div>\n          <div className=\"dd-content-header\">Background</div>\n          <button\n            onClick={() => alert(\"Background editing not currently supported.\")}\n          >\n            Mode 0\n          </button>\n        </Dropdown>\n        <Dropdown label=\"Edit\">\n          <button onClick={() => null}>Undo</button>\n          <button onClick={() => null}>Redo</button>\n          <div className=\"dd-divider\"></div>\n          <button onClick={() => null}>Clear All</button>\n        </Dropdown>\n        <Dropdown label=\"Import\">\n          <div className=\"dd-content-header\">Image</div>\n          <ImportButton\n            onFileInputChange={handleFileInputChange.bind(null, \"Image\")}\n            buttonLabel=\"Image (*.png, *.bmp, *.jpg)\"\n          />\n          <div className=\"dd-divider\"></div>\n          <ImportButton\n            onFileInputChange={handleFileInputChange.bind(null, \"Palette\")}\n            buttonLabel=\"Color Palette (*.pal)\"\n          />\n        </Dropdown>\n        <Dropdown label=\"Export\">\n          <div className=\"dd-content-header\">Image</div>\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"PNG\")}\n            buttonLabel=\"PNG Image (*.png)\"\n          />\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"BMP\")}\n            buttonLabel=\"Bitmap (*.bmp)\"\n          />\n          <div className=\"dd-divider\"></div>\n          <div className=\"dd-content-header\">GBA</div>\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"GBA\")}\n            buttonLabel=\"C Source Code (*.c/.h)\"\n          />\n          <div className=\"dd-divider\"></div>\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"PAL\")}\n            buttonLabel=\"Color Palette (*.pal)\"\n          />\n        </Dropdown>\n        <Dropdown label=\"Help\">\n          <form>\n            <button type=\"submit\" formAction=\"\" formTarget=\"\">\n              Documentation\n            </button>\n          </form>\n          <form>\n            <button\n              type=\"submit\"\n              formAction=\"https://www.coranac.com/tonc/text/\"\n              formTarget=\"_blank\"\n            >\n              GBA Graphics 101\n            </button>\n          </form>\n          <div className=\"dd-divider\"></div>\n          <form>\n            <button type=\"submit\" formAction=\"\" formTarget=\"\">\n              About VOCC\n            </button>\n          </form>\n          <div className=\"dd-divider\"></div>\n          <form>\n            <button\n              type=\"submit\"\n              formAction=\"https://github.com/lbussell/vocc\"\n              formTarget=\"_blank\"\n            >\n              View on GitHub\n            </button>\n          </form>\n          <button onClick={handleClearLocalStorage}>Clear Local Storage</button>\n        </Dropdown>\n      </div>\n      <div className=\"workspace-container\">\n        <div className=\"left-panel\">\n          <div className=\"tools-container\">\n            <ToolsPanel\n              settings={editorSettings}\n              onSettingsChange={handleSettingsChange}\n              onToolChange={handleToolChange}\n            ></ToolsPanel>\n          </div>\n          {image ? <div> Scale: {scale.toFixed(2)}x </div> : null}\n        </div>\n        <div className=\"image-container\">\n          {image ? (\n            <EditorCanvas\n              image={image}\n              settings={editorSettings}\n              palette={palette}\n              selectedPaletteIndex={selectedColorIndex}\n              scale={scale}\n              onChangeImage={handleImageChange}\n              onMouseWheel={handleMouseWheelEvent}\n            />\n          ) : (\n            <div className=\"start-message\">\n              <em>Import an image to get started</em>\n            </div>\n          )}\n        </div>\n        <div className=\"right-panel\">\n          <PalettePanel\n            palette={palette}\n            updatePalette={handlePaletteChange}\n            selectedColorIndex={selectedColorIndex}\n            onChangeSelectedColorIndex={handleChangeSelectedColor}\n            onChangeColor={handleColorChange}\n            handleQuantize={handleQuantize}\n            settings={editorSettings}\n            onSettingsChange={handleSettingsChange}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\nimport \"./styles/styles.scss\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}