{"version":3,"sources":["util/types.ts","models/Color.ts","util/consts.ts","util/exportUtils.ts","util/fileLoadUtils.ts","models/Bitmap.ts","models/ImageCanvas.ts","models/Bitmap3.ts","models/Bitmap4.ts","models/Palette.ts","models/Sprite.ts","models/Spritesheet4.ts","util/defaultPalette.ts","util/quantize.ts","components/buttons/ExportButton.tsx","components/buttons/ImportButton.tsx","components/Dropdown.tsx","components/EditorCanvas.tsx","components/hooks/useModal.tsx","components/modals/NewImageModal.tsx","components/buttons/QuantizeButton.tsx","components/PaletteDisplay.tsx","components/PalettePanel.tsx","components/SpritePanel.tsx","components/buttons/Toggle.tsx","components/ToolsPanel.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["EditorMode","Color","r","g","b","a","this","other","Tool","PALETTE_SIZE","height","width","PALETTE_LENGTH","STORAGE","DEFAULT_SETTINGS","grid","currentTool","PENCIL","imageMode","editorMode","Bitmap","generateCSourceFileString","image","mode","palette","generateMode3CSourceFileString","console","error","imageDataStore","fileName","dimensions","imageData","variableName","slice","lastIndexOf","bitmapLength","imageDefinitionString","imageDataHexString","i","length","paletteIndicesToHex","paletteCSourceString","palC","element","colorToHex","PaletteToGBA","generateMode4CSourceFileString","pixelCount","j","pixelToHex","generateHeaderString","params","generateMode3HeaderString","imageDimensions","bitmapLengthDefinition","toUpperCase","imageHeightDefinition","imageWidthDefinition","paletteLengthDefinition","paletteDefinitionString","generateMode4HeaderString","warn","bitmapSize","bitmapSizeDefinition","index1","index2","combinedIndexString","toString","padStart","bgr","binary_value","forEach","elementString","Math","floor","hex_value","parseInt","color","exportImage","img","type","getImageFileBlob","Blob","createHiddenCanvas","d","hiddenCanvas","document","createElement","hidden","setAttribute","loadImageDataFromCanvas","canvas","getContext","getImageData","data","loadHiddenImage","imagefile","Promise","resolve","reject","Image","onload","onerror","src","URL","createObjectURL","loadNewImage","imageFile","hiddenImage","naturalHeight","naturalWidth","context","drawImage","Bitmap3","name","offset","pos","y","x","loadNewPalette","paletteFile","Response","text","fileString","trim","replace","colors","Array","substr","log","red","green","blue","imageCanvas","Uint8ClampedArray","store","imageCanvasElement","toBlob","blob","Loader","pixelGridCanvasElement","ImageCanvas","pixelGridRatio","pixelGrid","PixelGrid","drawImageToHiddenCanvas","drawPixel","dx","dy","fillStyle","fillRect","getPixelColorAt","canvasElement","drawGrid","strokeStyle","beginPath","moveTo","lineTo","stroke","redrawImage","updatePixel","from","Bitmap4","indexArray","currentPaletteIndex","fill","newPaletteIndex","newPalette","drawPaletteToHiddenCanvas","paletteIndexToCol","paletteIndexToRow","Sprite","position","paletteRow","redrawSpritesheet","_data","_dimensions","_position","_palette","_paletteRow","_imageCanvas","_redrawSpritesheet","col","newDimensions","tileArr","tileStartRow","tileStartCol","numberTiles","tile","push","newPaletteRow","sprite","dangerouslySetData","SS4_SIZE_PIXELS","SS4_SIZE_TILES","TILE_SIZE","Spritesheet4","paletteCol","_selectedPaletteCol","_pixelDimensions","_tileDimensions","_hiddenCanvas","_pixelGrid","_tileGridHiddenCanvas","_sprites","_spriteMap","map","tileDimensions","ratio","drawTilesOnCanvas","createTileGridHiddenCanvas","fillBlack","sprites","decodedSprites","s","fromDataStore","JSON","parse","drawToHiddenCanvas","addToSpriteMap","redrawTileGridCanvas","newSprite","newSpriteIndex","addSpriteBoxToTileGridCanvas","c","alert","index","splice","p","t","getTileIndexFromCoordinates","getSpriteFromCoordinates","pixelCoords","ssc","ssd","stp","spd","spp","pixelPos","spritesheetCoordsToSpriteCoords","setPixelColorAt","ctx","stringify","spriteDataStore","bpp","varName","ssDimensions","len","SS_TILES_HEADER","palLength","PALETTE_HEADER","ss","dangerouslySetSprites","decodeSprites","globalAlpha","clearRect","spritePos","spriteDim","spriteNum","strokeRect","font","fillText","DEFAULT_PALETTE","BLACK","quantize","depth","centroids","imageArr","round","min","max","imageToArr","uniqueColors","uniqueColorsString","check","includes","pickedCentroids","maxDist","minDist","midDist","dist","centroidPossible","possible","centers","findCentroids","arrayToProcess","clusters","Groups","iterations","tempdistance","oldcentroids","changed","reset","minCluster","clusterIterate","pow","abs","sqrt","groups","kmeans","newCluster","sort","spriteIndexArrayLength","spriteIndexArray","center","imageIndex","getColorIndex","colorArr","points","numCentroids","currColor","ExportButton","startImageExport","buttonLabel","className","onClick","ImportButton","onFileInputChange","fileInput","useRef","accept","ref","onChange","e","current","Dropdown","label","children","useState","open","setOpen","id","EditorCanvas","selectedPaletteIndex","settings","scale","onChangeImage","onChangeColor","onMouseWheel","canvasRef","canvasSize","setCanvasSize","isPainting","setIsPainting","undefined","mousePos","setMousePos","startPos","setStartPos","imagePosition","setImagePosition","endingPos","setEndingPos","drawImageOnCanvas","useCallback","tileGridCanvasElement","useLayoutEffect","window","addEventListener","clientWidth","clientHeight","imageSmoothingEnabled","devicePixelRatio","getMousePos","rect","getBoundingClientRect","scaleX","scaleY","clientX","left","clientY","top","getImageCoord","fillPixel","setPixelColor","bucketFill","newColor","isEqual","queue","explored","curr","shift","edges","filter","n","startPaint","mousePosition","imageCoord","BUCKET","SQUARE","ELLIPSE","PAN","DROPPER","paint","newMousePos","newImagePosition","stopPaint","temp","point","l","mouseLeave","useEffect","removeEventListener","generateEditorCanvasProps","tool","base","useModal","isShowing","setIsShowing","toggle","NewImageForm","onAccept","setFileName","setHeight","setWidth","onSubmit","preventDefault","htmlFor","value","target","NewImageModal","hide","ReactDOM","createPortal","Fragment","aria-modal","aria-hidden","tabIndex","role","body","handleQuantize","setDepth","PALETTE_CANVAS_SIZE","SCALE","MOUSE_POS_TO_INDEX","XY_TO_INDEX","MOUSE_POS_TO_XY","PaletteDisplay","selectedColorIndex","onChangeSelectedColorIndex","paletteHiddenCanvas","setPaletteHiddenCanvas","setPixelGrid","drawPalette","PaletteUtils","drawSelectedColorHighlight","lineWidth","INDEX_TO_X","INDEX_TO_Y","setupCanvasSize","PalettePanel","onSettingsChange","ColorInput","currentColor","QuantizeButton","color32to256","color32","ceil","color256to32","newRValue","color256","handleRChange","newGValue","handleGChange","newBValue","handleBChange","SpritePanel","onAddSprite","onRemoveSprite","onUpdatePaletteRow","handleChangePaletteRow","NewSpriteForm","SpriteListItem","bind","onChangePaletteRow","renderSpriteList","setPaletteRow","key","newRow","setDimensions","setPosition","Toggle","state","ToolsPanel","onToolChange","title","icon","faPen","faFillDrip","faSquare","faCircle","ZOOM","faSearchPlus","faHandPaper","faEyeDropper","LAYER","faPlusSquare","newSettings","faBorderAll","faLayerGroup","faFileImage","faCode","scaleReducer","deltaY","App","setImage","setPalette","setSelectedColorIndex","editorSettings","setEditorSettings","React","updateState","forceUpdate","undoStack","setUndoStack","undoPointer","setUndoPointer","isMode3BitmapModalShowing","toggleMode3BitmpModal","isMode4BitmapModalShowing","toggleMode4BitmpModal","useReducer","scaleDispatch","handleMouseWheelEvent","handleFileInputChange","event","files","handleImageLoad","handlePaletteLoad","resetUndo","handleImageChange","newImage","spritesheetDataStore","localStorage","setItem","pushUndoStack","imageDataStoreString","newStack","handleUndo","newStoreString","newStore","updateFromStore","handleRedo","handlePaletteChange","handleSettingsChange","palFile","updatePalette","handleToolChange","newTool","handleNewImage","confirm","Spritesheet","Background","handleColorChange","handleImageExport","fileType","exportFailAlert","cBlob","cSourceData","saveAs","hBlob","headerData","pal","count","hex","paletteToHex","keydownHandler","keyCode","ctrlKey","shiftKey","alertBadFormatting","loadedImageMode","getItem","loadedImageType","loadedPalette","loadedImage","clear","parsedImageMode","parsedImageType","buildPalette","paletteString","parsedImage","newEditorSettings","formAction","formTarget","toFixed","newIndex","setPaletteIndex","newColorDepth","spritesheet","addSprite","removeSprite","handleRemoveSprite","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","render","getElementById","process","href","origin","fetch","response","contentType","headers","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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M,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,GAAI,GAAI,EAAG,GACrB,IAAIA,EAAM,GAAI,GAAI,EAAG,GACrB,IAAIA,EAAM,GAAI,GAAI,EAAG,GACrB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,EAAG,EAAG,GAAI,GACpB,IAAIA,EAAM,EAAG,EAAG,GAAI,GACpB,IAAIA,EAAM,EAAG,EAAG,GAAI,GACpB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,GAAI,EAAG,GAAI,GACrB,IAAIA,EAAM,GAAI,EAAG,GAAI,GACrB,IAAIA,EAAM,GAAI,EAAG,GAAI,GACrB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,EAAG,GAAI,GAAI,GACrB,IAAIA,EAAM,EAAG,GAAI,GAAI,GACrB,IAAIA,EAAM,EAAG,GAAI,GAAI,GACrB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,IAAK,GAAI,EAAG,GACtB,IAAIA,EAAM,IAAK,GAAI,EAAG,GACtB,IAAIA,EAAM,IAAK,GAAI,EAAG,GACtB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,IAAK,IAAK,EAAG,GACvB,IAAIA,EAAM,GAAI,IAAK,EAAG,GACtB,IAAIA,EAAM,GAAI,IAAK,EAAG,GACtB,IAAIA,EAAM,GAAI,IAAK,EAAG,GACtB,IAAIA,EAAM,EAAG,IAAK,EAAG,GACrB,IAAIA,EAAM,EAAG,IAAK,GAAI,GACtB,IAAIA,EAAM,EAAG,IAAK,GAAI,GACtB,IAAIA,EAAM,EAAG,IAAK,GAAI,GACtB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,IAAK,IAAK,GACvB,IAAIA,EAAM,EAAG,GAAI,IAAK,GACtB,IAAIA,EAAM,EAAG,GAAI,IAAK,GACtB,IAAIA,EAAM,EAAG,GAAI,IAAK,GACtB,IAAIA,EAAM,EAAG,EAAG,IAAK,GACrB,IAAIA,EAAM,GAAI,EAAG,IAAK,GACtB,IAAIA,EAAM,GAAI,EAAG,IAAK,GACtB,IAAIA,EAAM,GAAI,EAAG,IAAK,GACtB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,IAAK,GACvB,IAAIA,EAAM,IAAK,EAAG,GAAI,GACtB,IAAIA,EAAM,IAAK,EAAG,GAAI,GACtB,IAAIA,EAAM,IAAK,EAAG,GAAI,GACtB,IAAIA,EAAM,IAAK,EAAG,EAAG,GACrB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,EAAG,EAAG,EAAG,GACnB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,GAAI,GAAI,GAAI,GACtB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,GACzB,IAAIA,EAAM,IAAK,IAAK,IAAK,IC9PrBsQ,GAAe,IAAItQ,EAAM,EAAG,EAAG,EAAG,GAEjC,SAASuQ,GACdlP,EACAmP,GAYA,IATA,IAAIC,EACAC,EAgHN,SAAoBrP,GAElB,IADA,IAAIqP,EAAW,GACNtJ,EAAI,EAAGA,EAAI/F,EAAMQ,WAAWpB,OAAQ2G,IAC3C,IAAK,IAAIC,EAAI,EAAGA,EAAIhG,EAAMQ,WAAWnB,MAAO2G,IAAK,CAC/C,IAAIzC,EAAQvD,EAAMiI,gBAAgB,CAAEjC,IAAGD,MACvCsJ,EAAS9E,KAAK,CACZpH,KAAKmM,MAAMnM,KAAKoM,IAAIpM,KAAKqM,IAAIjM,EAAM3E,EAAG,GAAI,MAC1CuE,KAAKmM,MAAMnM,KAAKoM,IAAIpM,KAAKqM,IAAIjM,EAAM1E,EAAG,GAAI,MAC1CsE,KAAKmM,MAAMnM,KAAKoM,IAAIpM,KAAKqM,IAAIjM,EAAMzE,EAAG,GAAI,QAIhD,OAAOuQ,EA5HQI,CAAWzP,GACtBwG,EAAS2I,EAKTO,EAAe,GACfC,EAA+B,GAC1B3O,EAAI,EAAGA,EAAIqO,EAASpO,OAAQD,IAAK,CACxC,IAAI4O,EAAQP,EAASrO,GAChB2O,EAAmBE,SAAS3D,KAAK0B,UAAUgC,MAC9CF,EAAanF,KAAKqF,GAClBD,EAAmBpF,KAAK2B,KAAK0B,UAAUgC,KAM3C,GAAe,IAAXpJ,GAAgBkJ,EAAazO,OAASuF,EACxC4I,EAAYM,EACZlJ,EAASkJ,EAAazO,WACjB,CAAC,IACA6O,EAoPV,SACEJ,EACAP,GAEA,IAAIY,EAAU,IACVC,EAAU,EACVC,GAAWF,EAAUC,GAAW,EAEhCE,EAAO,EAEPJ,EAA8B,GAElC,KAAOE,GAAWD,GAAS,OAEGI,GAAiBT,EAD7CO,GAAWF,EAAUC,GAAW,EACoCb,GAA9DiB,EAFmB,EAEnBA,SAAUC,EAFS,EAETA,QAEXD,GAGCF,EAAOD,IACTH,EAAkB5D,KAAKC,MAAMD,KAAK0B,UAAUyC,IAC5CH,EAAOD,GAETD,EAAUC,EAAU,GANpBF,EAAUE,EAAU,EASxB,MAAO,CAAEH,mBA9QmBQ,CAAcZ,EAAclJ,GAAhDsJ,gBAENV,EAAYlD,KAAKC,MAAMD,KAAK0B,UAAUkC,IAgBxC,IA3CuC,MAsIzC,SACES,EACAnB,EACAoB,GAEA,IAAIC,EAAgB,GAChBC,EAAa,EACbC,EAAe,EACfC,EAA2B1E,KAAKC,MAAMD,KAAK0B,UAAUwB,IACrDyB,GAAU,EAEd,EAAG,CACD,IAAK,IAAIC,EAAQ,EAAGA,EAAQN,EAAUM,IACpCL,EAAOK,GAAS,GAGlBD,GAAU,EAEVA,GAAU,EAEV,IAAK,IAAI7P,EAAI,EAAGA,EAAIuP,EAAetP,OAAQD,IAAK,CAI9C,IAHA,IAAIgP,GAAW,EACXe,EAAa,EAGXC,EAAiB,EACrBA,EAAiBR,EACjBQ,IACA,CAGA,IAFA,IAAId,EAAO,EAEFxO,EAAI,EAAGA,EAAI6O,EAAevP,GAAGC,OAAQS,IAC5CwO,GAAQ/M,KAAK8N,IACX9N,KAAK+N,IAAIX,EAAevP,GAAGU,GAAK0N,EAAU4B,GAAgBtP,IAC1D,GAGJiP,EAAexN,KAAKgO,KAAKjB,KAER,IAAbF,GAAkBW,GAAgBX,KACpCA,EAAUW,EACVI,EAAaC,GAGjBP,EAAOM,GAAYxG,KAAKgG,EAAevP,GAAGL,SAG5C,IAAK,IAAIqQ,EAAiB,EAAGA,EAAiBR,EAAUQ,IAAkB,CACxE,IAAK,IAAIhQ,EAAI,EAAGA,EAAIyP,EAAOO,GAAgB/P,OAAQD,IACjD,IAAK,IAAIU,EAAI,EAAGA,EAAI+O,EAAOO,GAAgBhQ,GAAGC,OAAQS,IACpD0N,EAAU4B,GAAgBtP,IAAM+O,EAAOO,GAAgBhQ,GAAGU,GAG9D,IAAK,IAAIV,EAAI,EAAGA,EAAIoO,EAAU4B,GAAgB/P,OAAQD,IACpDoO,EAAU4B,GAAgBhQ,GAAKmC,KAAKmM,MAClCnM,KAAKoM,IACHpM,KAAKqM,IACHJ,EAAU4B,GAAgBhQ,IACzByP,EAAOO,GAAgB/P,QAAU,EAC9B,EACAwP,EAAOO,GAAgB/P,QAC3B,GAEF,MAIAmO,EAAU4B,GAAgBhQ,KAAO4P,EAAaI,GAAgBhQ,KAChE6P,GAAU,EACVD,EAAe,GACfA,EAAe1E,KAAKC,MAAMD,KAAK0B,UAAUwB,KAI/CsB,WACmB,IAAZG,GAAoBH,EAAa,KAY1C,OAVAtQ,QAAQuG,IAAI,kBACZvG,QAAQuG,IAAI+J,GAGZtQ,QAAQuG,IAAI,cAML,CAAEyK,OAAQX,EAAQJ,QAASjB,GA9LRiC,CACxBnF,KAAKC,MAAMD,KAAK0B,UAAUyB,IAC1BnD,KAAKC,MAAMD,KAAK0B,UAAUwB,IAC1B5I,GAHI4K,EA/BiC,EA+BjCA,OAAQf,EA/ByB,EA+BzBA,QAUVG,EAAyB,GAEpBxP,EAAI,EAAGA,EAAIqP,EAAQpP,OAAQD,IAAK,CACvC,IAAIsQ,EAAyB,CAAC,GAAI,IAClCA,EAAW,GAAKjB,EAAQrP,GACxB,IAAK,IAAIU,EAAI,EAAGA,EAAI0P,EAAOpQ,GAAGC,OAAQS,IACpC4P,EAAW5P,EAAI,GAAK0P,EAAOpQ,GAAGU,GAEhC8O,EAASjG,KAAK+G,GAGhBd,EAASe,MAAK,SAAUxS,EAAGD,GACzB,OAAOA,EAAEmC,OAASlC,EAAEkC,UAGtBb,QAAQuG,IAAI6J,GAEZ,IAAIgB,EAAyBxR,EAAMQ,WAAWpB,OAASY,EAAMQ,WAAWnB,MAGpEoS,EAA6B,IAAIhL,MAAc+K,GACnDC,EAAiB1I,KAAK,GAMtB,IAJA,IAAI7I,EAAmB,IAAIuG,MAAM,KAG7BzF,EAAI,EACAA,EAAIwP,EAASvP,QAAUD,EA/DZ,IA+D4BA,IAAK,CAClD,IAAI0Q,EAAgB,IAAI/S,EACtB6R,EAASxP,GAAG,GAAG,GACfwP,EAASxP,GAAG,GAAG,GACfwP,EAASxP,GAAG,GAAG,GACf,GAEFd,EAAQc,GAAK0Q,EACb,IAAK,IAAIhQ,EAAI,EAAGA,EAAI8O,EAASxP,GAAGC,OAAQS,IAAK,CAC3C,IAAIiQ,EAAaC,GAAcvC,EAAUmB,EAASxP,GAAGU,KAEjC,IAAhBiQ,IACFF,EAAiBE,GAAc3Q,IAKrC,KAAQA,EAhFW,IAgFKA,IACtBd,EAAQc,GAAKiO,GASf,MAAO,CAAExE,OANI,IAAI7B,EACf5I,EAAMO,SACNL,EACAF,EAAMQ,WACNiR,GAEevR,WAKnB,SAAS0R,GAAcvC,EAAsBwC,GAC3C,IAAK,IAAI7Q,EAAI,EAAGA,EAAIqO,EAASpO,OAAQD,IACnC,GACEqO,EAASrO,GAAG,KAAO6Q,EAAS,IAC5BxC,EAASrO,GAAG,KAAO6Q,EAAS,IAC5BxC,EAASrO,GAAG,KAAO6Q,EAAS,GAG5B,OADAxC,EAASrO,GAAK,EAAE,GAAI,GAAI,GACjBA,EAGX,OAAQ,EA0HV,SAASmP,GACP2B,EACA7B,EACA8B,GAEA,IAAI3C,EAAY,EACZ4C,EAAsBF,EAAO,GAC7B1B,GAAW,EACXC,EAAsB,GAE1BA,EAAQ9F,KAAKyH,GAEb,IAAK,IAAIhR,EAAI,EAAGA,EAAI8Q,EAAO7Q,OAAQD,IAAK,CAGtC,IAFA,IAAIkP,EAAO,EAEFxO,EAAI,EAAGA,EAAIoQ,EAAO9Q,GAAGC,OAAQS,IACpCwO,GAAQ/M,KAAK8N,IAAI9N,KAAK+N,IAAIY,EAAO9Q,GAAGU,GAAKsQ,EAAUtQ,IAAK,GAI1D,IAFAwO,EAAO/M,KAAKgO,KAAKjB,KAELD,IACVb,IACA4C,EAAYF,EAAO9Q,GACnBqP,EAAQ9F,KAAKuH,EAAO9Q,IAEhBoO,GAAa2C,GAEf,MAAO,CAAE3B,SADTA,GAAW,EACQC,WAIzB,MAAO,CAAED,WAAUC,WC/PN4B,OAZf,YAA0F,IAAlEC,EAAiE,EAAjEA,iBAAkBC,EAA+C,EAA/CA,YAKxC,OACE,4BAAQC,UAAU,uBAAuBC,QALvB,WAClBH,MAKGC,ICgBQG,OAlBf,YAAgF,IAAxDC,EAAuD,EAAvDA,kBAAmBJ,EAAoC,EAApCA,YACnCK,EAAYC,iBAAyB,MAE3C,OACE,oCACE,+BACGN,EACD,2BACEzO,KAAK,OACLgP,OAAO,gCACPC,IAAKH,EACLI,SAAU,SAAAC,GAAC,OAAIN,EAAkBC,EAAUM,QAASD,SCjB/C,SAASE,GAAT,GAGuB,IAFpCC,EAEmC,EAFnCA,MACAC,EACmC,EADnCA,SACmC,EACXC,oBAAS,GADE,mBAC5BC,EAD4B,KACtBC,EADsB,KAGnC,OACE,yBAAKhB,UAAU,gBACb,4BAAQC,QAAS,kBAAMe,GAASD,IAAOf,UAAU,aAC9CY,GAEH,yBACEK,GAAG,aACHjB,UAAWe,EAAO,qBAAuB,aACzCd,QAAS,kBAAMe,GAAQ,KAEtBH,ICUM,SAASK,GAAT,GASqB,IARlCtT,EAQiC,EARjCA,MACAE,EAOiC,EAPjCA,QACAqT,EAMiC,EANjCA,qBACAC,EAKiC,EALjCA,SACAC,EAIiC,EAJjCA,MACAC,EAGiC,EAHjCA,cACAC,EAEiC,EAFjCA,cACAC,EACiC,EADjCA,aAEMC,EAAYpB,iBAA0B,MADX,EAEGS,mBAAmB,CAAC,EAAG,IAF1B,mBAE1BY,EAF0B,KAEdC,EAFc,OAKGb,oBAAkB,GALrB,mBAK1Bc,EAL0B,KAKdC,EALc,OAMDf,wBAC9BgB,GAP+B,mBAM1BC,EAN0B,KAMhBC,EANgB,OASDlB,mBAA2B,CACzDlN,EAAG,EACHD,EAAG,IAX4B,mBAS1BsO,EAT0B,KAShBC,EATgB,OAaSpB,mBAA2B,CACnElN,EAAG,EACHD,EAAG,IAf4B,mBAa1BwO,EAb0B,KAaXC,EAbW,OAiBCtB,wBAChCgB,GAlB+B,mBAiB1BO,EAjB0B,KAiBfC,EAjBe,KAsB3BC,EAAoBC,uBAAY,WACpC,IAAMvQ,EAASwP,EAAUf,QACzB,GAAKzO,EAAL,CACA,IAAMoB,EAAUpB,EAAOC,WAAW,MAC7BmB,GACAzF,IAGLyF,EAAQgJ,UAAU,EAAG,EAAGpK,EAAOhF,MAAOgF,EAAOjF,QAE7CqG,EAAQC,UACN1F,EAAMkH,mBACNqN,EAAcvO,EACduO,EAAcxO,EACd/F,EAAMQ,WAAWnB,MAAQoU,EACzBzT,EAAMQ,WAAWpB,OAASqU,GAGxBD,EAAS/T,MAAQgU,GA/DI,GAgEvBhO,EAAQC,UACN1F,EAAMsH,uBACNiN,EAAcvO,EACduO,EAAcxO,EACd/F,EAAMQ,WAAWnB,MAAQoU,EACzBzT,EAAMQ,WAAWpB,OAASqU,GAM5BD,EAAS/T,MACTO,aAAiB8K,IACjB2I,GA5EsB,GA8EtBhO,EAAQC,UACL1F,EAAuB6U,sBACxBN,EAAcvO,EACduO,EAAcxO,EACd/F,EAAMQ,WAAWnB,MAAQoU,EACzBzT,EAAMQ,WAAWpB,OAASqU,OAG7B,CAACzT,EAAOuU,EAAeV,EAAWJ,EAAOD,EAAS/T,OAKrDqV,2BAAgB,WASdC,OAAOC,iBAAiB,UAAU,WAP5BnB,EAAUf,SACZiB,EAAc,CACZF,EAAUf,QAAQmC,YAClBpB,EAAUf,QAAQoC,oBAKvB,IAKHJ,2BAAgB,WACd1U,QAAQuG,IAAI,wBACZ,IAAMtC,EAASwP,EAAUf,QACzB,GAAKzO,EAAL,CACA,IAAMoB,EAAUpB,EAAOC,WAAW,MAC7BmB,IACLsO,EAAc,CAAC1P,EAAO4Q,YAAa5Q,EAAO6Q,eAC1CzP,EAAQ0P,uBAAwB,MAC/B,CAACtB,IAKJiB,2BAAgB,WACd,IAAMzQ,EAASwP,EAAUf,QACzB,GAAKzO,EAAL,CACA,IAAMoB,EAAUpB,EAAOC,WAAW,MAClC,GAAKmB,EAAL,CAEA,IAAM2P,EAAmBL,OAAOK,kBAAoB,EACpD/Q,EAAOhF,MAAQyU,EAAW,GAAKsB,EAC/B/Q,EAAOjF,OAAS0U,EAAW,GAAKsB,EAChC3P,EAAQ0P,uBAAwB,MAC/B,CAACrB,EAAYD,IAKhBiB,2BAAgB,WACVjB,EAAUf,SACZe,EAAUf,QAAQkC,iBAAiB,QAASpB,KAE7C,CAACA,IAMJkB,2BAAgB,kBAAMH,OAItB,IAAMU,EAAc,SAACxC,GACnB,IAAMxO,EAASwP,EAAUf,QACzB,GAAIzO,EAAQ,CACV,IAAMiR,EAAOjR,EAAOkR,wBACdC,EAASnR,EAAOhF,MAAQiW,EAAKjW,MAC7BoW,EAASpR,EAAOjF,OAASkW,EAAKlW,OACpC,MAAO,CACL4G,GAAI6M,EAAE6C,QAAUJ,EAAKK,MAAQH,EAC7BzP,GAAI8M,EAAE+C,QAAUN,EAAKO,KAAOJ,KAM5BK,EAAgBlB,uBACpB,SAACT,GACC,IAAMnO,EAAI7C,KAAKC,OAAO+Q,EAASnO,EAAIuO,EAAcvO,GAAKyN,GAChD1N,EAAI5C,KAAKC,OAAO+Q,EAASpO,EAAIwO,EAAcxO,GAAK0N,GACtD,KACEzN,EAAI,GACJA,EAAIhG,EAAMQ,WAAWnB,OACrB0G,EAAI,GACJA,EAAI/F,EAAMQ,WAAWpB,QAGvB,MAAO,CAAE4G,IAAGD,OAEd,CAAC0N,EAAOc,EAAevU,EAAMQ,aAkBzBuV,EAAYnB,uBAChB,SAAC9O,EAAmCvC,GAC7BuC,IACA+N,EAAUf,SACCe,EAAUf,QAAQxO,WAAW,QAG7CtE,EAAMgW,cAAclQ,EAAKvC,GACzBoR,QAEF,CAACA,EAAmB3U,IAGhBiW,EAAarB,uBACjB,SAAC9O,EAAmCoQ,GAElC,GAAKpQ,EAAL,CACA,IAAMvC,EAAQvD,EAAMiI,gBAAgBnC,GACpC,IAAIvC,EAAM4S,QAAQD,GAAlB,CACAlW,EAAMgW,cAAclQ,EAAKoQ,GACzB9V,QAAQuG,IAAIpD,GAGZ,IAFA,IAAI6S,EAAQ,IAAI3P,MAAwBX,GACpCuQ,EAAW,IAAI5P,MAAwBX,QACvBoO,IAAbkC,EAAM,IAAkB,CAC7B,IAAIE,EAAOF,EAAMG,QACbC,EAAQ,IAAI/P,MAAwB,GAEpC6P,EAAKvQ,EAAI,GACXyQ,EAAMjM,KAAK,CAAEvE,EAAGsQ,EAAKtQ,EAAGD,EAAGuQ,EAAKvQ,EAAI,IAElCuQ,EAAKvQ,EAAI/F,EAAMQ,WAAWpB,OAAS,GACrCoX,EAAMjM,KAAK,CAAEvE,EAAGsQ,EAAKtQ,EAAGD,EAAGuQ,EAAKvQ,EAAI,IAElCuQ,EAAKtQ,EAAI,GACXwQ,EAAMjM,KAAK,CAAEvE,EAAGsQ,EAAKtQ,EAAI,EAAGD,EAAGuQ,EAAKvQ,IAElCuQ,EAAKtQ,EAAIhG,EAAMQ,WAAWnB,MAAQ,GACpCmX,EAAMjM,KAAK,CAAEvE,EAAGsQ,EAAKtQ,EAAI,EAAGD,EAAGuQ,EAAKvQ,IAGtCyQ,EACGC,QAAO,SAACC,GAAD,OAAQL,EAASxG,SAAS6G,MACjCzT,SAAQ,SAACyT,GACRL,EAAS9L,KAAKmM,GACV1W,EAAMiI,gBAAgByO,GAAGP,QAAQ5S,KACnC6S,EAAM7L,KAAKmM,GACX1W,EAAMgW,cAAcU,EAAGR,OAK/BvB,QAEF,CAAC3U,EAAO2U,IAmBJgC,EAAa/B,uBACjB,SAAC/B,GACC,IAAM+D,EAAgBvB,EAAYxC,GAClC,GAAK+D,EAAL,CACAxC,EAAYwC,GACZ,IAAMC,EAAaf,EAAcc,GACjC,GAAK/C,EAAUf,QAEf,GADgBe,EAAUf,QAAQxO,WAAW,MAG7C,OAAQkP,EAAS9T,aACf,KAAKR,EAAKS,OACRsU,GAAc,GACd8B,EAAUc,EAAY3W,EAAQqT,IAC9B,MACF,KAAKrU,EAAK4X,OACRb,EAAWY,EAAY3W,EAAQqT,IAC/B,MACF,KAAKrU,EAAK6X,OACR,IAAKF,EAAY,OAEjBvC,EADoBuC,GAEpB5C,GAAc,GACd,MACF,KAAK/U,EAAK8X,QACR,IAAKH,EAAY,OACjBvC,EAAYuC,GACZ5C,GAAc,GACd,MACF,KAAK/U,EAAK+X,IACRhD,GAAc,GACd,MACF,KAAK/U,EAAKgY,QACR,IAAKL,EAAY,OACjB,IAAMtT,EAAQvD,EAAMiI,gBAAgB4O,GACpClD,EAAcpQ,OAIpB,CACEvD,EACA2T,EACAH,EAAS9T,YACTuW,EACAF,EACAD,EACA5V,EACAqT,IAIE4D,EAAQvC,uBACZ,SAAC/B,GACC,IAAMuE,EAAc/B,EAAYxC,GAChC,GAAKuE,EAAL,CACA,IAAMP,EAAaf,EAAcsB,GACjC,OAAQ5D,EAAS9T,aACf,KAAKR,EAAKS,OACJqU,IACF+B,EAAUc,EAAY3W,EAAQqT,IAC9Ba,EAAYgD,IAEd,MACF,KAAKlY,EAAK6X,OACR,GAAI/C,EAAY,CACd,IAAK6C,EAAY,OAEjBnC,EADkBmC,GAGpB,MACF,KAAK3X,EAAK8X,QACR,GAAIhD,EAAY,CACd,IAAK6C,EAAY,OAEjBnC,EADkBmC,GAGpB,MACF,KAAK3X,EAAK+X,IACR,GAAIjD,GAAcG,EAAU,CAC1B,IAAMkD,EAAmB,CACvBrR,EAAGuO,EAAcvO,GAAKoR,EAAYpR,EAAImO,EAASnO,GAC/CD,EAAGwO,EAAcxO,GAAKqR,EAAYrR,EAAIoO,EAASpO,IAEjDyO,EAAiB6C,GACjBjD,EAAYgD,QAKpB,CACEpD,EACA+B,EACAD,EACA5V,EACAqT,EACAgB,EACAJ,EACAX,EAAS9T,cAIP4X,EAAY1C,uBAAY,WAG5B,GAFAR,OAAYF,GACZD,GAAc,GACVT,EAAS9T,cAAgBR,EAAK6X,OAAQ,CACxC,IAAKtC,EAAW,OAChB,IAAIzI,EAAIqI,EACJxB,EAAI4B,EACR,GAAI5B,EAAE7M,EAAIgG,EAAEhG,EAAG,CACb,IAAIuR,EAAOvL,EAAEhG,EACbgG,EAAI,CAAEhG,EAAG6M,EAAE7M,EAAGD,EAAGiG,EAAEjG,GACnB8M,EAAI,CAAE7M,EAAGuR,EAAMxR,EAAG8M,EAAE9M,GAEtB,GAAI8M,EAAE9M,EAAIiG,EAAEjG,EAAG,CACb,IAAIwR,EAAOvL,EAAEjG,EACbiG,EAAI,CAAEhG,EAAGgG,EAAEhG,EAAGD,EAAG8M,EAAE9M,GACnB8M,EAAI,CAAE7M,EAAG6M,EAAE7M,EAAGD,EAAGwR,GAEnB,IAAK,IAAIvW,EAAIgL,EAAEjG,EAAG/E,GAAK6R,EAAE9M,EAAG/E,IAC1B,IAAK,IAAIU,EAAIsK,EAAEhG,EAAGtE,GAAKmR,EAAE7M,EAAGtE,IAAK,CAC/B,IAAIoE,EAAwB,CAAEE,EAAGtE,EAAGqE,EAAG/E,GACvChB,EAAMgW,cAAclQ,EAAK5F,EAAQqT,IAGrCoB,IAGF,GAAInB,EAAS9T,cAAgBR,EAAK8X,QAAS,CAEzC,GADA5W,QAAQuG,IAAI,oBACP8N,EAAW,OAChB,IAAIzI,EAAIqI,EACJxB,EAAI4B,EACR,GAAI5B,EAAE7M,EAAIgG,EAAEhG,EAAG,CACb,IAAIuR,EAAOvL,EAAEhG,EACbgG,EAAI,CAAEhG,EAAG6M,EAAE7M,EAAGD,EAAGiG,EAAEjG,GACnB8M,EAAI,CAAE7M,EAAGuR,EAAMxR,EAAG8M,EAAE9M,GAEtB,GAAI8M,EAAE9M,EAAIiG,EAAEjG,EAAG,CACb,IAAIwR,EAAOvL,EAAEjG,EACbiG,EAAI,CAAEhG,EAAGgG,EAAEhG,EAAGD,EAAG8M,EAAE9M,GACnB8M,EAAI,CAAE7M,EAAG6M,EAAE7M,EAAGD,EAAGwR,GAWnB,IATA,IAAI7F,EAAS,CACX1L,GAAIgG,EAAEhG,EAAI6M,EAAE7M,GAAK,EACjBD,GAAIiG,EAAEjG,EAAI8M,EAAE9M,GAAK,GAGfhH,EAAIoE,KAAK+N,IAAI2B,EAAE7M,EAAI0L,EAAO1L,GAC1BlH,EAAIqE,KAAK+N,IAAI2B,EAAE9M,EAAI2L,EAAO3L,GAGrB/E,EAAIgL,EAAEjG,EAAG/E,GAAK6R,EAAE9M,EAAG/E,IAC1B,IAAK,IAAIU,EAAIsK,EAAEhG,EAAGtE,GAAKmR,EAAE7M,EAAGtE,IAAK,CAC/B,IAAI8V,EAAQ,CAAExR,EAAGtE,EAAGqE,EAAG/E,GACvBZ,QAAQuG,IAAI6Q,GAEZ,IAAIC,EAAItU,KAAK8N,IAAIuG,EAAMxR,EAAI0L,EAAO1L,EAAG,GAAK7C,KAAK8N,IAAIlS,EAAG,GAClDH,EAAIuE,KAAK8N,IAAIuG,EAAMzR,EAAI2L,EAAO3L,EAAG,GAAK5C,KAAK8N,IAAInS,EAAG,GACtDsB,QAAQuG,IAAI8Q,EAAI7Y,GACQ6Y,EAAI7Y,GAAK,GAE/BoB,EAAMgW,cAAcwB,EAAOtX,EAAQqT,IAIzCoB,IAEFD,OAAaR,GACbR,EAAc1T,KACb,CACDwT,EAAS9T,YACT2U,EACAI,EACAE,EACA3U,EACAE,EACAqT,EACAG,IAGIgE,EAAa9C,uBAAY,WAC7BR,OAAYF,GACZD,GAAc,KACb,IA+BH,OA7BA0D,qBAAU,WACR,GAAK9D,EAAUf,QAAf,CACA,IAAMzO,EAASwP,EAAUf,QAEzB,OADAzO,EAAO2Q,iBAAiB,YAAa2B,GAC9B,kBAAMtS,EAAOuT,oBAAoB,YAAajB,OACpD,CAACA,IAEJgB,qBAAU,WACR,GAAK9D,EAAUf,QAAf,CACA,IAAMzO,EAASwP,EAAUf,QAEzB,OADAzO,EAAO2Q,iBAAiB,YAAamC,GAC9B,WACL9S,EAAOuT,oBAAoB,YAAaT,OAEzC,CAACA,IAEJQ,qBAAU,WACR,GAAK9D,EAAUf,QAAf,CACA,IAAMzO,EAASwP,EAAUf,QAGzB,OAFAzO,EAAO2Q,iBAAiB,UAAWsC,GACnCjT,EAAO2Q,iBAAiB,aAAc0C,GAC/B,WACLrT,EAAOuT,oBAAoB,UAAWN,GACtCjT,EAAOuT,oBAAoB,aAAcF,OAE1C,CAACJ,EAAWI,IAKb,4BACE/E,IAAKkB,EACLzB,UAAWyF,GAA0BrE,EAAS9T,eAKpD,IAAMmY,GAA4B,SAACC,GACjC,IAAMC,EAAO,gBACb,OAAQD,GACN,KAAK5Y,EAAKS,OACR,OAAOoY,EAAO,SAChB,KAAK7Y,EAAK4X,OACR,OAAOiB,EAAO,SAChB,KAAK7Y,EAAK6X,OACR,OAAOgB,EAAO,SAChB,KAAK7Y,EAAK8X,QACR,OAAOe,EAAO,UAChB,KAAK7Y,EAAK+X,IACR,OAAOc,EAAO,MAChB,KAAK7Y,EAAKgY,QACR,OAAOa,EAAO,UAElB,OAAOA,GClgBMC,GANE,WAAO,IAAD,EACa9E,oBAAS,GADtB,mBACd+E,EADc,KACHC,EADG,KAGrB,MAAO,CAAED,YAAWE,OADL,kBAAMD,GAAcD,MC4C/BG,GAAe,SAAC,GAAqC,IAAnCC,EAAkC,EAAlCA,SAAkC,EACxBnF,mBAAiB,YADO,mBACjD3S,EADiD,KACvC+X,EADuC,OAE5BpF,mBAAiB,IAFW,mBAEjD9T,EAFiD,KAEzCmZ,EAFyC,OAG9BrF,mBAAiB,IAHa,mBAGjD7T,EAHiD,KAG1CmZ,EAH0C,KAmBxD,OACE,0BAAMC,SANa,SAAC5F,GACpBA,EAAE6F,iBACFL,EAAS9X,EAAU,CAAEnB,SAAQC,YAK3B,yBAAK+S,UAAU,oBACb,2BAAOuG,QAAQ,WAAWvG,UAAU,eAApC,SAGA,2BACEiB,GAAG,WACHzN,KAAK,WACLlC,KAAK,OACLkV,MAAOrY,EACPqS,SAzBqB,SAACC,GAAD,OAC3ByF,EAAYzF,EAAEgG,OAAOD,WA2BnB,6BACA,2BAAOxG,UAAU,eAAjB,cACA,yBAAKA,UAAU,mBACb,2BAAOuG,QAAQ,SAASvG,UAAU,mBAAlC,WAGA,2BACEiB,GAAG,SACH3P,KAAK,SACL6L,IAtFW,EAuFXqJ,MAAOxZ,EACPwT,SApCmB,SAACC,GAAD,OACzB0F,EAAUjV,SAASuP,EAAEgG,OAAOD,WAqCxB,yCACA,6BACA,2BAAOD,QAAQ,QAAQvG,UAAU,mBAAjC,UAGA,2BACEiB,GAAG,QACH3P,KAAK,SACL6L,IAlGW,EAmGXqJ,MAAOvZ,EACPuT,SA7CkB,SAACC,GAAD,OACxB2F,EAASlV,SAASuP,EAAEgG,OAAOD,WA8CvB,0CAEF,6BACA,yBAAKxG,UAAU,qBACb,4BAAQA,UAAU,gBAAlB,SAMO0G,GApGO,SAAC,GAAD,IAAGT,EAAH,EAAGA,SAAUJ,EAAb,EAAaA,UAAWc,EAAxB,EAAwBA,KAAxB,OACpBd,EACIe,IAASC,aACP,kBAAC,IAAMC,SAAP,KACE,yBAAK9G,UAAU,kBACf,yBACEA,UAAU,gBACV+G,cAAA,EACAC,eAAA,EACAC,UAAW,EACXC,KAAK,UAEL,yBAAKlH,UAAU,SACb,yBAAKA,UAAU,gBAAf,sBACA,kBAAC,GAAD,CACEiG,SAAU,SAAC9X,EAAUC,GACnB6X,EAAS9X,EAAUC,GACnBuY,OAGJ,yBAAK3G,UAAU,sBACb,4BAAQC,QAAS0G,EAAM3G,UAAU,gBAAjC,cAORpO,SAASuV,MAEX,MCTStH,OA5Bf,YAA2E,IAAnDuH,EAAkD,EAAlDA,eAAkD,EAC9CtG,mBAAiB,IAD6B,mBACjE/D,EADiE,KAC1DsK,EAD0D,KAWxE,OACE,yBAAKrH,UAAU,sBACb,4BAAQA,UAAU,kBAAkBC,QAVpB,WACblD,EAILqK,EAAerK,GAHbxC,MAAM,kDAQN,YAGA,2BACEyF,UAAU,iBACV1O,KAAK,SACLkV,MAAOzJ,EACPI,IA3Ba,EA4BbC,IA3Ba,IA4BboD,SAAU,SAAAC,GAAC,OAAI4G,EAASnW,SAASuP,EAAEgG,OAAOD,aCf5Cc,GACI,IADJA,GAEG,IAGHC,GAAQD,GAA6B,GASrCE,GAAqB,SAAC9T,GAAD,OALP,SAAC,GAAD,IAAGE,EAAH,EAAGA,EAAH,OAA4C,GAA5C,EAAMD,EAA2CC,EAMnE6T,CALsB,SAAC,GAAD,IAAG7T,EAAH,EAAGA,EAAGD,EAAN,EAAMA,EAAN,MAAyC,CAC/DC,EAAG7C,KAAKC,MAAM4C,EAAI2T,IAClB5T,EAAG5C,KAAKC,MAAM2C,EAAI4T,KAGNG,CAAgBhU,KAuIfiU,OArIf,YAIkC,IAHhC7Z,EAG+B,EAH/BA,QACA8Z,EAE+B,EAF/BA,mBACAC,EAC+B,EAD/BA,2BAC+B,EACuB/G,qBADvB,mBACxBgH,EADwB,KACHC,EADG,OAIGjH,qBAJH,mBAIxBzL,EAJwB,KAIb2S,EAJa,KAMzBvG,EAAYpB,iBAA0B,MAKtCtK,EAAWyM,uBAAY,WAC3B,GAAKf,EAAUf,SAAYrL,EAA3B,CACA,IAAMhC,EAAUoO,EAAUf,QAAQxO,WAAW,MACxCmB,GACLA,EAAQC,UACN+B,EAAUS,cACV,EACA,EACAwR,GAA4B3E,OAAOK,iBACnCsE,GAA6B3E,OAAOK,qBAErC,CAAC3N,IAME4S,EAAczF,uBAAY,WAC9B,GAAKf,EAAUf,SAAYoH,EAA3B,CACA,IAAMzU,EAAUoO,EAAUf,QAAQxO,WAAW,MACxCmB,IACL6U,EAAuCpa,EAASga,GAChDzU,EAAQC,UACNwU,EACA,EACA,EACAR,GAA4B3E,OAAOK,iBACnCsE,GAA6B3E,OAAOK,sBAErC,CAAClV,EAASga,IAKPK,EAA6B3F,uBACjC,SAAChI,GACC,GAAKiH,EAAUf,QAAf,CACA,IAAIrN,EAAUoO,EAAUf,QAAQxO,WAAW,MAC3C,GAAKmB,EAAL,CACAA,EAAQ4C,YACR5C,EAAQ2C,YAAc,uBACtB3C,EAAQ+U,UAAY,EACpB,IAAM9O,EAAQqJ,OAAOK,iBAAmBuE,GACxClU,EAAQ6P,KApEK,SAAC1I,GAAD,OAAmBA,EAAQ,GAqEtC6N,CAAW7N,GAASlB,EApET,SAACkB,GAAD,OAAmBzJ,KAAKC,MAAMwJ,EAAQ,IAqEjD8N,CAAW9N,GAASlB,EACpBA,EACAA,GAEFjG,EAAQ+C,aAEV,CAACqL,IA8DH,OA7BA8D,qBAAU,WACRvX,QAAQuG,IAAI,6BAQRkN,EAAUf,SAPU,SAACzO,GACvB,IAAM+Q,EAAmBL,OAAOK,kBAAoB,EACpD/Q,EAAOhF,MAAQgF,EAAO4Q,YAAcG,EACpC/Q,EAAOjF,OAASiF,EAAO6Q,aAAeE,EACtC,IAAM3P,EAAUpB,EAAOC,WAAW,MAC9BmB,IAASA,EAAQ0P,uBAAwB,GAG7CwF,CAAgB9G,EAAUf,SAVd,MZxGT,CAAErL,UAHS,IAAIC,EAAUvI,EAAc,GAG1B4E,aAFCF,EAAmB1E,IYuHpCsI,EAbY,EAaZA,UAGF0S,EAhBc,EAcZpW,cAGFqW,EAAa3S,KACZ,IAKHkQ,qBAAU,WACR0C,IACAlS,IACAoS,EAA2BP,KAC1B,CAACA,EAAoBK,EAAalS,EAAUoS,IAG7C,4BAAQ5H,IAAKkB,EAAWxB,QArCN,SAACQ,GACnBoH,EAA2BL,GApBT,SAAC/G,GACnB,GAAIgB,EAAUf,QAAS,CACrB,IAAMwC,EAAOzB,EAAUf,QAAQyC,wBAC/B,MAAO,CACLvP,EAAG6M,EAAE6C,QAAUJ,EAAKK,KACpB5P,EAAG8M,EAAE+C,QAAUN,EAAKO,KAGxB,MAAO,CACL7P,GAAI,EACJD,GAAI,GAUwCsP,CAAYxC,MAoCZT,UAAU,oBChJ7C,SAASwI,GAAT,GAQqB,IAPlC1a,EAOiC,EAPjCA,QACA8Z,EAMiC,EANjCA,mBACAC,EAKiC,EALjCA,2BACAtG,EAIiC,EAJjCA,cACA6F,EAGiC,EAHjCA,eACAhG,EAEiC,EAFjCA,SAEiC,EADjCqH,iBAEA,OACE,6BACE,yBAAKzI,UAAU,oBAAf,WACA,yBAAKA,UAAU,qBACb,kBAAC,GAAD,CACElS,QAASA,EACT8Z,mBAAoBA,EACpBC,2BAA4BA,KAGhC,kBAACa,GAAD,CACEC,aAAc7a,EAAQ8Z,GACtBrG,cAAeA,IAEjB,kBAACqH,GAAD,CAAgBxB,eAAgBA,IAChC,yBAAKpH,UAAU,gBAAf,cACA,yBAAKA,UAAU,sBACb,2CACgBoB,EAAS3T,WACvB,6BAFF,cAGgB2T,EAAS3T,WAAWgD,cAO5C,IAWMoY,GAAe,SAAC1X,GACpB,IAAM3E,EAAoB,GAAf2E,EAAM3E,EAAI,GAAS,EACxBC,EAAoB,GAAf0E,EAAM1E,EAAI,GAAS,EACxBC,EAAoB,GAAfyE,EAAMzE,EAAI,GAAS,EAE9B,OAAO,IAAIH,EAAMC,EAAGC,EAAGC,EAAG,IAQ5B,SAASgc,GAAT,GAGkC,IAFhCC,EAE+B,EAF/BA,aACApH,EAC+B,EAD/BA,cAeMuH,EAtCa,SAAC3X,GACpB,IAAM3E,EAAIuE,KAAKgY,MAAM5X,EAAM3E,EAAI,GAAK,GAAK,EACnCC,EAAIsE,KAAKgY,MAAM5X,EAAM1E,EAAI,GAAK,GAAK,EACnCC,EAAIqE,KAAKgY,MAAM5X,EAAMzE,EAAI,GAAK,GAAK,EAEzC,OAAO,IAAIH,EAAMC,EAAGC,EAAGC,EAAG,GAiCVsc,CAAaL,GAoB7B,OACE,yBAAK3I,UAAU,iBACb,2BAAOA,UAAU,aAAjB,KACA,2BACEA,UAAU,YACV1O,KAAK,SACL8L,IAlEc,KAmEdD,IApEc,IAqEdqJ,MAAOsC,EAAQtc,EACfgU,SAAU,SAAAC,GAAC,OA3BK,SAACwI,GACrBH,EAAQtc,EAAIyc,EACZ,IAAMC,EAAWL,GAAaC,GAC9BvH,EAAc2H,GAwBKC,CAAcjY,SAASuP,EAAEgG,OAAOD,WAEjD,2BAAOxG,UAAU,aAAjB,KACA,2BACEA,UAAU,YACV1O,KAAK,SACL8L,IA3Ec,KA4EdD,IA7Ec,IA8EdqJ,MAAOsC,EAAQrc,EACf+T,SAAU,SAAAC,GAAC,OA9BK,SAAC2I,GACrBN,EAAQrc,EAAI2c,EACZ,IAAMF,EAAWL,GAAaC,GAC9BvH,EAAc2H,GA2BKG,CAAcnY,SAASuP,EAAEgG,OAAOD,WAEjD,2BAAOxG,UAAU,aAAjB,KACA,2BACEA,UAAU,YACV1O,KAAK,SACL8L,IApFc,KAqFdD,IAtFc,IAuFdqJ,MAAOsC,EAAQpc,EACf8T,SAAU,SAAAC,GAAC,OAjCK,SAAC6I,GACrBR,EAAQpc,EAAI4c,EACZ,IAAMJ,EAAWL,GAAaC,GAC9BvH,EAAc2H,GA8BKK,CAAcrY,SAASuP,EAAEgG,OAAOD,YChIxC,SAASgD,GAAT,GAKO,IAJpB9P,EAImB,EAJnBA,QACA+P,EAGmB,EAHnBA,YACAC,EAEmB,EAFnBA,eACAC,EACmB,EADnBA,mBAEMC,EAAyB,SAAChQ,EAAW0K,GACzC1K,EAAEzC,WAAamN,EACfqF,KAYF,OACE,6BACE,yBAAK3J,UAAU,sBAAf,WACA,yBAAKA,UAAU,yBACb,kBAAC6J,GAAD,CAAeJ,YAAaA,IAdT,SAAC/P,GAAD,OACvBA,EAAQN,KAAI,SAACQ,EAAGhL,GAAJ,OACV,kBAACkb,GAAD,CACEzR,OAAQuB,EACRhL,EAAGA,EACH8a,eAAgBA,EAAeK,KAAK,KAAMnb,GAC1Cob,mBAAoBJ,EAAuBG,KAAK,KAAMnQ,QASrDqQ,CAAiBvQ,KAa1B,SAASoQ,GAAT,GAKyB,IAJvBzR,EAIsB,EAJtBA,OACAzJ,EAGsB,EAHtBA,EACA8a,EAEsB,EAFtBA,eACAM,EACsB,EADtBA,mBACsB,EACclJ,mBAAiBzI,EAAOlB,YADtC,mBACfA,EADe,KACH+S,EADG,KAUtB,OACE,yBAAKC,IAAKvb,GACR,0CAAgBA,EAAhB,MADF,MAEMyJ,EAAOnB,SAAStD,EAFtB,KAE2ByE,EAAOnB,SAASvD,EAF3C,SAEoD0E,EAAOjK,WAAWnB,MAFtE,KAGKoL,EAAOjK,WAAWpB,OAHvB,IAG+B,4BAAQiT,QAASyJ,GAAjB,KAC7B,sCACA,2BACEpY,KAAK,SACL6L,IAAK,EACLC,IAAK,GACLoJ,MAAOrP,EACPqJ,SAnByB,SAACC,GAC9B,GAAKA,EAAEgG,OAAOD,MAAd,CACA,IAAM4D,EAASlZ,SAASuP,EAAEgG,OAAOD,OAC7B4D,GAAU,GAAKA,GAAU,KAC3BF,EAAcE,GACdJ,EAAmBI,SA2BzB,SAASP,GAAT,GAA6D,IAApCJ,EAAmC,EAAnCA,YAAmC,EAEtB3I,mBAA2B,CAC7D9T,OAAQ,EACRC,MAAO,IAJiD,mBAEnDmB,EAFmD,KAEvCic,EAFuC,OAO1BvJ,mBAA2B,CAAElN,EAAG,EAAGD,EAAG,IAPZ,mBAOnDuD,EAPmD,KAOzCoT,EAPyC,KA4C1D,OACE,0BAAMjE,SANa,SAAC5F,GACpBA,EAAE6F,iBACFmD,EAAYvS,EAAU9I,KAKpB,yBAAK4R,UAAU,qBAAf,cACA,yBAAKA,UAAU,0BACb,2BAAOuG,QAAQ,gBAAgBvG,UAAU,yBAAzC,YACA,4BACEA,UAAU,gBACViB,GAAG,gBACHzN,KAAK,gBACLgT,MAAOpY,EAAWpB,OAClBwT,SA7CyB,SAC/BC,GAEA4J,EAAc,CACZrd,OAAQkE,SAASuP,EAAEgG,OAAOD,OAC1BvZ,MAAOmB,EAAWnB,UA0Cd,4BAAQuZ,MAAO,GAAf,KACA,4BAAQA,MAAO,IAAf,MACA,4BAAQA,MAAO,IAAf,MACA,4BAAQA,MAAO,IAAf,OAEF,6BACA,2BAAOD,QAAQ,eAAevG,UAAU,yBAAxC,WACA,4BACEA,UAAU,gBACViB,GAAG,eACHzN,KAAK,eACLgT,MAAOpY,EAAWnB,MAClBuT,SAlDwB,SAACC,GAC/B4J,EAAc,CACZpd,MAAOiE,SAASuP,EAAEgG,OAAOD,OACzBxZ,OAAQoB,EAAWpB,WAiDf,4BAAQwZ,MAAO,GAAf,KACA,4BAAQA,MAAO,IAAf,MACA,4BAAQA,MAAO,IAAf,MACA,4BAAQA,MAAO,IAAf,QAIJ,yBAAKxG,UAAU,qBAAf,YACA,yBAAKA,UAAU,0BACb,2BAAOuG,QAAQ,eAAevG,UAAU,yBAAxC,OACA,2BACEA,UAAU,eACViB,GAAG,eACHzN,KAAK,eACLlC,KAAK,SACL6L,IAAK,EACLC,IAAK,GACLoJ,MAAOtP,EAAStD,EAChB4M,SA/DiB,SAACC,GACxB6J,EAAY,CACV1W,EAAG1C,SAASuP,EAAEgG,OAAOD,OACrB7S,EAAGuD,EAASvD,OA8DV,2BAAO4S,QAAQ,eAAevG,UAAU,yBAAxC,OACA,2BACEA,UAAU,eACViB,GAAG,eACHzN,KAAK,eACLlC,KAAK,SACL6L,IAAK,EACLC,IAAK,GACLoJ,MAAOtP,EAASvD,EAChB6M,SAnEiB,SAACC,GACxB6J,EAAY,CACV3W,EAAGzC,SAASuP,EAAEgG,OAAOD,OACrB5S,EAAGsD,EAAStD,QAoEZ,4BAAQoM,UAAU,iBAAlB,e,sCC3LS,SAASuK,GAAT,GAIkC,IAH/CC,EAG8C,EAH9CA,MACAvK,EAE8C,EAF9CA,QACAY,EAC8C,EAD9CA,SAEA,OACE,4BACEb,UAAWwK,EAAQ,YAAc,aACjCvK,QAAS,kBAAMA,GAASuK,KAEvB3J,GCWQ,SAAS4J,GAAT,GAIM,IAHnBrJ,EAGkB,EAHlBA,SACAqH,EAEkB,EAFlBA,iBACAiC,EACkB,EADlBA,aAEA,OACE,6BACE,yBAAK1K,UAAU,oBAAf,SACA,0BAAM2K,MAAM,aACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAKS,OACrC0S,QAAS,kBAAMyK,EAAa5d,EAAKS,UAEjC,kBAAC,KAAD,CAAiBqd,KAAMC,SAG3B,0BAAMF,MAAM,cACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAK4X,OACrCzE,QAAS,kBAAMyK,EAAa5d,EAAK4X,UAEjC,kBAAC,KAAD,CAAiBkG,KAAME,SAG7B,0BAAMH,MAAM,kBACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAK6X,OACrC1E,QAAS,kBAAMyK,EAAa5d,EAAK6X,UAEjC,kBAAC,KAAD,CAAiBiG,KAAMG,SAGzB,0BAAMJ,MAAM,gBACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAK8X,QACrC3E,QAAS,kBAAMyK,EAAa5d,EAAK8X,WAEjC,kBAAC,KAAD,CAAiBgG,KAAMI,SAG3B,0BAAML,MAAM,aACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAKme,KACrChL,QAAS,kBAAMyK,EAAa5d,EAAKme,QAEjC,kBAAC,KAAD,CAAiBL,KAAMM,SAG3B,0BAAMP,MAAM,YACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAK+X,IACrC5E,QAAS,kBAAMyK,EAAa5d,EAAK+X,OAEjC,kBAAC,KAAD,CAAiB+F,KAAMO,SAG3B,0BAAMR,MAAM,gBACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAKgY,QACrC7E,QAAS,kBAAMyK,EAAa5d,EAAKgY,WAEjC,kBAAC,KAAD,CAAiB8F,KAAMQ,SAG3B,0BAAMT,MAAM,aACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS9T,cAAgBR,EAAKue,MACrCpL,QAAS,kBAAMyK,EAAa5d,EAAKue,SAEjC,kBAAC,KAAD,CAAiBT,KAAMU,SAG3B,yBAAKtL,UAAU,gBAAf,QACA,0BAAM2K,MAAM,aACV,kBAACJ,GAAD,CACEC,MAAOpJ,EAAS/T,KAChB4S,QAAS,WACP,IAAIsL,EAAW,gBAAQnK,GACvBmK,EAAYle,MAAQ+T,EAAS/T,KAC7Bob,EAAiB8C,KAGnB,kBAAC,KAAD,CAAiBX,KAAMY,SAG3B,0BAAMb,MAAM,UACV,kBAACJ,GAAD,CAAQC,OAAO,EAAOvK,QAAS,kBAAM,OACnC,kBAAC,KAAD,CAAiB2K,KAAMa,SAG3B,0BAAMd,MAAM,iBACV,kBAACJ,GAAD,CAAQC,OAAO,EAAOvK,QAAS,kBAAM,OACnC,kBAAC,KAAD,CAAiB2K,KAAMc,SAG3B,0BAAMf,MAAM,cACV,kBAACJ,GAAD,CAAQC,OAAO,EAAOvK,QAAS,kBAAM,OACnC,kBAAC,KAAD,CAAiB2K,KAAMe,UC5FjC,SAASC,GAAapB,EAAe/J,GAEnC,OAAkB,KADAA,EAAEoL,OAAS,GAAK,EAAI,GAErB,IAARrB,EAEAA,EAAQ,IA6mBJsB,OAzmBf,WAA6B,IAAD,EACAhL,qBADA,mBACnBlT,EADmB,KACZme,EADY,OAEIjL,mBAAkBlE,IAFtB,mBAEnB9O,EAFmB,KAEVke,EAFU,OAG0BlL,mBAAiB,GAH3C,mBAGnB8G,EAHmB,KAGCqE,EAHD,OAIkBnL,mBAAyB,CACnEzT,MAAM,EACNC,YAAaR,EAAKS,OAClBC,UAAW,EACXC,WAAYnB,EAAWoB,SARC,mBAInBwe,EAJmB,KAIHC,EAJG,OAWFC,IAAMtL,WAArBuL,EAXiB,oBAYpBC,EAAc9J,uBAAY,kBAAM6J,EAAY,MAAK,IAZ7B,EAkBQvL,mBAAwB,IAlBhC,mBAkBnByL,EAlBmB,KAkBRC,EAlBQ,OAmBY1L,oBAAkB,GAnB9B,mBAmBnB2L,EAnBmB,KAmBNC,EAnBM,OAwBtB9G,KAFS+G,EAtBa,EAsBxB9G,UACQ+G,EAvBgB,EAuBxB7G,OAvBwB,EA4BtBH,KAFSiH,EA1Ba,EA0BxBhH,UACQiH,EA3BgB,EA2BxB/G,OA3BwB,EA8BKgH,qBAAWnB,GAAc,GA9B9B,oBA8BnBvK,GA9BmB,MA8BZ2L,GA9BY,MA+BpBC,GAAwBzK,uBAAY,SAAC/B,GAAD,OAAOuM,GAAcvM,KAAI,IAE7DyM,GAAwB,SAC5B5b,EACArC,EACAke,GAGA,GADAA,EAAM7G,iBACDrX,GAAYA,EAAQme,MACzB,OAAQ9b,GACN,IAAK,QACH+b,GAAgBpe,EAAQme,MAAM,IAC9B,MACF,IAAK,UACHE,GAAkBre,EAAQme,MAAM,MAKhCC,GAAe,uCAAG,WAAOpa,GAAP,eAAAtG,EAAA,0DAClBsG,EADkB,uBAEpBjF,QAAQuG,IAAI,8BAFQ,SAGFvB,EAAaC,GAHX,OAGhBrF,EAHgB,OAIpB2f,KACAC,GAAkB5f,GALE,2CAAH,sDASf4f,GAAoB,SAACC,GACzB,IAAI5Y,EAEFA,EADE4Y,aAAoB/U,GACdoB,KAAK0B,UAAUiS,EAASC,sBAExB5T,KAAK0B,UAAUiS,EAASvf,gBAElCyU,OAAOgL,aAAaC,QAAQzgB,EAAmB0H,GAC/CgZ,GAAchZ,GACdkX,EAAS0B,IAsBLI,GAAgB,SAACC,GACrB,IAAIC,EAAWxB,EAAUhe,MAAM,EAAGke,EAAc,GAChDsB,EAAS5V,KAAK2V,GACdtB,EAAauB,GACbrB,EAAeqB,EAASlf,OAAS,IAG7Bmf,GAAaxL,uBAAY,WAE7B,GADAxU,QAAQuG,IAAI,kBACR3G,GAAS6e,GAAe,EAAG,CAI7B,IAAMwB,EAAiB1B,EAAUE,EAAc,GACzCyB,EAAWpU,KAAKC,MAAMkU,GAC5BtL,OAAOgL,aAAaC,QAAQzgB,EAAmB8gB,GAC/CrgB,EAAMugB,gBAAgBD,GACtBxB,EAAeD,EAAc,GAC7BV,EAASne,MAEV,CAAC2e,EAAWE,EAAa7e,IAEtBwgB,GAAa5L,uBAAY,WAC7BxU,QAAQuG,IAAI,kBACR3G,GAAS6e,EAAc,EAAIF,EAAU1d,SACvCjB,EAAMugB,gBAAgBrU,KAAKC,MAAMwS,EAAUE,EAAc,KACzDC,EAAeD,EAAc,MAE9B,CAAC7e,EAAO6e,EAAaF,IAElBgB,GAAY,WAChBf,EAAa,IACbE,GAAgB,IAGZ2B,GAAsB,SAACxX,GAC3B8L,OAAOgL,aAAaC,QAAQzgB,EAAiB2M,KAAK0B,UAAU3E,IAC5DmV,EAAWnV,IAGPyX,GAAuB,SAAC/C,GAC5B5I,OAAOgL,aAAaC,QAClBzgB,EACAoe,EAAY/d,UAAUiD,YAExBkS,OAAOgL,aAAaC,QAClBzgB,EACAoe,EAAY9d,WAAWgD,YAEzB0b,EAAkBZ,IAKd+B,GAAiB,uCAAG,WAAOiB,GAAP,eAAA5hB,EAAA,0DACpB4hB,EADoB,uBAEtBvgB,QAAQuG,IAAI,gCAFU,SAGCV,EAAe0a,GAHhB,QAGlB1X,EAHkB,WAKhBjJ,aAAiB4I,GAAW5I,aAAiB8K,KAC/C9K,EAAM4gB,cAAc3X,GAEtBwX,GAAoBxX,IARA,2CAAH,sDAsBjB4X,GAAmBjM,uBACvB,SAACkM,GACCJ,GAAqB,CACnBjhB,KAAM6e,EAAe7e,KACrBC,YAAaohB,EACblhB,UAAW0e,EAAe1e,UAC1BC,WAAYye,EAAeze,eAG/B,CAACye,IAYGyC,GAAiB,SACrBlhB,EACAD,EACAW,EACAC,GAEA,GAAIR,IACW+U,OAAOiM,QAClB,gFAEW,OAEf,OAAQnhB,GACN,KAAKnB,EAAWoB,OAEd,OAAQF,GACN,KAAK,EAMH,OALA0e,EAAeze,WAAanB,EAAWoB,OACvCwe,EAAe1e,UAAY,EAC3B8gB,GAAqBpC,GACrBsB,GAAkB,IAAIja,EAAQpF,EAAUC,SACxCigB,GAAoBvgB,GAEtB,KAAK,EAMH,OALAoe,EAAeze,WAAanB,EAAWoB,OACvCwe,EAAe1e,UAAY,EAC3B8gB,GAAqBpC,GACrBsB,GAAkB,IAAIhX,EAAQrI,EAAUL,EAASM,SACjDigB,GAAoBvgB,GAEtB,QAEE,YADAyM,MAAM,2BAGZ,KAAKjO,EAAWuiB,YAYd,OAXA3C,EAAeze,WAAanB,EAAWuiB,YACvC3C,EAAe1e,UAAY,EAC3B8gB,GAAqBpC,GACrBsB,GACE,IAAI9U,GACF,WACA5K,EACAiJ,EAAkB6Q,UAGtByG,GAAoBvgB,GAEtB,KAAKxB,EAAWwiB,WAChB,QAEE,YADAvU,MAAM,+BA4BNwU,GAAoB,SAACjL,GACzB,IAAMjN,EAAa/I,EAAQS,QAC3BsI,EAAW+Q,GAAsB9D,GAC7BlW,aAAiB4I,GAAW5I,aAAiB8K,KAC/C9K,EAAM4gB,cAAc3X,GAEtBwX,GAAoBxX,IAGhBmY,GAAiB,uCAAG,WAAO1d,GAAP,yBAAA3E,EAAA,sDAEpBsiB,EAAW,GAIb9gB,EADEP,EACSA,EAAMO,SAASI,MAAM,EAAGX,EAAMO,SAASK,YAAY,MAEnD,UAGP0gB,EAAkB,kBACtB3U,MAAM,gEAZgB,KAchBjJ,EAdgB,OAejB,QAfiB,OA6BjB,QA7BiB,QAuCjB,QAvCiB,QAgDjB,QAhDiB,2BAgBf1D,EAhBe,uBAiBlB2M,MAAM,gDAjBY,iCAqBpB0U,EAAW,KACPE,EAAQ,IAAI3d,KAAK,CAAC5D,EAAMwhB,cAC5BC,iBAAOF,EAAOhhB,EAAW8gB,GAEzBA,EAAW,KACPK,EAAQ,IAAI9d,KAAK,CAAC5D,EAAM2hB,aAC5BF,iBAAOC,EAAOnhB,EAAW8gB,GA3BL,8BA+BfnhB,EA/Be,wBAgClByM,MAAM,wCAhCY,kCAmClB0U,EAAW,OACXja,EAAO,IAAIxD,KAAK,EvBjCIge,EuBiCW1hB,EvBxFlC,SAAsBA,GAC3B,IAAIygB,EAAU,GACVkB,EAAQ,EAkBZ,OAhBA3hB,EAAQ+C,SAAQ,SAAA5B,GACd,IAAIygB,EAAM,OACVA,GACEzgB,EAAQzC,EAAI,GAAK,IAAMyC,EAAQzC,EAAEiE,SAAS,IAAMxB,EAAQzC,EAAEiE,SAAS,IACrEif,GACEzgB,EAAQxC,EAAI,GAAK,IAAMwC,EAAQxC,EAAEgE,SAAS,IAAMxB,EAAQxC,EAAEgE,SAAS,IACrEif,GACEzgB,EAAQvC,EAAI,GAAK,IAAMuC,EAAQvC,EAAE+D,SAAS,IAAMxB,EAAQvC,EAAE+D,SAAS,IACrE8d,GAAWmB,EAAM,KATD,IAUZD,GACFlB,GAAW,KACXkB,EAAQ,GAERA,OAGGlB,EAoCAoB,CAAaH,MuBJM,gCAwCf5hB,EAxCe,wBAyClB2M,MAAM,gDAzCY,kCA6CpB0U,EAAW,OA7CS,UA8CP7d,EAAYxD,EAAO0D,GA9CZ,eA8CpB0D,EA9CoB,uCAiDfpH,EAjDe,wBAkDlB2M,MAAM,gDAlDY,kCAsDpB0U,EAAW,OAtDS,UAuDP7d,EAAYxD,EAAO0D,GAvDZ,eAuDpB0D,EAvDoB,uCA0DfpH,EA1De,wBA2DlB2M,MAAM,gDA3DY,kCA+DpB0U,EAAW,OA/DS,UAgEP7d,EAAYxD,EAAO0D,GAhEZ,QAgEpB0D,EAhEoB,eAkEnBA,EAGHqa,iBAAOra,EAAM7G,EAAW8gB,GAFxBC,IAnEsB,kCvBGrB,IAAuBM,IuBHF,OAAH,sDAkLvB,OAtGAjK,qBAAU,WACR,IAAMqK,EAAiB,SAACnP,GACJ,KAAdA,EAAEoP,SAAkBpP,EAAEqP,UACD,KAAdrP,EAAEoP,SAAkBpP,EAAEqP,SAAWrP,EAAEsP,SAC5C3B,KACuB,KAAd3N,EAAEoP,SAAkBpP,EAAEqP,SAC/B9B,OAIJ,OADApc,SAASgR,iBAAiB,UAAWgN,GAC9B,kBAAMhe,SAAS4T,oBAAoB,UAAWoK,MACpD,CAAC5B,GAAYI,KAKhB7I,qBAAU,WACR,IAAMyK,EAAqB,kBACzBzV,MAAM,+DAMF0V,EAAkBtN,OAAOgL,aAAauC,QAAQ/iB,GAC9CgjB,EAAkBxN,OAAOgL,aAAauC,QAAQ/iB,GAC9CijB,EAAgBzN,OAAOgL,aAAauC,QAAQ/iB,GAC5CkjB,EAAc1N,OAAOgL,aAAauC,QAAQ/iB,GAEhD,GAAI8iB,GAAmBE,GAAmBE,EAAa,CAGrD,IAZA1N,OAAOiM,QACL,kIAaA,YADAjM,OAAOgL,aAAa2C,QAItB,IAAMC,EAAwBrf,SAAS+e,GACjCO,EAA8BL,EAE9BM,EAAe,SAACC,GAOpB,OAFoB5W,KAAKC,MAAM2W,GACAtX,KAAI,SAACkB,GAAD,OAAO,IAAI/N,EAAM+N,EAAE9N,EAAG8N,EAAE7N,EAAG6N,EAAE5N,EAAG4N,EAAE3N,OAIvE,OAAQ4jB,GACN,KAAK,EACH,IAAKH,EAEH,YADAJ,IAGA,IAAMnZ,EAAa4Z,EAAaL,GAChCpiB,QAAQuG,IAAIsC,GACZ,IAAM8Z,EAAc7W,KAAKC,MAAMsW,GAC/BrE,EAAWnV,GACXkV,EACErT,GAAamB,cACX8W,EACA9Z,EACA,IAGJ,IAAI+Z,EAAoBxjB,EACxBwjB,EAAkBpjB,UAAY+iB,EAC9BK,EAAkBnjB,WAAa+iB,EAC/BrE,EAAkByE,GAEpB,MACF,KAAK,EACH,IAAMD,EAAc7W,KAAKC,MAAMsW,GAC/BtE,EAASxY,EAAQsG,cAAc8W,IAC/B,IAAIC,EAAoBxjB,EACxBwjB,EAAkBpjB,UAAY+iB,EAC9BK,EAAkBnjB,WAAa+iB,EAC/BrE,EAAkByE,GAClB,MACF,KAAK,EACH,IAAKR,EAEH,YADAJ,IAGA,IAAMW,EAAc7W,KAAKC,MAAMsW,GACzBxZ,EAAa4Z,EAAaL,GAChCrE,EAASvV,EAAQqD,cAAc8W,EAAa9Z,IAC5CmV,EAAWnV,GACX,IAAI+Z,EAAoBxjB,EACxBwjB,EAAkBpjB,UAAY+iB,EAC9BK,EAAkBnjB,WAAa+iB,EAC/BrE,EAAkByE,GAEpB,MACF,QACEZ,QAGL,IAGD,yBAAKhQ,UAAU,iBACb,yBAAKA,UAAU,UACb,0BAAMA,UAAU,SAAhB,QACA,kBAACW,GAAD,CAAUC,MAAM,OACd,yBAAKZ,UAAU,qBAAf,UACA,4BAAQC,QAAS2M,GAAjB,UACA,kBAAC,GAAD,CACE/G,UAAW8G,EACXhG,KAAMiG,EACN3G,SAAU0I,GAAe5E,KAAK,KAAMzd,EAAWoB,OAAQ,KAEzD,4BAAQuS,QAAS6M,GAAjB,UACA,kBAAC,GAAD,CACEjH,UAAWgH,EACXlG,KAAMmG,EACN7G,SAAU0I,GAAe5E,KAAK,KAAMzd,EAAWoB,OAAQ,KAEzD,yBAAKsS,UAAU,eACf,yBAAKA,UAAU,qBAAf,eACA,4BACEC,QAAS,kBACP0O,GAAeriB,EAAWuiB,YAAa,EAAG,WAAY,CACpD7hB,OAAQ,IACRC,MAAO,QAJb,SAUA,yBAAK+S,UAAU,eACf,yBAAKA,UAAU,qBAAf,cACA,4BACEC,QAAS,kBAAM1F,MAAM,iDADvB,WAMF,kBAACoG,GAAD,CAAUC,MAAM,QACd,4BAAQX,QAAS,kBAAM+N,OAAvB,QACA,4BAAQ/N,QAAS,kBAAMmO,OAAvB,QACA,yBAAKpO,UAAU,eACf,4BAAQC,QAAS,kBAAM,OAAvB,cAEF,kBAACU,GAAD,CAAUC,MAAM,UACd,yBAAKZ,UAAU,qBAAf,SACA,kBAAC,GAAD,CACEG,kBAAmB+M,GAAsBnD,KAAK,KAAM,SACpDhK,YAAY,gCAEd,yBAAKC,UAAU,eACf,kBAAC,GAAD,CACEG,kBAAmB+M,GAAsBnD,KAAK,KAAM,WACpDhK,YAAY,2BAGhB,kBAACY,GAAD,CAAUC,MAAM,UACd,yBAAKZ,UAAU,qBAAf,SACA,kBAAC,GAAD,CACEF,iBAAkBkP,GAAkBjF,KAAK,KAAM,OAC/ChK,YAAY,sBAEd,kBAAC,GAAD,CACED,iBAAkBkP,GAAkBjF,KAAK,KAAM,OAC/ChK,YAAY,mBAEd,yBAAKC,UAAU,eACf,yBAAKA,UAAU,qBAAf,OACA,kBAAC,GAAD,CACEF,iBAAkBkP,GAAkBjF,KAAK,KAAM,OAC/ChK,YAAY,2BAEd,yBAAKC,UAAU,eACf,kBAAC,GAAD,CACEF,iBAAkBkP,GAAkBjF,KAAK,KAAM,OAC/ChK,YAAY,2BAGhB,kBAACY,GAAD,CAAUC,MAAM,QACd,8BACE,4BAAQtP,KAAK,SAASuf,WAAW,GAAGC,WAAW,IAA/C,kBAIF,8BACE,4BACExf,KAAK,SACLuf,WAAW,qCACXC,WAAW,UAHb,qBAQF,yBAAK9Q,UAAU,eACf,8BACE,4BAAQ1O,KAAK,SAASuf,WAAW,GAAGC,WAAW,IAA/C,eAIF,yBAAK9Q,UAAU,eACf,8BACE,4BACE1O,KAAK,SACLuf,WAAW,mCACXC,WAAW,UAHb,mBAQF,4BAAQ7Q,QAlagB,kBAAM0C,OAAOgL,aAAa2C,UAkalD,yBAGJ,yBAAKtQ,UAAU,uBACb,yBAAKA,UAAU,cACb,yBAAKA,UAAU,mBACb,kBAACyK,GAAD,CACErJ,SAAU8K,EACVzD,iBAAkB6F,GAClB5D,aAAc+D,MAGjB7gB,EAAQ,wCAAcyT,GAAM0P,QAAQ,GAA5B,MAA0C,MAErD,yBAAK/Q,UAAU,mBACZpS,EACC,kBAACsT,GAAD,CACEtT,MAAOA,EACPwT,SAAU8K,EACVpe,QAASA,EACTqT,qBAAsByG,EACtBvG,MAAOA,GACPC,cAAekM,GACfjM,cAAewN,GACfvN,aAAcyL,KAGd,yBAAKjN,UAAU,iBACb,gEAIR,yBAAKA,UAAU,eACb,kBAACwI,GAAD,CACE1a,QAASA,EACT0gB,cAAeH,GACfzG,mBAAoBA,EACpBC,2BApVwB,SAACmJ,GACjC/E,EAAsB+E,IAClBpjB,aAAiB4I,GAAW5I,aAAiB8K,KAC/C9K,EAAMqjB,gBAAgBD,IAkVhBzP,cAAewN,GACf3H,eAtWa,SAAC8J,GAEtB,GADAA,EAAgBngB,KAAKC,MAAMkgB,GACrBtjB,aAAiB2F,GAMrB,GAHSoP,OAAOiM,QACd,2EAEM,CAAC,IAAD,EACoB9R,GAASlP,EAAOsjB,GAApCpjB,EADA,EACAA,QAASuK,EADT,EACSA,OACfmV,GAAkBnV,GAClBgW,GAAoBvgB,SARtByM,MAAM,+DAoWA6G,SAAU8K,EACVzD,iBAAkB6F,KAEnBpC,EAAeze,aAAenB,EAAWuiB,YACxC,kBAACrF,GAAD,CACEC,YAthBY,SACtBvS,EACA9I,GAEG,wDAAC,IACA+iB,EAAcvjB,EAClBujB,EAAYC,UAAUla,EAAU9I,GAChCof,GAAkB2D,GAClB7E,IACAte,QAAQuG,IAAI,kBA8gBFmV,eAAgB,SAAC9a,GAAD,OA3gBD,SAAChB,EAAmCgB,GACzDhB,GAASA,aAAiB8K,IAC3B9K,EAAuByjB,aAAaziB,GAEvC0d,IAugBiCgF,CAAmB1jB,EAAOgB,IACjD+a,mBAAoB2C,EACpB5S,QAAU9L,EAAuB8L,UAEjC,SChoBR6X,I,MAAcC,QACW,cAA7B7O,OAAO8O,SAASC,UAEe,UAA7B/O,OAAO8O,SAASC,UAEhB/O,OAAO8O,SAASC,SAASC,MACvB,4DA8CN,SAASC,GAAgBC,EAAeC,GACtCC,UAAUC,cACPC,SAASJ,GACTK,MAAK,SAAAC,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiB7H,QACfuH,UAAUC,cAAcQ,YAI1BxkB,QAAQuG,IACN,iHAKEud,GAAUA,EAAOW,UACnBX,EAAOW,SAASN,KAMlBnkB,QAAQuG,IAAI,sCAGRud,GAAUA,EAAOY,WACnBZ,EAAOY,UAAUP,WAO5BQ,OAAM,SAAA1kB,GACLD,QAAQC,MAAM,4CAA6CA,MClGjE2Y,IAASgM,OAAO,kBAAC,GAAD,MAAShhB,SAASihB,eAAe,SDqB1C,SAAkBf,GACvB,GAA6C,kBAAmBC,UAAW,CAMzE,GAJkB,IAAIjf,IACnBggB,QACDnQ,OAAO8O,SAASsB,MAEJC,SAAWrQ,OAAO8O,SAASuB,OAIvC,OAGFrQ,OAAOC,iBAAiB,QAAQ,WAC9B,IAAMiP,EAAK,UAAMiB,QAAN,sBAEPvB,KAgEV,SAAiCM,EAAeC,GAE9CmB,MAAMpB,GACHK,MAAK,SAAAgB,GAEJ,IAAMC,EAAcD,EAASE,QAAQC,IAAI,gBAEnB,MAApBH,EAASI,QACO,MAAfH,IAA8D,IAAvCA,EAAYI,QAAQ,cAG5CxB,UAAUC,cAAcwB,MAAMtB,MAAK,SAAAC,GACjCA,EAAasB,aAAavB,MAAK,WAC7BvP,OAAO8O,SAASiC,eAKpB9B,GAAgBC,EAAOC,MAG1Ba,OAAM,WACL3kB,QAAQuG,IACN,oEArFAof,CAAwB9B,EAAOC,GAI/BC,UAAUC,cAAcwB,MAAMtB,MAAK,WACjClkB,QAAQuG,IACN,iHAMJqd,GAAgBC,EAAOC,OC/C/BE,K","file":"static/js/main.d7d6de77.chunk.js","sourcesContent":["import { Tool } from \"./consts\";\nimport Color from \"../models/Color\";\n\nexport interface Color32 {\n  r: number;\n  g: number;\n  b: number;\n}\n\nexport interface Dimensions {\n  height: number;\n  width: number;\n}\n\nexport type SpriteDimensions =\n  // Square sizes\n  | { height: 8; width: 8 }\n  | { height: 16; width: 16 }\n  | { height: 32; width: 32 }\n  | { height: 64; width: 64 }\n  // Not square sizes\n  | { height: 16; width: 8 }\n  | { height: 32; width: 8 }\n  | { height: 32; width: 16 }\n  | { height: 64; width: 32 }\n  // Same as above but rotated 90 degrees\n  | { height: 8; width: 16 }\n  | { height: 8; width: 32 }\n  | { height: 16; width: 32 }\n  | { height: 32; width: 64 };\n\nexport type Mode = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\n\nexport enum EditorMode {\n  Bitmap = \"Bitmap\",\n  Spritesheet = \"Spritesheet\",\n  Background = \"Background\",\n}\n\nexport interface Drawable {\n  dimensions: Dimensions;\n  imageCanvasElement: HTMLCanvasElement;\n  pixelGridCanvasElement: HTMLCanvasElement;\n  getPixelColorAt: (pos: ImageCoordinates) => Color;\n}\n\n/**\n * Eventually, these methods should be entirely encapsulated within the classes\n * themselves, not separated as part of a utilities file. Make classes do the\n * work, not functions with access to the classes' private information.\n * Perhaps an abstract class with default implementations will work well here.\n */\nexport interface Exportable {\n  fileName: string;\n  imageDataStore: ImageDataStore;\n  headerData: string;\n  cSourceData: string;\n  getImageFileBlob: () => Promise<Blob | null>;\n  getPixelColorAt: (pos: ImageCoordinates) => Color;\n}\n\nexport interface Modifiable {\n  setPixelColor: (pos: ImageCoordinates, color: Color) => void;\n}\n\nexport interface Undoable {\n  updateFromStore: (store: ImageDataStore) => void;\n}\n\nexport interface ImageInterface\n  extends Drawable,\n  Exportable,\n  Modifiable,\n  Undoable { }\n\nexport interface EditorSettings {\n  grid: boolean;\n  currentTool: Tool;\n  imageMode: Mode;\n  editorMode: EditorMode;\n}\n\nexport interface ImageCoordinates {\n  x: number;\n  y: number;\n}\n\nexport interface ImageDataStore {\n  fileName: string;\n  dimensions: Dimensions;\n  imageData: Uint8ClampedArray | number[];\n}\n\nexport interface SpritesheetDataStore {\n  fileName: string;\n  dimensions: Dimensions;\n  sprites: string[];\n  bpp: number;\n}\n\nexport interface SpriteDataStore {\n  position: ImageCoordinates;\n  dimensions: SpriteDimensions;\n  paletteRow: number;\n  data: Uint8ClampedArray;\n}\n","interface IColor {\n  r: number; g: number; b: number; a: number;\n}\n\nexport default class Color implements IColor {\n  public r: number;\n  public g: number;\n  public b: number;\n  public a: number;\n\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a ? a : 1;\n  }\n\n  public toHexString(): string {\n    return \"\";\n  }\n\n  public toString() {\n    return `rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`;\n  }\n\n  public isEqual(other: IColor): boolean {\n    if (other === this) {\n      return true;\n    }\n    return (\n      this.r === other.r &&\n      this.g === other.g &&\n      this.b === other.b &&\n      this.a === other.a\n    );\n  }\n}","import Color from \"../models/Color\";\nimport { Dimensions, EditorMode, EditorSettings } from \"./types\";\n\nexport const COLORS = {\n  black: new Color(0, 0, 0, 1),\n  red: new Color(255, 0, 0, 1),\n  blue: new Color(0, 255, 0, 1),\n  green: new Color(0, 0, 255, 1)\n};\n\nexport const PALETTE_SIZE: Dimensions = { height: 16, width: 16 };\nexport const PALETTE_LENGTH = PALETTE_SIZE.height * PALETTE_SIZE.width;\n\nexport enum Tool {\n  PENCIL,\n  BUCKET,\n  SQUARE,\n  ELLIPSE,\n  ZOOM,\n  PAN,\n  DROPPER,\n  LAYER\n}\n\nexport const STORAGE = {\n  image: \"image\",\n  imageData: \"imageData\",\n  palette: \"palette\",\n  imageMode: \"imageMode\",\n  imageType: \"imageType\"\n};\n\nexport const DEFAULT_SETTINGS: EditorSettings = {\n  grid: true,\n  currentTool: Tool.PENCIL,\n  imageMode: 3,\n  editorMode: EditorMode.Bitmap\n};\n","import Color from \"../models/Color\";\nimport Palette from \"../models/Palette\";\nimport { PALETTE_LENGTH } from \"./consts\";\nimport { Dimensions, ImageInterface, Mode } from \"./types\";\n\n/*\n  getGBAImageString\n\n  take in ImageObject and Palette\n  get the image array from image2GBA\n  get the palette array from pal2GBA\n  returns the combination of them into one string\n*/\nexport function generateCSourceFileString(\n  image: ImageInterface,\n  mode: Mode,\n  palette?: Palette\n): string {\n  switch (mode) {\n    case 3:\n      return generateMode3CSourceFileString(image);\n    case 4:\n      return generateMode4CSourceFileString(image, palette);\n    default:\n      return generateMode3CSourceFileString(image);\n  }\n}\n\nfunction generateMode3CSourceFileString(image: ImageInterface): string {\n  const { fileName, dimensions, imageData } = image.imageDataStore;\n\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = dimensions.height * dimensions.width;\n  const imageDefinitionString = `const unsigned short ${variableName}Bitmap[${bitmapLength /\n    2}]__attribute__((aligned(4)))=\\n{\\n\\t`;\n\n  let imageDataHexString = ``;\n\n  let pixelCount = 0;\n  for (var i = 0, j = imageData.length; i < j; i += 4) {\n    let bgr = [imageData[i + 2], imageData[i + 1], imageData[i]]; // bgr for little endian\n    let hexcode = pixelToHex(bgr);\n    imageDataHexString += hexcode + \",\";\n    pixelCount++;\n    if (pixelCount % 8 === 0) {\n      imageDataHexString += \"\\n\";\n      if (pixelCount % 64 === 0) {\n        imageDataHexString += \"\\n\\t\";\n      } else {\n        imageDataHexString += \"\\t\";\n      }\n    }\n  }\n\n  const imageDefinitionEnd = `\\n};\\n`;\n\n  return imageDefinitionString + imageDataHexString + imageDefinitionEnd;\n}\n\nfunction generateMode4CSourceFileString(\n  image: ImageInterface,\n  palette?: Palette\n): string {\n  if (!palette) {\n    console.error(\n      \"Tried to generate mode 4 header string with no palette! Falling back to mode 3...\"\n    );\n    return generateMode3CSourceFileString(image);\n  }\n\n  const { fileName, dimensions, imageData } = image.imageDataStore;\n\n  // Note: we compress the length of the bitmap by 2 because we can fit 2 chars\n  // into a short\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = dimensions.height * dimensions.width;\n  const imageDefinitionString = `const unsigned short ${variableName}Bitmap[${bitmapLength /\n    2}]__attribute__((aligned(4)))=\\n{\\n`;\n\n  let imageDataHexString = \"\";\n  for (let i = 0; i < imageData.length; i += 2) {\n    imageDataHexString += paletteIndicesToHex(imageData[i], imageData[i + 1]);\n    if ((i / 2 + 1) % 8 === 0) imageDataHexString += `\\n`;\n  }\n  const imageDefinitionEnd = `};\\n\\n`;\n\n  // Palette length is uncompressed\n  const paletteCSourceString = PaletteToGBA(palette);\n\n  const CSourceString =\n    imageDefinitionString +\n    imageDataHexString +\n    imageDefinitionEnd +\n    paletteCSourceString;\n\n  return CSourceString;\n}\n\ninterface headerFileParams {\n  fileName: string;\n  imageDimensions: Dimensions;\n  palette?: Palette;\n}\n\nexport function generateHeaderString(\n  params: headerFileParams,\n  mode: 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7\n): string {\n  switch (mode) {\n    case 3:\n      return generateMode3HeaderString(params);\n    case 4:\n      return generateMode4HeaderString(params);\n    default:\n      console.warn(\n        `Attempting to generate header file for mode ${mode}, but it's unsupported for now. Defaulting to mode 3.`\n      );\n      return generateMode3HeaderString(params);\n  }\n}\n\nexport function generateMode3HeaderString({\n  fileName,\n  imageDimensions,\n  palette\n}: headerFileParams): string {\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = imageDimensions.height * imageDimensions.width;\n  const bitmapSize = bitmapLength * 2;\n  // TODO: Find out how to compute the size vs. the length of the bitmap\n  const bitmapSizeDefinition = `#define ${variableName.toUpperCase()}_SIZE ${bitmapSize}\\n`;\n  const bitmapLengthDefinition = `#define ${variableName.toUpperCase()}_LENGTH ${bitmapLength}\\n`;\n  const imageHeightDefinition = `#define ${variableName.toUpperCase()}_HEIGHT ${\n    imageDimensions.height\n    }\\n`;\n  const imageWidthDefinition = `#define ${variableName.toUpperCase()}_WIDTH ${\n    imageDimensions.width\n    }\\n`;\n  const imageDefinitionString = `extern const unsigned short ${variableName}Bitmap[${bitmapLength}];\\n\\n`;\n\n  const headerString =\n    bitmapLengthDefinition +\n    bitmapSizeDefinition +\n    imageHeightDefinition +\n    imageWidthDefinition +\n    `\\n` +\n    imageDefinitionString +\n    `\\n`;\n\n  return headerString;\n}\n\nexport function generateMode4HeaderString({\n  fileName,\n  imageDimensions,\n  palette\n}: headerFileParams): string {\n  if (!palette) {\n    console.error(\n      \"Tried to generate mode 4 header string with no palette! Falling back to mode 3...\"\n    );\n    return generateMode3HeaderString({\n      fileName: fileName,\n      imageDimensions: imageDimensions\n    });\n  }\n\n  // Note: we compress the length of the bitmap by 2 because we can fit 2 chars\n  // into a short\n  const variableName = fileName.slice(0, fileName.lastIndexOf(\".\"));\n  const bitmapLength = imageDimensions.height * imageDimensions.width;\n  const bitmapLengthDefinition = `#define ${variableName.toUpperCase()}_SIZE ${bitmapLength}\\n`;\n  const imageHeightDefinition = `#define ${variableName.toUpperCase()}_HEIGHT ${\n    imageDimensions.height\n    }\\n`;\n  const imageWidthDefinition = `#define ${variableName.toUpperCase()}_WIDTH ${\n    imageDimensions.width\n    }\\n`;\n  const imageDefinitionString = `extern const unsigned short ${variableName}Bitmap[${bitmapLength /\n    2}];\\n\\n`;\n\n  // Palette length is uncompressed\n  const paletteLengthDefinition = `#define ${variableName.toUpperCase()}_PAL_SIZE ${PALETTE_LENGTH *\n    2}\\n`;\n  const paletteDefinitionString = `extern const unsigned short ${variableName}Palette[${PALETTE_LENGTH}];\\n\\n`;\n\n  const headerString =\n    bitmapLengthDefinition +\n    imageHeightDefinition +\n    imageWidthDefinition +\n    imageDefinitionString +\n    paletteLengthDefinition +\n    paletteDefinitionString;\n\n  return headerString;\n}\n\nexport const PALETTE_HEADER = (varName: string, palLength = PALETTE_LENGTH) =>\n  `#define ${varName}PalLen ${palLength * 2}\\n`\n  + `extern const unsigned short ${varName}Palette[${palLength}];\\n\\n`;\n\nexport const SS_TILES_HEADER = (varName: string, ssDimensions = { height: 256, width: 256 }) => {\n  const len = ssDimensions.height * ssDimensions.width;\n  return `#define ${varName}TilesLen ${len / 2}\\n`\n    + `extern const unsigned short ${varName}Tiles[${len / 4}];\\n\\n`;\n}\n\nfunction paletteIndicesToHex(index1: number, index2: number): string {\n  if (index1 > 255 || index2 > 255) {\n    console.error(\n      `Tried to convert palette indices ${index1} and ${index2}, but at least one is out of range! Truncating bitwise...`\n    );\n  }\n\n  index1 = index1 & 0xff; // Truncate in case the indices are too big\n  index2 = index2 & 0xff;\n\n  const combinedIndexString = (index2 | (index1 << 8))\n    .toString(16)\n    .toUpperCase()\n    .padStart(4, \"0\");\n\n  return `0x${combinedIndexString}, `;\n}\n\n/*\n  pixel2hex\n\n  takes in a number array [b: number, g: number, r: number]\n  convert each pixel to GBA compatible bgr hex format\n  return hex value of pixel\n*/\nfunction pixelToHex(bgr: number[]): string {\n  // convert to 16-bit binary format: 0bbbbbgggggrrrrr\n  let binary_value = \"0\";\n  bgr.forEach(element => {\n    element = Math.floor((element * 32) / 256);\n    let elementString = element.toString(2); // convert to binary\n    while (elementString.length < 5) {\n      elementString = \"0\" + elementString;\n    }\n    binary_value += elementString;\n  });\n  // convert to hex\n  let hex_value = parseInt(binary_value, 2).toString(16);\n  while (hex_value.length < 4) {\n    hex_value = \"0\" + hex_value;\n  }\n  hex_value = hex_value.toUpperCase();\n  return \"0x\" + hex_value;\n}\n\nfunction colorToHex(color: Color): string {\n  let bgr = [color.b, color.g, color.r];\n  return pixelToHex(bgr);\n}\n\n/*\n  pal2Hex\n  \n  takes in a Palette and converts rgb into hex values 0x00rrggbb\n  outputs string of the converted Palette colorArray\n*/\nexport function paletteToHex(palette: Palette): string {\n  let palFile = \"\";\n  let count = 1;\n  const alignment = 4; //this number can change depending on how we want to format\n  palette.forEach(element => {\n    let hex = \"0x00\";\n    hex +=\n      element.r < 16 ? \"0\" + element.r.toString(16) : element.r.toString(16);\n    hex +=\n      element.g < 16 ? \"0\" + element.g.toString(16) : element.g.toString(16);\n    hex +=\n      element.b < 16 ? \"0\" + element.b.toString(16) : element.b.toString(16);\n    palFile += hex + \"\\t\";\n    if (count === alignment) {\n      palFile += \"\\n\";\n      count = 1;\n    } else {\n      count++;\n    }\n  });\n  return palFile;\n}\n\n/*\n  pal2GBA\n  \n  takes in a Palette and converts rgb into hex values (binary: 0bbbbbgggggrrrrr)\n  adds a declaration for the palette array in C\n  outputs string with the declaration and converted Palette colorArray\n*/\nfunction PaletteToGBA(palette: Palette): string {\n  const palArea = PALETTE_LENGTH;\n  const colAlignment = 8; //these numbers can change depending depending on how we want to format\n  const rowAlignment = 8; //\n\n  let palC =\n    \"const unsigned short powPal[\" +\n    palArea +\n    \"] __attribute__((aligned(4)))=\\n{\\n\";\n\n  for (let i = 1; i <= palette.length; i++) {\n    const element = palette[i - 1];\n    palC += colorToHex(element) + \",\";\n\n    if (i % colAlignment === 0) {\n      palC += \"\\n\";\n    }\n    if (i % (colAlignment * rowAlignment) === 0) {\n      palC += \"\\n\";\n    }\n  }\n\n  return palC + \"};\";\n}\n\nexport function exportPalette(pal: Palette): string {\n  return paletteToHex(pal);\n}\n\nexport async function exportImage(\n  img: ImageInterface,\n  type: string\n): Promise<Blob | null> {\n  switch (type) {\n    case \"BMP\":\n    case \"PNG\":\n      return await img.getImageFileBlob();\n    default:\n      return new Blob([\"Invalid file type\"]);\n  }\n}\n","import Bitmap from \"../models/Bitmap\";\nimport Bitmap3 from \"../models/Bitmap3\";\nimport Color from \"../models/Color\";\nimport Palette from \"../models/Palette\";\nimport { Dimensions, ImageCoordinates } from \"./types\";\n\nexport const createHiddenCanvas = (d: Dimensions): HTMLCanvasElement => {\n  let hiddenCanvas = document.createElement(\"canvas\");\n  hiddenCanvas.hidden = true;\n  hiddenCanvas.setAttribute(\"height\", d.height + \"px\");\n  hiddenCanvas.setAttribute(\"width\", d.width + \"px\");\n  return hiddenCanvas;\n};\n\nexport const loadImageDataFromCanvas = (\n  canvas: HTMLCanvasElement,\n  dimensions: Dimensions\n): Uint8ClampedArray => {\n  const context = canvas.getContext(\"2d\") as CanvasRenderingContext2D; // unsafe\n  return context.getImageData(0, 0, dimensions.width, dimensions.height).data;\n};\n\n// is async necessary here???? I don't think it is\nexport const loadHiddenImage = (imagefile: File): Promise<HTMLImageElement> => {\n  return new Promise((resolve, reject) => {\n    let image = new Image();\n    image.hidden = true;\n\n    image.onload = () => {\n      resolve(image);\n    };\n\n    image.onerror = reject;\n    image.src = URL.createObjectURL(imagefile);\n  });\n};\n\nexport const loadNewImage = async (imageFile: File): Promise<Bitmap> => {\n  let hiddenImage = await loadHiddenImage(imageFile);\n  let dimensions = {\n    height: hiddenImage.naturalHeight,\n    width: hiddenImage.naturalWidth\n  };\n  let hiddenCanvas = createHiddenCanvas(dimensions);\n  const context = hiddenCanvas.getContext(\"2d\");\n  if (context) context.drawImage(hiddenImage, 0, 0);\n  let imageData = loadImageDataFromCanvas(hiddenCanvas, dimensions);\n  return new Bitmap3(imageFile.name, dimensions, imageData);\n};\n\nexport const offset = (pos: ImageCoordinates, d: Dimensions) =>\n  4 * (pos.y * d.width + pos.x);\n\n/**\n * loadNewPalette\n * @param paletteFile .pal file being imported\n * generates a Color[] by iterating through the File\n * returns initialized palette\n */\nexport const loadNewPalette = async (\n  paletteFile: File\n): Promise<Palette | null> => {\n  let text = await new Response(paletteFile).text();\n  let fileString = text\n    .trim()\n    .replace(/\\t/g, \"\")\n    .replace(/\\n/g, \"\");\n  let colors: Color[] = new Array(256);\n\n  // checking to make sure string is properly formatted before iterating through it\n  if (fileString.substr(0, 4) === \"0x00\") {\n    console.log(\"Palette file is valid. Generating color array...\");\n\n    // string is in 0x00rrggbb format (length 10)\n    for (let i = 0, j = 0; i < fileString.length; i += 10, j++) {\n      let red = parseInt(fileString.substr(i + 4, 2), 16);\n      let green = parseInt(fileString.substr(i + 6, 2), 16);\n      let blue = parseInt(fileString.substr(i + 8, 2), 16);\n\n      let color = new Color(red, green, blue, 1);\n      colors[j] = color;\n    }\n    return colors;\n  } else {\n    console.log(\"Invalid palette. Palette unchanged.\");\n    return null;\n  }\n};\n","import Color from \"../models/Color\";\nimport * as Loader from \"../util/fileLoadUtils\";\nimport {\n  Dimensions,\n  ImageCoordinates,\n  ImageDataStore,\n  ImageInterface\n} from \"../util/types\";\nimport ImageCanvas from \"./ImageCanvas\";\n\nexport default abstract class Bitmap implements ImageInterface {\n  public fileName: string;\n  public dimensions: Dimensions;\n\n  protected imageData: Uint8ClampedArray;\n  protected abstract imageCanvas: ImageCanvas;\n\n  constructor(\n    fileName: string,\n    dimensions: Dimensions,\n    imageData?: Uint8ClampedArray\n  ) {\n    this.fileName = fileName;\n    this.dimensions = dimensions;\n\n    if (imageData) {\n      this.imageData = imageData;\n    } else {\n      this.imageData = new Uint8ClampedArray(\n        this.dimensions.width * this.dimensions.height * 4\n      );\n    }\n  }\n\n  public get imageCanvasElement(): HTMLCanvasElement {\n    return this.imageCanvas.imageCanvasElement;\n  }\n\n  public get pixelGridCanvasElement(): HTMLCanvasElement {\n    return this.imageCanvas.pixelGridCanvasElement;\n  }\n\n  public get imageDataStore(): ImageDataStore {\n    return {\n      fileName: this.fileName,\n      dimensions: this.dimensions,\n      imageData: this.imageData.slice()\n    };\n  }\n\n  public updateFromStore(store: ImageDataStore): void {\n    this.dimensions = store.dimensions;\n    this.fileName = store.fileName;\n    this.imageData = store.imageData as Uint8ClampedArray;\n  }\n\n  public async getImageFileBlob(): Promise<Blob | null> {\n    return new Promise(resolve => {\n      this.imageCanvasElement.toBlob(blob => resolve(blob));\n    });\n  }\n\n  protected updateImageData(pos: ImageCoordinates, color: Color): void {\n    this.imageData[Loader.offset(pos, this.dimensions)] = color.r;\n    this.imageData[Loader.offset(pos, this.dimensions) + 1] = color.g;\n    this.imageData[Loader.offset(pos, this.dimensions) + 2] = color.b;\n    this.imageData[Loader.offset(pos, this.dimensions) + 3] = color.a;\n  }\n\n  /////////////////////////////////////// abstract classes\n\n  public abstract get cSourceData(): string;\n  public abstract get headerData(): string;\n  public abstract getPixelColorAt(pos: ImageCoordinates): Color;\n  public abstract setPixelColor(pos: ImageCoordinates, color: Color): void;\n}\n","import Color from \"../models/Color\";\nimport { createHiddenCanvas } from \"../util/fileLoadUtils\";\nimport { Dimensions, ImageCoordinates, Drawable } from \"../util/types\";\n\nexport default class ImageCanvas {\n  public dimensions: Dimensions;\n  public pixelGridRatio = 16;\n\n  private hiddenCanvas: HTMLCanvasElement;\n  private context: CanvasRenderingContext2D | null;\n  private pixelGrid: PixelGrid;\n\n  public constructor(image: Drawable) {\n    console.log(\"Creating new internal ImageCanvas.\");\n\n    this.dimensions = image.dimensions;\n    this.hiddenCanvas = createHiddenCanvas(image.dimensions);\n    this.context = this.hiddenCanvas.getContext(\"2d\");\n    this.pixelGrid = new PixelGrid(image.dimensions, this.pixelGridRatio);\n\n    this.drawImageToHiddenCanvas(image);\n  }\n\n  public get imageCanvasElement(): HTMLCanvasElement {\n    return this.hiddenCanvas;\n  }\n\n  public get pixelGridCanvasElement(): HTMLCanvasElement {\n    return this.pixelGrid.canvasElement;\n  }\n\n  public updatePixel(pos: ImageCoordinates, color: Color): void {\n    this.drawPixel(pos, color);\n  }\n\n  public updateRegion(\n    image: Drawable,\n    x: number,\n    y: number,\n    dx: number,\n    dy: number\n  ): void {\n    // for (let x = 0; x < image.dimensions.width; x++) {\n    //   for (let y = 0; y < image.dimensions.height; y++) {\n    //     this.drawPixel({ x, y }, image.getPixelColorAt({ x, y }));\n    //   }\n    // }\n  }\n\n  public redrawImage(image: Drawable): void {\n    this.drawImageToHiddenCanvas(image);\n  }\n\n  private drawPixel({ x, y }: ImageCoordinates, color: Color): void {\n    if (!this.context) return;\n    this.context.fillStyle = color.toString();\n    this.context.fillRect(x, y, 1, 1);\n  }\n\n  private drawImageToHiddenCanvas(image: Drawable) {\n    for (let x = 0; x < image.dimensions.width; x++) {\n      for (let y = 0; y < image.dimensions.height; y++) {\n        this.drawPixel({ x, y }, image.getPixelColorAt({ x, y }));\n      }\n    }\n  }\n}\n\nexport class PixelGrid {\n  public dimensions: Dimensions;\n  public pixelGridRatio = 16;\n\n  private hiddenCanvas: HTMLCanvasElement;\n  private context: CanvasRenderingContext2D | null;\n\n  constructor(dimensions: Dimensions, pixelGridRatio: number) {\n    console.log(\"Setting up pixel grid.\");\n\n    this.pixelGridRatio = pixelGridRatio;\n\n    this.dimensions = dimensions;\n    this.hiddenCanvas = createHiddenCanvas({\n      width: this.dimensions.width * this.pixelGridRatio,\n      height: this.dimensions.height * this.pixelGridRatio\n    });\n    this.context = this.hiddenCanvas.getContext(\"2d\");\n\n    this.drawGrid();\n  }\n\n  public get canvasElement(): HTMLCanvasElement {\n    return this.hiddenCanvas;\n  }\n\n  private drawGrid(): void {\n    if (!this.context) return;\n    const { width, height } = this.dimensions;\n    this.context.strokeStyle = \"gray\";\n    this.context.beginPath();\n\n    for (let x = 0; x <= width; x++) {\n      this.context.moveTo(x * this.pixelGridRatio, 0);\n      this.context.lineTo(\n        x * this.pixelGridRatio,\n        height * this.pixelGridRatio\n      );\n    }\n\n    for (let y = 0; y <= height; y++) {\n      this.context.moveTo(0, y * this.pixelGridRatio);\n      this.context.lineTo(width * this.pixelGridRatio, y * this.pixelGridRatio);\n    }\n\n    this.context.stroke();\n  }\n}\n","import Color from \"../models/Color\";\nimport {\n  generateCSourceFileString,\n  generateHeaderString\n} from \"../util/exportUtils\";\nimport * as Loader from \"../util/fileLoadUtils\";\nimport { Dimensions, ImageCoordinates, ImageDataStore } from \"../util/types\";\nimport Bitmap from \"./Bitmap\";\nimport ImageCanvas from \"./ImageCanvas\";\n\nexport default class Bitmap3 extends Bitmap {\n  protected imageCanvas: ImageCanvas;\n\n  constructor(\n    fileName: string,\n    dimensions: Dimensions,\n    imageData?: Uint8ClampedArray\n  ) {\n    super(fileName, dimensions, imageData);\n\n    this.imageCanvas = new ImageCanvas(this);\n  }\n\n  static fromDataStore({\n    imageData,\n    dimensions,\n    fileName\n  }: ImageDataStore): Bitmap3 {\n    return new Bitmap3(fileName, dimensions, Uint8ClampedArray.from(imageData));\n  }\n\n  public updateFromStore({ imageData }: ImageDataStore) {\n    console.log(imageData as Uint8ClampedArray);\n    this.imageData = imageData as Uint8ClampedArray;\n    this.imageCanvas.redrawImage(this);\n  }\n\n  public get imageDataStore(): ImageDataStore {\n    return {\n      fileName: this.fileName,\n      dimensions: this.dimensions,\n      imageData: Array.from(this.imageData)\n    };\n  }\n\n  public get cSourceData(): string {\n    return generateCSourceFileString(this, 3);\n  }\n\n  public get headerData(): string {\n    return generateHeaderString(\n      { fileName: this.fileName, imageDimensions: this.dimensions },\n      3\n    );\n  }\n\n  public getPixelColorAt(pos: ImageCoordinates): Color {\n    const r = this.imageData[Loader.offset(pos, this.dimensions)];\n    const g = this.imageData[Loader.offset(pos, this.dimensions) + 1];\n    const b = this.imageData[Loader.offset(pos, this.dimensions) + 2];\n    const a = this.imageData[Loader.offset(pos, this.dimensions) + 3];\n\n    return new Color(r, g, b, a);\n  }\n\n  public setPixelColor(pos: ImageCoordinates, color: Color): void {\n    super.updateImageData(pos, color);\n    this.imageCanvas.updatePixel(pos, color);\n  }\n}","import Color from \"../models/Color\";\nimport {\n  generateCSourceFileString,\n  generateHeaderString\n} from \"../util/exportUtils\";\nimport { Dimensions, ImageCoordinates, ImageDataStore } from \"../util/types\";\nimport Bitmap from \"./Bitmap\";\nimport ImageCanvas from \"./ImageCanvas\";\nimport Palette from \"./Palette\";\n\nexport default class Bitmap4 extends Bitmap {\n  private data: number[];\n  private palette: Palette;\n  private currentPaletteIndex: number;\n\n  protected imageCanvas: ImageCanvas;\n\n  constructor(\n    fileName: string,\n    palette: Palette,\n    dimensions: Dimensions,\n    indexArray?: number[]\n  ) {\n    super(fileName, dimensions);\n    if (indexArray) {\n      this.data = indexArray;\n    } else {\n      this.data = Array<number>(dimensions.height * dimensions.width).fill(0);\n    }\n    this.palette = palette;\n    this.imageCanvas = new ImageCanvas(this);\n    this.currentPaletteIndex = 0;\n  }\n\n  static fromDataStore(\n    { imageData, dimensions, fileName }: ImageDataStore,\n    palette: Palette\n  ): Bitmap4 {\n    return new Bitmap4(fileName, palette, dimensions, imageData as number[]);\n  }\n\n  public updateFromStore({ imageData }: ImageDataStore): void {\n    this.data = imageData as number[];\n    this.imageCanvas.redrawImage(this);\n  }\n\n  public get headerData(): string {\n    return generateHeaderString(\n      {\n        fileName: this.fileName,\n        imageDimensions: this.dimensions,\n        palette: this.palette\n      },\n      4\n    );\n  }\n\n  public get cSourceData(): string {\n    return generateCSourceFileString(this, 4, this.palette);\n  }\n\n  /**\n   * Returns the color at the specified index in the image by indexing into the\n   * color palette\n   * @param ImageCoordinates the index in the Sprite that you would like to get\n   *    the color at\n   */\n  public getPixelColorAt(pos: ImageCoordinates): Color {\n    if (pos.x >= this.dimensions.width || pos.y >= this.dimensions.height) {\n      console.error(\n        \"Tried to access pixel at\",\n        pos,\n        \"but dimensions of sprite are\",\n        this.dimensions\n      );\n    }\n    return this.palette[this.data[this.dimensions.width * pos.y + pos.x]];\n  }\n\n  public setPixelColor(pos: ImageCoordinates): void {\n    this.data[pos.y * this.dimensions.width + pos.x] = this.currentPaletteIndex;\n    this.imageCanvas.updatePixel(pos, this.palette[this.currentPaletteIndex]);\n  }\n\n  setPaletteIndex(newPaletteIndex: number) {\n    this.currentPaletteIndex = newPaletteIndex;\n  }\n\n  public updatePalette(newPalette: Palette): void {\n    this.palette = newPalette;\n    this.imageCanvas.redrawImage(this);\n  }\n\n  public get imageDataStore(): ImageDataStore {\n    return {\n      imageData: this.data.slice(),\n      dimensions: this.dimensions,\n      fileName: this.fileName\n    };\n  }\n}\n","import { PALETTE_LENGTH, PALETTE_SIZE } from \"../util/consts\";\nimport { createHiddenCanvas } from \"../util/fileLoadUtils\";\nimport Color from \"./Color\";\nimport { PixelGrid } from \"./ImageCanvas\";\n\n// interface IPalette {\n//   readonly dimensions: Dimensions;\n//   getColorAt: (index: number) => Color;\n//   setColorAt: (index: number, color: Color) => void;\n//   swapRows: (row1: number, row2: number) => void;\n//   getColorArray: () => Color[];\n// }\n\ntype Palette = Color[];\n\nexport interface PaletteDrawables {\n  readonly pixelGrid: PixelGrid;\n  readonly hiddenCanvas: HTMLCanvasElement;\n}\n\n/**\n * Constructor for Palette objects. Contains initial draw call.\n * @param colorArray color array to be used as data for the palette\n */\nexport function PaletteDrawablesGenerator(): PaletteDrawables {\n  const pixelGrid = new PixelGrid(PALETTE_SIZE, 8);\n  const hiddenCanvas = createHiddenCanvas(PALETTE_SIZE);\n  // drawPaletteToHiddenCanvas(colorArray, hiddenCanvas);\n  return { pixelGrid, hiddenCanvas };\n}\n\nexport function drawPaletteToHiddenCanvas(\n  palette: Palette,\n  hiddenCanvas: HTMLCanvasElement\n) {\n  const context = hiddenCanvas.getContext(\"2d\");\n  if (!context) {\n    console.error(\"Failed to get Palette hidden canvas context!\");\n    return;\n  }\n  for (let i = 0; i < PALETTE_LENGTH; i++) {\n    const color = palette[i];\n    context.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n    context.fillRect(paletteIndexToCol(i), paletteIndexToRow(i), 1, 1);\n  }\n}\n\nexport function setPaletteColorAndRedraw(\n  palette: Palette,\n  hiddenCanvas: HTMLCanvasElement,\n  index: number,\n  color: Color\n) {\n  palette[index] = color;\n  drawPaletteToHiddenCanvas(palette, hiddenCanvas);\n}\n\nexport function paletteIndexToRow(i: number): number {\n  return Math.floor(i / 16);\n}\n\nexport function paletteIndexToCol(i: number): number {\n  return i % 16;\n}\n\nexport default Palette;\n","import { PALETTE_SIZE } from \"../util/consts\";\nimport {\n  Dimensions,\n  Drawable,\n  ImageCoordinates,\n  SpriteDimensions,\n  SpriteDataStore,\n} from \"../util/types\";\nimport Color from \"./Color\";\nimport ImageCanvas from \"./ImageCanvas\";\nimport Palette from \"./Palette\";\n\ninterface ISprite extends Drawable {\n  dimensions: SpriteDimensions; // In pixels\n  position: ImageCoordinates; // In tiles\n  palette: Palette;\n  paletteRow: number;\n}\n\nexport default class Sprite implements ISprite, Drawable {\n  private _data: Uint8ClampedArray;\n  private _dimensions: SpriteDimensions;\n  private _position: ImageCoordinates;\n  private _palette: Palette;\n  private _paletteRow: number;\n  private _imageCanvas: ImageCanvas;\n  private _redrawSpritesheet: () => void;\n\n  constructor(\n    position: ImageCoordinates,\n    dimensions: SpriteDimensions,\n    palette: Palette,\n    paletteRow: number,\n    redrawSpritesheet: () => void\n  ) {\n    this._dimensions = dimensions;\n    this._position = position;\n    this._palette = palette;\n    this._paletteRow = paletteRow;\n    this._data = new Uint8ClampedArray(dimensions.height * dimensions.width);\n    this._imageCanvas = new ImageCanvas(this);\n    this._redrawSpritesheet = redrawSpritesheet;\n  }\n\n  public static fromDataStore(\n    { position, dimensions, paletteRow, data }: SpriteDataStore,\n    palette: Palette,\n    redrawSpritesheet: () => void\n  ): Sprite {\n    const sprite = new Sprite(\n      position,\n      dimensions,\n      palette,\n      paletteRow,\n      redrawSpritesheet\n    );\n    sprite.dangerouslySetData(data);\n    return sprite;\n  }\n\n  public updateFromDataStore({\n    position,\n    dimensions,\n    paletteRow,\n    data,\n  }: SpriteDataStore) {\n    this._position = position;\n    this._dimensions = dimensions;\n    this._paletteRow = paletteRow;\n    this._data = data;\n  }\n\n  /**\n   * Sets the pixel color to the given palette column color (row is not\n   * applicable), then updates internal image canvas.\n   * @param pos the position on the sprite to draw the color, in pixels\n   * @param col column of the palette to draw the color of\n   */\n  public setPixelColorAt(pos: ImageCoordinates, col: number) {\n    if (pos.x >= this._dimensions.width || pos.y >= this._dimensions.height) {\n      console.error(\"Sprite: tried to set pixel color outside image bounds.\");\n      console.error(\n        \"Sprite dimensions:\",\n        this._dimensions,\n        \"Attempted to set color at coordinates:\",\n        pos\n      );\n    } else if (col < 0 || col > 0xf) {\n      console.error(\n        \"Sprite: tried to set pixel color outside palette bounds:\",\n        col\n      );\n      return;\n    }\n    console.log(\"set pixel color on sprite\");\n    this._data[offset(this._dimensions, pos)] = col;\n    this._imageCanvas.updatePixel(\n      pos,\n      this._palette[offset(PALETTE_SIZE, { x: col, y: this._paletteRow })]\n    );\n  }\n\n  public getPixelColorAt(pos: ImageCoordinates) {\n    const col = this._data[offset(this._dimensions, pos)];\n    return this._palette[offset(PALETTE_SIZE, { x: col, y: this._paletteRow })];\n  }\n\n  public dangerouslySetData(data: Uint8ClampedArray) {\n    this._data = data;\n    this._imageCanvas.redrawImage(this);\n  }\n\n  // Getters and setters\n\n  /** Position of sprite, in tiles */\n  public get position() {\n    return this._position;\n  }\n\n  /** Dimensions of the sprite, in pixels */\n  public get dimensions() {\n    return this._dimensions;\n  }\n\n  // returns array of 8x8 pixel times\n  public get tiles() {\n    let tileArr: Color[][][] = [];\n\n    let tileStartRow = 0;\n    let tileStartCol = 0;\n\n    //get the number of tiles needed to represent this sprite\n    // # pixels in image / # pixles in sprite\n    let numberTiles =\n      (this.dimensions.height * this.dimensions.width) / (8 * 8);\n\n    while (tileArr.length < numberTiles) {\n      let tile: Color[][] = [];\n      for (let i = 0; i < 8; i++) {\n        tile[i] = [];\n      }\n\n      for (let i = tileStartRow; i === tileStartRow || i % 8 !== 0; i++) {\n        for (let j = tileStartCol; j === tileStartCol || j % 8 !== 0; j++) {\n          tile[i - tileStartRow][j - tileStartCol] = this.getPixelColorAt({\n            x: i,\n            y: j,\n          });\n        }\n      }\n      tileStartRow + 8 >= this.dimensions.height\n        ? (tileStartRow = 0)\n        : (tileStartRow += 8);\n      tileStartCol + 8 >= this.dimensions.width\n        ? (tileStartCol = 0)\n        : (tileStartCol += 8);\n      tileArr.push(tile);\n    }\n\n    return tileArr;\n  }\n\n  public set dimensions(newDimensions: SpriteDimensions) {\n    console.warn(\"Sprite: Setting sprite dimensions not yet implemented.\");\n    // Make sure we properly resize the sprite data, as the Uint8ClampedArray\n    // is flattened\n  }\n\n  public get paletteRow() {\n    return this._paletteRow;\n  }\n\n  public set paletteRow(newPaletteRow: number) {\n    if (newPaletteRow < 0 || newPaletteRow > 0xf) {\n      console.error(\n        \"Sprite: tried to set palette row outside bounds: \",\n        newPaletteRow\n      );\n      return;\n    }\n    this._paletteRow = newPaletteRow;\n    this._imageCanvas.redrawImage(this);\n    this._redrawSpritesheet();\n  }\n\n  public get imageCanvasElement() {\n    return this._imageCanvas.imageCanvasElement;\n  }\n\n  public get pixelGridCanvasElement() {\n    return this._imageCanvas.pixelGridCanvasElement;\n  }\n\n  public set palette(newPalette: Palette) {\n    this._palette = newPalette;\n    this._imageCanvas.redrawImage(this);\n  }\n\n  public get spriteDataStore(): SpriteDataStore {\n    return {\n      position: this._position,\n      dimensions: this._dimensions,\n      paletteRow: this._paletteRow,\n      data: this._data,\n    };\n  }\n}\n\nfunction offset({ width }: Dimensions, { x, y }: ImageCoordinates) {\n  return width * y + x;\n}\n","import { createHiddenCanvas } from \"../util/fileLoadUtils\";\nimport { PALETTE_HEADER, SS_TILES_HEADER } from \"../util/exportUtils\";\nimport {\n  Dimensions,\n  ImageCoordinates,\n  ImageDataStore,\n  ImageInterface,\n  SpriteDimensions,\n  SpritesheetDataStore,\n  SpriteDataStore,\n} from \"../util/types\";\nimport Color from \"./Color\";\nimport { PixelGrid } from \"./ImageCanvas\";\nimport Palette, { paletteIndexToCol } from \"./Palette\";\nimport Sprite from \"./Sprite\";\n\nconst ALERT_INVALID_SPRITE = () =>\n  alert(\"There's already a sprite at that location!\");\n\n/**\n * Size of a 4bpp spritesheet in pixels\n */\nconst SS4_SIZE_PIXELS: Dimensions = { height: 256, width: 256 };\n\n/**\n * Size of a 4bpp spritesheet in tiles\n */\nconst SS4_SIZE_TILES: Dimensions = { height: 32, width: 32 };\n\n/**\n * Size of a single tile\n */\nconst TILE_SIZE: Dimensions = { height: 8, width: 8 };\n\nconst TILEGRID_RATIO = 8;\n\n/**\n * Representation of a 256 by 256 pixel (32x32 tile), 4bpp Spritesheet to be\n * used on the Gameboy Advance\n */\nexport default class Spritesheet4 implements ImageInterface {\n  public fileName: string;\n\n  private _palette: Palette;\n  private _selectedPaletteCol: number;\n  private _pixelDimensions: Dimensions = SS4_SIZE_PIXELS;\n  private _tileDimensions: Dimensions = SS4_SIZE_TILES;\n  /** Hidden canvas that is drawn directly to the editor's canvas. Contains a\n      composite of all children sprites. */\n  private _hiddenCanvas: HTMLCanvasElement;\n  private _pixelGrid: PixelGrid;\n  /** Hidden canvas that contains a tile grid. Shouldn't need to be modified. */\n  private _tileGridHiddenCanvas: HTMLCanvasElement;\n  /** Array of sprites that belong to this spritesheet */\n  private _sprites: Sprite[];\n  /** A 2D mapping of tiles to which sprite is in that tile */\n  private _spriteMap: (Sprite | null)[][] = new Array(SS4_SIZE_TILES.height)\n    .fill(null)\n    .map(() => new Array(32).fill(null));\n\n  // TODO: Implement\n  constructor(fileName: string, palette: Palette, paletteCol: number) {\n    this.fileName = fileName;\n    this._palette = palette;\n    this._selectedPaletteCol = paletteCol;\n    this._hiddenCanvas = createHiddenCanvas(this.dimensions);\n    this._pixelGrid = new PixelGrid(this._pixelDimensions, 16);\n    this._tileGridHiddenCanvas = createTileGridHiddenCanvas(\n      this._tileDimensions\n    );\n    this.fillBlack();\n    this._sprites = [];\n  }\n\n  public static fromDataStore(\n    { fileName, sprites }: SpritesheetDataStore,\n    palette: Palette,\n    paletteCol: number\n  ) {\n    let ss = new Spritesheet4(fileName, palette, paletteCol);\n    ss.dangerouslySetSprites(ss.decodeSprites(sprites));\n    return ss;\n  }\n\n  /** Decodes sprites from their string format and creates Sprite objects out\n   * of them. Also tries to add them to the spritemap without checking to make\n   * sure they're valid :( */\n  public decodeSprites(sprites: string[]): Sprite[] {\n    let decodedSprites = sprites.map((s) =>\n      Sprite.fromDataStore(\n        JSON.parse(s) as SpriteDataStore,\n        this._palette,\n        () => this.drawToHiddenCanvas()\n      )\n    );\n    decodedSprites.forEach((s) => this.addToSpriteMap(s));\n    return decodedSprites;\n  }\n\n  public dangerouslySetSprites(sprites: Sprite[]) {\n    this._sprites = sprites;\n    redrawTileGridCanvas(\n      this._tileGridHiddenCanvas,\n      sprites,\n      this._tileDimensions\n    );\n    this.drawToHiddenCanvas();\n  }\n\n  public addSprite({ x, y }: ImageCoordinates, dimensions: SpriteDimensions) {\n    const newSprite = new Sprite({ x, y }, dimensions, this._palette, 0, () =>\n      this.drawToHiddenCanvas()\n    );\n\n    if (!this.addToSpriteMap(newSprite)) {\n      return; // failed since there was another sprite in the way\n    }\n\n    const newSpriteIndex = this._sprites.length;\n    this._sprites[newSpriteIndex] = newSprite;\n\n    this.drawToHiddenCanvas();\n    addSpriteBoxToTileGridCanvas(\n      { x, y },\n      dimensions,\n      newSpriteIndex,\n      this._tileGridHiddenCanvas\n    );\n    console.log(\"Added sprite of size\", dimensions, \"at\", { x, y });\n  }\n\n  public addToSpriteMap(sprite: Sprite): boolean {\n    let { x, y } = sprite.position; // tiles\n    let { height, width } = sprite.dimensions; // pixels\n\n    for (let r = y; r < y + height / TILE_SIZE.height; r++) {\n      for (let c = x; c < x + width / TILE_SIZE.width; c++) {\n        if (this._spriteMap[r][c] != null) {\n          // There's already a sprite at the location we'd be putting this one,\n          // or it overlaps, so the new sprite is invalid.\n          ALERT_INVALID_SPRITE();\n          return false;\n        }\n      }\n    }\n\n    for (let r = y; r < y + height / 8; r++) {\n      for (let c = x; c < x + width / 8; c++) {\n        this._spriteMap[r][c] = sprite;\n      }\n    }\n\n    return true;\n  }\n\n  public removeSprite(index: number) {\n    const sprite = this._sprites[index];\n    const { x, y } = sprite.position;\n    // Clear out spritemap\n    for (let r = y; r < y + sprite.dimensions.height / TILE_SIZE.height; r++) {\n      for (let c = x; c < x + sprite.dimensions.width / TILE_SIZE.width; c++) {\n        this._spriteMap[r][c] = null;\n      }\n    }\n    // Remove from sprite array\n    this._sprites.splice(index, 1);\n    this.drawToHiddenCanvas();\n    redrawTileGridCanvas(\n      this._tileGridHiddenCanvas,\n      this._sprites,\n      this._tileDimensions\n    );\n  }\n\n  // TODO: Implement\n  public getPixelColorAt(pos: ImageCoordinates): Color {\n    return new Color(0, 0, 0);\n  }\n\n  /**\n   * Returns the Sprite that contains the pixel at the given position\n   * @param p position on image in pixels\n   */\n  private getSpriteFromCoordinates(p: ImageCoordinates): Sprite | null {\n    const t = this.getTileIndexFromCoordinates(p);\n    const sprite = this._spriteMap[t.y][t.x];\n    return sprite;\n  }\n\n  private getTileIndexFromCoordinates(p: ImageCoordinates): ImageCoordinates {\n    const tileX = Math.floor(p.x / 8);\n    const tileY = Math.floor(p.y / 8);\n    return { x: tileX, y: tileY };\n  } // TODO: Implement\n\n  public updatePalette(newPalette: Palette) {\n    this._palette = newPalette;\n    // for each sprite, set the new palette\n    // the sprites take care of redrawing themselves\n    this._sprites.map((s) => (s.palette = newPalette));\n    this.drawToHiddenCanvas();\n  }\n\n  public updateFromStore(store: ImageDataStore) {\n    return;\n  }\n\n  public setPixelColor(pos: ImageCoordinates, color: Color) {\n    const sprite = this.getSpriteFromCoordinates(pos);\n    if (!sprite) {\n      console.warn(\"Spritesheet: trying to set color but there's no sprite!\");\n      return;\n    }\n    const pixelCoords = spritesheetCoordsToSpriteCoords(\n      pos,\n      this._pixelDimensions,\n      sprite.position,\n      sprite.dimensions\n    );\n    sprite.setPixelColorAt(pixelCoords, this._selectedPaletteCol);\n    this.drawToHiddenCanvas();\n    return;\n  }\n\n  /**\n   * Sets the selected palette column using the given palette index.\n   * @param newPaletteIndex the index in the palette to set the selected column\n   * to. Row is ignored.\n   */\n  public setPaletteIndex(newPaletteIndex: number) {\n    this._selectedPaletteCol = paletteIndexToCol(newPaletteIndex);\n    console.log(this._selectedPaletteCol);\n  }\n\n  private fillBlack() {\n    const ctx = this._hiddenCanvas.getContext(\"2d\");\n    if (!ctx) return;\n    ctx.fillStyle = new Color(0, 0, 0).toString();\n    ctx.fillRect(0, 0, this.dimensions.width, this.dimensions.height);\n  }\n\n  private drawToHiddenCanvas() {\n    const ctx = this._hiddenCanvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    this.fillBlack();\n\n    this.sprites.forEach((sprite) => {\n      ctx.drawImage(\n        sprite.imageCanvasElement,\n        8 * sprite.position.x,\n        8 * sprite.position.y,\n        sprite.dimensions.width,\n        sprite.dimensions.height\n      );\n      ctx.stroke();\n    });\n  }\n\n  // Getters and setters -------------------------------------------------------\n\n  public get dimensions() {\n    return this._pixelDimensions;\n  }\n\n  public get sprites() {\n    return this._sprites;\n  }\n\n  public get imageCanvasElement() {\n    return this._hiddenCanvas;\n  }\n\n  public get tileGridCanvasElement() {\n    return this._tileGridHiddenCanvas;\n  }\n\n  // TODO: fix\n  public get pixelGridCanvasElement() {\n    return this._pixelGrid.canvasElement;\n  }\n\n  // TODO: Implement\n  public get imageDataStore() {\n    const tempData: ImageDataStore = {\n      fileName: this.fileName,\n      dimensions: this.dimensions,\n      imageData: [],\n    };\n    return tempData;\n  }\n\n  public get spritesheetDataStore(): SpritesheetDataStore {\n    let temp = {\n      fileName: this.fileName,\n      dimensions: this._pixelDimensions,\n      sprites: this._sprites.map((s) => JSON.stringify(s.spriteDataStore)),\n      bpp: 4,\n    };\n    return temp;\n  }\n\n  public async getImageFileBlob(): Promise<Blob | null> {\n    return new Promise((resolve) => {\n      this.imageCanvasElement.toBlob((blob) => resolve(blob));\n    });\n  }\n\n  // The correct order should be:\n  // tileHeader, tileData, mapHeader, mapData, paletteHeader, paletteData\n  public get headerData(): string {\n    return SS_TILES_HEADER(this.fileName) + PALETTE_HEADER(this.fileName);\n  }\n\n  // TODO: Implement\n  // size = (height * width) / bpp (4 bpp)\n  // private get tilesHeader(): string {\n  //   const size = (this.dimensions.height * this.dimensions.width) / 4\n  //   const name = this.fileName.slice(0, this.fileName.lastIndexOf(\".\"));\n  //   const imageDefinitionString = `const unsigned short [${name}] __attribute__((aligned(4)))=\\n{\\n\\t`;\n  //   return \"const unsigned short \" + name + \"[\" + size + \"]\" + \"__attribute__((aligned(4)))\";\n  // }\n\n  // //TODO: impliment\n  // // same as image data export for mode 3\n  // private get tileData(): String {\n  //   return \"\";\n  // }\n\n  // TODO: Implement\n  public get cSourceData(): string {\n    return \"lol sorry not done yet\";\n  }\n}\n\nfunction createTileGridHiddenCanvas(tileDimensions: Dimensions) {\n  // height vs. width doesn't matter, since tiles /should/ be square...\n  const ratio = TILEGRID_RATIO * TILE_SIZE.height;\n  const hiddenCanvas = createHiddenCanvas({\n    height: ratio * tileDimensions.height,\n    width: ratio * tileDimensions.width,\n  });\n  drawTilesOnCanvas(hiddenCanvas, tileDimensions);\n  return hiddenCanvas;\n}\n\nfunction drawTilesOnCanvas(\n  canvas: HTMLCanvasElement,\n  tileDimensions: Dimensions\n) {\n  const error = () =>\n    console.error(\n      \"Spritesheet: Failed to get context for tile grid canvas.\",\n      \"Cannot draw tile grid.\"\n    );\n\n  const ratio = TILEGRID_RATIO * TILE_SIZE.height;\n\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    error();\n    return canvas;\n  }\n\n  ctx.globalAlpha = 1;\n  ctx.strokeStyle = \"blue\";\n  ctx.beginPath();\n\n  for (let x = 0; x <= tileDimensions.width; x++) {\n    ctx.moveTo(x * ratio, 0);\n    ctx.lineTo(x * ratio, tileDimensions.height * ratio);\n  }\n\n  for (let y = 0; y <= tileDimensions.height; y++) {\n    ctx.moveTo(0, y * ratio);\n    ctx.lineTo(tileDimensions.width * ratio, y * ratio);\n  }\n\n  ctx.stroke();\n}\n\nfunction redrawTileGridCanvas(\n  canvas: HTMLCanvasElement,\n  sprites: Sprite[],\n  tileDimensions: Dimensions\n) {\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) return;\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  drawTilesOnCanvas(canvas, tileDimensions);\n  sprites.map((s, i) =>\n    addSpriteBoxToTileGridCanvas(s.position, s.dimensions, i, canvas)\n  );\n}\n\nfunction addSpriteBoxToTileGridCanvas(\n  spritePos: ImageCoordinates,\n  spriteDim: Dimensions,\n  spriteNum: number,\n  canvas: HTMLCanvasElement\n) {\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) return;\n  const ratio = TILEGRID_RATIO * TILE_SIZE.height;\n  ctx.strokeStyle = \"yellow\";\n  ctx.strokeRect(\n    spritePos.x * ratio,\n    spritePos.y * ratio,\n    spriteDim.width * TILEGRID_RATIO,\n    spriteDim.height * TILEGRID_RATIO\n  );\n  ctx.fillStyle = \"white\";\n  ctx.font = \"12px monospace\";\n  ctx.fillText(\n    spriteNum.toString(),\n    spritePos.x * ratio + 2,\n    spritePos.y * ratio + 12\n  );\n}\n\n/**\n * Translates coordinates from spritesheet space to the context of a sprite\n * @param ssc coordinates on the spritesheet to translate, in pixels\n * @param ssd the size of the spritesheet, in pixels\n * @param stp the position of the sprite on the spritesheet, in tiles\n * @param spd the size of the sprite, in pixels\n * @returns coordinates of the pixel in terms of a sprite at the given position\n */\nfunction spritesheetCoordsToSpriteCoords(\n  ssc: ImageCoordinates,\n  ssd: Dimensions,\n  stp: ImageCoordinates,\n  spd: Dimensions\n): ImageCoordinates {\n  const spp: ImageCoordinates = {\n    x: stp.x * TILE_SIZE.width,\n    y: stp.y * TILE_SIZE.height,\n  };\n  // console.log(\"in:\", ssc, ssd, spp, spd);\n\n  if (ssc.y >= ssd.height || ssc.x >= ssd.width) {\n    console.warn(\"Trying to translate spritesheet coordinates out of range!\");\n  }\n\n  const pixelPos: ImageCoordinates = {\n    x: ssc.x - spp.x,\n    y: ssc.y - spp.y,\n  };\n\n  if (pixelPos.x >= spd.width || pixelPos.y >= spd.height) {\n    console.warn(\"Translated sprite coordinates out of sprite range!\");\n  }\n\n  // console.log(\"out\", pixelPos);\n\n  return pixelPos;\n}\n","import Palette from \"../models/Palette\";\nimport Color from \"../models/Color\";\n\nconst DEFAULT_PALETTE: Palette = [\n  new Color(0, 0, 0, 1),\n  new Color(128, 0, 0, 1),\n  new Color(0, 128, 0, 1),\n  new Color(128, 128, 0, 1),\n  new Color(0, 0, 128, 1),\n  new Color(128, 0, 128, 1),\n  new Color(0, 128, 128, 1),\n  new Color(192, 192, 192, 1),\n  new Color(128, 128, 128, 1),\n  new Color(248, 0, 0, 1),\n  new Color(0, 248, 0, 1),\n  new Color(248, 248, 0, 1),\n  new Color(0, 0, 248, 1),\n  new Color(248, 0, 248, 1),\n  new Color(0, 248, 248, 1),\n  new Color(248, 248, 248, 1),\n  new Color(32, 0, 0, 1),\n  new Color(63, 0, 0, 1),\n  new Color(95, 0, 0, 1),\n  new Color(127, 0, 0, 1),\n  new Color(159, 0, 0, 1),\n  new Color(191, 0, 0, 1),\n  new Color(223, 0, 0, 1),\n  new Color(255, 0, 0, 1),\n  new Color(0, 32, 0, 1),\n  new Color(0, 63, 0, 1),\n  new Color(0, 95, 0, 1),\n  new Color(0, 127, 0, 1),\n  new Color(0, 159, 0, 1),\n  new Color(0, 191, 0, 1),\n  new Color(0, 223, 0, 1),\n  new Color(0, 255, 0, 1),\n  new Color(32, 32, 0, 1),\n  new Color(63, 63, 0, 1),\n  new Color(95, 95, 0, 1),\n  new Color(127, 127, 0, 1),\n  new Color(159, 159, 0, 1),\n  new Color(191, 191, 0, 1),\n  new Color(223, 223, 0, 1),\n  new Color(255, 255, 0, 1),\n  new Color(0, 0, 32, 1),\n  new Color(0, 0, 63, 1),\n  new Color(0, 0, 95, 1),\n  new Color(0, 0, 127, 1),\n  new Color(0, 0, 159, 1),\n  new Color(0, 0, 191, 1),\n  new Color(0, 0, 223, 1),\n  new Color(0, 0, 255, 1),\n  new Color(32, 0, 32, 1),\n  new Color(63, 0, 63, 1),\n  new Color(95, 0, 95, 1),\n  new Color(127, 0, 127, 1),\n  new Color(159, 0, 159, 1),\n  new Color(191, 0, 191, 1),\n  new Color(223, 0, 223, 1),\n  new Color(255, 0, 255, 1),\n  new Color(0, 32, 32, 1),\n  new Color(0, 63, 63, 1),\n  new Color(0, 95, 95, 1),\n  new Color(0, 127, 127, 1),\n  new Color(0, 159, 159, 1),\n  new Color(0, 191, 191, 1),\n  new Color(0, 223, 223, 1),\n  new Color(0, 255, 255, 1),\n  new Color(16, 16, 16, 1),\n  new Color(31, 31, 31, 1),\n  new Color(47, 47, 47, 1),\n  new Color(63, 63, 63, 1),\n  new Color(79, 79, 79, 1),\n  new Color(95, 95, 95, 1),\n  new Color(111, 111, 111, 1),\n  new Color(127, 127, 127, 1),\n  new Color(143, 143, 143, 1),\n  new Color(159, 159, 159, 1),\n  new Color(175, 175, 175, 1),\n  new Color(191, 191, 191, 1),\n  new Color(207, 207, 207, 1),\n  new Color(223, 223, 223, 1),\n  new Color(239, 239, 239, 1),\n  new Color(255, 255, 255, 1),\n  new Color(255, 0, 0, 1),\n  new Color(255, 31, 0, 1),\n  new Color(255, 63, 0, 1),\n  new Color(255, 95, 0, 1),\n  new Color(255, 127, 0, 1),\n  new Color(255, 159, 0, 1),\n  new Color(255, 191, 0, 1),\n  new Color(255, 223, 0, 1),\n  new Color(255, 255, 0, 1),\n  new Color(224, 255, 0, 1),\n  new Color(192, 255, 0, 1),\n  new Color(160, 255, 0, 1),\n  new Color(128, 255, 0, 1),\n  new Color(96, 255, 0, 1),\n  new Color(64, 255, 0, 1),\n  new Color(32, 255, 0, 1),\n  new Color(0, 255, 0, 1),\n  new Color(0, 255, 31, 1),\n  new Color(0, 255, 63, 1),\n  new Color(0, 255, 95, 1),\n  new Color(0, 255, 127, 1),\n  new Color(0, 255, 159, 1),\n  new Color(0, 255, 191, 1),\n  new Color(0, 255, 223, 1),\n  new Color(0, 255, 255, 1),\n  new Color(0, 224, 255, 1),\n  new Color(0, 192, 255, 1),\n  new Color(0, 160, 255, 1),\n  new Color(0, 128, 255, 1),\n  new Color(0, 96, 255, 1),\n  new Color(0, 64, 255, 1),\n  new Color(0, 32, 255, 1),\n  new Color(0, 0, 255, 1),\n  new Color(31, 0, 255, 1),\n  new Color(63, 0, 255, 1),\n  new Color(95, 0, 255, 1),\n  new Color(127, 0, 255, 1),\n  new Color(159, 0, 255, 1),\n  new Color(191, 0, 255, 1),\n  new Color(223, 0, 255, 1),\n  new Color(255, 0, 255, 1),\n  new Color(255, 0, 224, 1),\n  new Color(255, 0, 192, 1),\n  new Color(255, 0, 160, 1),\n  new Color(255, 0, 128, 1),\n  new Color(255, 0, 96, 1),\n  new Color(255, 0, 64, 1),\n  new Color(255, 0, 32, 1),\n  new Color(255, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(0, 0, 0, 1),\n  new Color(8, 8, 8, 1),\n  new Color(16, 16, 16, 1),\n  new Color(24, 24, 24, 1),\n  new Color(32, 32, 32, 1),\n  new Color(41, 41, 41, 1),\n  new Color(49, 49, 49, 1),\n  new Color(57, 57, 57, 1),\n  new Color(65, 65, 65, 1),\n  new Color(74, 74, 74, 1),\n  new Color(82, 82, 82, 1),\n  new Color(90, 90, 90, 1),\n  new Color(98, 98, 98, 1),\n  new Color(106, 106, 106, 1),\n  new Color(115, 115, 115, 1),\n  new Color(123, 123, 123, 1),\n  new Color(131, 131, 131, 1),\n  new Color(139, 139, 139, 1),\n  new Color(148, 148, 148, 1),\n  new Color(156, 156, 156, 1),\n  new Color(164, 164, 164, 1),\n  new Color(172, 172, 172, 1),\n  new Color(180, 180, 180, 1),\n  new Color(189, 189, 189, 1),\n  new Color(197, 197, 197, 1),\n  new Color(205, 205, 205, 1),\n  new Color(213, 213, 213, 1),\n  new Color(222, 222, 222, 1),\n  new Color(230, 230, 230, 1),\n  new Color(238, 238, 238, 1),\n  new Color(246, 246, 246, 1),\n  new Color(255, 255, 255, 1)\n];\n\nexport default DEFAULT_PALETTE;\n","import Bitmap from \"../models/Bitmap\";\r\nimport Bitmap4 from \"../models/Bitmap4\";\r\nimport Color from \"../models/Color\";\r\nimport Palette from \"../models/Palette\";\r\n\r\nconst BLACK: Color = new Color(0, 0, 0, 1);\r\n\r\nexport function quantize(\r\n  image: Bitmap,\r\n  depth: number\r\n): { sprite: Bitmap4; palette: Palette } {\r\n\r\n  let centroids: number[][];\r\n  let imageArr = imageToArr(image);\r\n  let colors = depth;\r\n  const MaxPalSize = 256;\r\n\r\n  //start by checking that there are at least 'depth' unique colors in image\r\n  // console.log(\"find colors\")\r\n  let uniqueColors = [];\r\n  let uniqueColorsString: String[] = [];\r\n  for (let i = 0; i < imageArr.length; i++) {\r\n    let check = imageArr[i];\r\n    if (!uniqueColorsString.includes(JSON.stringify(check))) {\r\n      uniqueColors.push(check);\r\n      uniqueColorsString.push(JSON.stringify(check));\r\n    }\r\n  }\r\n\r\n  //pick unique colors for centroids using binary search to find points with\r\n  //largest average distance\r\n  if (colors === 1 || uniqueColors.length < colors) {\r\n    centroids = uniqueColors;\r\n    colors = uniqueColors.length;\r\n  } else {\r\n    let { pickedCentroids } = findCentroids(uniqueColors, colors);\r\n    // console.log(pickedCentroids)\r\n    centroids = JSON.parse(JSON.stringify(pickedCentroids));\r\n  }\r\n\r\n  // use K-means to fit all colors in image to 'colors' clusters\r\n  let { groups, centers } = kmeans(\r\n    JSON.parse(JSON.stringify(imageArr)),\r\n    JSON.parse(JSON.stringify(centroids)),\r\n    colors\r\n  );\r\n\r\n  // console.log(\"kmeans output:\")\r\n  // console.log(groups[0][0]);\r\n  // console.log(centers);\r\n\r\n  let clusters: number[][][] = [];\r\n  //group centers and points in cluster for sorting\r\n  for (let i = 0; i < centers.length; i++) {\r\n    let newCluster: number[][] = [[], []];\r\n    newCluster[0] = centers[i];\r\n    for (var j = 0; j < groups[i].length; j++) {\r\n      newCluster[j + 1] = groups[i][j];\r\n    }\r\n    clusters.push(newCluster);\r\n  }\r\n  // sort clusters from largest to smallest\r\n  clusters.sort(function (a, b) {\r\n    return b.length - a.length;\r\n  });\r\n\r\n  console.log(clusters);\r\n\r\n  let spriteIndexArrayLength = image.dimensions.height * image.dimensions.width;\r\n\r\n  // generate out sprite and palette based on k-means clusters\r\n  let spriteIndexArray: number[] = new Array<number>(spriteIndexArrayLength);\r\n  spriteIndexArray.fill(0);\r\n\r\n  let palette: Color[] = new Array(256);\r\n\r\n  //clusters: [center[r,g,b]], [point 1[r,g,b]], ...]\r\n  let i = 0;\r\n  for (i; i < clusters.length && i < MaxPalSize; i++) {\r\n    let center: Color = new Color(\r\n      clusters[i][0][0],\r\n      clusters[i][0][1],\r\n      clusters[i][0][2],\r\n      1\r\n    );\r\n    palette[i] = center;\r\n    for (let j = 1; j < clusters[i].length; j++) {\r\n      let imageIndex = getColorIndex(imageArr, clusters[i][j]);\r\n      // console.log(imageIndex);\r\n      if (imageIndex !== -1) {\r\n        spriteIndexArray[imageIndex] = i;\r\n      }\r\n    }\r\n  }\r\n  // console.log(paletteColorArray)\r\n  for (i; i < MaxPalSize; i++) {\r\n    palette[i] = BLACK;\r\n  }\r\n\r\n  let sprite = new Bitmap4(\r\n    image.fileName,\r\n    palette,\r\n    image.dimensions,\r\n    spriteIndexArray\r\n  );\r\n  return { sprite, palette };\r\n}\r\n\r\n// Used to find index of colors for building sprite colorArray\r\n// This kills the imageArr (imageArr is destroyed by this function)\r\nfunction getColorIndex(imageArr: number[][], colorArr: number[]): number {\r\n  for (let i = 0; i < imageArr.length; i++) {\r\n    if (\r\n      imageArr[i][0] === colorArr[0] &&\r\n      imageArr[i][1] === colorArr[1] &&\r\n      imageArr[i][2] === colorArr[2]\r\n    ) {\r\n      imageArr[i] = [-1, -1, -1];\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\n//converts imageObject into array of colors for k-means\r\nfunction imageToArr(image: Bitmap): number[][] {\r\n  let imageArr = [];\r\n  for (let y = 0; y < image.dimensions.height; y++) {\r\n    for (let x = 0; x < image.dimensions.width; x++) {\r\n      let color = image.getPixelColorAt({ x, y });\r\n      imageArr.push([\r\n        Math.round(Math.min(Math.max(color.r, 0), 255)),\r\n        Math.round(Math.min(Math.max(color.g, 0), 255)),\r\n        Math.round(Math.min(Math.max(color.b, 0), 255))\r\n      ]);\r\n    }\r\n  }\r\n  return imageArr;\r\n}\r\n\r\n//used to find clusters of similar points for image depth reduction (quantization)\r\n//arrayToProcess: number array of colors; [[r, g, b], [r, g, b], ...]\r\n//centroids: center point of clusters;\r\n//clusters: number of clusters to generate\r\nfunction kmeans(\r\n  arrayToProcess: number[][],\r\n  centroids: number[][],\r\n  clusters: number\r\n): { groups: number[][][]; centers: number[][] } {\r\n  let Groups: any[] = [];\r\n  let iterations = 0;\r\n  let tempdistance = 0;\r\n  let oldcentroids: number[][] = JSON.parse(JSON.stringify(centroids));\r\n  let changed = false;\r\n\r\n  do {\r\n    for (let reset = 0; reset < clusters; reset++) {\r\n      Groups[reset] = [];\r\n    }\r\n\r\n    changed = false;\r\n\r\n    changed = false;\r\n\r\n    for (let i = 0; i < arrayToProcess.length; i++) {\r\n      let minDist = -1;\r\n      let minCluster = 0;\r\n\r\n      for (\r\n        let clusterIterate = 0;\r\n        clusterIterate < clusters;\r\n        clusterIterate++\r\n      ) {\r\n        let dist = 0;\r\n\r\n        for (let j = 0; j < arrayToProcess[i].length; j++) {\r\n          dist += Math.pow(\r\n            Math.abs(arrayToProcess[i][j] - centroids[clusterIterate][j]),\r\n            2\r\n          );\r\n        }\r\n        tempdistance = Math.sqrt(dist);\r\n\r\n        if (minDist === -1 || tempdistance <= minDist) {\r\n          minDist = tempdistance;\r\n          minCluster = clusterIterate;\r\n        }\r\n      }\r\n      Groups[minCluster].push(arrayToProcess[i].slice());\r\n    }\r\n\r\n    for (let clusterIterate = 0; clusterIterate < clusters; clusterIterate++) {\r\n      for (let i = 0; i < Groups[clusterIterate].length; i++) {\r\n        for (let j = 0; j < Groups[clusterIterate][i].length; j++) {\r\n          centroids[clusterIterate][j] += Groups[clusterIterate][i][j];\r\n        }\r\n      }\r\n      for (let i = 0; i < centroids[clusterIterate].length; i++) {\r\n        centroids[clusterIterate][i] = Math.round(\r\n          Math.min(\r\n            Math.max(\r\n              centroids[clusterIterate][i] /\r\n              (Groups[clusterIterate].length <= 1\r\n                ? 1\r\n                : Groups[clusterIterate].length),\r\n              0\r\n            ),\r\n            255\r\n          )\r\n        );\r\n\r\n        if (centroids[clusterIterate][i] !== oldcentroids[clusterIterate][i]) {\r\n          changed = true;\r\n          oldcentroids = [];\r\n          oldcentroids = JSON.parse(JSON.stringify(centroids));\r\n        }\r\n      }\r\n    }\r\n    iterations++;\r\n  } while (changed === true && iterations < 1000);\r\n\r\n  console.log(\"kmeans output:\");\r\n  console.log(iterations);\r\n  // console.log(Groups.length);\r\n  // console.log(Groups);\r\n  console.log(\"..........\");\r\n\r\n  // let ret = [Groups, centroids];\r\n  // console.log(ret);\r\n  // return ret;\r\n\r\n  return { groups: Groups, centers: centroids };\r\n}\r\n\r\n//function to determine if there exists a group of centroids with specific\r\n//average distance between them\r\n//points: list of points to search\r\n//midDist: desired average distance\r\n//numCentroids: number of points to find\r\n//\r\n//returns:\r\n//possible (boolean)\r\n//centers (list of points with desired distance)\r\nfunction centroidPossible(\r\n  points: number[][],\r\n  midDist: number,\r\n  numCentroids: number\r\n): { possible: boolean; centers: number[][] } {\r\n  let centroids = 1;\r\n  let currColor: number[] = points[0];\r\n  let possible = false;\r\n  let centers: number[][] = [];\r\n\r\n  centers.push(currColor);\r\n\r\n  for (let i = 0; i < points.length; i++) {\r\n    let dist = 0;\r\n\r\n    for (let j = 0; j < points[i].length; j++) {\r\n      dist += Math.pow(Math.abs(points[i][j] - currColor[j]), 2);\r\n    }\r\n    dist = Math.sqrt(dist);\r\n\r\n    if (dist >= midDist) {\r\n      centroids++;\r\n      currColor = points[i];\r\n      centers.push(points[i]);\r\n\r\n      if (centroids >= numCentroids) {\r\n        possible = true;\r\n        return { possible, centers };\r\n      }\r\n    }\r\n  }\r\n  return { possible, centers };\r\n}\r\n\r\n//binary search to find centroids, reutrn list of centroids with\r\n// average largest distance between them\r\nfunction findCentroids(\r\n  uniqueColors: number[][],\r\n  depth: number\r\n): { pickedCentroids: number[][] } {\r\n  let maxDist = 442;\r\n  let minDist = 0;\r\n  let midDist = (maxDist + minDist) / 2;\r\n\r\n  let dist = 0;\r\n\r\n  let pickedCentroids: number[][] = [];\r\n\r\n  while (minDist <= maxDist) {\r\n    midDist = (maxDist + minDist) / 2;\r\n    let { possible, centers } = centroidPossible(uniqueColors, midDist, depth);\r\n\r\n    if (!possible) {\r\n      maxDist = midDist - 1;\r\n    } else {\r\n      if (dist < midDist) {\r\n        pickedCentroids = JSON.parse(JSON.stringify(centers));\r\n        dist = midDist;\r\n      }\r\n      minDist = midDist + 1;\r\n    }\r\n  }\r\n  return { pickedCentroids };\r\n}\r\n","import React from \"react\";\n\ninterface ExportButtonProps {\n  startImageExport: () => void;\n  buttonLabel: string;\n}\n\nfunction ExportButton({ startImageExport, buttonLabel }: ExportButtonProps): JSX.Element {\n  const handleClick = () => {\n    startImageExport();\n  };\n\n  return (\n    <button className=\"button export-button\" onClick={handleClick}>\n      {buttonLabel}\n    </button>\n  );\n}\n\nexport default ExportButton;\n","import React, { useRef } from \"react\";\n\ntype ImportFile = File | null;\n\ninterface IProps {\n  buttonLabel: string;\n  onFileInputChange: (\n    element: HTMLInputElement | null,\n    event: React.FormEvent<HTMLInputElement>\n  ) => void;\n}\n\nfunction ImportButton({ onFileInputChange, buttonLabel }: IProps): JSX.Element {\n  const fileInput = useRef<HTMLInputElement>(null);\n\n  return (\n    <>\n      <label>\n        {buttonLabel}\n        <input\n          type=\"file\"\n          accept=\".png, .jpg, .jpeg, .bmp, .pal\"\n          ref={fileInput}\n          onChange={e => onFileInputChange(fileInput.current, e)}\n        />\n      </label>\n    </>\n  );\n}\n\nexport default ImportButton;\n","import React, { useState, PropsWithChildren } from \"react\";\r\n\r\ninterface DropdownProps {\r\n  label: string;\r\n}\r\n\r\nexport default function Dropdown({\r\n  label,\r\n  children\r\n}: PropsWithChildren<DropdownProps>) {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  return (\r\n    <div className=\"dd-container\">\r\n      <button onClick={() => setOpen(!open)} className=\"dd-button\">\r\n        {label}\r\n      </button>\r\n      <div\r\n        id=\"myDropdown\"\r\n        className={open ? \"dd-content dd-show\" : \"dd-content\"}\r\n        onClick={() => setOpen(false)}\r\n      >\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport Color from \"../models/Color\";\nimport Palette from \"../models/Palette\";\nimport Spritesheet4 from \"../models/Spritesheet4\";\nimport { Tool } from \"../util/consts\";\nimport {\n  EditorSettings,\n  ImageCoordinates,\n  ImageInterface,\n} from \"../util/types\";\n\n// The pixel grid will not be visible when the scale is smaller than this value.\nconst PIXELGRID_ZOOM_LIMIT = 8;\nconst TILEGRID_ZOOM_LIMIT = 4;\n\ninterface EditorCanvasProps {\n  image: ImageInterface;\n  palette: Palette;\n  selectedPaletteIndex: number;\n  settings: EditorSettings;\n  scale: number;\n  onChangeImage: (newImage: ImageInterface) => void;\n  onChangeColor: (newColor: Color) => void;\n  onMouseWheel: (e: WheelEvent) => void;\n}\n\nexport default function EditorCanvas({\n  image,\n  palette,\n  selectedPaletteIndex,\n  settings,\n  scale,\n  onChangeImage,\n  onChangeColor,\n  onMouseWheel\n}: EditorCanvasProps): JSX.Element {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [canvasSize, setCanvasSize] = useState<number[]>([0, 0]);\n\n  ///////////////////// Drawing Tool\n  const [isPainting, setIsPainting] = useState<boolean>(false);\n  const [mousePos, setMousePos] = useState<ImageCoordinates | undefined>(\n    undefined\n  );\n  const [startPos, setStartPos] = useState<ImageCoordinates>({\n    x: 0,\n    y: 0,\n  });\n  const [imagePosition, setImagePosition] = useState<ImageCoordinates>({\n    x: 0,\n    y: 0,\n  });\n  const [endingPos, setEndingPos] = useState<ImageCoordinates | undefined>(\n    undefined\n  );\n  ///////////////////////////////////////////\n\n  const drawImageOnCanvas = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n    if (!image) return;\n\n    // Clear the context\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    // Draw the image at the correct position and scale\n    context.drawImage(\n      image.imageCanvasElement,\n      imagePosition.x,\n      imagePosition.y,\n      image.dimensions.width * scale,\n      image.dimensions.height * scale\n    );\n    // Draw the grid (if we need to)\n    if (settings.grid && scale >= PIXELGRID_ZOOM_LIMIT) {\n      context.drawImage(\n        image.pixelGridCanvasElement,\n        imagePosition.x,\n        imagePosition.y,\n        image.dimensions.width * scale,\n        image.dimensions.height * scale\n      );\n    }\n    // Always draw tile grid on spritesheets\n    // TODO: Add option for this\n    if (\n      settings.grid &&\n      image instanceof Spritesheet4 &&\n      scale >= TILEGRID_ZOOM_LIMIT\n    ) {\n      context.drawImage(\n        (image as Spritesheet4).tileGridCanvasElement,\n        imagePosition.x,\n        imagePosition.y,\n        image.dimensions.width * scale,\n        image.dimensions.height * scale\n      );\n    }\n  }, [image, imagePosition, canvasRef, scale, settings.grid]);\n\n  /**\n   * Handle window resizing and set the new canvasSize state.\n   */\n  useLayoutEffect(() => {\n    const updateCanvasSize = () => {\n      if (canvasRef.current) {\n        setCanvasSize([\n          canvasRef.current.clientWidth,\n          canvasRef.current.clientHeight,\n        ]);\n      }\n    };\n    window.addEventListener(\"resize\", () => updateCanvasSize());\n  }, []);\n\n  /**\n   * Set up the canvas.\n   */\n  useLayoutEffect(() => {\n    console.log(\"Setting up canvas...\");\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n    setCanvasSize([canvas.clientWidth, canvas.clientHeight]);\n    context.imageSmoothingEnabled = false;\n  }, [canvasRef]);\n\n  /**\n   * Change the dimensions of the canvas when the canvasSize changes.\n   */\n  useLayoutEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n    canvas.width = canvasSize[0] * devicePixelRatio;\n    canvas.height = canvasSize[1] * devicePixelRatio;\n    context.imageSmoothingEnabled = false;\n  }, [canvasSize, canvasRef]);\n\n  /**\n   * Handle mousewheel zooming\n   */\n  useLayoutEffect(() => {\n    if (canvasRef.current) {\n      canvasRef.current.addEventListener(\"wheel\", onMouseWheel);\n    }\n  }, [onMouseWheel]);\n\n  /**\n   * Draw the image whenever the image, imageCanvas, context, scale, or editor\n   * settings change.\n   */\n  useLayoutEffect(() => drawImageOnCanvas());\n\n  /////////////////////////////////////////////////////////////////////////////\n  // Drawing Tool\n  const getMousePos = (e: MouseEvent): ImageCoordinates | undefined => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const rect = canvas.getBoundingClientRect();\n      const scaleX = canvas.width / rect.width;\n      const scaleY = canvas.height / rect.height;\n      return {\n        x: (e.clientX - rect.left) * scaleX,\n        y: (e.clientY - rect.top) * scaleY,\n      };\n    }\n    return undefined;\n  };\n\n  const getImageCoord = useCallback(\n    (mousePos: ImageCoordinates): ImageCoordinates | undefined => {\n      const x = Math.floor((mousePos.x - imagePosition.x) / scale);\n      const y = Math.floor((mousePos.y - imagePosition.y) / scale);\n      if (\n        x < 0 ||\n        x > image.dimensions.width ||\n        y < 0 ||\n        y > image.dimensions.height\n      )\n        return undefined;\n      return { x, y };\n    },\n    [scale, imagePosition, image.dimensions]\n  );\n\n  // const atNewPixel = useCallback((newPos: ImageCoordinates): boolean => {\n  //   if (!mousePos) return false;\n  //   const prevImgCoord = getImageCoord(mousePos);\n  //   if (!prevImgCoord) return false;\n  //   const prevPixel = {\n  //     x: imagePosition.x + prevImgCoord.x * scale,\n  //     y: imagePosition.y + prevImgCoord.y * scale\n  //   }\n\n  //   if (prevPixel.x === newPos.x && prevPixel.y === newPos.y) {\n  //     return false;\n  //   }\n  //   return true;\n  // }, [mousePos, getImageCoord, imagePosition, scale]);\n\n  const fillPixel = useCallback(\n    (pos: ImageCoordinates | undefined, color: Color): void => {\n      if (!pos) return;\n      if (!canvasRef.current) return;\n      const context = canvasRef.current.getContext(\"2d\");\n      if (!context) return;\n\n      image.setPixelColor(pos, color);\n      drawImageOnCanvas();\n    },\n    [drawImageOnCanvas, image]\n  );\n\n  const bucketFill = useCallback(\n    (pos: ImageCoordinates | undefined, newColor: Color): void => {\n      // BFS fill\n      if (!pos) return;\n      const color = image.getPixelColorAt(pos);\n      if (color.isEqual(newColor)) return;\n      image.setPixelColor(pos, newColor);\n      console.log(color);\n      let queue = new Array<ImageCoordinates>(pos);\n      let explored = new Array<ImageCoordinates>(pos);\n      while (queue[0] !== undefined) {\n        let curr = queue.shift() as ImageCoordinates;\n        let edges = new Array<ImageCoordinates>(0);\n        // add edges\n        if (curr.y > 0) {\n          edges.push({ x: curr.x, y: curr.y - 1 });\n        }\n        if (curr.y < image.dimensions.height - 1) {\n          edges.push({ x: curr.x, y: curr.y + 1 });\n        }\n        if (curr.x > 0) {\n          edges.push({ x: curr.x - 1, y: curr.y });\n        }\n        if (curr.x < image.dimensions.width - 1) {\n          edges.push({ x: curr.x + 1, y: curr.y });\n        }\n        ///\n        edges\n          .filter((n) => !explored.includes(n))\n          .forEach((n) => {\n            explored.push(n);\n            if (image.getPixelColorAt(n).isEqual(color)) {\n              queue.push(n);\n              image.setPixelColor(n, newColor);\n            }\n          });\n      }\n\n      drawImageOnCanvas();\n    },\n    [image, drawImageOnCanvas]\n  );\n\n  // const rectangle = useCallback((): void => {\n  //   if (!endingPos) return;\n  //   if (!canvasRef.current) return;\n  //   const context = canvasRef.current.getContext('2d');\n  //   if (!context) return;\n  //   // drawImageOnCanvas();\n  //   const color = palette[selectedPaletteIndex];\n  //   const colorString = `rgb(${color.r}, ${color.g}, ${color.b}, ${color.a})`;\n  //   context.fillStyle = colorString;\n  //   context.lineWidth = 1;\n  //   context.rect(\n  //     startPos.x, startPos.y,\n  //     endingPos.x - startPos.x, endingPos.y - startPos.y);\n  //   context.fill();\n  // }, [startPos, endingPos, palette, selectedPaletteIndex]);\n\n  const startPaint = useCallback(\n    (e: MouseEvent) => {\n      const mousePosition = getMousePos(e);\n      if (!mousePosition) return;\n      setMousePos(mousePosition);\n      const imageCoord = getImageCoord(mousePosition);\n      if (!canvasRef.current) return;\n      const context = canvasRef.current.getContext(\"2d\");\n      if (!context) return;\n      // if (!imageCoord) return;\n      switch (settings.currentTool) {\n        case Tool.PENCIL:\n          setIsPainting(true);\n          fillPixel(imageCoord, palette[selectedPaletteIndex]);\n          break;\n        case Tool.BUCKET:\n          bucketFill(imageCoord, palette[selectedPaletteIndex]);\n          break;\n        case Tool.SQUARE:\n          if (!imageCoord) return;\n          const startingPos = imageCoord;\n          setStartPos(startingPos);\n          setIsPainting(true);\n          break;\n        case Tool.ELLIPSE:\n          if (!imageCoord) return;\n          setStartPos(imageCoord);\n          setIsPainting(true);\n          break;\n        case Tool.PAN:\n          setIsPainting(true);\n          break;\n        case Tool.DROPPER:\n          if (!imageCoord) return;\n          const color = image.getPixelColorAt(imageCoord);\n          onChangeColor(color);\n          break;\n      }\n    },\n    [\n      image,\n      onChangeColor,\n      settings.currentTool,\n      bucketFill,\n      fillPixel,\n      getImageCoord,\n      palette,\n      selectedPaletteIndex,\n    ]\n  );\n\n  const paint = useCallback(\n    (e: MouseEvent) => {\n      const newMousePos = getMousePos(e);\n      if (!newMousePos) return;\n      const imageCoord = getImageCoord(newMousePos);\n      switch (settings.currentTool) {\n        case Tool.PENCIL:\n          if (isPainting) {\n            fillPixel(imageCoord, palette[selectedPaletteIndex]);\n            setMousePos(newMousePos);\n          }\n          break;\n        case Tool.SQUARE:\n          if (isPainting) {\n            if (!imageCoord) return;\n            const endingPos = imageCoord;\n            setEndingPos(endingPos);\n          }\n          break;\n        case Tool.ELLIPSE:\n          if (isPainting) {\n            if (!imageCoord) return;\n            const endingPos = imageCoord;\n            setEndingPos(endingPos);\n          }\n          break;\n        case Tool.PAN:\n          if (isPainting && mousePos) {\n            const newImagePosition = {\n              x: imagePosition.x + (newMousePos.x - mousePos.x),\n              y: imagePosition.y + (newMousePos.y - mousePos.y),\n            };\n            setImagePosition(newImagePosition);\n            setMousePos(newMousePos);\n          }\n          break;\n      }\n    },\n    [\n      isPainting,\n      fillPixel,\n      getImageCoord,\n      palette,\n      selectedPaletteIndex,\n      imagePosition,\n      mousePos,\n      settings.currentTool,\n    ]\n  );\n\n  const stopPaint = useCallback(() => {\n    setMousePos(undefined);\n    setIsPainting(false);\n    if (settings.currentTool === Tool.SQUARE) {\n      if (!endingPos) return;\n      let s = startPos;\n      let e = endingPos;\n      if (e.x < s.x) {\n        let temp = s.x;\n        s = { x: e.x, y: s.y };\n        e = { x: temp, y: e.y };\n      }\n      if (e.y < s.y) {\n        let temp = s.y;\n        s = { x: s.x, y: e.y };\n        e = { x: e.x, y: temp };\n      }\n      for (let i = s.y; i <= e.y; i++) {\n        for (let j = s.x; j <= e.x; j++) {\n          let pos: ImageCoordinates = { x: j, y: i };\n          image.setPixelColor(pos, palette[selectedPaletteIndex]);\n        }\n      }\n      drawImageOnCanvas();\n    }\n\n    if (settings.currentTool === Tool.ELLIPSE) {\n      console.log(\"drawing ellipse\");\n      if (!endingPos) return;\n      let s = startPos;\n      let e = endingPos;\n      if (e.x < s.x) {\n        let temp = s.x;\n        s = { x: e.x, y: s.y };\n        e = { x: temp, y: e.y };\n      }\n      if (e.y < s.y) {\n        let temp = s.y;\n        s = { x: s.x, y: e.y };\n        e = { x: e.x, y: temp };\n      }\n      let center = {\n        x: (s.x + e.x) / 2,\n        y: (s.y + e.y) / 2\n      };\n      // let center = startPos;\n      let a = Math.abs(e.x - center.x);\n      let b = Math.abs(e.y - center.y);\n      // let s = { x: center.x - a, y: center.y - b };\n      // let e = { x: center.x + a, y: center.y + b };\n      for (let i = s.y; i <= e.y; i++) {\n        for (let j = s.x; j <= e.x; j++) {\n          let point = { x: j, y: i };\n          console.log(point);\n          // solve for equation of ellipse to check if inside or on ellipse\n          let l = Math.pow(point.x - center.x, 2) / Math.pow(a, 2);\n          let r = Math.pow(point.y - center.y, 2) / Math.pow(b, 2);\n          console.log(l + r);\n          let isInside: boolean = l + r <= 1;\n          if (isInside) {\n            image.setPixelColor(point, palette[selectedPaletteIndex]);\n          }\n        }\n      }\n      drawImageOnCanvas();\n    }\n    setEndingPos(undefined);\n    onChangeImage(image);\n  }, [\n    settings.currentTool,\n    startPos,\n    endingPos,\n    drawImageOnCanvas,\n    image,\n    palette,\n    selectedPaletteIndex,\n    onChangeImage,\n  ]);\n\n  const mouseLeave = useCallback(() => {\n    setMousePos(undefined);\n    setIsPainting(false);\n  }, []);\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    canvas.addEventListener(\"mousedown\", startPaint);\n    return () => canvas.removeEventListener(\"mousedown\", startPaint);\n  }, [startPaint]);\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    canvas.addEventListener(\"mousemove\", paint);\n    return () => {\n      canvas.removeEventListener(\"mousemove\", paint);\n    };\n  }, [paint]);\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    canvas.addEventListener(\"mouseup\", stopPaint);\n    canvas.addEventListener(\"mouseleave\", mouseLeave);\n    return () => {\n      canvas.removeEventListener(\"mouseup\", stopPaint);\n      canvas.removeEventListener(\"mouseleave\", mouseLeave);\n    };\n  }, [stopPaint, mouseLeave]);\n\n  /////////////////////////////////////////////////////////////////////////////\n\n  return (\n    <canvas\n      ref={canvasRef}\n      className={generateEditorCanvasProps(settings.currentTool)}\n    />\n  );\n}\n\nconst generateEditorCanvasProps = (tool: Tool): string => {\n  const base = \"image-canvas \";\n  switch (tool) {\n    case Tool.PENCIL:\n      return base + \"pencil\";\n    case Tool.BUCKET:\n      return base + \"bucket\";\n    case Tool.SQUARE:\n      return base + \"square\";\n    case Tool.ELLIPSE:\n      return base + \"ellipse\";\n    case Tool.PAN:\n      return base + \"pan\";\n    case Tool.DROPPER:\n      return base + \"dropper\";\n  }\n  return base;\n};\n","import { useState } from \"react\";\n\nconst useModal = () => {\n  const [isShowing, setIsShowing] = useState(false);\n  const toggle = () => setIsShowing(!isShowing);\n  return { isShowing, toggle };\n};\n\nexport default useModal;\n","import React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Dimensions } from \"../../util/types\";\n\nconst MIN_IMG_SIZE = 1;\n\ninterface NewImageModalProps {\n  onAccept: (fileName: string, dimensions: Dimensions) => void;\n  isShowing: boolean;\n  hide: () => void;\n}\n\ninterface NewImageFormProps {\n  onAccept: (fileName: string, dimensions: Dimensions) => void;\n}\n\nconst NewImageModal = ({ onAccept, isShowing, hide }: NewImageModalProps) =>\n  isShowing\n    ? ReactDOM.createPortal(\n        <React.Fragment>\n          <div className=\"modal-overlay\" />\n          <div\n            className=\"modal-wrapper\"\n            aria-modal\n            aria-hidden\n            tabIndex={-1}\n            role=\"dialog\"\n          >\n            <div className=\"modal\">\n              <div className=\"modal-header\">Create a New Image</div>\n              <NewImageForm\n                onAccept={(fileName, dimensions) => {\n                  onAccept(fileName, dimensions);\n                  hide();\n                }}\n              ></NewImageForm>\n              <div className=\"modal-button-right\">\n                <button onClick={hide} className=\"modal-button\">\n                  Cancel\n                </button>\n              </div>\n            </div>\n          </div>\n        </React.Fragment>,\n        document.body\n      )\n    : null;\n\nconst NewImageForm = ({ onAccept }: NewImageFormProps) => {\n  const [fileName, setFileName] = useState<string>(\"untitled\");\n  const [height, setHeight] = useState<number>(32);\n  const [width, setWidth] = useState<number>(32);\n\n  const handleFileNameChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setFileName(e.target.value);\n\n  const handleHeightChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setHeight(parseInt(e.target.value));\n\n  const handleWidthChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setWidth(parseInt(e.target.value));\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onAccept(fileName, { height, width });\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <div className=\"modal-input-text\">\n        <label htmlFor=\"filename\" className=\"modal-label\">\n          Name:\n        </label>\n        <input\n          id=\"filename\"\n          name=\"filename\"\n          type=\"text\"\n          value={fileName}\n          onChange={handleFileNameChange}\n        />\n      </div>\n      <br />\n      <label className=\"modal-label\">Image Size</label>\n      <div className=\"modal-input-num\">\n        <label htmlFor=\"height\" className=\"modal-label-num\">\n          Height:\n        </label>\n        <input\n          id=\"height\"\n          type=\"number\"\n          min={MIN_IMG_SIZE}\n          value={height}\n          onChange={handleHeightChange}\n        />\n        <label>&nbsp;px</label>\n        <br />\n        <label htmlFor=\"width\" className=\"modal-label-num\">\n          Width:\n        </label>\n        <input\n          id=\"width\"\n          type=\"number\"\n          min={MIN_IMG_SIZE}\n          value={width}\n          onChange={handleWidthChange}\n        />\n        <label>&nbsp;px</label>\n      </div>\n      <br />\n      <div className=\"modal-button-left\">\n        <button className=\"modal-button\">OK</button>\n      </div>\n    </form>\n  );\n};\n\nexport default NewImageModal;\n","import React, { useState } from \"react\";\n\nconst MIN_QUANTIZE = 1;\nconst MAX_QUANTIZE = 256;\n\ninterface ExportButtonProps {\n  handleQuantize: (newColorDepth: number) => void;\n}\n\nfunction ExportButton({ handleQuantize }: ExportButtonProps): JSX.Element {\n  const [depth, setDepth] = useState<number>(15);\n\n  const handleClick = () => {\n    if (!depth) {\n      alert(\"Can't quantize with unspecified color depth!\");\n      return;\n    }\n    handleQuantize(depth);\n  };\n\n  return (\n    <div className=\"quantize-container\">\n      <button className=\"quantize-button\" onClick={handleClick}>\n        Quantize\n      </button>\n      <input\n        className=\"quantize-input\"\n        type=\"number\"\n        value={depth}\n        min={MIN_QUANTIZE}\n        max={MAX_QUANTIZE}\n        onChange={e => setDepth(parseInt(e.target.value))}\n      ></input>\n    </div>\n  );\n}\n\nexport default ExportButton;\n","import React, { useRef, useEffect, useCallback, useState } from \"react\";\nimport Palette, * as PaletteUtils from \"../models/Palette\";\nimport { PixelGrid } from \"../models/ImageCanvas\";\n\ninterface IPaletteDisplay {\n  palette: Palette;\n  selectedColorIndex: number;\n  onChangeSelectedColorIndex: (newIndex: number) => void;\n}\n\ninterface MousePos {\n  x: number;\n  y: number;\n}\n\n// This size is defined the same in app.scss\nconst PALETTE_CANVAS_SIZE = {\n  height: 192,\n  width: 192\n};\n\nconst SCALE = PALETTE_CANVAS_SIZE.height / 16;\n\nconst INDEX_TO_X = (index: number) => index % 16;\nconst INDEX_TO_Y = (index: number) => Math.floor(index / 16);\nconst XY_TO_INDEX = ({ x, y }: { x: number; y: number }) => y * 16 + x;\nconst MOUSE_POS_TO_XY = ({ x, y }: { x: number; y: number }) => ({\n  x: Math.floor(x / SCALE),\n  y: Math.floor(y / SCALE)\n});\nconst MOUSE_POS_TO_INDEX = (pos: { x: number; y: number }) =>\n  XY_TO_INDEX(MOUSE_POS_TO_XY(pos));\n\nfunction PaletteDisplay({\n  palette,\n  selectedColorIndex,\n  onChangeSelectedColorIndex\n}: IPaletteDisplay): JSX.Element {\n  const [paletteHiddenCanvas, setPaletteHiddenCanvas] = useState<\n    HTMLCanvasElement\n  >();\n  const [pixelGrid, setPixelGrid] = useState<PixelGrid>();\n\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  /**\n   * method to draw the palette grid\n   */\n  const drawGrid = useCallback(() => {\n    if (!canvasRef.current || !pixelGrid) return;\n    const context = canvasRef.current.getContext(\"2d\");\n    if (!context) return;\n    context.drawImage(\n      pixelGrid.canvasElement,\n      0,\n      0,\n      PALETTE_CANVAS_SIZE.width * window.devicePixelRatio,\n      PALETTE_CANVAS_SIZE.height * window.devicePixelRatio\n    );\n  }, [pixelGrid]);\n\n  /**\n   * method to populate the palette with colors\n   * fills palette index with proper color using palette colorArray\n   */\n  const drawPalette = useCallback(() => {\n    if (!canvasRef.current || !paletteHiddenCanvas) return;\n    const context = canvasRef.current.getContext(\"2d\");\n    if (!context) return;\n    PaletteUtils.drawPaletteToHiddenCanvas(palette, paletteHiddenCanvas);\n    context.drawImage(\n      paletteHiddenCanvas,\n      0,\n      0,\n      PALETTE_CANVAS_SIZE.width * window.devicePixelRatio,\n      PALETTE_CANVAS_SIZE.height * window.devicePixelRatio\n    );\n  }, [palette, paletteHiddenCanvas]);\n\n  /**\n   * Draws a box around the selected color in the palette view.\n   */\n  const drawSelectedColorHighlight = useCallback(\n    (index: number) => {\n      if (!canvasRef.current) return;\n      let context = canvasRef.current.getContext(\"2d\");\n      if (!context) return;\n      context.beginPath();\n      context.strokeStyle = \"rgba(255, 255, 0, 1)\";\n      context.lineWidth = 2;\n      const ratio = window.devicePixelRatio * SCALE;\n      context.rect(\n        INDEX_TO_X(index) * ratio,\n        INDEX_TO_Y(index) * ratio,\n        ratio,\n        ratio\n      );\n      context.stroke();\n    },\n    [canvasRef]\n  );\n\n  /**\n   * gets mouse position on the palette canvas\n   * @param e MouseEvent\n   */\n  const getMousePos = (e: React.MouseEvent): MousePos => {\n    if (canvasRef.current) {\n      const rect = canvasRef.current.getBoundingClientRect();\n      return {\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top\n      };\n    }\n    return {\n      x: -1,\n      y: -1\n    };\n  };\n\n  /**\n   * handles mouse click event\n   * selects the proper row on the palette\n   * @param e MouseEvent\n   */\n  const handleClick = (e: React.MouseEvent): void => {\n    onChangeSelectedColorIndex(MOUSE_POS_TO_INDEX(getMousePos(e)));\n  };\n\n  /**\n   * Set up the canvas\n   */\n  useEffect(() => {\n    console.log(\"Setting up palette canvas\");\n    const setupCanvasSize = (canvas: HTMLCanvasElement) => {\n      const devicePixelRatio = window.devicePixelRatio || 1;\n      canvas.width = canvas.clientWidth * devicePixelRatio;\n      canvas.height = canvas.clientHeight * devicePixelRatio;\n      const context = canvas.getContext(\"2d\");\n      if (context) context.imageSmoothingEnabled = false;\n    };\n    if (canvasRef.current) {\n      setupCanvasSize(canvasRef.current);\n    }\n    const {\n      pixelGrid,\n      hiddenCanvas\n    } = PaletteUtils.PaletteDrawablesGenerator();\n    setPaletteHiddenCanvas(hiddenCanvas);\n    setPixelGrid(pixelGrid);\n  }, []);\n\n  /**\n   * Draw the palette every time something changes\n   */\n  useEffect(() => {\n    drawPalette();\n    drawGrid();\n    drawSelectedColorHighlight(selectedColorIndex);\n  }, [selectedColorIndex, drawPalette, drawGrid, drawSelectedColorHighlight]);\n\n  return (\n    <canvas ref={canvasRef} onClick={handleClick} className=\"palette-canvas\" />\n  );\n}\n\nexport default PaletteDisplay;\n","import React from \"react\";\nimport Color from \"../models/Color\";\nimport Palette from \"../models/Palette\";\nimport { EditorSettings } from \"../util/types\";\nimport QuantizeButton from \"./buttons/QuantizeButton\";\nimport PaletteDisplay from \"./PaletteDisplay\";\n\ninterface PalettePanelProps {\n  palette: Palette;\n  selectedColorIndex: number;\n  updatePalette: (newPalette: Palette) => void;\n  onChangeSelectedColorIndex: (newIndex: number) => void;\n  onChangeColor: (newColor: Color) => void;\n  handleQuantize: (newColorDepth: number) => void;\n  settings: EditorSettings;\n  onSettingsChange: (newSettings: EditorSettings) => void;\n}\n\nexport default function PalettePanel({\n  palette,\n  selectedColorIndex,\n  onChangeSelectedColorIndex,\n  onChangeColor,\n  handleQuantize,\n  settings,\n  onSettingsChange\n}: PalettePanelProps): JSX.Element {\n  return (\n    <div>\n      <div className=\"panel-header-top\">Palette</div>\n      <div className=\"palette-container\">\n        <PaletteDisplay\n          palette={palette}\n          selectedColorIndex={selectedColorIndex}\n          onChangeSelectedColorIndex={onChangeSelectedColorIndex}\n        />\n      </div>\n      <ColorInput\n        currentColor={palette[selectedColorIndex]}\n        onChangeColor={onChangeColor}\n      ></ColorInput>\n      <QuantizeButton handleQuantize={handleQuantize} />\n      <div className=\"panel-header\">Properties</div>\n      <div className=\"settings-container\">\n        <div>\n          Mode: &nbsp; {settings.editorMode}\n          <br />\n          Type: &nbsp; {settings.editorMode.toString()}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nconst MIN_COLOR_VAL = \"0\";\nconst MAX_COLOR_VAL = \"31\";\n\nconst color256to32 = (color: Color): Color => {\n  const r = Math.ceil((color.r + 1) / 8) - 1;\n  const g = Math.ceil((color.g + 1) / 8) - 1;\n  const b = Math.ceil((color.b + 1) / 8) - 1;\n\n  return new Color(r, g, b, 1);\n};\n\nconst color32to256 = (color: Color): Color => {\n  const r = (color.r + 1) * 8 - 1;\n  const g = (color.g + 1) * 8 - 1;\n  const b = (color.b + 1) * 8 - 1;\n\n  return new Color(r, g, b, 1);\n};\n\ninterface ColorInputProps {\n  currentColor: Color;\n  onChangeColor: (newColor: Color) => void;\n}\n\nfunction ColorInput({\n  currentColor,\n  onChangeColor\n}: ColorInputProps): JSX.Element {\n  // const [color, setColor] = useState<Color>(Color256to32(currentColor));\n\n  /**\n   * When we select a new color from props, we should update which color is being inspected\n   */\n  // useEffect(() => {\n  //   setColor(Color256to32(currentColor));\n  // }, [currentColor]);\n\n  // useEffect(() => {\n  //   onChangeColor(Color32to256(color));\n  // }, [color, onChangeColor]);\n\n  const color32 = color256to32(currentColor);\n\n  const handleRChange = (newRValue: number) => {\n    color32.r = newRValue;\n    const color256 = color32to256(color32);\n    onChangeColor(color256);\n  };\n\n  const handleGChange = (newGValue: number) => {\n    color32.g = newGValue;\n    const color256 = color32to256(color32);\n    onChangeColor(color256);\n  };\n\n  const handleBChange = (newBValue: number) => {\n    color32.b = newBValue;\n    const color256 = color32to256(color32);\n    onChangeColor(color256);\n  };\n\n  return (\n    <div className=\"rgb-container\">\n      <label className=\"rgb-label\">R</label>\n      <input\n        className=\"rgb-input\"\n        type=\"number\"\n        max={MAX_COLOR_VAL}\n        min={MIN_COLOR_VAL}\n        value={color32.r}\n        onChange={e => handleRChange(parseInt(e.target.value))}\n      ></input>\n      <label className=\"rgb-label\">G</label>\n      <input\n        className=\"rgb-input\"\n        type=\"number\"\n        max={MAX_COLOR_VAL}\n        min={MIN_COLOR_VAL}\n        value={color32.g}\n        onChange={e => handleGChange(parseInt(e.target.value))}\n      ></input>\n      <label className=\"rgb-label\">B</label>\n      <input\n        className=\"rgb-input\"\n        type=\"number\"\n        max={MAX_COLOR_VAL}\n        min={MIN_COLOR_VAL}\n        value={color32.b}\n        onChange={e => handleBChange(parseInt(e.target.value))}\n      ></input>\n    </div>\n  );\n}\n","import React, { useState } from \"react\";\nimport Sprite from \"../models/Sprite\";\nimport { ImageCoordinates, SpriteDimensions } from \"../util/types\";\n\ninterface SpritePanelProps {\n  onAddSprite: (\n    position: ImageCoordinates,\n    dimensions: SpriteDimensions\n  ) => void;\n  onRemoveSprite: (i: number) => void;\n  onUpdatePaletteRow: () => void;\n  sprites: Sprite[];\n}\n\nexport default function SpritePanel({\n  sprites,\n  onAddSprite,\n  onRemoveSprite,\n  onUpdatePaletteRow,\n}: SpritePanelProps) {\n  const handleChangePaletteRow = (s: Sprite, n: number) => {\n    s.paletteRow = n;\n    onUpdatePaletteRow();\n  };\n  const renderSpriteList = (sprites: Sprite[]) =>\n    sprites.map((s, i) => (\n      <SpriteListItem\n        sprite={s}\n        i={i}\n        onRemoveSprite={onRemoveSprite.bind(null, i)}\n        onChangePaletteRow={handleChangePaletteRow.bind(null, s)}\n      />\n    ));\n\n  return (\n    <div>\n      <div className=\"spritepanel-header\">Sprites</div>\n      <div className=\"spritepanel-container\">\n        <NewSpriteForm onAddSprite={onAddSprite}></NewSpriteForm>\n        {renderSpriteList(sprites)}\n      </div>\n    </div>\n  );\n}\n\ninterface SpriteListItemProps {\n  sprite: Sprite;\n  i: number;\n  onRemoveSprite: () => void;\n  onChangePaletteRow: (newPaletteRow: number) => void;\n}\n\nfunction SpriteListItem({\n  sprite,\n  i,\n  onRemoveSprite,\n  onChangePaletteRow,\n}: SpriteListItemProps) {\n  const [paletteRow, setPaletteRow] = useState<number>(sprite.paletteRow);\n  const handleChangePaletteRow = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.value) return;\n    const newRow = parseInt(e.target.value);\n    if (newRow >= 0 && newRow <= 15) {\n      setPaletteRow(newRow);\n      onChangePaletteRow(newRow);\n    }\n  };\n  return (\n    <div key={i}>\n      <strong>Sprite {i}: </strong>\n      p:({sprite.position.x}, {sprite.position.y}), d:({sprite.dimensions.width}\n      , {sprite.dimensions.height})<button onClick={onRemoveSprite}>X</button>\n      <label>Row</label>\n      <input\n        type=\"number\"\n        min={0}\n        max={15}\n        value={paletteRow}\n        onChange={handleChangePaletteRow}\n      ></input>\n    </div>\n  );\n}\n\ninterface NewSpriteFormProps {\n  onAddSprite: (\n    position: ImageCoordinates,\n    dimensions: SpriteDimensions\n  ) => void;\n}\n\nfunction NewSpriteForm({ onAddSprite }: NewSpriteFormProps) {\n  // In terms of PIXELS\n  const [dimensions, setDimensions] = useState<SpriteDimensions>({\n    height: 8,\n    width: 8,\n  });\n  // In terms of TILES\n  const [position, setPosition] = useState<ImageCoordinates>({ x: 0, y: 0 });\n\n  const handleSpriteHeightChange = (\n    e: React.ChangeEvent<HTMLSelectElement>\n  ) => {\n    setDimensions({\n      height: parseInt(e.target.value),\n      width: dimensions.width,\n    } as SpriteDimensions);\n  };\n\n  const handleSpriteWidthChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    setDimensions({\n      width: parseInt(e.target.value),\n      height: dimensions.height,\n    } as SpriteDimensions);\n  };\n\n  const handlePosXChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setPosition({\n      x: parseInt(e.target.value),\n      y: position.y,\n    });\n  };\n\n  const handlePosYChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setPosition({\n      y: parseInt(e.target.value),\n      x: position.x,\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onAddSprite(position, dimensions);\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <div className=\"spritepanel-label\">Dimensions</div>\n      <div className=\"sprite-input-container\">\n        <label htmlFor=\"sprite-height\" className=\"spritepanel-label-num\">Height: </label>\n        <select\n          className=\"sprite-select\"\n          id=\"sprite-height\"\n          name=\"sprite-height\"\n          value={dimensions.height}\n          onChange={handleSpriteHeightChange}\n        >\n          <option value={8}>8</option>\n          <option value={16}>16</option>\n          <option value={32}>32</option>\n          <option value={64}>64</option>\n        </select>\n        <br />\n        <label htmlFor=\"sprite-width\" className=\"spritepanel-label-num\">Width: </label>\n        <select\n          className=\"sprite-select\"\n          id=\"sprite-width\"\n          name=\"sprite-width\"\n          value={dimensions.width}\n          onChange={handleSpriteWidthChange}\n        >\n          <option value={8}>8</option>\n          <option value={16}>16</option>\n          <option value={32}>32</option>\n          <option value={64}>64</option>\n        </select>\n      </div>\n      {/* <br /> */}\n      <div className=\"spritepanel-label\">Position</div>\n      <div className=\"sprite-input-container\">\n        <label htmlFor=\"sprite-pos-x\" className=\"spritepanel-label-pos\">X: </label>\n        <input\n          className=\"sprite-input\"\n          id=\"sprite-pos-x\"\n          name=\"sprite-pos-x\"\n          type=\"number\"\n          min={0}\n          max={31}\n          value={position.x}\n          onChange={handlePosXChange}\n        ></input>\n        <label htmlFor=\"sprite-pos-y\" className=\"spritepanel-label-pos\">Y: </label>\n        <input\n          className=\"sprite-input\"\n          id=\"sprite-pos-y\"\n          name=\"sprite-pos-y\"\n          type=\"number\"\n          min={0}\n          max={31}\n          value={position.y}\n          onChange={handlePosYChange}\n        ></input>\n      </div>\n      {/* <br /> */}\n      <button className=\"sprite-button\">Add Sprite</button>\n    </form>\n  );\n}\n","import React, { PropsWithChildren } from \"react\";\n\ntype ToggleProps = {\n  state: boolean;\n  onClick: (newState: boolean) => void;\n};\n\nexport default function Toggle({\n  state,\n  onClick,\n  children\n}: PropsWithChildren<ToggleProps>): JSX.Element {\n  return (\n    <button\n      className={state ? \"toggle-on\" : \"toggle-off\"}\n      onClick={() => onClick(!state)}\n    >\n      {children}\n    </button>\n  );\n}\n","import React from \"react\";\nimport { EditorSettings } from \"../util/types\";\nimport {\n  faBorderAll,\n  faPen,\n  faFillDrip,\n  faSearchPlus,\n  faEyeDropper,\n  faLayerGroup,\n  faCode,\n  faPlusSquare,\n  faFileImage\n} from \"@fortawesome/free-solid-svg-icons\";\nimport {\n  faCircle,\n  faSquare,\n  faHandPaper\n} from \"@fortawesome/free-regular-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { Tool } from \"../util/consts\";\nimport Toggle from \"./buttons/Toggle\";\n\ntype ToolsPanelProps = {\n  settings: EditorSettings;\n  onSettingsChange: (newSettings: EditorSettings) => void;\n  onToolChange: (newTool: Tool) => void;\n};\n\nexport default function ToolsPanel({\n  settings,\n  onSettingsChange,\n  onToolChange\n}: ToolsPanelProps) {\n  return (\n    <div>\n      <div className=\"panel-header-top\">Tools</div>\n      <span title=\"Draw Tool\">\n        <Toggle\n          state={settings.currentTool === Tool.PENCIL}\n          onClick={() => onToolChange(Tool.PENCIL)}\n        >\n          <FontAwesomeIcon icon={faPen} />\n        </Toggle>\n      </span>\n      <span title=\"Color Fill\">\n        <Toggle\n          state={settings.currentTool === Tool.BUCKET}\n          onClick={() => onToolChange(Tool.BUCKET)}\n        >\n          <FontAwesomeIcon icon={faFillDrip} />\n        </Toggle>\n      </span>\n    <span title=\"Draw Rectangle\">\n      <Toggle\n        state={settings.currentTool === Tool.SQUARE}\n        onClick={() => onToolChange(Tool.SQUARE)}\n      >\n        <FontAwesomeIcon icon={faSquare} />\n        </Toggle>\n      </span>\n      <span title=\"Draw Ellipse\">\n        <Toggle\n          state={settings.currentTool === Tool.ELLIPSE}\n          onClick={() => onToolChange(Tool.ELLIPSE)}\n        >\n          <FontAwesomeIcon icon={faCircle} />\n        </Toggle>\n      </span>\n      <span title=\"Zoom Tool\">\n        <Toggle\n          state={settings.currentTool === Tool.ZOOM}\n          onClick={() => onToolChange(Tool.ZOOM)}\n        >\n          <FontAwesomeIcon icon={faSearchPlus} />\n        </Toggle>\n      </span>\n      <span title=\"Pan Tool\">\n        <Toggle\n          state={settings.currentTool === Tool.PAN}\n          onClick={() => onToolChange(Tool.PAN)}\n        >\n          <FontAwesomeIcon icon={faHandPaper} />\n        </Toggle>\n      </span>\n      <span title=\"Color Picker\">\n        <Toggle\n          state={settings.currentTool === Tool.DROPPER}\n          onClick={() => onToolChange(Tool.DROPPER)}\n        >\n          <FontAwesomeIcon icon={faEyeDropper} />\n        </Toggle>\n      </span>\n      <span title=\"New Layer\">\n        <Toggle\n          state={settings.currentTool === Tool.LAYER}\n          onClick={() => onToolChange(Tool.LAYER)}\n        >\n          <FontAwesomeIcon icon={faPlusSquare} />\n        </Toggle>\n      </span>\n      <div className=\"panel-header\">View</div>\n      <span title=\"Gridlines\">\n        <Toggle\n          state={settings.grid}\n          onClick={() => {\n            let newSettings = { ...settings };\n            newSettings.grid = !settings.grid;\n            onSettingsChange(newSettings);\n          }}\n        >\n          <FontAwesomeIcon icon={faBorderAll} />\n        </Toggle>\n      </span>\n      <span title=\"Layers\">\n        <Toggle state={false} onClick={() => null}>\n          <FontAwesomeIcon icon={faLayerGroup} />\n        </Toggle>\n      </span>\n      <span title=\"Image Preview\">\n        <Toggle state={false} onClick={() => null}>\n          <FontAwesomeIcon icon={faFileImage} />\n        </Toggle>\n      </span>\n      <span title=\"Code Panel\">\n        <Toggle state={false} onClick={() => null}>\n          <FontAwesomeIcon icon={faCode} />\n        </Toggle>\n      </span>\n    </div>\n  );\n}\n","import Color from \"../models/Color\";\nimport { saveAs } from \"file-saver\";\nimport React, { useCallback, useEffect, useReducer, useState } from \"react\";\nimport Bitmap3 from \"../models/Bitmap3\";\nimport Bitmap4 from \"../models/Bitmap4\";\nimport Palette, { paletteIndexToCol } from \"../models/Palette\";\nimport Spritesheet4 from \"../models/Spritesheet4\";\nimport { DEFAULT_SETTINGS, STORAGE, Tool } from \"../util/consts\";\nimport DEFAULT_PALETTE from \"../util/defaultPalette\";\nimport { exportImage, exportPalette } from \"../util/exportUtils\";\nimport { loadNewImage, loadNewPalette } from \"../util/fileLoadUtils\";\nimport { quantize } from \"../util/quantize\";\nimport {\n  Dimensions,\n  EditorMode,\n  EditorSettings,\n  ImageCoordinates,\n  ImageDataStore,\n  ImageInterface,\n  Mode,\n  SpriteDimensions,\n  SpritesheetDataStore,\n} from \"../util/types\";\nimport ExportButton from \"./buttons/ExportButton\";\nimport ImportButton from \"./buttons/ImportButton\";\nimport Dropdown from \"./Dropdown\";\nimport EditorCanvas from \"./EditorCanvas\";\nimport useModal from \"./hooks/useModal\";\nimport NewImageModal from \"./modals/NewImageModal\";\nimport PalettePanel from \"./PalettePanel\";\nimport SpritePanel from \"./SpritePanel\";\nimport ToolsPanel from \"./ToolsPanel\";\n\nfunction scaleReducer(state: number, e: WheelEvent) {\n  const direction = e.deltaY < 0 ? -1 : 1;\n  if (direction === 1) {\n    return state * 1.1;\n  } else {\n    return state / 1.1;\n  }\n}\n\nfunction App(): JSX.Element {\n  const [image, setImage] = useState<ImageInterface>();\n  const [palette, setPalette] = useState<Palette>(DEFAULT_PALETTE);\n  const [selectedColorIndex, setSelectedColorIndex] = useState<number>(0);\n  const [editorSettings, setEditorSettings] = useState<EditorSettings>({\n    grid: true,\n    currentTool: Tool.PENCIL,\n    imageMode: 3,\n    editorMode: EditorMode.Bitmap,\n  });\n\n  const [, updateState] = React.useState();\n  const forceUpdate = useCallback(() => updateState({}), []);\n\n  /**\n   * The undo stack will hold stringified ImageDataStore objects ONLY. They will\n   * be decoded on undo.\n   */\n  const [undoStack, setUndoStack] = useState<Array<string>>([]);\n  const [undoPointer, setUndoPointer] = useState<number>(-1);\n\n  const {\n    isShowing: isMode3BitmapModalShowing,\n    toggle: toggleMode3BitmpModal,\n  } = useModal();\n  const {\n    isShowing: isMode4BitmapModalShowing,\n    toggle: toggleMode4BitmpModal,\n  } = useModal();\n\n  const [scale, scaleDispatch] = useReducer(scaleReducer, 8);\n  const handleMouseWheelEvent = useCallback((e) => scaleDispatch(e), []);\n\n  const handleFileInputChange = (\n    type: \"Image\" | \"Palette\",\n    element: HTMLInputElement | null,\n    event: React.FormEvent<HTMLInputElement>\n  ): void => {\n    event.preventDefault();\n    if (!element || !element.files) return;\n    switch (type) {\n      case \"Image\":\n        handleImageLoad(element.files[0]);\n        break;\n      case \"Palette\":\n        handlePaletteLoad(element.files[0]);\n        break;\n    }\n  };\n\n  const handleImageLoad = async (imageFile: File | null) => {\n    if (imageFile) {\n      console.log(\"Loading image from file...\");\n      let image = await loadNewImage(imageFile);\n      resetUndo();\n      handleImageChange(image);\n    }\n  };\n\n  const handleImageChange = (newImage: ImageInterface) => {\n    let store: string;\n    if (newImage instanceof Spritesheet4) {\n      store = JSON.stringify(newImage.spritesheetDataStore);\n    } else {\n      store = JSON.stringify(newImage.imageDataStore);\n    }\n    window.localStorage.setItem(STORAGE.imageData, store);\n    pushUndoStack(store);\n    setImage(newImage);\n  };\n\n  const handleAddSprite = (\n    position: ImageCoordinates,\n    dimensions: SpriteDimensions,\n    paletteRow = 0\n  ) => {\n    let spritesheet = image as Spritesheet4;\n    spritesheet.addSprite(position, dimensions);\n    handleImageChange(spritesheet);\n    forceUpdate();\n    console.log(\"Adding sprite\");\n  };\n\n  const handleRemoveSprite = (image: ImageInterface | undefined, i: number) => {\n    if (image && image instanceof Spritesheet4) {\n      (image as Spritesheet4).removeSprite(i);\n    }\n    forceUpdate();\n  };\n\n  const pushUndoStack = (imageDataStoreString: string) => {\n    let newStack = undoStack.slice(0, undoPointer + 1);\n    newStack.push(imageDataStoreString);\n    setUndoStack(newStack);\n    setUndoPointer(newStack.length - 1);\n  };\n\n  const handleUndo = useCallback(() => {\n    console.log(\"trying to undo\");\n    if (image && undoPointer >= 1) {\n      if (image instanceof Spritesheet4) {\n      } else {\n      }\n      const newStoreString = undoStack[undoPointer - 1];\n      const newStore = JSON.parse(newStoreString);\n      window.localStorage.setItem(STORAGE.imageData, newStoreString);\n      image.updateFromStore(newStore);\n      setUndoPointer(undoPointer - 1);\n      setImage(image);\n    }\n  }, [undoStack, undoPointer, image]);\n\n  const handleRedo = useCallback(() => {\n    console.log(\"trying to redo\");\n    if (image && undoPointer + 1 < undoStack.length) {\n      image.updateFromStore(JSON.parse(undoStack[undoPointer + 1]));\n      setUndoPointer(undoPointer + 1);\n    }\n  }, [image, undoPointer, undoStack]);\n\n  const resetUndo = () => {\n    setUndoStack([]);\n    setUndoPointer(-1);\n  };\n\n  const handlePaletteChange = (newPalette: Palette) => {\n    window.localStorage.setItem(STORAGE.palette, JSON.stringify(newPalette));\n    setPalette(newPalette);\n  };\n\n  const handleSettingsChange = (newSettings: EditorSettings) => {\n    window.localStorage.setItem(\n      STORAGE.imageMode,\n      newSettings.imageMode.toString()\n    );\n    window.localStorage.setItem(\n      STORAGE.imageType,\n      newSettings.editorMode.toString()\n    );\n    setEditorSettings(newSettings);\n  };\n\n  const handleClearLocalStorage = () => window.localStorage.clear();\n\n  const handlePaletteLoad = async (palFile: File | null) => {\n    if (palFile) {\n      console.log(\"Loading palette from file...\");\n      let newPalette = await loadNewPalette(palFile);\n      if (newPalette) {\n        if (image instanceof Bitmap4 || image instanceof Spritesheet4) {\n          image.updatePalette(newPalette);\n        }\n        handlePaletteChange(newPalette);\n      }\n    }\n  };\n\n  const handlePaletteImport = (\n    oldPal: Palette,\n    newPal: Palette,\n    oldStartRow: number,\n    newStartRow: number,\n    numRows: number,\n    overwrite: boolean\n  ) => { };\n\n  const handleToolChange = useCallback(\n    (newTool: Tool) => {\n      handleSettingsChange({\n        grid: editorSettings.grid,\n        currentTool: newTool,\n        imageMode: editorSettings.imageMode,\n        editorMode: editorSettings.editorMode,\n      });\n    },\n    [editorSettings]\n  );\n\n  /**\n   * Call this function when initializing a new \"project\" or whatever you want\n   * to call it. You will be greeted with a blank image to work on.\n   *\n   * @param editorMode The mode to set up the editor in. Can be either bitmap,\n   * spritesheet, or background.\n   * @param imageMode The image mode to edit in. Can be any of the GBA Modes,\n   * although only 0, 3, and 4 are supported.\n   */\n  const handleNewImage = (\n    editorMode: EditorMode,\n    imageMode: Mode,\n    fileName: string,\n    dimensions: Dimensions\n  ) => {\n    if (image) {\n      let accept = window.confirm(\n        \"Are you sure you want to create a new image? You will lose all unsaved work.\"\n      );\n      if (!accept) return;\n    }\n    switch (editorMode) {\n      case EditorMode.Bitmap:\n        // Open a modal dialog to query for image filename and dimensions\n        switch (imageMode) {\n          case 3: // Set up the editor for working on a mode 3 bitmap\n            editorSettings.editorMode = EditorMode.Bitmap;\n            editorSettings.imageMode = 3;\n            handleSettingsChange(editorSettings);\n            handleImageChange(new Bitmap3(fileName, dimensions));\n            handlePaletteChange(palette);\n            return;\n          case 4: // Set up the editor for working on a mode 4 paletted bitmap\n            editorSettings.editorMode = EditorMode.Bitmap;\n            editorSettings.imageMode = 4;\n            handleSettingsChange(editorSettings);\n            handleImageChange(new Bitmap4(fileName, palette, dimensions));\n            handlePaletteChange(palette);\n            return;\n          default:\n            alert(\"Unsupported image mode!\");\n            return;\n        }\n      case EditorMode.Spritesheet:\n        editorSettings.editorMode = EditorMode.Spritesheet;\n        editorSettings.imageMode = 0;\n        handleSettingsChange(editorSettings);\n        handleImageChange(\n          new Spritesheet4(\n            \"untitled\",\n            palette,\n            paletteIndexToCol(selectedColorIndex)\n          )\n        );\n        handlePaletteChange(palette);\n        return;\n      case EditorMode.Background:\n      default:\n        alert(\"Unsupported editing mode!\");\n        return;\n    }\n  };\n\n  const handleQuantize = (newColorDepth: number): void => {\n    newColorDepth = Math.floor(newColorDepth); // just in case of a float\n    if (!(image instanceof Bitmap3)) {\n      alert(\"Requantization of paletted images currently not supported!\");\n    } else {\n      let ok = window.confirm(\n        \"Quantizing a bitmap will change it from mode 3 to mode 4. Is this okay?\"\n      );\n      if (ok) {\n        let { palette, sprite } = quantize(image, newColorDepth);\n        handleImageChange(sprite);\n        handlePaletteChange(palette);\n      }\n    }\n  };\n\n  const handleChangeSelectedColor = (newIndex: number) => {\n    setSelectedColorIndex(newIndex);\n    if (image instanceof Bitmap4 || image instanceof Spritesheet4) {\n      image.setPaletteIndex(newIndex);\n    }\n  };\n\n  const handleColorChange = (newColor: Color): void => {\n    const newPalette = palette.slice();\n    newPalette[selectedColorIndex] = newColor;\n    if (image instanceof Bitmap4 || image instanceof Spritesheet4) {\n      image.updatePalette(newPalette);\n    }\n    handlePaletteChange(newPalette);\n  };\n\n  const handleImageExport = async (type: string) => {\n    let fileName;\n    let fileType = \"\";\n    let blob: Blob | null;\n\n    if (image) {\n      fileName = image.fileName.slice(0, image.fileName.lastIndexOf(\".\"));\n    } else {\n      fileName = \"default\";\n    }\n\n    const exportFailAlert = () =>\n      alert(\"Failed to export image! Check console for more information.\");\n\n    switch (type) {\n      case \"GBA\":\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //.c file\n        fileType = \".c\";\n        let cBlob = new Blob([image.cSourceData]);\n        saveAs(cBlob, fileName + fileType);\n        //.h file\n        fileType = \".h\";\n        let hBlob = new Blob([image.headerData]);\n        saveAs(hBlob, fileName + fileType);\n        return;\n      case \"PAL\":\n        //.pal file\n        if (!palette) {\n          alert(\"Can't export a non-existant palette!\");\n          return;\n        } else {\n          fileType = \".pal\";\n          blob = new Blob([exportPalette(palette)]);\n          break;\n        }\n      case \"BMP\":\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //.bmp file\n        fileType = \".bmp\";\n        blob = await exportImage(image, type);\n        break;\n      case \"PNG\":\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //.png file\n        fileType = \".png\";\n        blob = await exportImage(image, type);\n        break;\n      default:\n        if (!image) {\n          alert(\"No image to export! Try importing one first.\");\n          return;\n        }\n        //default as .txt if unrecognized type is selected\n        fileType = \".txt\";\n        blob = await exportImage(image, type);\n    }\n    if (!blob) {\n      exportFailAlert();\n    } else {\n      saveAs(blob, fileName + fileType);\n    }\n  };\n\n  /**\n   * Set up listeners for undo and redo.\n   */\n  useEffect(() => {\n    const keydownHandler = (e: KeyboardEvent) => {\n      if (e.keyCode === 89 && e.ctrlKey) {\n      } else if (e.keyCode === 90 && e.ctrlKey && e.shiftKey) {\n        handleRedo();\n      } else if (e.keyCode === 90 && e.ctrlKey) {\n        handleUndo();\n      }\n    };\n    document.addEventListener(\"keydown\", keydownHandler);\n    return () => document.removeEventListener(\"keydown\", keydownHandler);\n  }, [handleUndo, handleRedo]);\n\n  /**\n   * Load Images from local storage.\n   */\n  useEffect(() => {\n    const alertBadFormatting = () =>\n      alert(\"Image data incorrectly formatted. Aborting load operation.\");\n    const askLoadImage = () =>\n      window.confirm(\n        \"Found automatically saved image data from your last session in storage. Would you like to load it? If not, it will be deleted.\"\n      );\n\n    const loadedImageMode = window.localStorage.getItem(STORAGE.imageMode);\n    const loadedImageType = window.localStorage.getItem(STORAGE.imageType);\n    const loadedPalette = window.localStorage.getItem(STORAGE.palette);\n    const loadedImage = window.localStorage.getItem(STORAGE.imageData);\n\n    if (loadedImageMode && loadedImageType && loadedImage) {\n      let loadImage = askLoadImage();\n\n      if (!loadImage) {\n        window.localStorage.clear();\n        return;\n      }\n\n      const parsedImageMode: Mode = parseInt(loadedImageMode) as Mode;\n      const parsedImageType: EditorMode = loadedImageType as EditorMode;\n\n      const buildPalette = (paletteString: string): Palette => {\n        interface IColor {\n          r: number, g: number, b: number, a: number\n        }\n        // The following cast is definitely unsafe.\n        let parsedPalette = JSON.parse(paletteString) as IColor[]\n        let newPalette = parsedPalette.map((c) => new Color(c.r, c.g, c.b, c.a))\n        return newPalette;\n      }\n\n      switch (parsedImageMode) {\n        case 0:\n          if (!loadedPalette) {\n            alertBadFormatting();\n            return;\n          } else {\n            const newPalette = buildPalette(loadedPalette);\n            console.log(newPalette);\n            const parsedImage = JSON.parse(loadedImage) as SpritesheetDataStore;\n            setPalette(newPalette);\n            setImage(\n              Spritesheet4.fromDataStore(\n                parsedImage,\n                newPalette,\n                0\n              )\n            );\n            let newEditorSettings = DEFAULT_SETTINGS;\n            newEditorSettings.imageMode = parsedImageMode;\n            newEditorSettings.editorMode = parsedImageType;\n            setEditorSettings(newEditorSettings);\n          }\n          break;\n        case 3:\n          const parsedImage = JSON.parse(loadedImage) as ImageDataStore;\n          setImage(Bitmap3.fromDataStore(parsedImage));\n          let newEditorSettings = DEFAULT_SETTINGS;\n          newEditorSettings.imageMode = parsedImageMode;\n          newEditorSettings.editorMode = parsedImageType;\n          setEditorSettings(newEditorSettings);\n          break;\n        case 4:\n          if (!loadedPalette) {\n            alertBadFormatting();\n            return;\n          } else {\n            const parsedImage = JSON.parse(loadedImage) as ImageDataStore;\n            const newPalette = buildPalette(loadedPalette);\n            setImage(Bitmap4.fromDataStore(parsedImage, newPalette));\n            setPalette(newPalette);\n            let newEditorSettings = DEFAULT_SETTINGS;\n            newEditorSettings.imageMode = parsedImageMode;\n            newEditorSettings.editorMode = parsedImageType;\n            setEditorSettings(newEditorSettings);\n          }\n          break;\n        default:\n          alertBadFormatting();\n      }\n    }\n  }, []);\n\n  return (\n    <div className=\"app-container\">\n      <div className=\"navbar\">\n        <span className=\"title\">VOCC</span>\n        <Dropdown label=\"New\">\n          <div className=\"dd-content-header\">Bitmap</div>\n          <button onClick={toggleMode3BitmpModal}>Mode 3</button>\n          <NewImageModal\n            isShowing={isMode3BitmapModalShowing}\n            hide={toggleMode3BitmpModal}\n            onAccept={handleNewImage.bind(null, EditorMode.Bitmap, 3)}\n          ></NewImageModal>\n          <button onClick={toggleMode4BitmpModal}>Mode 4</button>\n          <NewImageModal\n            isShowing={isMode4BitmapModalShowing}\n            hide={toggleMode4BitmpModal}\n            onAccept={handleNewImage.bind(null, EditorMode.Bitmap, 4)}\n          ></NewImageModal>\n          <div className=\"dd-divider\"></div>\n          <div className=\"dd-content-header\">Spritesheet</div>\n          <button\n            onClick={() =>\n              handleNewImage(EditorMode.Spritesheet, 0, \"untitled\", {\n                height: 256,\n                width: 256,\n              })\n            }\n          >\n            4 bpp\n          </button>\n          <div className=\"dd-divider\"></div>\n          <div className=\"dd-content-header\">Background</div>\n          <button\n            onClick={() => alert(\"Background editing not currently supported.\")}\n          >\n            Mode 0\n          </button>\n        </Dropdown>\n        <Dropdown label=\"Edit\">\n          <button onClick={() => handleUndo()}>Undo</button>\n          <button onClick={() => handleRedo()}>Redo</button>\n          <div className=\"dd-divider\"></div>\n          <button onClick={() => null}>Clear All</button>\n        </Dropdown>\n        <Dropdown label=\"Import\">\n          <div className=\"dd-content-header\">Image</div>\n          <ImportButton\n            onFileInputChange={handleFileInputChange.bind(null, \"Image\")}\n            buttonLabel=\"Image (*.png, *.bmp, *.jpg)\"\n          />\n          <div className=\"dd-divider\"></div>\n          <ImportButton\n            onFileInputChange={handleFileInputChange.bind(null, \"Palette\")}\n            buttonLabel=\"Color Palette (*.pal)\"\n          />\n        </Dropdown>\n        <Dropdown label=\"Export\">\n          <div className=\"dd-content-header\">Image</div>\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"PNG\")}\n            buttonLabel=\"PNG Image (*.png)\"\n          />\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"BMP\")}\n            buttonLabel=\"Bitmap (*.bmp)\"\n          />\n          <div className=\"dd-divider\"></div>\n          <div className=\"dd-content-header\">GBA</div>\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"GBA\")}\n            buttonLabel=\"C Source Code (*.c/.h)\"\n          />\n          <div className=\"dd-divider\"></div>\n          <ExportButton\n            startImageExport={handleImageExport.bind(null, \"PAL\")}\n            buttonLabel=\"Color Palette (*.pal)\"\n          />\n        </Dropdown>\n        <Dropdown label=\"Help\">\n          <form>\n            <button type=\"submit\" formAction=\"\" formTarget=\"\">\n              Documentation\n            </button>\n          </form>\n          <form>\n            <button\n              type=\"submit\"\n              formAction=\"https://www.coranac.com/tonc/text/\"\n              formTarget=\"_blank\"\n            >\n              GBA Graphics 101\n            </button>\n          </form>\n          <div className=\"dd-divider\"></div>\n          <form>\n            <button type=\"submit\" formAction=\"\" formTarget=\"\">\n              About VOCC\n            </button>\n          </form>\n          <div className=\"dd-divider\"></div>\n          <form>\n            <button\n              type=\"submit\"\n              formAction=\"https://github.com/lbussell/vocc\"\n              formTarget=\"_blank\"\n            >\n              View on GitHub\n            </button>\n          </form>\n          <button onClick={handleClearLocalStorage}>Clear Local Storage</button>\n        </Dropdown>\n      </div>\n      <div className=\"workspace-container\">\n        <div className=\"left-panel\">\n          <div className=\"tools-container\">\n            <ToolsPanel\n              settings={editorSettings}\n              onSettingsChange={handleSettingsChange}\n              onToolChange={handleToolChange}\n            ></ToolsPanel>\n          </div>\n          {image ? <div> Scale: {scale.toFixed(2)}x </div> : null}\n        </div>\n        <div className=\"image-container\">\n          {image ? (\n            <EditorCanvas\n              image={image}\n              settings={editorSettings}\n              palette={palette}\n              selectedPaletteIndex={selectedColorIndex}\n              scale={scale}\n              onChangeImage={handleImageChange}\n              onChangeColor={handleColorChange}\n              onMouseWheel={handleMouseWheelEvent}\n            />\n          ) : (\n              <div className=\"start-message\">\n                <em>Import an image to get started</em>\n              </div>\n            )}\n        </div>\n        <div className=\"right-panel\">\n          <PalettePanel\n            palette={palette}\n            updatePalette={handlePaletteChange}\n            selectedColorIndex={selectedColorIndex}\n            onChangeSelectedColorIndex={handleChangeSelectedColor}\n            onChangeColor={handleColorChange}\n            handleQuantize={handleQuantize}\n            settings={editorSettings}\n            onSettingsChange={handleSettingsChange}\n          />\n          {editorSettings.editorMode === EditorMode.Spritesheet ? (\n            <SpritePanel\n              onAddSprite={handleAddSprite}\n              onRemoveSprite={(i) => handleRemoveSprite(image, i)}\n              onUpdatePaletteRow={forceUpdate}\n              sprites={(image as Spritesheet4).sprites}\n            />\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\nimport \"./styles/styles.scss\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}