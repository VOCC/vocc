(this.webpackJsonpgba_vocc_ts=this.webpackJsonpgba_vocc_ts||[]).push([[0],{21:function(e,t,n){e.exports=n(33)},32:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a,i=n(0),r=n.n(i),o=n(10),s=n.n(o),l=n(3),c=n.n(l),u=n(6),d=n(1),m=n(15),w=n(4),h=n(5),f=n(11),p=n(9),g=n(19),v=n(13),b=n(14),x=function(){function e(t,n,a,i){Object(w.a)(this,e),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=t,this.g=n,this.b=a,this.a=i||1}return Object(h.a)(e,[{key:"toHexString",value:function(){return""}},{key:"toString",value:function(){return"rgba(".concat(this.r,", ").concat(this.g,", ").concat(this.b,", ").concat(this.a,")")}},{key:"isEqual",value:function(e){return e===this||this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}}]),e}();!function(e){e.Bitmap="Bitmap",e.Spritesheet="Spritesheet",e.Background="Background"}(a||(a={}));new x(0,0,0,1),new x(255,0,0,1),new x(0,255,0,1),new x(0,0,255,1);var E,y={height:16,width:16},C=y.height*y.width;!function(e){e[e.PENCIL=0]="PENCIL",e[e.BUCKET=1]="BUCKET",e[e.SQUARE=2]="SQUARE",e[e.ELLIPSE=3]="ELLIPSE",e[e.ZOOM=4]="ZOOM",e[e.PAN=5]="PAN",e[e.DROPPER=6]="DROPPER",e[e.LAYER=7]="LAYER"}(E||(E={}));var S,k="imageData",N="palette",O="imageMode",P="imageType",_={grid:!0,currentTool:E.PENCIL,imageMode:3,editorMode:a.Bitmap};function I(e,t,n){switch(t){case 3:return j(e);case 4:return function(e,t){if(!t)return console.error("Tried to generate mode 4 header string with no palette! Falling back to mode 3..."),j(e);for(var n=e.imageDataStore,a=n.fileName,i=n.dimensions,r=n.imageData,o=a.slice(0,a.lastIndexOf(".")),s=i.height*i.width,l="const unsigned short ".concat(o,"Bitmap[").concat(s/2,"]__attribute__((aligned(4)))=\n{\n"),c="",u=0;u<r.length;u+=2)c+=R(r[u],r[u+1]),(u/2+1)%8===0&&(c+="\n");var d=M(t);return l+c+"};\n\n"+d}(e,n);default:return j(e)}}function j(e){for(var t=e.imageDataStore,n=t.fileName,a=t.dimensions,i=t.imageData,r=n.slice(0,n.lastIndexOf(".")),o=a.height*a.width,s="const unsigned short ".concat(r,"Bitmap[").concat(o/2,"]__attribute__((aligned(4)))=\n{\n\t"),l="",c=0,u=0,d=i.length;u<d;u+=4){l+=T([i[u+2],i[u+1],i[u]])+",",++c%8===0&&(l+="\n",l+=c%64===0?"\n\t":"\t")}return s+l+"\n};\n"}function D(e,t){switch(t){case 3:return A(e);case 4:return function(e){var t=e.fileName,n=e.imageDimensions;if(!e.palette)return console.error("Tried to generate mode 4 header string with no palette! Falling back to mode 3..."),A({fileName:t,imageDimensions:n});var a=t.slice(0,t.lastIndexOf(".")),i=n.height*n.width,r="#define ".concat(a.toUpperCase(),"_SIZE ").concat(i,"\n"),o="#define ".concat(a.toUpperCase(),"_HEIGHT ").concat(n.height,"\n"),s="#define ".concat(a.toUpperCase(),"_WIDTH ").concat(n.width,"\n"),l="extern const unsigned short ".concat(a,"Bitmap[").concat(i/2,"];\n\n"),c="#define ".concat(a.toUpperCase(),"_PAL_SIZE ").concat(2*C,"\n"),u="extern const unsigned short ".concat(a,"Palette[").concat(C,"];\n\n");return r+o+s+l+c+u}(e);default:return console.warn("Attempting to generate header file for mode ".concat(t,", but it's unsupported for now. Defaulting to mode 3.")),A(e)}}function A(e){var t=e.fileName,n=e.imageDimensions,a=(e.palette,t.slice(0,t.lastIndexOf("."))),i=n.height*n.width,r=2*i,o="#define ".concat(a.toUpperCase(),"_SIZE ").concat(r,"\n");return"#define ".concat(a.toUpperCase(),"_LENGTH ").concat(i,"\n")+o+"#define ".concat(a.toUpperCase(),"_HEIGHT ").concat(n.height,"\n")+"#define ".concat(a.toUpperCase(),"_WIDTH ").concat(n.width,"\n")+"\n"+"extern const unsigned short ".concat(a,"Bitmap[").concat(i,"];\n\n")+"\n"}!function(e){e[e.GBA=0]="GBA",e[e.PAL=1]="PAL",e[e.BMP=2]="BMP",e[e.PNG=3]="PNG",e[e.BG=4]="BG"}(S||(S={}));function R(e,t){(e>255||t>255)&&console.error("Tried to convert palette indices ".concat(e," and ").concat(t,", but at least one is out of range! Truncating bitwise..."));var n=((t&=255)|(e&=255)<<8).toString(16).toUpperCase().padStart(4,"0");return"0x".concat(n,", ")}function T(e){var t="0";e.forEach((function(e){for(var n=(e=Math.floor(32*e/256)).toString(2);n.length<5;)n="0"+n;t+=n}));for(var n=parseInt(t,2).toString(16);n.length<4;)n="0"+n;return"0x"+(n=n.toUpperCase())}function M(e){for(var t,n="const unsigned short powPal["+C+"] __attribute__((aligned(4)))=\n{\n\t",a=1;a<=e.length;a++){var i=e[a-1];n+=T([(t=i).b,t.g,t.r])+",",a%8===0&&(n+="\n\t"),a%64===0&&(n+="\n\t")}return n+"};"}function L(e,t){return B.apply(this,arguments)}function B(){return(B=Object(u.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next=e.t0===S.BMP||e.t0===S.PNG?3:6;break;case 3:return e.next=5,t.getImageFileBlob();case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",new Blob(["Invalid file type"]));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G=function(e){var t=document.createElement("canvas");return t.hidden=!0,t.setAttribute("height",e.height+"px"),t.setAttribute("width",e.width+"px"),t},F=function(e,t){return e.getContext("2d").getImageData(0,0,t.width,t.height).data},U=function(e){return new Promise((function(t,n){var a=new Image;a.hidden=!0,a.onload=function(){t(a)},a.onerror=n,a.src=URL.createObjectURL(e)}))},H=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,a,i,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t);case 2:return n=e.sent,a={height:n.naturalHeight,width:n.naturalWidth},i=G(a),(r=i.getContext("2d"))&&r.drawImage(n,0,0),o=F(i,a),e.abrupt("return",new q(t.name,a,o));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(e,t){return 4*(e.y*t.width+e.x)},W=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,a,i,r,o,s,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Response(t).text();case 2:if(n=e.sent,a=n.trim().replace(/\t/g,"").replace(/\n/g,""),i=new Array(256),"0x00"!==a.substr(0,4)){e.next=11;break}for(console.log("Palette file is valid. Generating color array..."),r=0,o=0;r<a.length;r+=10,o++)s=parseInt(a.substr(r+4,2),16),l=parseInt(a.substr(r+6,2),16),u=parseInt(a.substr(r+8,2),16),d=new x(s,l,u,1),i[o]=d;return e.abrupt("return",i);case 11:return console.log("Invalid palette. Palette unchanged."),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){function e(t,n,a){Object(w.a)(this,e),this.fileName=void 0,this.dimensions=void 0,this.imageData=void 0,this.imageCanvas=void 0,this.fileName=t,this.dimensions=n,this.imageData=a||new Uint8ClampedArray(this.dimensions.width*this.dimensions.height*4)}return Object(h.a)(e,[{key:"updateFromStore",value:function(e){this.dimensions=e.dimensions,this.fileName=e.fileName,this.imageData=e.imageData}},{key:"getImageFileBlob",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.imageCanvasElement.toBlob((function(t){return e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"updateImageData",value:function(e,t){this.imageData[J(e,this.dimensions)]=t.r,this.imageData[J(e,this.dimensions)+1]=t.g,this.imageData[J(e,this.dimensions)+2]=t.b,this.imageData[J(e,this.dimensions)+3]=t.a}},{key:"imageCanvasElement",get:function(){return this.imageCanvas.imageCanvasElement}},{key:"pixelGridCanvasElement",get:function(){return this.imageCanvas.pixelGridCanvasElement}},{key:"imageDataStore",get:function(){return{fileName:this.fileName,dimensions:this.dimensions,imageData:this.imageData.slice()}}}]),e}(),Q=function(){function e(t){Object(w.a)(this,e),this.dimensions=void 0,this.pixelGridRatio=16,this.hiddenCanvas=void 0,this.context=void 0,this.pixelGrid=void 0,console.log("Creating new internal ImageCanvas."),this.dimensions=t.dimensions,this.hiddenCanvas=G(t.dimensions),this.context=this.hiddenCanvas.getContext("2d"),this.pixelGrid=new K(t.dimensions,this.pixelGridRatio),this.drawImageToHiddenCanvas(t)}return Object(h.a)(e,[{key:"updatePixel",value:function(e,t){this.drawPixel(e,t)}},{key:"updateRegion",value:function(e,t,n,a,i){}},{key:"redrawImage",value:function(e){this.drawImageToHiddenCanvas(e)}},{key:"drawPixel",value:function(e,t){var n=e.x,a=e.y;this.context&&(this.context.fillStyle=t.toString(),this.context.fillRect(n,a,1,1))}},{key:"drawImageToHiddenCanvas",value:function(e){for(var t=0;t<e.dimensions.width;t++)for(var n=0;n<e.dimensions.height;n++)this.drawPixel({x:t,y:n},e.getPixelColorAt({x:t,y:n}))}},{key:"imageCanvasElement",get:function(){return this.hiddenCanvas}},{key:"pixelGridCanvasElement",get:function(){return this.pixelGrid.canvasElement}}]),e}(),K=function(){function e(t,n){Object(w.a)(this,e),this.dimensions=void 0,this.pixelGridRatio=16,this.hiddenCanvas=void 0,this.context=void 0,console.log("Setting up pixel grid."),this.pixelGridRatio=n,this.dimensions=t,this.hiddenCanvas=G({width:this.dimensions.width*this.pixelGridRatio,height:this.dimensions.height*this.pixelGridRatio}),this.context=this.hiddenCanvas.getContext("2d"),this.drawGrid()}return Object(h.a)(e,[{key:"drawGrid",value:function(){if(this.context){var e=this.dimensions,t=e.width,n=e.height;this.context.strokeStyle="gray",this.context.beginPath();for(var a=0;a<=t;a++)this.context.moveTo(a*this.pixelGridRatio,0),this.context.lineTo(a*this.pixelGridRatio,n*this.pixelGridRatio);for(var i=0;i<=n;i++)this.context.moveTo(0,i*this.pixelGridRatio),this.context.lineTo(t*this.pixelGridRatio,i*this.pixelGridRatio);this.context.stroke()}}},{key:"canvasElement",get:function(){return this.hiddenCanvas}}]),e}(),q=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e,a,i){var r;return Object(w.a)(this,n),(r=t.call(this,e,a,i)).imageCanvas=void 0,r.imageCanvas=new Q(Object(f.a)(r)),r}return Object(h.a)(n,[{key:"updateFromStore",value:function(e){var t=e.imageData;console.log(t),this.imageData=t,this.imageCanvas.redrawImage(this)}},{key:"getPixelColorAt",value:function(e){var t=this.imageData[J(e,this.dimensions)],n=this.imageData[J(e,this.dimensions)+1],a=this.imageData[J(e,this.dimensions)+2],i=this.imageData[J(e,this.dimensions)+3];return new x(t,n,a,i)}},{key:"setPixelColor",value:function(e,t){Object(g.a)(Object(p.a)(n.prototype),"updateImageData",this).call(this,e,t),this.imageCanvas.updatePixel(e,t)}},{key:"imageDataStore",get:function(){return{fileName:this.fileName,dimensions:this.dimensions,imageData:Array.from(this.imageData)}}},{key:"cSourceData",get:function(){return I(this,3)}},{key:"headerData",get:function(){return D({fileName:this.fileName,imageDimensions:this.dimensions},3)}}],[{key:"fromDataStore",value:function(e){var t=e.imageData,a=e.dimensions;return new n(e.fileName,a,Uint8ClampedArray.from(t))}}]),n}(z),Y=function(e){Object(b.a)(n,e);var t=Object(v.a)(n);function n(e,a,i,r){var o;return Object(w.a)(this,n),(o=t.call(this,e,i)).data=void 0,o.palette=void 0,o.currentPaletteIndex=void 0,o.imageCanvas=void 0,o.data=r||Array(i.height*i.width).fill(0),o.palette=a,o.imageCanvas=new Q(Object(f.a)(o)),o.currentPaletteIndex=0,o}return Object(h.a)(n,[{key:"updateFromStore",value:function(e){var t=e.imageData;this.data=t,this.imageCanvas.redrawImage(this)}},{key:"getPixelColorAt",value:function(e){return(e.x>=this.dimensions.width||e.y>=this.dimensions.height)&&console.error("Tried to access pixel at",e,"but dimensions of sprite are",this.dimensions),this.palette[this.data[this.dimensions.width*e.y+e.x]]}},{key:"setPixelColor",value:function(e){this.data[e.y*this.dimensions.width+e.x]=this.currentPaletteIndex,this.imageCanvas.updatePixel(e,this.palette[this.currentPaletteIndex])}},{key:"setPaletteIndex",value:function(e){this.currentPaletteIndex=e}},{key:"updatePalette",value:function(e){this.palette=e,this.imageCanvas.redrawImage(this)}},{key:"headerData",get:function(){return D({fileName:this.fileName,imageDimensions:this.dimensions,palette:this.palette},4)}},{key:"cSourceData",get:function(){return I(this,4,this.palette)}},{key:"imageDataStore",get:function(){return{imageData:this.data.slice(),dimensions:this.dimensions,fileName:this.fileName}}}],[{key:"fromDataStore",value:function(e,t){var a=e.imageData,i=e.dimensions;return new n(e.fileName,t,i,a)}}]),n}(z);function Z(e,t){var n=t.getContext("2d");if(n)for(var a=0;a<C;a++){var i=e[a];n.fillStyle="rgb(".concat(i.r,", ").concat(i.g,", ").concat(i.b,")"),n.fillRect(X(a),V(a),1,1)}else console.error("Failed to get Palette hidden canvas context!")}function V(e){return Math.floor(e/16)}function X(e){return e%16}var $=function(){function e(t,n,a,i,r){Object(w.a)(this,e),this._data=void 0,this._dimensions=void 0,this._position=void 0,this._palette=void 0,this._paletteRow=void 0,this._imageCanvas=void 0,this._redrawSpritesheet=void 0,this._dimensions=n,this._position=t,this._palette=a,this._paletteRow=i,this._data=new Uint8ClampedArray(n.height*n.width),this._imageCanvas=new Q(this),this._redrawSpritesheet=r}return Object(h.a)(e,[{key:"updateFromDataStore",value:function(e){var t=e.position,n=e.dimensions,a=e.paletteRow,i=e.data;this._position=t,this._dimensions=n,this._paletteRow=a,this._data=i}},{key:"setPixelColorAt",value:function(e,t){if(e.x>=this._dimensions.width||e.y>=this._dimensions.height)console.error("Sprite: tried to set pixel color outside image bounds."),console.error("Sprite dimensions:",this._dimensions,"Attempted to set color at coordinates:",e);else if(t<0||t>15)return void console.error("Sprite: tried to set pixel color outside palette bounds:",t);console.log("set pixel color on sprite"),this._data[ee(this._dimensions,e)]=t,this._imageCanvas.updatePixel(e,this._palette[ee(y,{x:t,y:this._paletteRow})])}},{key:"getPixelColorAt",value:function(e){var t=this._data[ee(this._dimensions,e)];return this._palette[ee(y,{x:t,y:this._paletteRow})]}},{key:"getDataAt",value:function(e){return this._data[ee(this._dimensions,e)]}},{key:"dangerouslySetData",value:function(e){this._data=e,this._imageCanvas.redrawImage(this)}},{key:"position",get:function(){return this._position}},{key:"dimensions",get:function(){return this._dimensions},set:function(e){console.warn("Sprite: Setting sprite dimensions not yet implemented.")}},{key:"tiles",get:function(){for(var e=[],t=0,n=0,a=this.dimensions.height*this.dimensions.width/64;e.length<a;){for(var i=[],r=0;r<8;r++)i[r]=[];for(var o=t;o===t||o%8!==0;o++)for(var s=n;s===n||s%8!==0;s++)i[o-t][s-n]=this.getPixelColorAt({x:o,y:s});t+8>=this.dimensions.height?t=0:t+=8,n+8>=this.dimensions.width?n=0:n+=8,e.push(i)}return e}},{key:"paletteRow",get:function(){return this._paletteRow},set:function(e){e<0||e>15?console.error("Sprite: tried to set palette row outside bounds: ",e):(this._paletteRow=e,this._imageCanvas.redrawImage(this),this._redrawSpritesheet())}},{key:"imageCanvasElement",get:function(){return this._imageCanvas.imageCanvasElement}},{key:"pixelGridCanvasElement",get:function(){return this._imageCanvas.pixelGridCanvasElement}},{key:"palette",set:function(e){this._palette=e,this._imageCanvas.redrawImage(this)}},{key:"spriteDataStore",get:function(){return{position:this._position,dimensions:this._dimensions,paletteRow:this._paletteRow,data:this._data}}}],[{key:"fromDataStore",value:function(t,n,a){var i=t.position,r=t.dimensions,o=t.paletteRow,s=t.data,l=new e(i,r,n,o,a);return l.dangerouslySetData(s),l}}]),e}();function ee(e,t){var n=e.width,a=t.x;return n*t.y+a}var te=function(){return alert("There's already a sprite at that location!")},ne={height:256,width:256},ae={height:32,width:32},ie=8,re=8,oe=function(){function e(t,n,a){Object(w.a)(this,e),this.fileName=void 0,this._backgroundColor=void 0,this._palette=void 0,this._selectedPaletteCol=void 0,this._pixelDimensions=ne,this._tileDimensions=ae,this._hiddenCanvas=void 0,this._pixelGrid=void 0,this._tileGridHiddenCanvas=void 0,this._sprites=void 0,this._spriteMap=new Array(ae.height).fill(null).map((function(){return new Array(32).fill(null)})),this.fileName=t,this._palette=n,this._selectedPaletteCol=a,this._hiddenCanvas=G(this.dimensions),this._pixelGrid=new K(this._pixelDimensions,16),this._tileGridHiddenCanvas=se.createHiddenCanvas(this._tileDimensions),this._backgroundColor=this._palette[0],this.fillBackground(),this._sprites=[]}return Object(h.a)(e,[{key:"decodeSprites",value:function(e){var t=this,n=e.map((function(e){return $.fromDataStore(JSON.parse(e),t._palette,(function(){return t.drawToHiddenCanvas()}))}));return n.forEach((function(e){return t.addToSpriteMap(e)})),n}},{key:"dangerouslySetSprites",value:function(e){this._sprites=e,se.redrawCanvas(this._tileGridHiddenCanvas,e,this._tileDimensions),this.drawToHiddenCanvas()}},{key:"addSprite",value:function(e,t){var n=this,a=e.x,i=e.y,r=new $({x:a,y:i},t,this._palette,0,(function(){return n.drawToHiddenCanvas()}));if(this.addToSpriteMap(r)){var o=this._sprites.length;this._sprites[o]=r,this.drawToHiddenCanvas(),se.addSpriteBoxToCanvas({x:a,y:i},t,o,this._tileGridHiddenCanvas),console.log("Added sprite of size",t,"at",{x:a,y:i})}}},{key:"addToSpriteMap",value:function(e){var t=e.position,n=t.x,a=t.y,i=e.dimensions,r=i.height,o=i.width/re,s=r/ie;if(a+s>=this._tileDimensions.height||n+o>=this._tileDimensions.width)return te(),!1;for(var l=a;l<a+s;l++)for(var c=n;c<n+o;c++)if(null!=this._spriteMap[l][c])return te(),!1;for(var u=a;u<a+s;u++)for(var d=n;d<n+o;d++)this._spriteMap[u][d]=e;return!0}},{key:"removeSprite",value:function(e){for(var t=this._sprites[e],n=t.position,a=n.x,i=n.y,r=i;r<i+t.dimensions.height/ie;r++)for(var o=a;o<a+t.dimensions.width/re;o++)this._spriteMap[r][o]=null;this._sprites.splice(e,1),this.drawToHiddenCanvas(),se.redrawCanvas(this._tileGridHiddenCanvas,this._sprites,this._tileDimensions)}},{key:"getPixelColorAt",value:function(e){var t=this.getSpriteFromCoordinates(e);if(!t)return console.warn("Spritesheet: trying to get color but there's no sprite!"),this._palette[0];var n=le(e,this._pixelDimensions,t.position,t.dimensions);return t.getPixelColorAt(n)}},{key:"getSpriteFromCoordinates",value:function(e){var t=this.getTileIndexFromCoordinates(e);return this._spriteMap[t.y][t.x]}},{key:"getTileIndexFromCoordinates",value:function(e){return{x:Math.floor(e.x/8),y:Math.floor(e.y/8)}}},{key:"updatePalette",value:function(e){this._palette=e,this._sprites.map((function(t){return t.palette=e})),this.drawToHiddenCanvas()}},{key:"updateFromStore",value:function(e){}},{key:"setPixelColor",value:function(e,t){var n=this.getSpriteFromCoordinates(e);if(n){var a=le(e,this._pixelDimensions,n.position,n.dimensions);n.setPixelColorAt(a,this._selectedPaletteCol),this.drawToHiddenCanvas()}else console.warn("Spritesheet: trying to set color but there's no sprite!")}},{key:"setBackgroundColor",value:function(e){this._backgroundColor=e}},{key:"setPaletteIndex",value:function(e){this._selectedPaletteCol=X(e),console.log(this._selectedPaletteCol)}},{key:"fillBackground",value:function(){var e=this._hiddenCanvas.getContext("2d");e&&(e.fillStyle=this._backgroundColor.toString(),e.fillRect(0,0,this.dimensions.width,this.dimensions.height))}},{key:"drawToHiddenCanvas",value:function(){var e=this._hiddenCanvas.getContext("2d");e&&(this.fillBackground(),this.sprites.forEach((function(t){e.drawImage(t.imageCanvasElement,8*t.position.x,8*t.position.y,t.dimensions.width,t.dimensions.height),e.stroke()})))}},{key:"getImageFileBlob",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.imageCanvasElement.toBlob((function(t){return e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dimensions",get:function(){return this._pixelDimensions}},{key:"sprites",get:function(){return this._sprites}},{key:"imageCanvasElement",get:function(){return this._hiddenCanvas}},{key:"tileGridCanvasElement",get:function(){return this._tileGridHiddenCanvas}},{key:"pixelGridCanvasElement",get:function(){return this._pixelGrid.canvasElement}},{key:"imageDataStore",get:function(){return{fileName:this.fileName,dimensions:this.dimensions,imageData:[]}}},{key:"spritesheetDataStore",get:function(){return{fileName:this.fileName,dimensions:this._pixelDimensions,sprites:this._sprites.map((function(e){return JSON.stringify(e.spriteDataStore)})),bpp:4}}},{key:"headerData",get:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{height:256,width:256},n=t.height*t.width;return"#define ".concat(e,"TilesLen ").concat(n/2,"\n")+"extern const unsigned short ".concat(e,"Tiles[").concat(n/4,"];\n\n")}(this.fileName)+function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C;return"#define ".concat(e,"PalLen ").concat(2*t,"\n")+"extern const unsigned short ".concat(e,"Palette[").concat(t,"];\n\n")}(this.fileName)}},{key:"tileData",get:function(){for(var e="const unsigned short "+this.fileName.slice(0,this.fileName.lastIndexOf("."))+"Tiles["+this.dimensions.height*this.dimensions.width/4+"] __attribute__((aligned(4)))=\n{\n\t",t=0;t<this._tileDimensions.height;t++)for(var n=0;n<this._tileDimensions.width;n++){var a=this._spriteMap[t][n];if(a)for(var i=0;i<8;i+=1){for(var r=0;r<8;r+=4){var o=le({x:n*re+r,y:t*ie+i},this._pixelDimensions,a.position,a.dimensions),s="0x"+((a.getDataAt(o)<<0)+(a.getDataAt({x:o.x+1,y:o.y})<<4)+(a.getDataAt({x:o.x+2,y:o.y})<<8)+(a.getDataAt({x:o.x+3,y:o.y})<<12)).toString(16).padStart(4,"0")+", ";console.log(s),e+=s}3!==i&&7!==i||(e+="\n\t")}else e+="0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n\t0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n\t";(n+1)%4===0&&(e+="\n\t")}return e+="};"}},{key:"cSourceData",get:function(){return"//spritesheet export\n"+this.tileData+"\n\n"+M(this._palette)}}],[{key:"fromDataStore",value:function(t,n){var a=t.fileName,i=t.sprites,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=new e(a,n,r);return o.dangerouslySetSprites(o.decodeSprites(i)),o}}]),e}(),se={createHiddenCanvas:function(e){var t=8*ie,n=G({height:t*e.height,width:t*e.width});return this.drawTilesOnCanvas(n,e),n},drawTilesOnCanvas:function(e,t){var n=8*ie,a=e.getContext("2d");if(!a)return console.error("Spritesheet: Failed to get context for tile grid canvas.","Cannot draw tile grid."),e;a.globalAlpha=1,a.strokeStyle="blue",a.beginPath();for(var i=0;i<=t.width;i++)a.moveTo(i*n,0),a.lineTo(i*n,t.height*n);for(var r=0;r<=t.height;r++)a.moveTo(0,r*n),a.lineTo(t.width*n,r*n);a.stroke()},redrawCanvas:function(e,t,n){var a=this,i=e.getContext("2d");i&&(i.clearRect(0,0,e.width,e.height),this.drawTilesOnCanvas(e,n),t.map((function(t,n){return a.addSpriteBoxToCanvas(t.position,t.dimensions,n,e)})))},addSpriteBoxToCanvas:function(e,t,n,a){var i=a.getContext("2d");if(i){var r=8*ie;i.strokeStyle="yellow",i.strokeRect(e.x*r,e.y*r,8*t.width,8*t.height),i.fillStyle="white",i.font="12px monospace",i.fillText(n.toString(),e.x*r+2,e.y*r+12)}}};function le(e,t,n,a){var i=n.x*re,r=n.y*ie;(e.y>=t.height||e.x>=t.width)&&console.warn("Trying to translate spritesheet coordinates out of range!");var o={x:e.x-i,y:e.y-r};return(o.x>=a.width||o.y>=a.height)&&console.warn("Translated sprite coordinates out of sprite range!"),o}var ce=[new x(0,0,0,1),new x(128,0,0,1),new x(0,128,0,1),new x(128,128,0,1),new x(0,0,128,1),new x(128,0,128,1),new x(0,128,128,1),new x(192,192,192,1),new x(128,128,128,1),new x(248,0,0,1),new x(0,248,0,1),new x(248,248,0,1),new x(0,0,248,1),new x(248,0,248,1),new x(0,248,248,1),new x(248,248,248,1),new x(32,0,0,1),new x(63,0,0,1),new x(95,0,0,1),new x(127,0,0,1),new x(159,0,0,1),new x(191,0,0,1),new x(223,0,0,1),new x(255,0,0,1),new x(0,32,0,1),new x(0,63,0,1),new x(0,95,0,1),new x(0,127,0,1),new x(0,159,0,1),new x(0,191,0,1),new x(0,223,0,1),new x(0,255,0,1),new x(32,32,0,1),new x(63,63,0,1),new x(95,95,0,1),new x(127,127,0,1),new x(159,159,0,1),new x(191,191,0,1),new x(223,223,0,1),new x(255,255,0,1),new x(0,0,32,1),new x(0,0,63,1),new x(0,0,95,1),new x(0,0,127,1),new x(0,0,159,1),new x(0,0,191,1),new x(0,0,223,1),new x(0,0,255,1),new x(32,0,32,1),new x(63,0,63,1),new x(95,0,95,1),new x(127,0,127,1),new x(159,0,159,1),new x(191,0,191,1),new x(223,0,223,1),new x(255,0,255,1),new x(0,32,32,1),new x(0,63,63,1),new x(0,95,95,1),new x(0,127,127,1),new x(0,159,159,1),new x(0,191,191,1),new x(0,223,223,1),new x(0,255,255,1),new x(16,16,16,1),new x(31,31,31,1),new x(47,47,47,1),new x(63,63,63,1),new x(79,79,79,1),new x(95,95,95,1),new x(111,111,111,1),new x(127,127,127,1),new x(143,143,143,1),new x(159,159,159,1),new x(175,175,175,1),new x(191,191,191,1),new x(207,207,207,1),new x(223,223,223,1),new x(239,239,239,1),new x(255,255,255,1),new x(255,0,0,1),new x(255,31,0,1),new x(255,63,0,1),new x(255,95,0,1),new x(255,127,0,1),new x(255,159,0,1),new x(255,191,0,1),new x(255,223,0,1),new x(255,255,0,1),new x(224,255,0,1),new x(192,255,0,1),new x(160,255,0,1),new x(128,255,0,1),new x(96,255,0,1),new x(64,255,0,1),new x(32,255,0,1),new x(0,255,0,1),new x(0,255,31,1),new x(0,255,63,1),new x(0,255,95,1),new x(0,255,127,1),new x(0,255,159,1),new x(0,255,191,1),new x(0,255,223,1),new x(0,255,255,1),new x(0,224,255,1),new x(0,192,255,1),new x(0,160,255,1),new x(0,128,255,1),new x(0,96,255,1),new x(0,64,255,1),new x(0,32,255,1),new x(0,0,255,1),new x(31,0,255,1),new x(63,0,255,1),new x(95,0,255,1),new x(127,0,255,1),new x(159,0,255,1),new x(191,0,255,1),new x(223,0,255,1),new x(255,0,255,1),new x(255,0,224,1),new x(255,0,192,1),new x(255,0,160,1),new x(255,0,128,1),new x(255,0,96,1),new x(255,0,64,1),new x(255,0,32,1),new x(255,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(8,8,8,1),new x(16,16,16,1),new x(24,24,24,1),new x(32,32,32,1),new x(41,41,41,1),new x(49,49,49,1),new x(57,57,57,1),new x(65,65,65,1),new x(74,74,74,1),new x(82,82,82,1),new x(90,90,90,1),new x(98,98,98,1),new x(106,106,106,1),new x(115,115,115,1),new x(123,123,123,1),new x(131,131,131,1),new x(139,139,139,1),new x(148,148,148,1),new x(156,156,156,1),new x(164,164,164,1),new x(172,172,172,1),new x(180,180,180,1),new x(189,189,189,1),new x(197,197,197,1),new x(205,205,205,1),new x(213,213,213,1),new x(222,222,222,1),new x(230,230,230,1),new x(238,238,238,1),new x(246,246,246,1),new x(255,255,255,1)],ue=[new x(255,0,255,1),new x(128,0,0,1),new x(255,0,0,1),new x(128,0,128,1),new x(0,128,0,1),new x(0,255,0,1),new x(128,128,0,1),new x(255,255,0,1),new x(255,128,0,1),new x(0,0,128,1),new x(0,0,255,1),new x(0,128,128,1),new x(0,255,255,1),new x(0,0,0,1),new x(192,192,192,1),new x(255,255,255,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(255,0,255,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1),new x(0,0,0,1)],de=new x(0,0,0,1);function me(e,t){for(var n,a=function(e){for(var t=[],n=0;n<e.dimensions.height;n++)for(var a=0;a<e.dimensions.width;a++){var i=e.getPixelColorAt({x:a,y:n});t.push([Math.round(Math.min(Math.max(i.r,0),255)),Math.round(Math.min(Math.max(i.g,0),255)),Math.round(Math.min(Math.max(i.b,0),255))])}return t}(e),i=t,r=[],o=[],s=0;s<a.length;s++){var l=a[s];o.includes(JSON.stringify(l))||(r.push(l),o.push(JSON.stringify(l)))}if(1===i||r.length<i)n=r,i=r.length;else{var c=function(e,t){var n=442,a=0,i=(n+a)/2,r=0,o=[];for(;a<=n;){var s=he(e,i=(n+a)/2,t),l=s.possible,c=s.centers;l?(r<i&&(o=JSON.parse(JSON.stringify(c)),r=i),a=i+1):n=i-1}return{pickedCentroids:o}}(r,i).pickedCentroids;n=JSON.parse(JSON.stringify(c))}for(var u=function(e,t,n){var a=[],i=0,r=0,o=JSON.parse(JSON.stringify(t)),s=!1;do{for(var l=0;l<n;l++)a[l]=[];s=!1,s=!1;for(var c=0;c<e.length;c++){for(var u=-1,d=0,m=0;m<n;m++){for(var w=0,h=0;h<e[c].length;h++)w+=Math.pow(Math.abs(e[c][h]-t[m][h]),2);r=Math.sqrt(w),(-1===u||r<=u)&&(u=r,d=m)}a[d].push(e[c].slice())}for(var f=0;f<n;f++){for(var p=0;p<a[f].length;p++)for(var g=0;g<a[f][p].length;g++)t[f][g]+=a[f][p][g];for(var v=0;v<t[f].length;v++)t[f][v]=Math.round(Math.min(Math.max(t[f][v]/(a[f].length<=1?1:a[f].length),0),255)),t[f][v]!==o[f][v]&&(s=!0,o=[],o=JSON.parse(JSON.stringify(t)))}i++}while(!0===s&&i<1e3);return console.log("kmeans output:"),console.log(i),console.log(".........."),{groups:a,centers:t}}(JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(n)),i),d=u.groups,m=u.centers,w=[],h=0;h<m.length;h++){var f=[[],[]];f[0]=m[h];for(var p=0;p<d[h].length;p++)f[p+1]=d[h][p];w.push(f)}w.sort((function(e,t){return t.length-e.length})),console.log(w);var g=e.dimensions.height*e.dimensions.width,v=new Array(g);v.fill(0);for(var b=new Array(256),E=0;E<w.length&&E<256;E++){var y=new x(w[E][0][0],w[E][0][1],w[E][0][2],1);b[E]=y;for(var C=1;C<w[E].length;C++){var S=we(a,w[E][C]);-1!==S&&(v[S]=E)}}for(;E<256;E++)b[E]=de;return{sprite:new Y(e.fileName,b,e.dimensions,v),palette:b}}function we(e,t){for(var n=0;n<e.length;n++)if(e[n][0]===t[0]&&e[n][1]===t[1]&&e[n][2]===t[2])return e[n]=[-1,-1,-1],n;return-1}function he(e,t,n){var a=1,i=e[0],r=!1,o=[];o.push(i);for(var s=0;s<e.length;s++){for(var l=0,c=0;c<e[s].length;c++)l+=Math.pow(Math.abs(e[s][c]-i[c]),2);if((l=Math.sqrt(l))>=t&&(a++,i=e[s],o.push(e[s]),a>=n))return{possible:r=!0,centers:o}}return{possible:r,centers:o}}var fe=function(e){var t=e.startImageExport,n=e.buttonLabel;return r.a.createElement("button",{className:"button export-button",onClick:function(){t()}},n)};var pe=function(e){var t=e.onFileInputChange,n=e.buttonLabel,a=Object(i.useRef)(null);return r.a.createElement(r.a.Fragment,null,r.a.createElement("label",null,n,r.a.createElement("input",{type:"file",accept:".png, .jpg, .jpeg, .bmp, .pal",ref:a,onChange:function(e){return t(a.current,e)}})))};function ge(e){var t=e.label,n=e.children,a=Object(i.useState)(!1),o=Object(d.a)(a,2),s=o[0],l=o[1];return r.a.createElement("div",{className:"dd-container"},r.a.createElement("button",{onClick:function(){return l(!s)},className:"dd-button"},t),r.a.createElement("div",{id:"myDropdown",className:s?"dd-content dd-show":"dd-content",onClick:function(){return l(!1)}},n))}function ve(e){var t=e.image,n=e.palette,a=e.selectedPaletteIndex,o=e.settings,s=e.scale,l=e.onChangeImage,c=e.onChangeColor,u=e.onMouseWheel,m=Object(i.useRef)(null),w=Object(i.useState)([0,0]),h=Object(d.a)(w,2),f=h[0],p=h[1],g=Object(i.useState)(!1),v=Object(d.a)(g,2),b=v[0],x=v[1],y=Object(i.useState)(void 0),C=Object(d.a)(y,2),S=C[0],k=C[1],N=Object(i.useState)({x:0,y:0}),O=Object(d.a)(N,2),P=O[0],_=O[1],I=Object(i.useState)({x:0,y:0}),j=Object(d.a)(I,2),D=j[0],A=j[1],R=Object(i.useState)(void 0),T=Object(d.a)(R,2),M=T[0],L=T[1],B=Object(i.useCallback)((function(){var e=m.current;if(e){var n=e.getContext("2d");n&&t&&(n.clearRect(0,0,e.width,e.height),n.drawImage(t.imageCanvasElement,D.x,D.y,t.dimensions.width*s,t.dimensions.height*s),o.grid&&s>=8&&n.drawImage(t.pixelGridCanvasElement,D.x,D.y,t.dimensions.width*s,t.dimensions.height*s),o.grid&&t instanceof oe&&s>=4&&n.drawImage(t.tileGridCanvasElement,D.x,D.y,t.dimensions.width*s,t.dimensions.height*s))}}),[t,D,m,s,o.grid]);Object(i.useLayoutEffect)((function(){window.addEventListener("resize",(function(){m.current&&p([m.current.clientWidth,m.current.clientHeight])}))}),[]),Object(i.useLayoutEffect)((function(){console.log("Setting up canvas...");var e=m.current;if(e){var t=e.getContext("2d");t&&(p([e.clientWidth,e.clientHeight]),t.imageSmoothingEnabled=!1)}}),[m]),Object(i.useLayoutEffect)((function(){var e=m.current;if(e){var t=e.getContext("2d");if(t){var n=window.devicePixelRatio||1;e.width=f[0]*n,e.height=f[1]*n,t.imageSmoothingEnabled=!1}}}),[f,m]),Object(i.useLayoutEffect)((function(){m.current&&m.current.addEventListener("wheel",u)}),[u]),Object(i.useLayoutEffect)((function(){return B()}));var G=function(e){var t=m.current;if(t){var n=t.getBoundingClientRect(),a=t.width/n.width,i=t.height/n.height;return{x:(e.clientX-n.left)*a,y:(e.clientY-n.top)*i}}},F=Object(i.useCallback)((function(e){var n=Math.floor((e.x-D.x)/s),a=Math.floor((e.y-D.y)/s);if(!(n<0||n>t.dimensions.width||a<0||a>t.dimensions.height))return{x:n,y:a}}),[s,D,t.dimensions]),U=Object(i.useCallback)((function(e,n){e&&(m.current&&m.current.getContext("2d")&&(t.setPixelColor(e,n),B()))}),[B,t]),H=Object(i.useCallback)((function(e,n,a,i){if(e){var r=t.getPixelColorAt(e);if(!r.isEqual(n)){t.setPixelColor(e,n);for(var o=new Array(e),s=new Array(e);void 0!==o[0];){var l=o.shift(),c=new Array(0);l.y>a.y&&c.push({x:l.x,y:l.y-1}),l.y<i.y-1&&c.push({x:l.x,y:l.y+1}),l.x>a.x&&c.push({x:l.x-1,y:l.y}),l.x<i.x-1&&c.push({x:l.x+1,y:l.y}),c.filter((function(e){return!s.includes(e)})).forEach((function(e){s.push(e),t.getPixelColorAt(e).isEqual(r)&&(o.push(e),t.setPixelColor(e,n))}))}B()}}}),[t,B]),J=Object(i.useCallback)((function(e){var i=G(e);if(i){k(i);var r=F(i);if(r)if(m.current)if(m.current.getContext("2d"))switch(o.currentTool){case E.PENCIL:x(!0),U(r,n[a]);break;case E.BUCKET:var s={x:0,y:0},l=t.dimensions,u={x:l.width,y:l.height};if(t instanceof oe){var d=t.getSpriteFromCoordinates(r);if(!d)return;l=d.dimensions;var w=le(r,t.dimensions,d.position,d.dimensions);u={x:(s={x:r.x-w.x,y:r.y-w.y}).x+l.width,y:s.y+l.height}}H(r,n[a],s,u);break;case E.SQUARE:if(!r)return;_(r),x(!0);break;case E.ELLIPSE:if(!r)return;_(r),x(!0);break;case E.PAN:x(!0);break;case E.DROPPER:if(!r)return;var h=t.getPixelColorAt(r);c(h)}}}),[t,c,o.currentTool,H,U,F,n,a]),W=Object(i.useCallback)((function(e){var t=G(e);if(t){var i=F(t);switch(o.currentTool){case E.PENCIL:b&&(U(i,n[a]),k(t));break;case E.SQUARE:if(b){if(!i)return;L(i)}break;case E.ELLIPSE:if(b){if(!i)return;L(i)}break;case E.PAN:if(b&&S){var r={x:D.x+(t.x-S.x),y:D.y+(t.y-S.y)};A(r),k(t)}}}}),[b,U,F,n,a,D,S,o.currentTool]),z=Object(i.useCallback)((function(){if(k(void 0),x(!1),o.currentTool===E.SQUARE){if(!M)return;var e=P,i=M;if(i.x<e.x){var r=e.x;e={x:i.x,y:e.y},i={x:r,y:i.y}}if(i.y<e.y){var s=e.y;e={x:e.x,y:i.y},i={x:i.x,y:s}}for(var c=e.y;c<=i.y;c++)for(var u=e.x;u<=i.x;u++){var d={x:u,y:c};t.setPixelColor(d,n[a])}B()}if(o.currentTool===E.ELLIPSE){if(console.log("drawing ellipse"),!M)return;var m=P,w=M;if(w.x<m.x){var h=m.x;m={x:w.x,y:m.y},w={x:h,y:w.y}}if(w.y<m.y){var f=m.y;m={x:m.x,y:w.y},w={x:w.x,y:f}}for(var p={x:(m.x+w.x)/2,y:(m.y+w.y)/2},g=Math.abs(w.x-p.x),v=Math.abs(w.y-p.y),b=m.y;b<=w.y;b++)for(var y=m.x;y<=w.x;y++){var C={x:y,y:b};console.log(C);var S=Math.pow(C.x-p.x,2)/Math.pow(g,2),N=Math.pow(C.y-p.y,2)/Math.pow(v,2);console.log(S+N),S+N<=1&&t.setPixelColor(C,n[a])}B()}L(void 0),l(t)}),[o.currentTool,P,M,B,t,n,a,l]),Q=Object(i.useCallback)((function(){k(void 0),x(!1)}),[]);return Object(i.useEffect)((function(){if(m.current){var e=m.current;return e.addEventListener("mousedown",J),function(){return e.removeEventListener("mousedown",J)}}}),[J]),Object(i.useEffect)((function(){if(m.current){var e=m.current;return e.addEventListener("mousemove",W),function(){e.removeEventListener("mousemove",W)}}}),[W]),Object(i.useEffect)((function(){if(m.current){var e=m.current;return e.addEventListener("mouseup",z),e.addEventListener("mouseleave",Q),function(){e.removeEventListener("mouseup",z),e.removeEventListener("mouseleave",Q)}}}),[z,Q]),r.a.createElement("canvas",{ref:m,className:be(o.currentTool)})}var be=function(e){var t="image-canvas ";switch(e){case E.PENCIL:return t+"pencil";case E.BUCKET:return t+"bucket";case E.SQUARE:return t+"square";case E.ELLIPSE:return t+"ellipse";case E.PAN:return t+"pan";case E.DROPPER:return t+"dropper"}return t},xe=function(){var e=Object(i.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1];return{isShowing:n,toggle:function(){return a(!n)}}},Ee=function(e){var t=e.onAccept,n=e.oldPal,a=Object(i.useState)(ce),o=Object(d.a)(a,2),s=o[0],l=o[1],m=Object(i.useState)(0),w=Object(d.a)(m,2),h=w[0],f=w[1],p=Object(i.useState)(0),g=Object(d.a)(p,2),v=g[0],b=g[1],x=Object(i.useState)(16),E=Object(d.a)(x,2),y=E[0],C=E[1],S=function(){var e=Object(u.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("Loading palette from file..."),e.next=4,W(t);case 4:(n=e.sent)&&l(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),ye(n,s,h,v,y),t(n,h,v,y)}},r.a.createElement("div",{className:"modal-input-container"},r.a.createElement("div",{className:"import-file-button"},r.a.createElement(pe,{onFileInputChange:function(e,t){t.preventDefault(),e&&e.files&&S(e.files[0])},buttonLabel:"Choose File"})),"(*.pal)"),r.a.createElement("br",null),r.a.createElement("label",{className:"modal-label"}," Properties: "),r.a.createElement("br",null),r.a.createElement("div",{className:"modal-prop-container"},r.a.createElement("label",{htmlFor:"currStartRow",className:"modal-label-input"},"Current Palette Starting Row:"),r.a.createElement("input",{id:"currStartRow",type:"number",min:0,max:16,value:h,onChange:function(e){return f(parseInt(e.target.value))},className:"modal-input"}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"importStartRow",className:"modal-label-input"},"Imported Palette Starting Row:"),r.a.createElement("input",{id:"importStartRow",type:"number",min:0,max:16,value:v,onChange:function(e){return b(parseInt(e.target.value))},className:"modal-input"}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"numRows",className:"modal-label-input"},"Number of Rows:"),r.a.createElement("input",{id:"numRows",type:"number",min:0,max:16,value:y,onChange:function(e){return C(parseInt(e.target.value))},className:"modal-input"})),r.a.createElement("br",null),r.a.createElement("div",{className:"modal-import-left"},r.a.createElement("button",{className:"modal-button-import"},"OK")))},ye=function(e,t,n,a,i){for(var r=0;r<16*i;r++)e[r+16*n]=t[r+16*a]},Ce=function(e){var t=e.onAccept,n=e.isShowing,a=e.hide,i=e.oldPal;return n?s.a.createPortal(r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal-overlay"}),r.a.createElement("div",{className:"modal-wrapper","aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog"},r.a.createElement("div",{className:"import-pal-modal"},r.a.createElement("div",{className:"modal-header"},"Import A Color Palette"),r.a.createElement(Ee,{onAccept:function(e,n,i,r){t(e,n,i,r),a()},oldPal:i}),r.a.createElement("div",{className:"modal-import-right"},r.a.createElement("button",{onClick:a,className:"modal-button-import"},"Cancel"))))),document.body):null},Se=function(e){var t=e.onAccept,n=Object(i.useState)("untitled"),a=Object(d.a)(n,2),o=a[0],s=a[1],l=Object(i.useState)(32),c=Object(d.a)(l,2),u=c[0],m=c[1],w=Object(i.useState)(32),h=Object(d.a)(w,2),f=h[0],p=h[1];return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t(o,{height:u,width:f})}},r.a.createElement("div",{className:"modal-input-text"},r.a.createElement("label",{htmlFor:"filename",className:"modal-label"},"Name:"),r.a.createElement("input",{id:"filename",name:"filename",type:"text",value:o,onChange:function(e){return s(e.target.value)}})),r.a.createElement("br",null),r.a.createElement("label",{className:"modal-label"},"Image Size"),r.a.createElement("div",{className:"modal-input-num"},r.a.createElement("label",{htmlFor:"height",className:"modal-label-num"},"Height:"),r.a.createElement("input",{id:"height",type:"number",min:1,value:u,onChange:function(e){return m(parseInt(e.target.value))}}),r.a.createElement("label",null,"\xa0px"),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"width",className:"modal-label-num"},"Width:"),r.a.createElement("input",{id:"width",type:"number",min:1,value:f,onChange:function(e){return p(parseInt(e.target.value))}}),r.a.createElement("label",null,"\xa0px")),r.a.createElement("br",null),r.a.createElement("div",{className:"modal-button-left"},r.a.createElement("button",{className:"modal-button"},"OK")))},ke=function(e){var t=e.onAccept,n=e.isShowing,a=e.hide;return n?s.a.createPortal(r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal-overlay"}),r.a.createElement("div",{className:"modal-wrapper","aria-modal":!0,"aria-hidden":!0,tabIndex:-1,role:"dialog"},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"modal-header"},"Create a New Image"),r.a.createElement(Se,{onAccept:function(e,n){t(e,n),a()}}),r.a.createElement("div",{className:"modal-button-right"},r.a.createElement("button",{onClick:a,className:"modal-button"},"Cancel"))))),document.body):null};var Ne=function(e){var t=e.handleQuantize,n=Object(i.useState)(15),a=Object(d.a)(n,2),o=a[0],s=a[1];return r.a.createElement("div",{className:"quantize-container"},r.a.createElement("button",{className:"quantize-button",onClick:function(){o?t(o):alert("Can't quantize with unspecified color depth!")}},"Quantize"),r.a.createElement("input",{className:"quantize-input",type:"number",value:o,min:1,max:256,onChange:function(e){return s(parseInt(e.target.value))}}))},Oe=192,Pe=192,_e=Oe/16,Ie=function(e){return function(e){var t=e.x;return 16*e.y+t}(function(e){var t=e.x,n=e.y;return{x:Math.floor(t/_e),y:Math.floor(n/_e)}}(e))};var je=function(e){var t=e.palette,n=e.selectedColorIndex,a=e.onChangeSelectedColorIndex,o=Object(i.useState)(),s=Object(d.a)(o,2),l=s[0],c=s[1],u=Object(i.useState)(),m=Object(d.a)(u,2),w=m[0],h=m[1],f=Object(i.useRef)(null),p=Object(i.useCallback)((function(){if(f.current&&w){var e=f.current.getContext("2d");e&&e.drawImage(w.canvasElement,0,0,Pe*window.devicePixelRatio,Oe*window.devicePixelRatio)}}),[w]),g=Object(i.useCallback)((function(){if(f.current&&l){var e=f.current.getContext("2d");e&&(Z(t,l),e.drawImage(l,0,0,Pe*window.devicePixelRatio,Oe*window.devicePixelRatio))}}),[t,l]),v=Object(i.useCallback)((function(e){if(f.current){var t=f.current.getContext("2d");if(t){t.beginPath(),t.strokeStyle="rgba(255, 255, 0, 1)",t.lineWidth=2;var n=window.devicePixelRatio*_e;t.rect(function(e){return e%16}(e)*n,function(e){return Math.floor(e/16)}(e)*n,n,n),t.stroke()}}}),[f]);return Object(i.useEffect)((function(){console.log("Setting up palette canvas");f.current&&function(e){var t=window.devicePixelRatio||1;e.width=e.clientWidth*t,e.height=e.clientHeight*t;var n=e.getContext("2d");n&&(n.imageSmoothingEnabled=!1)}(f.current);var e={pixelGrid:new K(y,8),hiddenCanvas:G(y)},t=e.pixelGrid;c(e.hiddenCanvas),h(t)}),[]),Object(i.useEffect)((function(){g(),p(),v(n)}),[n,g,p,v]),r.a.createElement("canvas",{ref:f,onClick:function(e){a(Ie(function(e){if(f.current){var t=f.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}return{x:-1,y:-1}}(e)))},className:"palette-canvas"})};function De(e){var t=e.palette,n=e.selectedColorIndex,a=e.onChangeSelectedColorIndex,i=e.onChangeColor,o=e.handleQuantize,s=e.settings;e.onSettingsChange;return r.a.createElement("div",null,r.a.createElement("div",{className:"panel-header-top"},"Palette"),r.a.createElement("div",{className:"palette-container"},r.a.createElement(je,{palette:t,selectedColorIndex:n,onChangeSelectedColorIndex:a})),r.a.createElement(Re,{currentColor:t[n],onChangeColor:i}),r.a.createElement(Ne,{handleQuantize:o}),r.a.createElement("div",{className:"panel-header"},"Properties"),r.a.createElement("div",{className:"properties-container"},r.a.createElement("div",null,"Mode: \xa0 ",s.imageMode,r.a.createElement("br",null),"Type: \xa0 ",s.editorMode.toString())))}var Ae=function(e){var t=8*(e.r+1)-1,n=8*(e.g+1)-1,a=8*(e.b+1)-1;return new x(t,n,a,1)};function Re(e){var t=e.currentColor,n=e.onChangeColor,a=function(e){var t=Math.ceil((e.r+1)/8)-1,n=Math.ceil((e.g+1)/8)-1,a=Math.ceil((e.b+1)/8)-1;return new x(t,n,a,1)}(t);return r.a.createElement("div",{className:"rgb-container"},r.a.createElement("label",{className:"rgb-label"},"R"),r.a.createElement("input",{type:"number",max:"31",min:"0",value:a.r,onChange:function(e){return function(e){a.r=e;var t=Ae(a);n(t)}(parseInt(e.target.value))}}),r.a.createElement("label",{className:"rgb-label"},"G"),r.a.createElement("input",{type:"number",max:"31",min:"0",value:a.g,onChange:function(e){return function(e){a.g=e;var t=Ae(a);n(t)}(parseInt(e.target.value))}}),r.a.createElement("label",{className:"rgb-label"},"B"),r.a.createElement("input",{type:"number",max:"31",min:"0",value:a.b,onChange:function(e){return function(e){a.b=e;var t=Ae(a);n(t)}(parseInt(e.target.value))}}))}function Te(e){var t=e.sprites,n=e.onAddSprite,a=e.onRemoveSprite,i=e.onUpdatePaletteRow,o=function(e,t){e.paletteRow=t,i()};return r.a.createElement("div",null,r.a.createElement("div",{className:"panel-header"},"Sprites"),r.a.createElement("div",{className:"spritepanel-container"},r.a.createElement(Le,{onAddSprite:n}),r.a.createElement("div",{className:"sprite-list-container"},function(e){return e.map((function(e,t){return r.a.createElement(Me,{sprite:e,i:t,onRemoveSprite:a.bind(null,t),onChangePaletteRow:o.bind(null,e)})}))}(t))))}function Me(e){var t=e.sprite,n=e.i,a=e.onRemoveSprite,o=e.onChangePaletteRow,s=Object(i.useState)(t.paletteRow),l=Object(d.a)(s,2),c=l[0],u=l[1];return r.a.createElement("div",{className:"sprite-list-content"},r.a.createElement("div",{key:n},r.a.createElement("div",{className:"sprite-list-label"},"Sprite #",n,r.a.createElement("button",{onClick:a,className:"x-button"},"x")),"Position: (",t.position.x,", ",t.position.y,")",r.a.createElement("br",null),"Dimensions: ",t.dimensions.height,"x",t.dimensions.width," px",r.a.createElement("br",null),r.a.createElement("label",null,"Palette Row: "),r.a.createElement("input",{className:"row-num-input",min:0,max:15,value:c,onChange:function(e){if(e.target.value){var t=parseInt(e.target.value);t>=0&&t<=15&&(u(t),o(t))}}}),r.a.createElement("br",null)))}function Le(e){var t=e.onAddSprite,n=Object(i.useState)({height:8,width:8}),a=Object(d.a)(n,2),o=a[0],s=a[1],l=Object(i.useState)({x:0,y:0}),c=Object(d.a)(l,2),u=c[0],m=c[1];return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t(u,o)}},r.a.createElement("div",{className:"spritepanel-label"},"Dimensions"),r.a.createElement("div",{className:"sprite-input-container"},r.a.createElement("label",{htmlFor:"sprite-height",className:"spritepanel-label-dim"},"Height:"),r.a.createElement("select",{className:"sprite-select",id:"sprite-height",name:"sprite-height",value:o.height,onChange:function(e){s({height:parseInt(e.target.value),width:o.width})}},r.a.createElement("option",{value:8},"8"),r.a.createElement("option",{value:16},"16"),r.a.createElement("option",{value:32},"32"),r.a.createElement("option",{value:64},"64")),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"sprite-width",className:"spritepanel-label-dim"},"Width:"),r.a.createElement("select",{className:"sprite-select",id:"sprite-width",name:"sprite-width",value:o.width,onChange:function(e){s({width:parseInt(e.target.value),height:o.height})}},r.a.createElement("option",{value:8},"8"),r.a.createElement("option",{value:16},"16"),r.a.createElement("option",{value:32},"32"),r.a.createElement("option",{value:64},"64"))),r.a.createElement("br",null),r.a.createElement("div",{className:"spritepanel-label"},"Position"),r.a.createElement("div",{className:"sprite-input-container"},r.a.createElement("label",{htmlFor:"sprite-pos-x",className:"spritepanel-label-pos"},"X:"),r.a.createElement("input",{className:"sprite-input",id:"sprite-pos-x",name:"sprite-pos-x",type:"number",min:0,max:31,value:u.x,onChange:function(e){m({x:parseInt(e.target.value),y:u.y})}}),r.a.createElement("label",{htmlFor:"sprite-pos-y",className:"spritepanel-label-pos"},"Y:"),r.a.createElement("input",{className:"sprite-input",id:"sprite-pos-y",name:"sprite-pos-y",type:"number",min:0,max:31,value:u.y,onChange:function(e){m({y:parseInt(e.target.value),x:u.x})}})),r.a.createElement("br",null),r.a.createElement("button",{className:"sprite-button"},"Add Sprite"))}var Be=n(20),Ge=n(8),Fe=n(16),Ue=n(7);function He(e){var t=e.state,n=e.onClick,a=e.children;return r.a.createElement("button",{className:t?"toggle-on":"toggle-off",onClick:function(){return n(!t)}},a)}function Je(e){var t=e.settings,n=e.onSettingsChange,a=e.onToolChange;return r.a.createElement("div",null,r.a.createElement("div",{className:"panel-header-top"},"Tools"),r.a.createElement("span",{title:"Draw Tool"},r.a.createElement(He,{state:t.currentTool===E.PENCIL,onClick:function(){return a(E.PENCIL)}},r.a.createElement(Ue.a,{icon:Ge.g}))),r.a.createElement("span",{title:"Color Fill"},r.a.createElement(He,{state:t.currentTool===E.BUCKET,onClick:function(){return a(E.BUCKET)}},r.a.createElement(Ue.a,{icon:Ge.e}))),r.a.createElement("span",{title:"Draw Rectangle"},r.a.createElement(He,{state:t.currentTool===E.SQUARE,onClick:function(){return a(E.SQUARE)}},r.a.createElement(Ue.a,{icon:Fe.c}))),r.a.createElement("span",{title:"Draw Ellipse"},r.a.createElement(He,{state:t.currentTool===E.ELLIPSE,onClick:function(){return a(E.ELLIPSE)}},r.a.createElement(Ue.a,{icon:Fe.a}))),r.a.createElement("span",{title:"Zoom Tool"},r.a.createElement(He,{state:t.currentTool===E.ZOOM,onClick:function(){return a(E.ZOOM)}},r.a.createElement(Ue.a,{icon:Ge.i}))),r.a.createElement("span",{title:"Pan Tool"},r.a.createElement(He,{state:t.currentTool===E.PAN,onClick:function(){return a(E.PAN)}},r.a.createElement(Ue.a,{icon:Fe.b}))),r.a.createElement("span",{title:"Color Picker"},r.a.createElement(He,{state:t.currentTool===E.DROPPER,onClick:function(){return a(E.DROPPER)}},r.a.createElement(Ue.a,{icon:Ge.c}))),r.a.createElement("span",{title:"New Layer"},r.a.createElement(He,{state:t.currentTool===E.LAYER,onClick:function(){return a(E.LAYER)}},r.a.createElement(Ue.a,{icon:Ge.h}))),r.a.createElement("div",{className:"panel-header"},"View"),r.a.createElement("span",{title:"Gridlines"},r.a.createElement(He,{state:t.grid,onClick:function(){var e=Object(Be.a)({},t);e.grid=!t.grid,n(e)}},r.a.createElement(Ue.a,{icon:Ge.a}))),r.a.createElement("span",{title:"Layers"},r.a.createElement(He,{state:!1,onClick:function(){return null}},r.a.createElement(Ue.a,{icon:Ge.f}))),r.a.createElement("span",{title:"Image Preview"},r.a.createElement(He,{state:!1,onClick:function(){return null}},r.a.createElement(Ue.a,{icon:Ge.d}))),r.a.createElement("span",{title:"Code Panel"},r.a.createElement(He,{state:!1,onClick:function(){return null}},r.a.createElement(Ue.a,{icon:Ge.b}))))}function We(e,t){return 1===(t.deltaY<0?-1:1)?1.1*e:e/1.1}var ze=function(){var e=Object(i.useState)(),t=Object(d.a)(e,2),n=t[0],o=t[1],s=Object(i.useState)(ce),l=Object(d.a)(s,2),w=l[0],h=l[1],f=Object(i.useState)(0),p=Object(d.a)(f,2),g=p[0],v=p[1],b=Object(i.useState)({grid:!0,currentTool:E.PENCIL,imageMode:3,editorMode:a.Bitmap}),y=Object(d.a)(b,2),C=y[0],I=y[1],j=r.a.useState(),D=Object(d.a)(j,2)[1],A=Object(i.useCallback)((function(){return D({})}),[]),R=Object(i.useState)([]),T=Object(d.a)(R,2),M=T[0],B=T[1],G=Object(i.useState)(-1),F=Object(d.a)(G,2),U=F[0],J=F[1],W=xe(),z=W.isShowing,Q=W.toggle,K=xe(),Z=K.isShowing,V=K.toggle,$=xe(),ee=$.isShowing,te=$.toggle,ne=Object(i.useReducer)(We,8),ae=Object(d.a)(ne,2),ie=ae[0],re=ae[1],se=Object(i.useCallback)((function(e){return re(e)}),[]),le=function(){var e=Object(u.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return console.log("Loading image from file..."),e.next=4,H(t);case 4:n=e.sent,Ee(),de(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(e){var t;t=e instanceof oe?JSON.stringify(e.spritesheetDataStore):JSON.stringify(e.imageDataStore),window.localStorage.setItem(k,t),we(t),o(e)},we=function(e){var t=M.slice(0,U+1);t.push(e),B(t),J(t.length-1)},he=Object(i.useCallback)((function(){if(console.log("trying to undo"),n&&U>=1){var e=M[U-1],t=JSON.parse(e);window.localStorage.setItem(k,e),n.updateFromStore(t),J(U-1),o(n)}}),[M,U,n]),be=Object(i.useCallback)((function(){console.log("trying to redo"),n&&U+1<M.length&&(n.updateFromStore(JSON.parse(M[U+1])),J(U+1))}),[n,U,M]),Ee=function(){B([]),J(-1)},ye=function(e){window.localStorage.setItem(N,JSON.stringify(e)),h(e)},Se=function(e){window.localStorage.setItem(O,e.imageMode.toString()),window.localStorage.setItem(P,e.editorMode.toString()),I(e)},Ne=Object(i.useCallback)((function(e){Se({grid:C.grid,currentTool:e,imageMode:C.imageMode,editorMode:C.editorMode})}),[C]),Oe=function(e,t,i,r){if(n&&!window.confirm("Are you sure you want to create a new image? You will lose all unsaved work."))return;switch(e){case a.Bitmap:switch(t){case 3:return C.editorMode=a.Bitmap,C.imageMode=3,Se(C),de(new q(i,r)),void ye(w);case 4:return C.editorMode=a.Bitmap,C.imageMode=4,Se(C),de(new Y(i,w,r)),void ye(w);default:return void alert("Unsupported image mode!")}case a.Spritesheet:return C.editorMode=a.Spritesheet,C.imageMode=0,Se(C),de(new oe("untitled",ue,X(g))),void ye(ue);case a.Background:default:return void alert("Unsupported editing mode!")}},Pe=function(e){var t=w.slice();if(t[g]=e,g%16===0&&n instanceof oe){for(var a=0;a<16;a++){t[16*a]=e}n.setBackgroundColor(e)}(n instanceof Y||n instanceof oe)&&n.updatePalette(t),ye(t)},_e=function(){var e=Object(u.a)(c.a.mark((function e(t){var a,i,r,o,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i="",a=n?n.fileName.slice(0,n.fileName.lastIndexOf(".")):"default",o=function(){return alert("Failed to export image! Check console for more information.")},e.t0=t,e.next=e.t0===S.GBA?6:e.t0===S.BG?16:e.t0===S.PAL?19:e.t0===S.BMP?27:e.t0===S.PNG?35:43;break;case 6:if(n){e.next=9;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 9:return i=".c",s=new Blob([n.cSourceData]),Object(m.saveAs)(s,a+i),i=".h",l=new Blob([n.headerData]),Object(m.saveAs)(l,a+i),e.abrupt("return");case 16:return r=null,console.log("Trying to export as background!"),e.abrupt("break",43);case 19:if(w){e.next=24;break}return alert("Can't export a non-existant palette!"),e.abrupt("return");case 24:return i=".pal",r=new Blob([(c=w,function(e){var t="",n=1;return e.forEach((function(e){var a="0x00";a+=e.r<16?"0"+e.r.toString(16):e.r.toString(16),a+=e.g<16?"0"+e.g.toString(16):e.g.toString(16),a+=e.b<16?"0"+e.b.toString(16):e.b.toString(16),t+=a+"\t",4===n?(t+="\n",n=1):n++})),t}(c))]),e.abrupt("break",43);case 27:if(n){e.next=30;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 30:return i=".bmp",e.next=33,L(n,t);case 33:return r=e.sent,e.abrupt("break",43);case 35:if(n){e.next=38;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 38:return i=".png",e.next=41,L(n,t);case 41:return r=e.sent,e.abrupt("break",43);case 43:r?Object(m.saveAs)(r,a+i):o();case 44:case"end":return e.stop()}var c}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(i.useEffect)((function(){var e=function(e){89===e.keyCode&&e.ctrlKey||(90===e.keyCode&&e.ctrlKey&&e.shiftKey?be():90===e.keyCode&&e.ctrlKey&&he())};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[he,be]),Object(i.useEffect)((function(){var e=function(){return alert("Image data incorrectly formatted. Aborting load operation.")},t=window.localStorage.getItem(O),n=window.localStorage.getItem(P),a=window.localStorage.getItem(N),i=window.localStorage.getItem(k);if(t&&n&&i){if(!window.confirm("Found automatically saved image data from your last session in storage. Would you like to load it? If not, it will be deleted."))return void window.localStorage.clear();var r=parseInt(t),s=n,l=function(e){return JSON.parse(e).map((function(e){return new x(e.r,e.g,e.b,e.a)}))};switch(r){case 0:if(!a)return void e();var c=l(a);console.log(c);var u=JSON.parse(i);h(c),o(oe.fromDataStore(u,c,0));var d=_;d.imageMode=r,d.editorMode=s,I(d);break;case 3:var m=JSON.parse(i);o(q.fromDataStore(m));var w=_;w.imageMode=r,w.editorMode=s,I(w);break;case 4:if(!a)return void e();var f=JSON.parse(i),p=l(a);o(Y.fromDataStore(f,p)),h(p);var g=_;g.imageMode=r,g.editorMode=s,I(g);break;default:e()}}}),[]),r.a.createElement("div",{className:"app-container"},r.a.createElement("div",{className:"navbar"},r.a.createElement("span",{className:"title"},"VOCC"),r.a.createElement(ge,{label:"New"},r.a.createElement("div",{className:"dd-content-header"},"Bitmap"),r.a.createElement("button",{onClick:Q},"Mode 3"),r.a.createElement(ke,{isShowing:z,hide:Q,onAccept:Oe.bind(null,a.Bitmap,3)}),r.a.createElement("button",{onClick:V},"Mode 4"),r.a.createElement(ke,{isShowing:Z,hide:V,onAccept:Oe.bind(null,a.Bitmap,4)}),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("div",{className:"dd-content-header"},"Spritesheet"),r.a.createElement("button",{onClick:function(){return Oe(a.Spritesheet,0,"untitled",{height:256,width:256})}},"4 bpp"),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("div",{className:"dd-content-header"},"Background"),r.a.createElement("button",{onClick:function(){return alert("Background editing not currently supported.")}},"Mode 0")),r.a.createElement(ge,{label:"Edit"},r.a.createElement("button",{onClick:function(){return he()}},"Undo"),r.a.createElement("button",{onClick:function(){return be()}},"Redo"),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("button",{onClick:function(){return null}},"Clear All")),r.a.createElement(ge,{label:"Import"},r.a.createElement("div",{className:"dd-content-header"},"Image"),r.a.createElement(pe,{onFileInputChange:function(e,t,n){if(n.preventDefault(),t&&t.files)switch(e){case"Image":le(t.files[0])}}.bind(null,"Image"),buttonLabel:"Image (*.png, *.bmp, *.jpg)"}),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("button",{onClick:te},"Palette"),r.a.createElement(Ce,{isShowing:ee,hide:te,onAccept:function(e){n instanceof Y&&n.updatePalette(e),ye(e.slice())},oldPal:w})),r.a.createElement(ge,{label:"Export"},r.a.createElement("div",{className:"dd-content-header"},"Image"),r.a.createElement(fe,{startImageExport:_e.bind(null,S.PNG),buttonLabel:"PNG Image (*.png)"}),r.a.createElement(fe,{startImageExport:_e.bind(null,S.BMP),buttonLabel:"Bitmap (*.bmp)"}),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("div",{className:"dd-content-header"},"GBA"),r.a.createElement(fe,{startImageExport:_e.bind(null,S.GBA),buttonLabel:"C Source Code (*.c/.h)"}),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement(fe,{startImageExport:_e.bind(null,S.PAL),buttonLabel:"Color Palette (*.pal)"})),r.a.createElement(ge,{label:"Help"},r.a.createElement("form",null,r.a.createElement("button",{type:"submit",formAction:"",formTarget:""},"Documentation")),r.a.createElement("form",null,r.a.createElement("button",{type:"submit",formAction:"https://www.coranac.com/tonc/text/",formTarget:"_blank"},"GBA Graphics 101")),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("form",null,r.a.createElement("button",{type:"submit",formAction:"",formTarget:""},"About VOCC")),r.a.createElement("div",{className:"dd-divider"}),r.a.createElement("form",null,r.a.createElement("button",{type:"submit",formAction:"https://github.com/lbussell/vocc",formTarget:"_blank"},"View on GitHub")),r.a.createElement("button",{onClick:function(){return window.localStorage.clear()}},"Clear Local Storage"))),r.a.createElement("div",{className:"workspace-container"},r.a.createElement("div",{className:"left-panel"},r.a.createElement("div",{className:"tools-container"},r.a.createElement(Je,{settings:C,onSettingsChange:Se,onToolChange:Ne}),r.a.createElement("div",{className:"scale-container"},n?r.a.createElement("div",null," Scale: ",ie.toFixed(2),"x "):null))),r.a.createElement("div",{className:"image-container"},n?r.a.createElement(ve,{image:n,settings:C,palette:w,selectedPaletteIndex:g,scale:ie,onChangeImage:de,onChangeColor:Pe,onMouseWheel:se}):r.a.createElement("div",{className:"start-message"},r.a.createElement("em",null,"Import an image to get started"))),r.a.createElement("div",{className:"right-panel"},r.a.createElement(De,{palette:w,updatePalette:ye,selectedColorIndex:g,onChangeSelectedColorIndex:function(e){v(e),(n instanceof Y||n instanceof oe)&&n.setPaletteIndex(e)},onChangeColor:Pe,handleQuantize:function(e){if(e=Math.floor(e),n instanceof q){if(window.confirm("Quantizing a bitmap will change it from mode 3 to mode 4. Is this okay?")){var t=me(n,e),a=t.palette,i=t.sprite;de(i),ye(a)}}else alert("Requantization of paletted images currently not supported!")},settings:C,onSettingsChange:Se}),C.editorMode===a.Spritesheet?r.a.createElement(Te,{onAddSprite:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a=n;a.addSprite(e,t),de(a),A(),console.log("Adding sprite")},onRemoveSprite:function(e){return function(e,t){e&&e instanceof oe&&e.removeSprite(t),A()}(n,e)},onUpdatePaletteRow:A,sprites:n.sprites}):null)))},Qe=(n(32),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function Ke(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(r.a.createElement(ze,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/vocc",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vocc","/service-worker.js");Qe?(!function(e,t){fetch(e).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ke(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Ke(t,e)}))}}()}},[[21,1,2]]]);
//# sourceMappingURL=main.248bc36c.chunk.js.map