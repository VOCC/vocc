(this.webpackJsonpgba_vocc_ts=this.webpackJsonpgba_vocc_ts||[]).push([[0],{21:function(e,t,n){e.exports=n(33)},32:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a,r=n(0),i=n.n(r),o=n(18),c=n.n(o),s=n(3),l=n.n(s),u=n(6),d=n(2),m=n(4),h=n(5),w=function(){function e(t,n,a,r){Object(m.a)(this,e),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=t,this.g=n,this.b=a,this.a=r}return Object(h.a)(e,[{key:"isEqual",value:function(t){if(t===this)return!0;if(!(t instanceof e))return!1;var n=t;return this.r===n.r&&this.g===n.g&&this.b===n.b&&this.a===n.a}}]),e}();!function(e){e.Bitmap="Bitmap",e.Spritesheet="Spritesheet",e.Background="Background"}(a||(a={}));new w(0,0,0,1),new w(255,0,0,1),new w(0,255,0,1),new w(0,0,255,1);var f,g={height:16,width:16},v=g.height*g.width;function p(e,t,n){switch(t){case 3:return b(e);case 4:return function(e,t){if(!t)return console.error("Tried to generate mode 4 header string with no palette! Falling back to mode 3..."),b(e);for(var n=e.fileName.slice(0,e.fileName.lastIndexOf(".")),a=e.dimensions.height*e.dimensions.width,r="const unsigned short ".concat(n,"Bitmap[").concat(a/2,"]__attribute__((aligned(4)))=\n{\n"),i=e.getImageData(),o="",c=0;c<i.length;c+=2)o+=C(i[c],i[c+1]),(c/2+1)%8===0&&(o+="\n");var s=function(e){for(var t="const unsigned short powPal["+v+"] __attribute__((aligned(4)))=\n{\n",n=1;n<=e.length;n++){var a=e[n-1];t+=y(a)+",",n%8===0&&(t+="\n"),n%64===0&&(t+="\n")}return t+"};"}(t);return r+o+"};\n\n"+s}(e,n);default:return b(e)}}function b(e){for(var t=e.fileName.slice(0,e.fileName.lastIndexOf(".")),n=e.dimensions.height*e.dimensions.width,a="const unsigned short ".concat(t,"Bitmap[").concat(n/2,"]__attribute__((aligned(4)))=\n{\n\t"),r=e.getImageData(),i="",o=0,c=0,s=r.length;c<s;c+=4){i+=O([r[c+2],r[c+1],r[c]])+",",++o%8===0&&(i+="\n",i+=o%64===0?"\n\t":"\t")}return a+i+"\n};\n"}function x(e,t){switch(t){case 3:return E(e);case 4:return function(e){var t=e.fileName,n=e.imageDimensions;if(!e.palette)return console.error("Tried to generate mode 4 header string with no palette! Falling back to mode 3..."),E({fileName:t,imageDimensions:n});var a=t.slice(0,t.lastIndexOf(".")),r=n.height*n.width,i="#define ".concat(a.toUpperCase(),"_SIZE ").concat(r,"\n"),o="#define ".concat(a.toUpperCase(),"_HEIGHT ").concat(n.height,"\n"),c="#define ".concat(a.toUpperCase(),"_WIDTH ").concat(n.width,"\n"),s="extern const unsigned short ".concat(a,"Bitmap[").concat(r/2,"];\n\n"),l="#define ".concat(a.toUpperCase(),"_PAL_SIZE ").concat(2*v,"\n"),u="extern const unsigned short ".concat(a,"Palette[").concat(v,"];\n\n");return i+o+c+s+l+u}(e);default:return console.warn("Attempting to generate header file for mode ".concat(t,", but it's unsupported for now. Defaulting to mode 3.")),E(e)}}function E(e){var t=e.fileName,n=e.imageDimensions,a=(e.palette,t.slice(0,t.lastIndexOf("."))),r=n.height*n.width,i=2*r,o="#define ".concat(a.toUpperCase(),"_SIZE ").concat(i,"\n");return"#define ".concat(a.toUpperCase(),"_LENGTH ").concat(r,"\n")+o+"#define ".concat(a.toUpperCase(),"_HEIGHT ").concat(n.height,"\n")+"#define ".concat(a.toUpperCase(),"_WIDTH ").concat(n.width,"\n")+"\n"+"extern const unsigned short ".concat(a,"Bitmap[").concat(r,"];\n\n")+"\n"}function C(e,t){(e>255||t>255)&&console.error("Tried to convert palette indices ".concat(e," and ").concat(t,", but at least one is out of range! Truncating bitwise..."));var n=((t&=255)|(e&=255)<<8).toString(16).toUpperCase().padStart(4,"0");return"0x".concat(n,", ")}function O(e){var t="0";e.forEach((function(e){for(var n=(e=Math.floor(32*e/256)).toString(2);n.length<5;)n="0"+n;t+=n}));for(var n=parseInt(t,2).toString(16);n.length<4;)n="0"+n;return"0x"+(n=n.toUpperCase())}function y(e){return O([e.b,e.g,e.r])}function k(e,t){return N.apply(this,arguments)}function N(){return(N=Object(u.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="BMP"===e.t0||"PNG"===e.t0?3:6;break;case 3:return e.next=5,t.getImageFileBlob();case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",new Blob(["Invalid file type"]));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.PENCIL=0]="PENCIL",e[e.BUCKET=1]="BUCKET",e[e.SQUARE=2]="SQUARE",e[e.ELLIPSE=3]="ELLIPSE",e[e.ZOOM=4]="ZOOM",e[e.PAN=5]="PAN",e[e.DROPPER=6]="DROPPER"}(f||(f={}));var j=n(12),P=n(10),I=n(9),S=n(19),T=n(13),R=function(){function e(t,n,a){Object(m.a)(this,e),this.fileName=void 0,this.dimensions=void 0,this.imageData=void 0,this.imageCanvas=void 0,this.fileName=t,this.dimensions=n,this.imageData=a||new Uint8ClampedArray(this.dimensions.width*this.dimensions.height*4)}return Object(h.a)(e,[{key:"getImageCanvasElement",value:function(){return this.imageCanvas.getImageCanvasElement()}},{key:"getPixelGridCanvasElement",value:function(){return this.imageCanvas.getPixelGridCanvasElement()}},{key:"getImageData",value:function(){return this.imageData}},{key:"getImageFileBlob",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.getImageCanvasElement().toBlob((function(t){return e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"updateImageData",value:function(e,t){this.imageData[_(e,this.dimensions)]=t.r,this.imageData[_(e,this.dimensions)+1]=t.g,this.imageData[_(e,this.dimensions)+2]=t.b,this.imageData[_(e,this.dimensions)+3]=t.a}}]),e}(),L=function(){function e(t){Object(m.a)(this,e),this.dimensions=void 0,this.pixelGridRatio=16,this.hiddenCanvas=void 0,this.context=void 0,this.pixelGrid=void 0,console.log("Creating new internal ImageCanvas."),this.dimensions=t.dimensions,this.hiddenCanvas=B(t.dimensions),this.context=this.hiddenCanvas.getContext("2d"),this.pixelGrid=new A(t.dimensions,this.pixelGridRatio),this.drawImageToHiddenCanvas(t)}return Object(h.a)(e,[{key:"getImageCanvasElement",value:function(){return this.hiddenCanvas}},{key:"getPixelGridCanvasElement",value:function(){return this.pixelGrid.getCanvasElement()}},{key:"updatePixel",value:function(e,t){this.drawPixel(e,t)}},{key:"updateRegion",value:function(e,t,n,a,r){}},{key:"redrawImage",value:function(e){this.drawImageToHiddenCanvas(e)}},{key:"drawPixel",value:function(e,t){if(this.context){var n="rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")");this.context.fillStyle=n,this.context.fillRect(e.x,e.y,1,1)}}},{key:"drawImageToHiddenCanvas",value:function(e){for(var t=0;t<e.dimensions.width;t++)for(var n=0;n<e.dimensions.height;n++)this.drawPixel({x:t,y:n},e.getPixelColorAt({x:t,y:n}))}}]),e}(),A=function(){function e(t,n){Object(m.a)(this,e),this.dimensions=void 0,this.pixelGridRatio=16,this.hiddenCanvas=void 0,this.context=void 0,console.log("Setting up pixel grid."),this.pixelGridRatio=n,this.dimensions=t,this.hiddenCanvas=B({width:this.dimensions.width*this.pixelGridRatio,height:this.dimensions.height*this.pixelGridRatio}),this.context=this.hiddenCanvas.getContext("2d"),this.drawGrid()}return Object(h.a)(e,[{key:"getCanvasElement",value:function(){return this.hiddenCanvas}},{key:"drawGrid",value:function(){if(this.context){var e=this.dimensions,t=e.width,n=e.height;this.context.strokeStyle="gray",this.context.beginPath();for(var a=0;a<=t;a++)this.context.moveTo(a*this.pixelGridRatio,0),this.context.lineTo(a*this.pixelGridRatio,n*this.pixelGridRatio);for(var r=0;r<=n;r++)this.context.moveTo(0,r*this.pixelGridRatio),this.context.lineTo(t*this.pixelGridRatio,r*this.pixelGridRatio);this.context.stroke()}}}]),e}(),M=function(e){function t(e,n,a){var r;return Object(m.a)(this,t),(r=Object(j.a)(this,Object(I.a)(t).call(this,e,n,a))).imageCanvas=void 0,r.imageCanvas=new L(Object(P.a)(r)),r}return Object(T.a)(t,e),Object(h.a)(t,[{key:"getCSourceData",value:function(){return p(this,3)}},{key:"getHeaderData",value:function(){return x({fileName:this.fileName,imageDimensions:this.dimensions},3)}},{key:"getPixelColorAt",value:function(e){var t=this.imageData[_(e,this.dimensions)],n=this.imageData[_(e,this.dimensions)+1],a=this.imageData[_(e,this.dimensions)+2],r=this.imageData[_(e,this.dimensions)+3];return new w(t,n,a,r)}},{key:"setPixelColor",value:function(e,n){console.log("setting pixel color bmp3"),Object(S.a)(Object(I.a)(t.prototype),"updateImageData",this).call(this,e,n),this.imageCanvas.updatePixel(e,n)}}]),t}(R),B=function(e){var t=document.createElement("canvas");return t.hidden=!0,t.setAttribute("height",e.height+"px"),t.setAttribute("width",e.width+"px"),t},D=function(e,t){return e.getContext("2d").getImageData(0,0,t.width,t.height).data},G=function(e){return new Promise((function(t,n){var a=new Image;a.hidden=!0,a.onload=function(){t(a)},a.onerror=n,a.src=URL.createObjectURL(e)}))},U=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,r,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return n=e.sent,a={height:n.naturalHeight,width:n.naturalWidth},r=B(a),(i=r.getContext("2d"))&&i.drawImage(n,0,0),o=D(r,a),e.abrupt("return",new M(t.name,a,o));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e,t){return 4*(e.y*t.width+e.x)},H=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,r,i,o,c,s,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Response(t).text();case 2:if(n=e.sent,a=n.trim().replace(/\t/g,"").replace(/\n/g,""),r=new Array(256),"0x00"!==a.substr(0,4)){e.next=11;break}for(console.log("Palette file is valid. Generating color array..."),i=0,o=0;i<a.length;i+=10,o++)c=parseInt(a.substr(i+4,2),16),s=parseInt(a.substr(i+6,2),16),u=parseInt(a.substr(i+8,2),16),d=new w(c,s,u,1),r[o]=d;return e.abrupt("return",r);case 11:return console.log("Invalid palette. Palette unchanged."),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(e){function t(e,n,a,r){var i;return Object(m.a)(this,t),(i=Object(j.a)(this,Object(I.a)(t).call(this,e,r))).data=void 0,i.palette=void 0,i.currentPaletteIndex=void 0,i.imageCanvas=void 0,i.data=n,i.palette=a,i.imageCanvas=new L(Object(P.a)(i)),i.currentPaletteIndex=0,i}return Object(T.a)(t,e),Object(h.a)(t,[{key:"getHeaderData",value:function(){return x({fileName:this.fileName,imageDimensions:this.dimensions,palette:this.palette},4)}},{key:"getCSourceData",value:function(){return p(this,4,this.palette)}},{key:"getPixelColorAt",value:function(e){return(e.x>=this.dimensions.width||e.y>=this.dimensions.height)&&console.error("Tried to access pixel at",e,"but dimensions of sprite are",this.dimensions),this.palette[this.data[this.dimensions.width*e.y+e.x]]}},{key:"setPixelColor",value:function(e){console.log("setting pixel color bmp4"),this.data[e.y*this.dimensions.width+e.x]=this.currentPaletteIndex,this.imageCanvas.updatePixel(e,this.palette[this.currentPaletteIndex])}},{key:"setPaletteIndex",value:function(e){this.currentPaletteIndex=e}},{key:"updatePalette",value:function(e){this.palette=e,this.imageCanvas.redrawImage(this)}}]),t}(R),W=new w(0,0,0,1);function z(e,t){for(var n,a=function(e){for(var t=[],n=0;n<e.dimensions.height;n++)for(var a=0;a<e.dimensions.width;a++){var r=e.getPixelColorAt({x:a,y:n});t.push([Math.round(Math.min(Math.max(r.r,0),255)),Math.round(Math.min(Math.max(r.g,0),255)),Math.round(Math.min(Math.max(r.b,0),255))])}return t}(e),r=t,i=[],o=[],c=0;c<a.length;c++){var s=a[c];o.includes(JSON.stringify(s))||(i.push(s),o.push(JSON.stringify(s)))}if(1===r||i.length<r)n=i,r=i.length;else{var l=function(e,t){var n=442,a=0,r=(n+a)/2,i=0,o=[];for(;a<=n;){var c=Q(e,r=(n+a)/2,t),s=c.possible,l=c.centers;s?(i<r&&(o=JSON.parse(JSON.stringify(l)),i=r),a=r+1):n=r-1}return{pickedCentroids:o}}(i,r).pickedCentroids;n=JSON.parse(JSON.stringify(l))}for(var u=function(e,t,n){var a=[],r=0,i=0,o=JSON.parse(JSON.stringify(t)),c=!1;do{for(var s=0;s<n;s++)a[s]=[];c=!1,c=!1;for(var l=0;l<e.length;l++){for(var u=-1,d=0,m=0;m<n;m++){for(var h=0,w=0;w<e[l].length;w++)h+=Math.pow(Math.abs(e[l][w]-t[m][w]),2);i=Math.sqrt(h),(-1===u||i<=u)&&(u=i,d=m)}a[d].push(e[l].slice())}for(var f=0;f<n;f++){for(var g=0;g<a[f].length;g++)for(var v=0;v<a[f][g].length;v++)t[f][v]+=a[f][g][v];for(var p=0;p<t[f].length;p++)t[f][p]=Math.round(Math.min(Math.max(t[f][p]/(a[f].length<=1?1:a[f].length),0),255)),t[f][p]!==o[f][p]&&(c=!0,o=[],o=JSON.parse(JSON.stringify(t)))}r++}while(!0===c&&r<1e3);return console.log("kmeans output:"),console.log(r),console.log(".........."),{groups:a,centers:t}}(JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(n)),r),d=u.groups,m=u.centers,h=[],f=0;f<m.length;f++){var g=[[],[]];g[0]=m[f];for(var v=0;v<d[f].length;v++)g[v+1]=d[f][v];h.push(g)}h.sort((function(e,t){return t.length-e.length})),console.log(h);var p=e.dimensions.height*e.dimensions.width,b=new Array(p);b.fill(0);for(var x=new Array(256),E=0;E<h.length&&E<256;E++){var C=new w(h[E][0][0],h[E][0][1],h[E][0][2],1);x[E]=C;for(var O=1;O<h[E].length;O++){var y=F(a,h[E][O]);-1!==y&&(b[y]=E)}}for(;E<256;E++)x[E]=W;return{sprite:new J(e.fileName,b,x,e.dimensions),palette:x}}function F(e,t){for(var n=0;n<e.length;n++)if(e[n][0]===t[0]&&e[n][1]===t[1]&&e[n][2]===t[2])return e[n]=[-1,-1,-1],n;return-1}function Q(e,t,n){var a=1,r=e[0],i=!1,o=[];o.push(r);for(var c=0;c<e.length;c++){for(var s=0,l=0;l<e[c].length;l++)s+=Math.pow(Math.abs(e[c][l]-r[l]),2);if((s=Math.sqrt(s))>=t&&(a++,r=e[c],o.push(e[c]),a>=n))return{possible:i=!0,centers:o}}return{possible:i,centers:o}}var q=n(14),Z=[new w(0,0,0,1),new w(128,0,0,1),new w(0,128,0,1),new w(128,128,0,1),new w(0,0,128,1),new w(128,0,128,1),new w(0,128,128,1),new w(192,192,192,1),new w(128,128,128,1),new w(248,0,0,1),new w(0,248,0,1),new w(248,248,0,1),new w(0,0,248,1),new w(248,0,248,1),new w(0,248,248,1),new w(248,248,248,1),new w(32,0,0,1),new w(63,0,0,1),new w(95,0,0,1),new w(127,0,0,1),new w(159,0,0,1),new w(191,0,0,1),new w(223,0,0,1),new w(255,0,0,1),new w(0,32,0,1),new w(0,63,0,1),new w(0,95,0,1),new w(0,127,0,1),new w(0,159,0,1),new w(0,191,0,1),new w(0,223,0,1),new w(0,255,0,1),new w(32,32,0,1),new w(63,63,0,1),new w(95,95,0,1),new w(127,127,0,1),new w(159,159,0,1),new w(191,191,0,1),new w(223,223,0,1),new w(255,255,0,1),new w(0,0,32,1),new w(0,0,63,1),new w(0,0,95,1),new w(0,0,127,1),new w(0,0,159,1),new w(0,0,191,1),new w(0,0,223,1),new w(0,0,255,1),new w(32,0,32,1),new w(63,0,63,1),new w(95,0,95,1),new w(127,0,127,1),new w(159,0,159,1),new w(191,0,191,1),new w(223,0,223,1),new w(255,0,255,1),new w(0,32,32,1),new w(0,63,63,1),new w(0,95,95,1),new w(0,127,127,1),new w(0,159,159,1),new w(0,191,191,1),new w(0,223,223,1),new w(0,255,255,1),new w(16,16,16,1),new w(31,31,31,1),new w(47,47,47,1),new w(63,63,63,1),new w(79,79,79,1),new w(95,95,95,1),new w(111,111,111,1),new w(127,127,127,1),new w(143,143,143,1),new w(159,159,159,1),new w(175,175,175,1),new w(191,191,191,1),new w(207,207,207,1),new w(223,223,223,1),new w(239,239,239,1),new w(255,255,255,1),new w(255,0,0,1),new w(255,31,0,1),new w(255,63,0,1),new w(255,95,0,1),new w(255,127,0,1),new w(255,159,0,1),new w(255,191,0,1),new w(255,223,0,1),new w(255,255,0,1),new w(224,255,0,1),new w(192,255,0,1),new w(160,255,0,1),new w(128,255,0,1),new w(96,255,0,1),new w(64,255,0,1),new w(32,255,0,1),new w(0,255,0,1),new w(0,255,31,1),new w(0,255,63,1),new w(0,255,95,1),new w(0,255,127,1),new w(0,255,159,1),new w(0,255,191,1),new w(0,255,223,1),new w(0,255,255,1),new w(0,224,255,1),new w(0,192,255,1),new w(0,160,255,1),new w(0,128,255,1),new w(0,96,255,1),new w(0,64,255,1),new w(0,32,255,1),new w(0,0,255,1),new w(31,0,255,1),new w(63,0,255,1),new w(95,0,255,1),new w(127,0,255,1),new w(159,0,255,1),new w(191,0,255,1),new w(223,0,255,1),new w(255,0,255,1),new w(255,0,224,1),new w(255,0,192,1),new w(255,0,160,1),new w(255,0,128,1),new w(255,0,96,1),new w(255,0,64,1),new w(255,0,32,1),new w(255,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(0,0,0,1),new w(8,8,8,1),new w(16,16,16,1),new w(24,24,24,1),new w(32,32,32,1),new w(41,41,41,1),new w(49,49,49,1),new w(57,57,57,1),new w(65,65,65,1),new w(74,74,74,1),new w(82,82,82,1),new w(90,90,90,1),new w(98,98,98,1),new w(106,106,106,1),new w(115,115,115,1),new w(123,123,123,1),new w(131,131,131,1),new w(139,139,139,1),new w(148,148,148,1),new w(156,156,156,1),new w(164,164,164,1),new w(172,172,172,1),new w(180,180,180,1),new w(189,189,189,1),new w(197,197,197,1),new w(205,205,205,1),new w(213,213,213,1),new w(222,222,222,1),new w(230,230,230,1),new w(238,238,238,1),new w(246,246,246,1),new w(255,255,255,1)];function K(e){var t=e.image,n=e.palette,a=e.selectedPaletteIndex,o=e.settings,c=e.scale,s=e.onMouseWheel,l=Object(r.useRef)(null),u=Object(r.useState)([0,0]),m=Object(d.a)(u,2),h=m[0],w=m[1],g=Object(r.useState)(!1),v=Object(d.a)(g,2),p=v[0],b=v[1],x=Object(r.useState)(void 0),E=Object(d.a)(x,2),C=E[0],O=E[1],y=Object(r.useState)({x:0,y:0}),k=Object(d.a)(y,2),N=k[0],j=k[1],P=Object(r.useCallback)((function(){var e=l.current;if(e){var n=e.getContext("2d");n&&t&&(n.clearRect(0,0,e.width,e.height),n.drawImage(t.getImageCanvasElement(),N.x,N.y,t.dimensions.width*c,t.dimensions.height*c),o.grid&&c>=8&&n.drawImage(t.getPixelGridCanvasElement(),N.x,N.y,t.dimensions.width*c,t.dimensions.height*c))}}),[t,N,l,c,o.grid]);Object(r.useLayoutEffect)((function(){window.addEventListener("resize",(function(){l.current&&w([l.current.clientWidth,l.current.clientHeight])}))}),[]),Object(r.useLayoutEffect)((function(){console.log("Setting up canvas...");var e=l.current;if(e){var t=e.getContext("2d");t&&(w([e.clientWidth,e.clientHeight]),t.imageSmoothingEnabled=!1)}}),[l]),Object(r.useLayoutEffect)((function(){var e=l.current;if(e){var t=e.getContext("2d");if(t){var n=window.devicePixelRatio||1;e.width=h[0]*n,e.height=h[1]*n,t.imageSmoothingEnabled=!1}}}),[h,l]),Object(r.useLayoutEffect)((function(){l.current&&l.current.addEventListener("wheel",s)}),[s]),Object(r.useLayoutEffect)((function(){return P()}),[P,n,h]);var I=function(e){var t=l.current;if(t){var n=t.getBoundingClientRect(),a=t.width/n.width,r=t.height/n.height;return{x:(e.clientX-n.left)*a,y:(e.clientY-n.top)*r}}},S=Object(r.useCallback)((function(e){return{x:Math.floor((e.x-N.x)/c),y:Math.floor((e.y-N.y)/c)}}),[c,N]),T=Object(r.useCallback)((function(e,n){l.current&&(l.current.getContext("2d")&&(t.setPixelColor(e,n),P()))}),[P,t]),R=Object(r.useCallback)((function(e,n){var a=t.getPixelColorAt(e);t.setPixelColor(e,n),console.log(a);for(var r=new Array(e),i=new Array(e);void 0!==r[0];){var o=r.shift();console.log(o);var c=new Array(0);o.y>0&&c.push({x:o.x,y:o.y-1}),o.y<t.dimensions.height-1&&c.push({x:o.x,y:o.y+1}),o.x>0&&c.push({x:o.x-1,y:o.y}),o.x<t.dimensions.width-1&&c.push({x:o.x+1,y:o.y}),c.filter((function(e){return!i.includes(e)})).forEach((function(e){i.push(e),t.getPixelColorAt(e).isEqual(a)&&(r.push(e),t.setPixelColor(e,n))}))}P()}),[t,P]),L=Object(r.useCallback)((function(e){var t=I(e);if(t)switch(O(t),o.currentTool){case f.PENCIL:b(!0),T(t,n[a]);break;case f.BUCKET:R(S(t),n[a]);break;case f.PAN:b(!0)}}),[o.currentTool,R,T,S,n,a]),A=Object(r.useCallback)((function(e){var t=I(e);switch(o.currentTool){case f.PENCIL:p&&t&&T(S(t),n[a]);break;case f.PAN:if(p&&C&&t){var r={x:N.x+(t.x-C.x),y:N.y+(t.y-C.y)};j(r),O(t)}}}),[p,T,S,n,a,N,C,o.currentTool]),M=Object(r.useCallback)((function(){O(void 0),b(!1)}),[]);return Object(r.useEffect)((function(){if(l.current){var e=l.current;return e.addEventListener("mousedown",L),function(){return e.removeEventListener("mousedown",L)}}}),[L]),Object(r.useEffect)((function(){if(l.current){var e=l.current;return e.addEventListener("mousemove",A),function(){e.removeEventListener("mousemove",A)}}}),[A]),Object(r.useEffect)((function(){if(l.current){var e=l.current;return e.addEventListener("mouseup",M),e.addEventListener("mouseleave",M),function(){e.removeEventListener("mouseup",M),e.removeEventListener("mouseleave",M)}}}),[M]),i.a.createElement("canvas",{ref:l,className:V(o.currentTool)})}var V=function(e){var t="image-canvas ";switch(e){case f.PENCIL:return t+"pencil";case f.BUCKET:return t+"bucket";case f.PAN:return t+"pan"}return t};var Y=function(e){var t=e.startImageExport,n=e.buttonLabel;return i.a.createElement("button",{className:"button export-button",onClick:function(){t()}},n)};var X=function(e){var t=e.onFileChange,n=e.buttonLabel,a=Object(r.useRef)(null),o=function(e){e.preventDefault(),a.current&&a.current.files&&t(a.current.files[0])};return i.a.createElement("button",{className:"button import-button"},i.a.createElement("label",null,n,i.a.createElement("input",{type:"file",accept:".png, .jpg, .jpeg, .bmp, .pal",ref:a,onChange:o})))};function $(e,t){var n=t.getContext("2d");if(n)for(var a=0;a<v;a++){var r=e[a];n.fillStyle="rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")"),n.fillRect(a%16,Math.floor(a/16),1,1)}else console.error("Failed to get Palette hidden canvas context!")}var ee=192,te=192,ne=ee/16,ae=function(e){return function(e){var t=e.x;return 16*e.y+t}(function(e){var t=e.x,n=e.y;return{x:Math.floor(t/ne),y:Math.floor(n/ne)}}(e))};var re=function(e){var t=e.palette,n=e.selectedColorIndex,a=e.onChangeSelectedColorIndex,o=Object(r.useState)(),c=Object(d.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(),m=Object(d.a)(u,2),h=m[0],w=m[1],f=Object(r.useRef)(null),v=Object(r.useCallback)((function(){if(f.current&&h){var e=f.current.getContext("2d");e&&e.drawImage(h.getCanvasElement(),0,0,te*window.devicePixelRatio,ee*window.devicePixelRatio)}}),[h]),p=Object(r.useCallback)((function(){if(f.current&&s){var e=f.current.getContext("2d");e&&($(t,s),e.drawImage(s,0,0,te*window.devicePixelRatio,ee*window.devicePixelRatio))}}),[t,s]),b=Object(r.useCallback)((function(e){if(f.current){var t=f.current.getContext("2d");if(t){t.beginPath(),t.strokeStyle="rgba(255, 255, 0, 1)",t.lineWidth=2;var n=window.devicePixelRatio*ne;t.rect(function(e){return e%16}(e)*n,function(e){return Math.floor(e/16)}(e)*n,n,n),t.stroke()}}}),[f]);return Object(r.useEffect)((function(){console.log("Setting up palette canvas");f.current&&function(e){var t=window.devicePixelRatio||1;e.width=e.clientWidth*t,e.height=e.clientHeight*t;var n=e.getContext("2d");n&&(n.imageSmoothingEnabled=!1)}(f.current);var e={pixelGrid:new A(g,8),hiddenCanvas:B(g)},t=e.pixelGrid;l(e.hiddenCanvas),w(t)}),[]),Object(r.useEffect)((function(){p(),v(),b(n)}),[n,p,v,b]),i.a.createElement("canvas",{ref:f,onClick:function(e){a(ae(function(e){if(f.current){var t=f.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}return{x:-1,y:-1}}(e)))},className:"palette-canvas"})};var ie=function(e){var t=e.handleQuantize,n=Object(r.useState)(15),a=Object(d.a)(n,2),o=a[0],c=a[1];return i.a.createElement("div",{className:"quantize-container"},i.a.createElement("button",{className:"quantize-button",onClick:function(){o?t(o):alert("Can't quantize with unspecified color depth!")}},"Quantize"),i.a.createElement("input",{className:"quantize-input",type:"number",value:o,min:1,max:256,onChange:function(e){return c(parseInt(e.target.value))}}))};function oe(e){var t=e.palette,n=e.selectedColorIndex,a=e.onChangeSelectedColorIndex,r=e.onChangeColor,o=e.handleQuantize;return i.a.createElement("div",null,i.a.createElement("div",{className:"panel-label"},"Color Palette"),i.a.createElement("div",{className:"palette-container"},i.a.createElement(re,{palette:t,selectedColorIndex:n,onChangeSelectedColorIndex:a})),i.a.createElement(se,{currentColor:t[n],onChangeColor:r}),i.a.createElement(ie,{handleQuantize:o}))}var ce=function(e){var t=8*(e.r+1)-1,n=8*(e.g+1)-1,a=8*(e.b+1)-1;return new w(t,n,a,1)};function se(e){var t=e.currentColor,n=e.onChangeColor,a=function(e){var t=Math.ceil((e.r+1)/8)-1,n=Math.ceil((e.g+1)/8)-1,a=Math.ceil((e.b+1)/8)-1;return new w(t,n,a,1)}(t);return i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("label",null,"R"),i.a.createElement("input",{type:"number",max:"31",min:"0",value:a.r,onChange:function(e){return function(e){a.r=e;var t=ce(a);n(t)}(parseInt(e.target.value))}})),i.a.createElement("div",null,i.a.createElement("label",null,"G"),i.a.createElement("input",{type:"number",max:"31",min:"0",value:a.g,onChange:function(e){return function(e){a.g=e;var t=ce(a);n(t)}(parseInt(e.target.value))}})),i.a.createElement("div",null,i.a.createElement("label",null,"B"),i.a.createElement("input",{type:"number",max:"31",min:"0",value:a.b,onChange:function(e){return function(e){a.b=e;var t=ce(a);n(t)}(parseInt(e.target.value))}})))}var le=n(20),ue=n(8),de=n(15),me=n(7);function he(e){var t=e.state,n=e.onClick,a=e.children;return i.a.createElement("button",{className:t?"toggle-on":"toggle-off",onClick:function(){return n(!t)}},a)}function we(e){var t=e.settings,n=e.onSettingsChange,a=e.onToolChange;return i.a.createElement("div",null,i.a.createElement("div",{className:"heading"},"Tools"),i.a.createElement(he,{state:t.currentTool===f.PENCIL,onClick:function(){return a(f.PENCIL)}},i.a.createElement(me.a,{icon:ue.f})),i.a.createElement(he,{state:t.currentTool===f.BUCKET,onClick:function(){return a(f.BUCKET)}},i.a.createElement(me.a,{icon:ue.d})),i.a.createElement(he,{state:t.currentTool===f.SQUARE,onClick:function(){return a(f.SQUARE)}},i.a.createElement(me.a,{icon:de.c})),i.a.createElement(he,{state:t.currentTool===f.ELLIPSE,onClick:function(){return a(f.ELLIPSE)}},i.a.createElement(me.a,{icon:de.a})),i.a.createElement(he,{state:t.currentTool===f.ZOOM,onClick:function(){return a(f.ZOOM)}},i.a.createElement(me.a,{icon:ue.g})),i.a.createElement(he,{state:t.currentTool===f.PAN,onClick:function(){return a(f.PAN)}},i.a.createElement(me.a,{icon:de.b})),i.a.createElement(he,{state:t.currentTool===f.DROPPER,onClick:function(){return a(f.DROPPER)}},i.a.createElement(me.a,{icon:ue.c})),i.a.createElement("div",{className:"heading"},"View"),i.a.createElement(he,{state:t.grid,onClick:function(){var e=Object(le.a)({},t);e.grid=!t.grid,n(e)}},i.a.createElement(me.a,{icon:ue.a})),i.a.createElement(he,{state:!1,onClick:function(){return null}},i.a.createElement(me.a,{icon:ue.e})),i.a.createElement(he,{state:!1,onClick:function(){return null}},i.a.createElement(me.a,{icon:ue.b})),i.a.createElement("div",{className:"heading"},"Settings"),i.a.createElement("div",null,"Mode: ",t.mode,i.a.createElement("br",null),t.editorMode.toString()))}function fe(e){var t=e.label,n=e.children,a=Object(r.useState)(!1),o=Object(d.a)(a,2),c=o[0],s=o[1];return i.a.createElement("div",{className:"dd-container"},i.a.createElement("button",{onClick:function(){return s(!c)},className:"dd-button"},t),i.a.createElement("div",{id:"myDropdown",className:c?"dd-content dd-show":"dd-content"},n))}function ge(e,t){return 1===(t.deltaY<0?-1:1)?1.1*e:e/1.1}var ve=function(){var e=Object(r.useState)(Z),t=Object(d.a)(e,2),n=t[0],o=t[1],c=Object(r.useState)(),s=Object(d.a)(c,2),m=s[0],h=s[1],w=Object(r.useState)(0),g=Object(d.a)(w,2),v=g[0],p=g[1],b=Object(r.useState)({grid:!0,currentTool:f.PENCIL,mode:3,editorMode:a.Bitmap}),x=Object(d.a)(b,2),E=x[0],C=x[1],O=Object(r.useReducer)(ge,8),y=Object(d.a)(O,2),N=y[0],j=y[1],P=Object(r.useCallback)((function(e){return j(e)}),[]),I=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("Loading image..."),e.next=4,U(t);case 4:n=e.sent,h(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=Object(r.useCallback)((function(e){C({grid:E.grid,currentTool:e,mode:E.mode,editorMode:E.editorMode})}),[E]),T=Object(r.useCallback)((function(e,t){C({grid:E.grid,currentTool:E.currentTool,mode:t,editorMode:e})}),[E]),R=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("Loading palette..."),e.next=4,H(t);case 4:(n=e.sent)&&(m instanceof J&&m.updatePalette(n),o(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,i,o,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="",a=m?m.fileName.slice(0,m.fileName.lastIndexOf(".")):"default",o=function(){return alert("Failed to export image! Check console for more information.")},e.t0=t,e.next="GBA"===e.t0?6:"PAL"===e.t0?16:"BMP"===e.t0?24:"PNG"===e.t0?32:40;break;case 6:if(m){e.next=9;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 9:return r=".c",c=new Blob([m.getCSourceData()]),Object(q.saveAs)(c,a+r),r=".h",s=new Blob([m.getHeaderData()]),Object(q.saveAs)(s,a+r),e.abrupt("return");case 16:if(n){e.next=21;break}return alert("Can't export a non-existant palette!"),e.abrupt("return");case 21:return r=".pal",i=new Blob([(l=n,function(e){var t="",n=1;return e.forEach((function(e){var a="0x00";a+=e.r<16?"0"+e.r.toString(16):e.r.toString(16),a+=e.g<16?"0"+e.g.toString(16):e.g.toString(16),a+=e.b<16?"0"+e.b.toString(16):e.b.toString(16),t+=a+"\t",4===n?(t+="\n",n=1):n++})),t}(l))]),e.abrupt("break",47);case 24:if(m){e.next=27;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 27:return r=".bmp",e.next=30,k(m,t);case 30:return i=e.sent,e.abrupt("break",47);case 32:if(m){e.next=35;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 35:return r=".png",e.next=38,k(m,t);case 38:return i=e.sent,e.abrupt("break",47);case 40:if(m){e.next=43;break}return alert("No image to export! Try importing one first."),e.abrupt("return");case 43:return r=".txt",e.next=46,k(m,t);case 46:i=e.sent;case 47:i?Object(q.saveAs)(i,a+r):o();case 48:case"end":return e.stop()}var l}),e)})));return function(t){return e.apply(this,arguments)}}(),A=Object(r.useCallback)((function(e){return C(e)}),[]);return i.a.createElement("div",{className:"app-container"},i.a.createElement("div",{className:"navbar"},i.a.createElement("span",{className:"title"},"VOCC"),i.a.createElement(fe,{label:"New"},i.a.createElement("div",{className:"dd-content-header"},"Bitmap"),i.a.createElement("button",{onClick:function(){return T(a.Bitmap,3)}},"Mode 3"),i.a.createElement("button",{onClick:function(){return T(a.Bitmap,4)}},"Mode 4"),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement("div",{className:"dd-content-header"},"Spritesheet"),i.a.createElement("button",{onClick:function(){return T(a.Spritesheet,4)}},"4 bpp"),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement("div",{className:"dd-content-header"},"Background"),i.a.createElement("button",{onClick:function(){return T(a.Background,0)}},"Mode 0")),i.a.createElement(fe,{label:"Edit"},i.a.createElement("button",{onClick:function(){return null}},"Undo"),i.a.createElement("button",{onClick:function(){return null}},"Redo"),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement("button",{onClick:function(){return null}},"Clear All")),i.a.createElement(fe,{label:"Import"},i.a.createElement("div",{className:"dd-content-header"},"Image"),i.a.createElement(X,{onFileChange:I,buttonLabel:"Image (*.png, *.bmp, *.jpg)"}),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement(X,{onFileChange:R,buttonLabel:"Palette (*.pal)"})),i.a.createElement(fe,{label:"Export"},i.a.createElement("div",{className:"dd-content-header"},"Image"),i.a.createElement(Y,{startImageExport:L.bind(null,"PNG"),buttonLabel:"PNG Image (*.png)"}),i.a.createElement(Y,{startImageExport:L.bind(null,"BMP"),buttonLabel:"Bitmap (*.bmp)"}),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement("div",{className:"dd-content-header"},"GBA"),i.a.createElement(Y,{startImageExport:L.bind(null,"GBA"),buttonLabel:"C Source Code (*.c/.h)"}),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement(Y,{startImageExport:L.bind(null,"PAL"),buttonLabel:"Color Palette (*.pal)"})),i.a.createElement(fe,{label:"Help"},i.a.createElement("form",null,i.a.createElement("button",{type:"submit",formAction:"",formTarget:""},"Documentation")),i.a.createElement("form",null,i.a.createElement("button",{type:"submit",formAction:"https://www.coranac.com/tonc/text/",formTarget:"_blank"},"GBA Graphics 101")),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement("form",null,i.a.createElement("button",{type:"submit",formAction:"",formTarget:""},"About VOCC")),i.a.createElement("div",{className:"dd-divider"}),i.a.createElement("form",null,i.a.createElement("button",{type:"submit",formAction:"https://github.com/lbussell/vocc",formTarget:"_blank"},"View on GitHub")))),i.a.createElement("div",{className:"workspace-container"},i.a.createElement("div",{className:"left-panel"},i.a.createElement("div",{className:"tools-container"},i.a.createElement(we,{settings:E,onSettingsChange:A,onToolChange:S})),m?i.a.createElement("div",null," Scale: ",N.toFixed(2),"x "):null),i.a.createElement("div",{className:"image-container"},m?i.a.createElement(K,{image:m,settings:E,palette:n,selectedPaletteIndex:v,scale:N,onMouseWheel:P}):i.a.createElement("div",{className:"start-message"},i.a.createElement("em",null,"Import an image to get started"))),i.a.createElement("div",{className:"right-panel"},i.a.createElement(oe,{palette:n,updatePalette:o,selectedColorIndex:v,onChangeSelectedColorIndex:function(e){p(e),m instanceof J&&m.setPaletteIndex(e)},onChangeColor:function(e){var t=n.slice();t[v]=e,m instanceof J&&m.updatePalette(t),o(t)},handleQuantize:function(e){if(e=Math.floor(e),m instanceof M){if(window.confirm("(Don't panic!) Quantizing a bitmap will change it from mode 3 to mode 4. Is this okay?")){var t=z(m,e),n=t.palette,a=t.sprite;h(a),o(n)}}else alert("Requantization of paletted images currently not supported!")}}))))},pe=(n(32),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function be(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(i.a.createElement(ve,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/vocc",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vocc","/service-worker.js");pe?(!function(e,t){fetch(e).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):be(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):be(t,e)}))}}()}},[[21,1,2]]]);
//# sourceMappingURL=main.1ed2df6c.chunk.js.map